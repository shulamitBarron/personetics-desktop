(function(window,Personetics,undefined){Personetics.processor=Personetics.processor||{};var templateDateRegex=/Date\s+([A-Za-z\.\[\]\(\)\'\,\_0-9]*)(?:\s+format='(.*)')?/;var templateEmojiRegex=/Emoji\s+([A-Za-z\.\[\]\(\)\'\,\_0-9]*)?/;var templateAmountRegex=/Amount\s+([A-Za-z\d\.\[\]\(\)\'\,\/\*\+\-]*)(?:\s+format='([#0,\.\+]*)')?(?:\s+currency='(.*)')?/;var templateStringRegex=/String\s+([A-Za-z\d\.\[\]\(\)\'\,\/\*\+\-]*)?(?:\s+maxLength='(.*)')?/;var nodeTypes=["BinaryExpression","UnaryExpression","Identifier","Literal","ArrayExpression","MemberExpression","CallExpression"];Personetics.processor.PExp=function PExp(expStr){this.str=this.compile(expStr);try{this.exp=jsep(this.str)}
catch(e){this.err(e,"PExp('"+this.str+"') Error -Invalid expression: '"+expStr+"'",!0)}};Personetics.processor.PExp.prototype.binops={"+":function(a,b){return a+b},"-":function(a,b){return a-b},"*":function(a,b){return a*b},"/":function(a,b){if(b==0)return 0;return a/b},"%":function(a,b){return a%b},"==":function(a,b){return a==b},"!=":function(a,b){return a!=b},"<":function(a,b){return a<b},"<=":function(a,b){return a<=b},">":function(a,b){return a>b},">=":function(a,b){return a>=b}};Personetics.processor.PExp.prototype.unops={"-":function(a){return-a},"+":function(a){return a}};Personetics.processor.PExp.prototype.compile=function compile(exp){var originalExp=exp;var dateMatch=exp.match(templateDateRegex);var value;var format;if(dateMatch){value=dateMatch[1];format=null;if(dateMatch.length>2&&dateMatch[2])
format="'"+dateMatch[2]+"'";exp="utils.formatDate("+value+","+format+")"}
var amountMatch=exp.match(templateAmountRegex);if(amountMatch){value=amountMatch[1];format=null;var currency=null;var amountMatch2=amountMatch[2];if(typeof amountMatch2!=='undefined'&&amountMatch2!==null&&amountMatch2.length>0)
format="'"+amountMatch[2]+"'";if(typeof amountMatch[3]!=='undefined'&&amountMatch[3]!==null)
currency=amountMatch[3];if(typeof currency=='string')
{currency=currency.replace(/^\s+|\s+$/g,'');if(currency===''){currency='""'}}
exp="utils.formatAmount("+value+", "+currency+", "+format+")";exp=originalExp.replace(templateAmountRegex,exp)}
var emojiMatch=exp.match(templateEmojiRegex);if(emojiMatch){exp="'{{"+exp+"}}'"}
var stringMatch=exp.match(templateStringRegex);var maxLength=null;if(stringMatch){value=stringMatch[1];var stringMatch2=stringMatch[2];if(typeof stringMatch2!=='undefined'&&stringMatch2!==null&&stringMatch2.length>0)
maxLength=stringMatch[2];exp="utils.limitString("+value+","+maxLength+")";exp=originalExp.replace(templateStringRegex,exp)}
return exp};Personetics.processor.PExp.prototype.eval=function(ctx,parentCtx,options){var errorObj=null;var hasError=!1;try{Personetics.log("PExp: attempting to evaluate expression: '"+this.str+"'");var result=this.evalNode(this.exp,ctx,parentCtx,options);if(typeof result==='undefined'||result===null){hasError=!0;errorObj=this.err(null,"PExp.eval('"+this.str+"') Error - Invalid result after evaluating expression: '"+result+"'",!1)}}
catch(e){hasError=!0;errorObj=this.err(e,"PExp.eval('"+this.str+"') Error - Could not evaluate expression",!1)}
if(hasError){this.err(errorObj,null,!0)}
else{var resStr=result;try{resStr=JSON.stringify(result)}
catch(e){resStr=result}
Personetics.log("Result: "+resStr);return result}};Personetics.processor.PExp.prototype.evalNode=function(node,ctx,parentCtx,options){var me=this;var val;if(node.type==="BinaryExpression"){var leftArg=this.evalNode(node.left,ctx,parentCtx,options);var rightArg=this.evalNode(node.right,ctx,parentCtx,options);val=this.binops[node.operator](leftArg,rightArg)}else if(node.type==="UnaryExpression"){val=this.unops[node.operator](this.evalNode(node.argument,ctx,parentCtx,options))}else if(node.type==="Identifier"){val=Personetics.processor.PUtils.getUtilsInstance(node.name,ctx,parentCtx);if(typeof val==="undefined"||val===null)
val=this.getChild(ctx,node.name,ctx,parentCtx,options);if(typeof parentCtx!=='undefined'&&parentCtx!==null){if(typeof val==='undefined'||val===null){val=this.getChild(parentCtx,node.name,ctx,parentCtx,options)}}}else if(node.type==="Literal"){val=node.value}else if(node.type==="ArrayExpression"){var arr=[];for(key in node.elements){var item=node.elements[key];var arrVal=me.evalNode(item,ctx,parentCtx,options);arr.push(arrVal)}
val=arr}else if(node.type==="MemberExpression"){var obj=this.evalNode(node.object,ctx,parentCtx,options);if(node.property.type=="Identifier")
val=this.getChild(obj,node.property.name,ctx,parentCtx,options);else{var prop=this.evalNode(node.property,obj,parentCtx,options);val=this.getChild(obj,prop,options,ctx,parentCtx,options)}
if(typeof(val)=='function'){var bfunc=new PBoundFunction(obj,val);val=bfunc}}else if(node.type==="CallExpression"){var callee=this.evalNode(node.callee,ctx,parentCtx,options);var args=[];for(var key in node.arguments){var arg=node.arguments[key];var argVal=me.evalNode(arg,ctx,parentCtx,options);args.push(argVal)}
if(!callee||!PBoundFunction.prototype.isPrototypeOf(callee))
this.err({"message":"TypeError: Cannot find function '"+node.callee.property.name+"' of '"+node.callee.object.name+"'"},null,!0);val=callee.call(args)}
return val};Personetics.processor.PExp.prototype.getChild=function(obj,prop,ctx,parentCtx,options){if(!obj)
return obj;var child;if(Personetics.processor.PDataSource.prototype.isPrototypeOf(obj))
child=obj.get(prop,options);if(!child)
child=obj[prop];if(this.isNode(child)){child=this.evalNode(child,ctx,parentCtx,options)}
return child};Personetics.processor.PExp.prototype.isNode=function(node){var isNode=!1;if(node&&node.hasOwnProperty("type")){var type=node.type;isNode=nodeTypes.indexOf(type)>=0}
return isNode};Personetics.processor.PExp.prototype.err=function err(e,errorMessage,throwException){throwException=typeof throwException!=='undefined'&&throwException!==null&&throwException!=!1;var msg=null;var stack=null;if(typeof e!=='undefined'&&e!==null){if(typeof e==="object"){if(e.hasOwnProperty("message"))
msg=e.message;if(e.hasOwnProperty("stack"))
stack=e.stack}
else if(typeof e==="string"){msg=e}}
errorMessage=errorMessage?msg?errorMessage+"\n\t Error message: "+msg:errorMessage:msg?msg:"";var errorObj={message:errorMessage,stack:stack};if(throwException)
throw errorObj;else{return errorObj}};var PExpCtx=function PExpCtx(parent){this.parent=parent};PExpCtx.prototype.get=function(name){};PExpCtx.prototype.getParent=function(){};var PObjWrapper=function PObjWrapper(obj){this.obj=obj};PObjWrapper.get=function(name){};var PBoundFunction=function PBoundFunction(obj,func){if(!obj)
throw "No obj provided to bound function";this.obj=obj;this.func=func};PBoundFunction.prototype.call=function(args){return this.func.apply(this.obj,args)}})(window,window.Personetics=window.Personetics||{});(function(window,Personetics,undefined){var pUtils=function(){this._instance={};this.utilsFactory={"utils":utils,"dateUtils":date,"amountUtils":amount}};pUtils.prototype.getUtilsInstance=function(instanceName,context,parentContext){if(this.utilsFactory.hasOwnProperty(instanceName)){if(!this._instance.hasOwnProperty(instanceName)){var clazz=this.utilsFactory[instanceName];this._instance[instanceName]=new clazz(context,parentContext)}
else{var myUtils=this._instance[instanceName];if(typeof myUtils.context=='undefined'||myUtils.context==null)
myUtils.setContext(context,parentContext)}}
return this._instance[instanceName]};var amount=function(context,parentContext){this.context=context;this.parentContext=parentContext};amount.prototype.setContext=function(context,parentContext){this.context=context||this.context;this.parentContext=parentContext||this.parentContext};var date=function(context,parentContext){this.context=context;this.parentContext=parentContext;this.monthNumbers=[1,2,3,4,5,6,7,8,9,10,11,12];this.monthNames={"en-short":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],en:["January","February","March","April","May","June","July","August","September","October","November","December"],he:["ינואר","פברואר","מרץ","אפריל","מאי","יוני","יולי","אוגוסט","ספטמבר","אוקטובר","נובמבר","דצמבר"],"he-short":["ינו","פבר","מרץ","אפר","מאי","יונ","יול","אוג","ספט","אוק","נוב","דצמ"],"es-short":["Ene","Feb","Mar","Abr","May","Jun","Jul","Ago","Sep","Oct","Nov","Dic"],"es":["enero","febrero","marzo","abril","mayo","junio","julio","agosto","septiembre","octubre","noviembre","diciembre"],"fr":["Janvier","Février","Mars","Avril","Mai","Juin","Juillet","Août","Septembre","Octobre","Novembre","Décembre"],"fr-short":["Jan","Fév","Mar","Avr","Mai","Jun","Jul","Aoû","Sep","Oct","Nov","Déc"]}};date.prototype.getMonthName=function(lang){var names=this.monthNames[lang];if(!names){names=this.monthNames.en}
return names}
date.prototype.getMonthNumber=function(lang,monthName){return this.monthNames[lang].indexOf(monthName.replace(/'/gi,''))}
date.prototype.setContext=function(context,parentContext){this.context=context||this.context;this.parentContext=parentContext||this.parentContext};date.prototype.getday=function(dateStr,modifier){return this.getDay(dateStr,modifier)};date.prototype.getDay=function(dateStr,modifier){var result;Personetics.verbose("Calling dateUtils.getDay("+dateStr+", "+modifier+")");var parsedDateStr=dateStr.split('.')[0].replace(/T/g,' ');parsedDateStr=parsedDateStr.split('-').join('/');dateStr=(isNaN(Date.parse(parsedDateStr)))?dateStr:parsedDateStr;var d=new Date(dateStr);var day=d.getDate();var parsedModifier=parseInt(modifier);if(!isNaN(parsedModifier)){d.setDate(day+parsedModifier);result=d.getDate()}
else{result=day}
Personetics.verbose("Result: "+result);return result};date.prototype.getmonth=function(dateStr,modifier){return this.getMonth(dateStr,modifier)};date.prototype.getMonth=function(dateStr,modifier){var result;Personetics.verbose("Calling dateUtils.getMonth("+dateStr+", "+modifier+")");var parsedDateStr=dateStr.split('.')[0].replace(/T/g,' ');parsedDateStr=parsedDateStr.split('-').join('/');dateStr=(isNaN(Date.parse(parsedDateStr)))?dateStr:parsedDateStr;var d=new Date(dateStr);var month=d.getMonth();if(month!=undefined&&month!=null&&!isNaN(month)){month=d.getMonth()+1}
else{try{if(typeof dateStr==='string'){if(!isNaN(dateStr)){month=parseInt(dateStr)}}
else month=dateStr}catch(e){Personetics.verbose("dateUtils.getMonth(): invalid input + '"+dateStr+"'");return dateStr}}
if(modifier){var place=month+modifier;var monthNumbersLength=this.monthNumbers.length;if(place>=monthNumbersLength){place-=monthNumbersLength}
else if(place<=0){place=monthNumbersLength+place}
result=place}
else{result=month}
Personetics.verbose("Result: "+result);return result};date.prototype.getdatemonth=function(dateStr,modifier){return this.getDateMonth(dateStr,modifier)};date.prototype.getDateMonth=function(dateStr,modifier){var result;Personetics.verbose("Calling dateUtils.getDateMonth("+dateStr+", "+modifier+")");var parsedDateStr=dateStr.split('.')[0].replace(/T/g,' ');parsedDateStr=parsedDateStr.split('-').join('/');dateStr=(isNaN(Date.parse(parsedDateStr)))?dateStr:parsedDateStr;var d=new Date(dateStr);var month=d.getMonth()+1;var year=d.getFullYear();var day=d.getDate();if(month==undefined&&month==null&&isNaN(month)){Personetics.verbose("dateUtils.getDateMonth(): invalid input + '"+dateStr+"'");return dateStr}
if(modifier){var newMonth=month+modifier;var monthNumbersLength=this.monthNumbers.length;if(newMonth>=monthNumbersLength){newMonth-=monthNumbersLength;year=year+1}
else if(newMonth<=0){newMonth=monthNumbersLength+newMonth;year=year-1}
if(newMonth<10)
newMonth='0'+newMonth;if(day<10)
day='0'+day;var newDate=year+'-'+newMonth+'-'+day;result=newDate}
else{result=dateStr}
Personetics.verbose("Result: "+result);return result};var utils=function(context,parentContext){this.context=context;this.parentContext=parentContext;this.monthNames={"en-short":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],en:["January","February","March","April","May","June","July","August","September","October","November","December"],he:["ינואר","פברואר","מרץ","אפריל","מאי","יוני","יולי","אוגוסט","ספטמבר","אוקטובר","נובמבר","דצמבר"],"he-short":["ינו'","פבר'","מרץ","אפר'","מאי","יונ'","יול'","אוג'","ספט'","אוק'","נוב'","דצמ'"],"es-short":["Ene","Feb","Mar","Abr","May","Jun","Jul","Ago","Sep","Oct","Nov","Dic"],"es":["enero","febrero","marzo","abril","mayo","junio","julio","agosto","septiembre","octubre","noviembre","diciembre"],"fr":["Janvier","Février","Mars","Avril","Mai","Juin","Juillet","Août","Septembre","Octobre","Novembre","Décembre"],"fr-short":["Jan","Fév","Mar","Avr","Mai","Jun","Jul","Aoû","Sep","Oct","Nov","Déc"]};this.weekDays={en:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],es:["Domingo","Lunes","Martes","Miércoles","Jueves","Viernes","Sábado"]};this.defaultCurrency="";this.tableJoinTypes={INNER:"INNER",LEFT:"LEFT"}};utils.prototype.setContext=function(context,parentContext){this.context=context||this.context;this.parentContext=parentContext||this.parentContext};utils.prototype.monthname=function(dateStr,short,lowerCase){return this.monthName(dateStr,short,lowerCase)};utils.prototype.monthName=function(dateStr,short,lowerCase){var result;Personetics.verbose("Calling utils.monthName("+dateStr+", "+short+","+lowerCase+")");if(!(parseInt(dateStr)==dateStr)){var d=new Date(dateStr);var month=d.getMonth();if(month!=undefined&&month!=null&&!isNaN(month)){month=d.getMonth()}}
else{try{var dn=parseInt(dateStr);if(dn>=1&&dn<=12){month=dn-1}
else{Personetics.log("utils.monthName(): invalid month number + '"+dateStr+"'");return dateStr}}catch(e){Personetics.log("utils.monthName(): invalid input + '"+dateStr+"'");return dateStr}}
var lang=Personetics.processor.PStoryConfig.getConfig("lang");if(short==!0||short=="MMM")
lang=lang+"-short";var names=this.monthNames[lang];if(!names){Personetics.verbose("utils.monthName(): month names not available + '"+names+"'");return dateStr}
result=names[month];if(lowerCase==!0){result=result.toLowerCase()}
Personetics.verbose("Result: "+result);return result};utils.prototype.dayname=function(dateStr,short){return this.dayName(dateStr,short)};utils.prototype.dayName=function(dateStr,short){var result="";if(!(parseInt(dateStr)==dateStr)){var d=new Date(dateStr);var weekday=d.getDay();if(weekday==undefined||weekday==null||isNaN(weekday)){Personetics.verbose("utils.dayName(): invalid weekday");return result}}
else{Personetics.verbose("utils.dayName(): invalid date + '"+dateStr+"'")}
var lang=Personetics.processor.PStoryConfig.getConfig("lang");var names=this.weekDays[lang];if(!names){Personetics.verbose("utils.dayName(): weekdays names are not available for "+lang);return result}
result=names[weekday];return result};utils.prototype.formatdate=function(dateStr,format,isAccessibilityFormat){return this.formatDate(dateStr,format,isAccessibilityFormat)};utils.prototype.formatDate=function formatDate(dateStr,format,isAccessibilityFormat){Personetics.verbose("Calling utils.formatDate("+dateStr+", "+format+")");if(typeof dateStr==='undefined'||dateStr===null||dateStr.length<=0)
throw{message:"utils.formatDate("+dateStr+", "+format+") Error: invalid dateStr parameter"};if(typeof format==="undefined"||format==null)
format=Personetics.processor.PStoryConfig.getConfig("dateFormat");var parsedDateStr=dateStr.split('.')[0].replace(/T/g,' ');parsedDateStr=parsedDateStr.split('-').join('/');dateStr=(isNaN(Date.parse(parsedDateStr)))?dateStr:parsedDateStr;var date=new Date(dateStr);var result=format;var arr=format.split(/[\s\/\\\-\:]/);var arr=format.match(/(dd|DD|d|mmmm|mmm|MMMMM|MMMM|MMM|mm|MM|m|M|YYYY|yy|YY|y|weekday)/g);var me=this;arr.forEach(function(dateFormatItem,index){var dateFormatValue=me.dateFormatToDate(dateFormatItem,date,dateStr);if(dateFormatValue){result=result.replace(dateFormatItem,dateFormatValue)}});if(isAccessibilityFormat){result=this.createAccessibleDateText(result,dateStr,format)}
Personetics.verbose("Result: "+result);return result};utils.prototype.dateFormatToDate=function(formatItem,date,dateStr){var result=null;switch(formatItem){case "d":var day=date.getDate()+'';result=day;break;case "dd":var day=date.getDate()+'';var suffix=day.substring(day.length-1);if(suffix=="1")
result=day+"st";else if(suffix=="2")
result=day+"nd";else if(suffix=="3")
result=day+"rd";else if(day=="11"||day=="12"||day=="13")
result=day+"th";else result=day+"th";break;case "DD":var day=date.getDate();if(day<10)
day="0"+day;result=day;break;case "mmmm":result=this.monthName(dateStr,!0,!0);break;case "m":case "MMMM":case "MMMMM":result=this.monthName(dateStr);break;case "M":case "MMM":result=this.monthName(dateStr,!0);break;case "mm":var monthNum=date.getMonth()+1;result=monthNum;break;case "MM":var monthNum=date.getMonth()+1;result=monthNum;if(monthNum<10)
result="0"+result;break;case "mmm":var monthNum=date.getMonth()+1;monthNum=monthNum+'';result=this.monthName(monthNum);break;case "y":case "YY":case "YYYY":result=date.getFullYear();break;case "yy":var fullYear=date.getFullYear().toString();result=fullYear.substring(2);break;case "weekday":result=this.dayName(dateStr);break;default:break}
return result};utils.prototype.createAccessibleDateText=function createAccessibleDateText(result,dateStr,format){accFormat=format.replace(/(mmm|MMM|mm|MM|m|M)/g,"m");accFormat=accFormat.replace(/DD/g,"dd");accFormat=accFormat.split(/[\/\\]/).join(' ');if(format===accFormat)
return result;var accText=this.formatdate(dateStr,accFormat);var res="<span class='perso-accessibility-wrapper' role='text'><span class='perso-accessibility-no-read' "+"aria-hidden='true'>"+result+"</span><span class='perso-accessibility-read'>"+accText+"</span></span>";return res};utils.prototype.numberWithCommas=function(x){return x.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")};utils.prototype.formatamount=function(amountStr,currency,format){return this.formatAmount(amountStr,currency,format)};utils.prototype.formatAmount=function(amountStr,currency,format){Personetics.verbose("Calling utils.formatAmount("+amountStr+", "+currency+", "+format+")");if(typeof amountStr==='undefined'||amountStr==null)
return null;amountStr=amountStr+'';format=typeof format==='undefined'||format===null?Personetics.processor.PStoryConfig.getConfig("amountFormat"):format;currency=typeof currency==='undefined'||currency===null||Personetics.processor.PStoryConfig.getConfig("useProjectDefaultCurrency")==!0?Personetics.processor.PStoryConfig.getConfig("currencySymbol"):currency;var minus="";var accessibilityMinus="";var formattedStr;var decimals='';var dot='';var isAbs=!1;var value;if(format){var matches=format.match(/0/g);var helper=format;var fixed=matches?matches.length:0;value=parseFloat(amountStr).toFixed(fixed);if(fixed>0){decimals=value.slice(fixed*-1);value=value.slice(0,fixed*-1);dot=value.slice(-1);value=value.slice(0,-1);helper=helper.slice(0,(fixed+1)*-1)}
matches=helper.match(/[,/.]/g);matches.reverse();var helper2=helper;var abs=format[0];if(abs=="+"){format=format.substring(1);isAbs=!0}
if(Array.isArray(matches)){matches.forEach(function(item,i){var valueLength=value.charAt(0)=="-"?value.length-1:value.length;var helperLength=helper.length;var helperIndex=helper.lastIndexOf(item);var index=helperLength-helperIndex-1;index=index+(helper2.length-helperLength);if(index>=valueLength){return!1}
index=index*-1;value=[value.slice(0,index),item,value.slice(index)].join('');helper=helper.slice(0,helperIndex)})}
formattedStr=value}
else{value=amountStr.replace(/\,/g,'');value=this.round(value);formattedStr=this.numberWithCommas(value)}
if(formattedStr.indexOf('-')>-1){formattedStr=formattedStr.substring(1);if(isAbs==!1){minus="-";accessibilityMinus="&minus;"}}
var resultStr;var amountAccessibilityString=accessibilityMinus+currency+formattedStr+dot+decimals;if(Personetics.processor.PStoryConfig.getConfig("supportHtmlTagInProcessor")==!1){resultStr=minus+currency+formattedStr+dot+decimals}
else{decimals="<span class='perso-decimals'>"+decimals+"</span>";currency="<span class='perso-currency'>"+currency+"</span>";formattedStr="<span class='perso-int-num'>"+formattedStr+"</span>";minus="<span class='perso-minus-sign'>"+minus+"</span>";dot="<span class='perso-decimals-dot'>"+dot+"</span>";if(Personetics.processor.PStoryConfig.isRtl())
resultStr="<span class='perso-amount' role='text' aria-label='"+amountAccessibilityString+"'>"+currency+minus+formattedStr+dot+decimals+"</span>";else resultStr="<span class='perso-amount' role='text' aria-label='"+amountAccessibilityString+"'>"+minus+currency+formattedStr+dot+decimals+"</span>"}
Personetics.verbose("Result: "+resultStr);return resultStr};utils.prototype.formatAmountInteger=function(amountStr,currency,format){Personetics.verbose("Calling utils.formatAmountInteger("+amountStr+", "+currency+", "+format+")");amountStr=amountStr+'';currency=typeof currency==='undefined'||currency===null?Personetics.processor.PStoryConfig.getConfig("currencySymbol"):currency;if(typeof currency==='undefined'||currency==null)
currency="";var value=amountStr.replace(/\,/g,'');value=parseInt(value);var resultStr;var unformattedStr=this.numberWithCommas(value);if(value<0)
resultStr="-"+currency+unformattedStr.substring(1);else resultStr=currency+unformattedStr;Personetics.verbose("Result: "+resultStr);return resultStr};utils.prototype.formatpercent=function formatpercent(amountStr){return this.formatPercent(amountStr)};utils.prototype.formatPercent=function formatPercent(amountStr){Personetics.verbose("Calling utils.formatPercent("+amountStr+")");var result=parseFloat(amountStr);result=result*100;result=Math.round(result);result+="%";Personetics.verbose("Result: "+amount);return result};utils.prototype.limitstring=function limitstring(string,maxLength){return this.limitString(string,maxLength)};utils.prototype.limitString=function limitString(string,maxLength){Personetics.verbose("Calling utils.limitString("+string+","+maxLength+")");var _numOfChars=maxLength||parseInt(Personetics.processor.PStoryConfig.getConfig("stringMaxLength"));var _ellipsisString='...';var result=string;if(string.length>_numOfChars)
result=string.substring(0,_numOfChars-(_ellipsisString.length))+_ellipsisString;return result};utils.prototype.round=function round(amount){Personetics.verbose("Calling utils.round("+amount+")");var numb=parseFloat(amount);numb=Math.round(numb);Personetics.verbose("Result: "+numb);return numb};utils.prototype.abs=function abs(x){Personetics.verbose("Calling utils.abs("+x+")");var result=null;if(typeof x!=='undefined'&&x!==null){if(typeof(x)=="string")
result=x.replace("-","");else result=x;result=Math.abs(result)}
Personetics.verbose("Result: "+result);return result};utils.prototype.highlighttext=function(value){return this.highlightText(value)};utils.prototype.highlightText=function(value){return'<span class="perso-highlight">'+value+'</span>'};utils.prototype.join=function join(leftTable,rightTable,conditionExpStr,type){var joinType=type||this.tableJoinTypes.INNER;var regexp=/(\w*)\.(\w*)([\=\!]+)(\w*)\.(\w*)/;var matches=conditionExpStr.match(regexp);if(matches){var leftTableName=matches[1];var leftColName=matches[2];var middlePart=matches[3];var rightTableName=matches[4];var rightColName=matches[5];var newExp="_JoinLeftTable.getValue(leftIndex,'"+leftColName+"')"+middlePart+"_JoinRightTable.getValue(rightIndex,'"+rightColName+"')";var leftSize=leftTable.size();var rightSize=rightTable.size();var cols=leftTable.data.cols;var colMap=leftTable.colMap;var colMapIndex=cols.length;if(Array.isArray(rightTable.data.cols)){var ar=rightTable.data.cols;ar.forEach(function(col,index){if(cols.indexOf(col)<0){cols.push(col);colMap[col]=colMapIndex;colMapIndex++}})}
var result={type:"PTable",cols:cols,rows:[]};var _context,_parentContext;var joinTables={_JoinLeftTable:leftTable,_JoinRightTable:rightTable};if(typeof(this.parentContext)!=='undefined'&&this.parentContext!=null){_parentContext=this.parentContext;_context=this.context;_context._JoinLeftTable=leftTable;_context._JoinRightTable=rightTable}
else{_parentContext=this.context;_context=joinTables}
for(var leftIndex=0;leftIndex<leftSize;leftIndex++){var foundValue=!1;for(var rightIndex=0;rightIndex<rightSize;rightIndex++){var exp=newExp.replace("leftIndex",leftIndex).replace("rightIndex",rightIndex);var conditionExp=new Personetics.processor.PExp(exp);try{var conditionValue=conditionExp.eval(_context,_parentContext)}
catch(e){throw{message:"utils.join() - Error: failed to evaluate join expression. Error message: "+e.message,stack:e.stack}}
if(conditionValue){foundValue=!0;var newRow=new Array(cols.length);for(var colName in colMap){if(colMap.hasOwnProperty(colName)){var colIndex=colMap[colName];var value=leftTable.getValue(leftIndex,colName);if(!value)
value=rightTable.getValue(rightIndex,colName);newRow[colIndex]=value}}
result.rows.push(newRow)}}
if(!foundValue&&joinType==this.tableJoinTypes.LEFT){var newRow=new Array(cols.length);for(var colName in colMap){if(colMap.hasOwnProperty(colName)){var colIndex=colMap[colName];var value=leftTable.getValue(leftIndex,colName);if(!value)
value=null;newRow[colIndex]=value}}
result.rows.push(newRow)}}
var ptable=new Personetics.processor.PTable(result);return ptable}
else return leftTable};Personetics.processor=Personetics.processor||{};Personetics.processor.PUtils=new pUtils()})(window,window.Personetics=window.Personetics||{});(function(window,Personetics,undefined){Personetics.processor=Personetics.processor||{};Personetics.processor.PStoryConfig=new function(){this.configMap={"dateFormat":"MM/DD/YY","amountFormat":"###,###,###","currencySymbol":"$","useProjectDefaultCurrency":!1,"lang":"en","supportHtmlTagInProcessor":"false","stringMaxLength":"15","context":"","serverCallBack":""};this.getConfig=function(configId){if(this.configMap.hasOwnProperty(configId)){return this.configMap[configId]}
return null};this.setConfig=function(configId,configValue){if(this.configMap.hasOwnProperty(configId)&&configValue!='undefined'&&configValue!=null){this.configMap[configId]=configValue}};this.rtlMap={"en":!1,"he":!0};this.isRtl=function(){var lang=this.configMap.lang;if(this.rtlMap.hasOwnProperty(lang)){return this.rtlMap[lang]}
return!1}}})(window,window.Personetics=window.Personetics||{});(function(window,Personetics,undefined){Personetics.processor=Personetics.processor||{};Personetics.processor.PDataSource=function PDataSource(data){this.data=data};Personetics.processor.PDataSource.prototype.getType=function(){return this.type};Personetics.processor.PDataSource.prototype.getData=function(){return this.data};Personetics.processor.PDataSource.prototype.get=function(name){var obj=this.data[name];if(!obj||!obj.type)
return obj;return obj};Personetics.processor.PDataSource.prototype.getChild=function(obj,prop){if(Personetics.processor.PDataSource.prototype.isPrototypeOf(obj))
return obj.get(prop);return obj[prop]}})(window,window.Personetics=window.Personetics||{});(function(window,Personetics,undefined){Personetics.processor=Personetics.processor||{};Personetics.processor.PFuture=function PFuture(){Personetics.processor.PDataSource.call(this,{type:"future",future:!0});this.type="future";this.future=!0};Personetics.processor.PFuture.prototype=Object.create(Personetics.processor.PDataSource.prototype);Personetics.processor.Future=new Personetics.processor.PFuture()})(window,window.Personetics=window.Personetics||{});(function(window,Personetics,undefined){Personetics.processor=Personetics.processor||{};Personetics.processor.POptionModel=function POptionModel(data,parentDataSource){Personetics.processor.PDataSource.call(this,data);this.filteredFields=data.whiteListFields;this.parentDataSource=parentDataSource};Personetics.processor.POptionModel.prototype=Object.create(Personetics.processor.PDataSource.prototype);Personetics.processor.POptionModel.prototype.get=function(name){if(!this.filteredFields||this.filteredFields.hasOwnProperty(name)){var filterName=this.filteredFields?this.filteredFields[name]:name;var value=Personetics.processor.PDataSource.prototype.get.call(this,filterName);if(!value)
value=this.parentDataSource.get(name);return value}
else{return"NOPE"}}})(window,window.Personetics=window.Personetics||{});(function(window,Personetics,undefined){Personetics.processor=Personetics.processor||{};var PTableMappingMethods={sum:{startValue:0,method:function(group,newValue){return group.value+newValue}},avg:{startValue:0,method:function(group,newValue){var oldSize=group.size-1;var oldAvg=group.value;var oldSum=oldSize*oldAvg;return(oldSum+newValue)/group.size}},count:{startValue:0,method:function(group,newValue){return group.size}},standardDeviation:{startValue:0,method:function(group,newValue,index,tableSize){if(group.size==1)
group.mem={items:[]};group.mem.items.push(newValue);if(index==tableSize-1){var variance;var dev;var avg;var sum=0;group.mem.items.forEach(group.mem.items,function(item,i){sum+=item});avg=sum/group.mem.items.length;group.mem.items.forEach(group.mem.items,function(item,i){var x=item-avg;dev+=Math.pow(x,2)});variance=dev/group.mem.items.length;return Math.sqrt(variance)}
else{return null}}},min:{},max:{}};var PTableTypes={PText:"PText"}
Personetics.processor.PTable=function PTable(data){Personetics.processor.PDataSource.call(this,data);this.name=data.name;this.colMap={};this.data={cols:[],rows:[]};this.attributesTypes=data.attributesTypes;this.filter.bind(this);this.loadTable(data)};Personetics.processor.PTable.prototype=Object.create(Personetics.processor.PDataSource.prototype);Personetics.processor.PTable.prototype.toString=function toString(){var result={name:this.name,cols:this.data.cols,rows:this.data.rows,attributesTypes:this.data.attributesTypes,type:this.data.type};return JSON.stringify(result)};Personetics.processor.PTable.prototype.loadTable=function loadTable(data){if(!data||data.future)
return;this.data=data;var colMap={};data.cols.forEach(function(header,i){colMap[header]=i});this.colMap=colMap};Personetics.processor.PTable.prototype.loadObjArray=function loadObjArray(objArray){if(!objArray)
return;var colMap={};var rows=[];var i=0;objArray.forEach(function(obj){for(var key in obj){if(obj.hasOwnProperty(key)){var colIndex=colMap[key];if(!colIndex){colIndex=i++;colMap[key]=colIndex}}}});this.colMap=colMap;var numCols=colMap.length;var cols=new Array(numCols);for(var key in colMap){if(colMap.hasOwnProperty(key)){var index=colMap[key];cols[index]=key}}
objArray.forEach(function(obj){var row=new Array(numCols);for(var key in obj){if(obj.hasOwnProperty(key)){var value=obj[key];var colIndex=colMap[key];row[colIndex]=value}}
rows.push(row)});this.data={cols:cols,rows:rows}};Personetics.processor.PTable.prototype.getObjArray=function getObjArray(){var arr=[];for(var row=0;row<this.getRowCount();row++){var obj={};for(var col=0;col<this.data.cols.length;col++){obj[this.data.cols[col]]=getResultByType(this.data,col,row)}
arr.push(obj)}
return arr};Personetics.processor.PTable.prototype.getColIndex=function getColIndex(name){return this.colMap[name]};Personetics.processor.PTable.prototype.size=function size(){var result;if(!this.data.hasOwnProperty("rows")){result=0}
else{result=this.data.rows.length}
Personetics.verbose("Calling '"+this.name+"'.size()");Personetics.verbose("Result: "+result);return result};Personetics.processor.PTable.prototype.getrowcount=function getrowcount(){return this.getRowCount()};Personetics.processor.PTable.prototype.getRowCount=function getRowCount(){var result=this.data.rows.length;Personetics.verbose("Calling '"+this.name+"'.getRowCount()");Personetics.verbose("Result: "+result);return result};Personetics.processor.PTable.prototype.getrow=function getrow(rowIndex){return this.getRow(rowIndex)};Personetics.processor.PTable.prototype.getRow=function getRow(rowIndex){var result=[];for(var i=0;i<this.data.rows[rowIndex].length;i++){result[i]=getResultByType(this.data,i,rowIndex)}
Personetics.verbose("Calling '"+this.name+"'.getRow("+rowIndex+")");Personetics.verbose("Result: "+JSON.stringify(result));return result};Personetics.processor.PTable.prototype.getfirstrows=function getfirstrows(numOfRows){return this.getFirstRows(numOfRows)};Personetics.processor.PTable.prototype.getFirstRows=function getFirstRows(numOfRows){Personetics.verbose("Calling '"+this.name+"'.getFirstRows("+numOfRows+")");var table=this;if(table.getRowCount()>numOfRows){var rows=table.data.rows.slice(0,numOfRows);var resultTable=new Personetics.processor.PTable({cols:table.data.cols,rows:rows,name:this.name+".getFirstRows("+numOfRows+")",attributesTypes:table.data.attributesTypes,type:table.data.type});Personetics.verbose("Result: "+resultTable.toString());return resultTable}
else{Personetics.verbose("Result: "+table.toString());return table}};Personetics.processor.PTable.prototype.getlastrows=function getlastrows(numOfRows){return this.getLastRows(numOfRows)};Personetics.processor.PTable.prototype.getLastRows=function getLastRows(numOfRows){Personetics.verbose("Calling '"+this.name+"'.getLastRows("+numOfRows+")");var table=this;if(table.getRowCount()>numOfRows){var rows=table.data.rows.slice(0-numOfRows);var resultTable=new Personetics.processor.PTable({cols:table.data.cols,rows:rows,name:this.name+".getLastRows("+numOfRows+")",attributesTypes:this.data.attributesTypes,type:this.data.type});Personetics.verbose("Result: "+resultTable.toString());return resultTable}
else{Personetics.verbose("Result: "+table.toString());return table}};Personetics.processor.PTable.prototype.getrowasobject=function getrowasobject(rowIndex){return this.getRowAsObject(rowIndex)};Personetics.processor.PTable.prototype.getRowAsObject=function getRowAsObject(rowIndex){Personetics.verbose("Calling '"+this.name+"'.getRowAsObject("+rowIndex+")");if(rowIndex<this.data.rows.length){var row=this.data.rows[rowIndex];var result={};for(var colName in this.colMap){if(this.colMap.hasOwnProperty(colName)){var index=this.colMap[colName];result[colName]=row[index]}}
Personetics.verbose("Result: "+JSON.stringify(result));return result}
else{Personetics.verbose("Result: ''");return''}};Personetics.processor.PTable.prototype.getvalue=function getvalue(rowIndex,colName){return this.getValue(rowIndex,colName)};Personetics.processor.PTable.prototype.getValue=function getValue(rowIndex,colName){Personetics.verbose("Calling '"+this.name+"'.getValue("+rowIndex+", "+colName+")");var size=this.size();if(this.colMap.hasOwnProperty(colName)&&size>rowIndex){var colIndex=this.colMap[colName];var result=getResultByType(this.data,this.colMap[colName],rowIndex);Personetics.verbose("Result: "+result);return result}
else{Personetics.verbose("Result: null");return null}};var getResultByType=function getResultByType(data,colIndex,rowIndex)
{var type=data.hasOwnProperty("attributesTypes")&&(typeof data.attributesTypes!=='undefined')&&(data.attributesTypes!==null)?data.attributesTypes[colIndex]:"";switch(type){case PTableTypes.PText:return getTextByLanguage(data.rows[rowIndex][colIndex]);default:return data.rows[rowIndex][colIndex]}};var getTextByLanguage=function getTextByLanguage(row)
{if(row===null||row===undefined)return row;if(row.hasOwnProperty(Personetics.processor.PStoryConfig.getConfig("lang"))){return row[Personetics.processor.PStoryConfig.getConfig("lang")]}
else{if(typeof row!=="object")
{return row}
var firstKey=(function getFirstKey(pTextObj){for(var key in pTextObj)return key})(row);if(firstKey){return row[firstKey]}}};Personetics.processor.PTable.prototype.filter=function filter(colName,validValue){Personetics.verbose("Calling '"+this.name+"'.filter("+colName+", "+validValue+")");if(!validValue||validValue=="all"){Personetics.verbose("No validValue or no filter. Result: "+this.toString());return this}
var rows=[];var i;for(i=0;i<this.getRowCount();i++){var val=this.getValue(i,colName);if(val==validValue)
rows.push(this.getRow(i))}
var table=new Personetics.processor.PTable({cols:this.data.cols,rows:rows,name:this.name+".filter("+colName+", "+validValue+")",attributesTypes:this.data.attributesTypes,type:this.data.type});Personetics.verbose("Result: "+table.toString());return table};Personetics.processor.PTable.prototype.filterbynumber=function filterbynumber(colName,validValue){return this.filterByNumber(colName,validValue)};Personetics.processor.PTable.prototype.filterByNumber=function filterByNumber(colName,validValue){if(arguments.length>2){var operator,amount;var exp=arguments[2];operator=exp;if(arguments.length>3){var exp2=arguments[3];amount=exp2}}
else{return this.filter(colName,validValue)}};var getBackdate=function getBackDate(currentDate,numOfDaysBack){var backdate=new Date(currentDate);var _numOfDaysBack=(numOfDaysBack)?numOfDaysBack:0;backdate=new Date(backdate.setDate(backdate.getDate()+_numOfDaysBack));var backdateObj=new Date(backdate.setHours(0,0,0,0));return backdateObj};Personetics.processor.PTable.prototype.filterByDays=function filterByDays(colName,currentDate,fromDate,toDate){var parsedDateStr=currentDate.split('.')[0].replace(/T/g,' ');parsedDateStr=parsedDateStr.split('-').join('/');currentDate=(isNaN(Date.parse(parsedDateStr)))?currentDate:parsedDateStr;Personetics.verbose("Calling '"+this.name+"'.filterByDays("+colName+", "+currentDate+", "+fromDate+", "+toDate+")");var _toDate=(typeof toDate!=='undefined'&&toDate!==null)?getBackdate(currentDate,toDate):getBackdate(currentDate,0);var _fromDate=getBackdate(currentDate,fromDate);var rows=[];for(var i=0;i<this.getRowCount();i++){var val=this.getValue(i,colName);var dateVal=new Date(val);dateVal.setHours(0,0,0,0);if(typeof dateVal==='object'&&dateVal<=_toDate&&dateVal>=_fromDate){rows.push(this.getRow(i))}}
var table=new Personetics.processor.PTable({cols:this.data.cols,rows:rows,name:this.name+".filterByDays("+colName+", "+currentDate+", "+fromDate+", "+toDate+")",attributesTypes:this.data.attributesTypes,type:this.data.type});Personetics.verbose("Result: "+table.toString());return table};Personetics.processor.PTable.prototype.groupby=function groupby(keyFieldNames,valueFieldName,mappingMethod){return this.groupBy(keyFieldNames,valueFieldName,mappingMethod)};Personetics.processor.PTable.prototype.groupBy=function groupBy(keyFieldNames,valueFieldName,mappingMethod){Personetics.verbose("Calling '"+this.name+"'.groupBy("+keyFieldNames+", "+valueFieldName+", "+mappingMethod+")");var mapping;if(mappingMethod&&PTableMappingMethods.hasOwnProperty(mappingMethod)){mapping=PTableMappingMethods[mappingMethod]}
else{mapping=PTableMappingMethods.sum}
if(!Array.isArray(keyFieldNames))
keyFieldNames=[keyFieldNames];var table=this;var cols=[];cols=cols.concat(keyFieldNames);cols.push(valueFieldName);var groupMap={};var tableSize=table.getRowCount();for(var i=0;i<tableSize;i++){var key="";var keyValues=[];var keyFieldValues=[];for(var keyField in keyFieldNames){if(keyFieldNames.hasOwnProperty(keyField)){keyField=keyFieldNames[keyField];var keyFieldValue=table.getValue(i,keyField);keyFieldValues.push(keyFieldValue);key+=keyFieldValue+","}}
var group=groupMap[key];if(!group){group={key:key,keyValues:keyFieldValues,value:mapping.startValue,size:0};groupMap[key]=group}
group.size++;var value=table.getValue(i,valueFieldName);value=Number(value);group.value=mapping.method(group,value,i,tableSize)}
var rows=[];for(group in groupMap){if(groupMap.hasOwnProperty(group)){var row=[];var groupValue=groupMap[group];for(j=0;j<keyFieldNames.length;j++){row.push(groupValue.keyValues[j])}
row.push(groupValue.value);rows.push(row)}}
var resultTable=new Personetics.processor.PTable({cols:cols,rows:rows,name:this.name+".groupBy("+keyFieldNames+", "+valueFieldName+", "+mappingMethod+")",attributesTypes:this.data.attributesTypes,type:this.data.type});Personetics.verbose("Result: "+resultTable.toString());return resultTable};Personetics.processor.PTable.prototype.groupByExpression=function groupByExpression(expression){Personetics.verbose("Calling '"+this.name+"'.groupByExpression("+expression+")");var exp=new Personetics.processor.PExp(expression);var objArray=this.getObjArray();var rows=this.data.rows;var cols=this.data.cols;var groups={};var me=this;if(Array.isArray(rows)){rows.forEach(function(row,index){var context=objArray[index];try{var key=exp.eval(context);if(!groups.hasOwnProperty(key)){groups[key]=[]}
groups[key].push(row)}
catch(e){Personetics.error(me.name+"'.groupByExpression("+expression+") Error: Failed to evaluate row "+index+", ignoring row")}})}
var tables=[];for(var key in groups){if(groups.hasOwnProperty(key)){var group=groups[key];var table=new Personetics.processor.PTable({cols:cols,rows:group,name:this.name+".groupByExpression("+expression+")",attributesTypes:this.data.attributesTypes,type:this.data.type});var resultTable={table:table,seriesName:key};tables.push(resultTable)}}
var res="[";var sep="";for(var k=0;k<tables;k++){sep=",";res+=sep+tables[k].toString()}
res+="]";Personetics.verbose("Result: "+res);return tables};Personetics.processor.PTable.prototype.sortbydate=function sortbydate(colNames,direction){return this.sortByDate(colNames,direction)};Personetics.processor.PTable.prototype.sortByDate=function sortByDate(colNames,direction){Personetics.verbose("Calling '"+this.name+"'.sortByDate("+colNames+", "+direction+")");var asc=1;if(direction){if(direction.toLowerCase()=="asc"){asc=1}
else if(direction.toLowerCase()=="desc"){asc=-1}}
var table=this;if(!Array.isArray(colNames))
colNames=[colNames];var cols=[];colNames.forEach(function(name){var col=table.colMap[name];cols.push(col)});var newRows=this.data.rows.slice(0);var length=newRows.length;var range;newRows.sort(function(a,b){for(var i=0;i<cols.length;i++){var col=cols[i];var valA=new Date(a[col]).getTime();var valB=new Date(b[col]).getTime();var val=valA-valB;if(val!=0){return asc*val}}
return 0});var resultTable=new Personetics.processor.PTable({cols:table.data.cols,rows:newRows,attributesTypes:table.data.attributesTypes,type:table.data.type});Personetics.verbose("Result: "+resultTable.toString());return resultTable};Personetics.processor.PTable.prototype.sortbymonth=function sortbymonth(colNames,direction){return this.sortByMonth(colNames,direction)};Personetics.processor.PTable.prototype.sortByMonth=function sortByMonth(colNames,direction){Personetics.verbose("Calling '"+this.name+"'.sortByMonth("+colNames+", "+direction+")");var table=this;if(!Array.isArray(colNames))
colNames=[colNames];var cols=[];colNames.forEach(function(name){var col=table.colMap[name];cols.push(col)});var newRows=this.data.rows.slice(0);var range;newRows.sort(function(a,b){for(var i=0;i<cols.length;i++){var col=cols[i];var valA=parseInt(a[col]);var valB=parseInt(b[col]);return valA-valB}
return 0});var range;var index=0;for(var i=1;i<newRows.length;i++){range=Math.abs(newRows[i][0]-newRows[i-1][0]);if(range>1){index=i;break}}
var finalRows;if(index>0){finalRows=newRows.slice(index);finalRows=finalRows.concat(newRows.slice(0,index))}else{finalRows=newRows}
if(direction&&direction.toLowerCase()=="desc"){finalRows.reverse()}
var resultTable=new Personetics.processor.PTable({cols:table.data.cols,rows:finalRows,name:this.name+".sortByMonth("+colNames+", "+direction+")",attributesTypes:table.data.attributesTypes,type:table.data.type});Personetics.verbose("Result: "+resultTable.toString());return resultTable};Personetics.processor.PTable.prototype.sortby=function sortby(colNames,direction,type){return this.sortBy(colNames,direction,type)};Personetics.processor.PTable.prototype.sortBy=function sortBy(colNames,direction,type){Personetics.verbose("Calling '"+this.name+"'.sortBy("+colNames+", "+direction+", "+type+")");var asc=1;if(direction){if(direction.toLowerCase()=="asc"){asc=1}
else if(direction.toLowerCase()=="desc"){asc=-1}}
var table=this;if(!Array.isArray(colNames))
colNames=[colNames];var cols=[];colNames.forEach(function(name){var col=table.colMap[name];cols.push(col)});var newRows=this.data.rows.slice(0);var length=newRows.length;var range;newRows.sort(function(a,b){for(var i=0;i<cols.length;i++){var col=cols[i];var valA=a[col];var valB=b[col];if(valA>valB)return asc;if(valA<valB)return-asc}
return 0});var resultTable=new Personetics.processor.PTable({cols:table.data.cols,rows:newRows,attributesTypes:table.data.attributesTypes,type:table.data.type});Personetics.verbose("Result: "+resultTable.toString());return resultTable};Personetics.processor.PTable.prototype.getasgroupedTable=function getasgroupedTable(valueFunc){return this.getAsGroupedTable(valueFunc)};Personetics.processor.PTable.prototype.getAsGroupedTable=function getAsGroupedTable(valueFunc){Personetics.verbose("Calling '"+this.name+"'.getAsGroupedTable("+valueFunc+")");var groups=[];var curGroup;var valToIndices={};var lastVal;if(Array.isArray(this.data.rows)){this.data.rows.forEach(function(row,i){var val=valueFunc(row).trim();var valIndex=valToIndices[val];if(typeof valIndex==='undefined'||valIndex===null){curGroup={encValue:Personetics.utils.string.stripSpecialChars(val),value:val,rows:[]};groups.push(curGroup);var index=groups.length-1;valToIndices[val]=index}
else{curGroup=groups[valIndex]}
var newRow=jQuery.extend({},row);curGroup.rows.push(newRow)})}
Personetics.verbose("Result: "+groups);return groups};Personetics.processor.PTable.prototype.max=function max(colName){Personetics.verbose("Calling '"+this.name+"'.max("+colName+")");var result=this.extremum(colName,function(extremeVal,val){return extremeVal<val},"max");Personetics.verbose("Result: "+result);return result};Personetics.processor.PTable.prototype.min=function min(colName){Personetics.verbose("Calling '"+this.name+"'.min("+colName+")");var result=this.extremum(colName,function(extremeVal,val){return extremeVal>val},"min");Personetics.verbose("Result: "+result);return result};Personetics.processor.PTable.prototype.extremum=function extremum(colName,isNewExtremeFunc,callingMethodName){if(this.getRowCount()==0)
return this;var colIndex=this.getColIndex(colName);var extremRow=this.data.rows[0];var extremVal=extremRow[colIndex];for(var i=0;i<this.getRowCount();i++){var row=this.data.rows[i];var val=row[colIndex];var floatExtremVal=typeof(extremVal)=='string'?parseFloat(extremVal):extremVal;var floatVal=typeof(val)=='string'?parseFloat(val):val;if(isNewExtremeFunc(floatExtremVal,floatVal)){extremVal=val;extremRow=row}}
var resultTable=new Personetics.processor.PTable({cols:this.data.cols,rows:[extremRow],name:this.name+"."+callingMethodName+"("+colName+", "+isNewExtremeFunc+")",attributesTypes:this.data.attributesTypes,type:this.data.type});return resultTable};Personetics.processor.PTable.prototype.addComputedCol=function addComputedCol(colName,expStr){var exp=new Personetics.processor.PExp(expStr);var newCols=this.data.cols.slice(0);newCols.push(colName);var newRows=[];var me=this;for(var i=0;i<this.getRowCount();i++){var row=this.data.rows[i];try{var val=exp.eval(row);var newRow=row.slice(0);newRow.push(val);newRows.push(newRow)}
catch(e){Personetics.error(me.name+"'.addComputedCol("+colName+", "+expStr+") Error: Failed to "+"valuate row "+i+", ignoring row")}}
var resultTable=new Personetics.processor.PTable({cols:newCols,rows:newRows,name:this.name+".addComputedCol("+colName+", "+expStr+")",attributesTypes:this.data.attributesTypes,type:this.data.type});return resultTable};Personetics.processor.PTable.prototype.map=function map(colName,mappingMethod,optStartVal){if(this.getRowCount()==0)
return optStartVal!=undefined?optStartVal:{};var colIndex=this.getColIndex(colName);var returnValue=optStartVal||0;for(var i=0;i<this.getRowCount();i++){returnValue=mappingMethod(returnValue,this.getValue(i,colName))}
return returnValue};Personetics.processor.PTable.prototype.sum=function(colName){Personetics.verbose("Calling '"+this.name+"'.sum("+colName+")");var result=this.map(colName,function(oldValue,newValue){var oldValueNum=oldValue;if(typeof oldValue==='string')
oldValueNum=parseFloat(oldValue);var newValueNum=newValue;if(typeof newValue==='string')
newValueNum=parseFloat(newValue);return oldValueNum+newValueNum},0);Personetics.verbose("Result: "+result);return result};Personetics.processor.PTable.prototype.avg=function(colName){Personetics.verbose("Calling '"+this.name+"'.avg("+colName+")");var result=0;if(this.getRowCount()>0){var sum=this.sum(colName);result=sum/this.getRowCount()}
Personetics.verbose("Result: "+result);return result};Personetics.processor.PTable.prototype.first=function first(colName){Personetics.verbose("Calling '"+this.name+"'.first("+colName+")");var result;var count=this.getRowCount();if(count>0){if(colName)
result=this.getValue(0,colName);else{var rows=[];rows.push(this.getRow(0));var table=new Personetics.processor.PTable({cols:this.data.cols,rows:rows,name:this.name+".first("+colName+")",attributesTypes:this.data.attributesTypes,type:this.data.type});result=table.getObjArray()[0]}}
else result=this;Personetics.verbose("Result: "+result);return result};Personetics.processor.PTable.prototype.last=function(colName){Personetics.verbose("Calling '"+this.name+"'.last("+colName+")");var result;var count=this.getRowCount();if(count>0){if(colName)
result=this.getValue(count-1,colName);else{var rows=[];rows.push(this.getRow(count-1));var table=new Personetics.processor.PTable({cols:this.data.cols,rows:rows,name:this.name+".last("+colName+")",attributesTypes:this.data.attributesTypes,type:this.data.type});result=table.getObjArray()[0]}}
else{if(colName){if(colName=="month"||colName=="amount")
return 0;else result=null}
else{result=null}}
Personetics.verbose("Result: "+result);return result};Personetics.processor.PTable.prototype.abs=function(colName){Personetics.verbose("Calling '"+this.name+"'.last("+colName+")");var i;var absRows=[];var colIndex=this.colMap[colName];for(i=0;i<this.getRowCount();i++){var currentRow=this.getRow(i);var absRow=[];for(var j=0;j<currentRow.length;j++){var value=currentRow[j];if(j==colIndex)
value=Math.abs(value);absRow.push(value)}
absRows.push(absRow)}
var result=new Personetics.processor.PTable({cols:this.data.cols,rows:absRows,name:this.name+".abs("+colName+")",attributesTypes:this.data.attributesTypes,type:this.data.type});return result}})(window,window.Personetics=window.Personetics||{});(function(window,Personetics,undefined){Personetics.processor=Personetics.processor||{};var PrimitiveFactTypes=["PNumber","PAmount","PDate","PString"];Personetics.processor.PFact=function PFact(data,dataType,formats){Personetics.processor.PTable.call(this,data);this.dataType=dataType;this.formats=formats;this.name=data.name;this.isPrimitive=PrimitiveFactTypes.indexOf(dataType)>=0};Personetics.processor.PFact.prototype=Object.create(Personetics.processor.PTable.prototype);Personetics.processor.PFact.prototype.get=function(key){var colName=key;if(this.isPrimitive)
colName="value";var value=this.getValue(0,colName);return value}})(window,window.Personetics=window.Personetics||{});(function(window,Personetics,undefined){Personetics.processor=Personetics.processor||{};Personetics.processor.PQuery=function PQuery(cfg,model){this.queryName=cfg.queryName;this.model=model;this.preQueryParams=cfg.queryParams;this.queryParams={};this.data=null;this.evalParams()};Personetics.processor.PQuery.prototype.evalParams=function(){var me=this;this.preQueryParams.forEach(function(paramObject,index){var paramName=paramObject.paramName;var varName=paramObject.varName;var exp=new Personetics.processor.PExp(varName);var val=exp.eval(me.model);if(val){me.queryParams[paramName]=val}})};Personetics.processor.PQuery.prototype.getCacheKey=function(){var cacheKey=this.queryName+"?";for(var key in this.queryParams){if(this.queryParams.hasOwnProperty(key)){cacheKey+=key+"="+this.queryParams[val]+"&"}}
return cacheKey};Personetics.processor.PQuery.prototype.getData=function(block){if(this.data)
return this.data;if(!personetics.pserverProxy)
return null;var query=this;personetics.getQueryData({id:block.story.insight.id,queryName:this.queryName,queryParams:this.queryParams},Personetics.bind(this,this.handleQuery));return Personetics.processor.Future};Personetics.processor.PQuery.prototype.handleQuery=function(data){this.model.handleQuery(this,data)}})(window,window.Personetics=window.Personetics||{});(function(window,Personetics,undefined){Personetics.processor=Personetics.processor||{};Personetics.processor.PModel=function PModel(parent,options){Personetics.processor.PDataSource.call(this,options.facts);this.initPModel(options.facts,options.expressions);this.parent=parent};Personetics.processor.PModel.prototype=Object.create(Personetics.processor.PDataSource.prototype);Personetics.processor.PModel.prototype.initPModel=function initPModel(facts,expressions){this.factsConfigs={};this.facts=facts;this.expressionsConfigs={};this.expressions=expressions;this.varCfgs={};this.varValues={};this.varValuesForSave={};this.queryCfgs={};this.queryCache={};this.exps={};this.cache={};this.setupObjFactory();mapObjects(this.facts,this.factsConfigs);mapObjects(this.expressions,this.expressionsConfigs);this.listeners=[]};Personetics.processor.PModel.prototype.setFormats=function(formats){this.formats=formats};Personetics.processor.PModel.prototype.setupObjFactory=function(){var model=this;this.objFactory={};this.objFactory.PTable=function(data){return new Personetics.processor.PTable(data)};this.objFactory.PObjList=function(data){var table=new Personetics.processor.PTable();table.loadObjArray(data);return table};this.objFactory.PFact=function(data,type){return new Personetics.processor.PFact(data,type,model.formats)}};Personetics.processor.PModel.prototype.createObj=function(type,data){var obj=data;var modelType=type;if(type!="PTable"&&type!="PObjList")
modelType="PFact";var creator=this.objFactory[modelType];if(creator)
obj=creator(data,type);if(obj.isPrimitive)
obj=obj.get();return obj};Personetics.processor.PModel.prototype.test=function(id){var val=this.get(id,{test:!0});return{success:val?!0:!1,value:val}};Personetics.processor.PModel.prototype.get=function(id,options){var errorMessage="";var hasError=!1;var val=this.cache[id];if(typeof val!=='undefined'&&val!==null)
return val;var varCfg=this.varCfgs[id];if(!val&&varCfg){val=this.getVarValue(id)}
var dataCfg=this.factsConfigs[id];if(!val&&dataCfg){val=dataCfg;if(typeof val==='undefined'||val===null){Personetics.log("PStoryModel.get('"+id+"') - Error: fact exists but is invalid: '"+val+"'. "+"Trying to evaluate as expression")}
else{if(dataCfg.type){val.name=id;val=this.createObj(dataCfg.type,val)}}}
var expDataCfg=this.expressionsConfigs[id];if(!val&&expDataCfg){try{val=jsep(expDataCfg)}
catch(e){Personetics.log("PStoryModel.get('"+id+"') Error - Invalid expression string: '"+expDataCfg+"'");val=null}
if(typeof val==='undefined'||val===null){Personetics.log("PStoryModel.get('"+id+"') - Error: expression exists but is invalid: '"+val+"'. "+"Trying to evaluate as expression")}}
if(typeof val==='undefined'||val===null){if(this.lastGetValue&&this.lastGetValue==id){this.lastGetValue=null;return null}
this.lastGetValue=id;var exp=new Personetics.processor.PExp(id);try{val=exp.eval(this,null,options);if(typeof val==='undefined'||val===null){hasError=!0;errorMessage="PStoryModel.get('"+id+"') - Error: Evaluating as expression returned an invalid result: '"+val+"'"}}
catch(e){val=null;hasError=!0;errorMessage="PStoryModel.get('"+id+"') Error: Failed to evaluate as expression: \n\t"+e.message}}
if(typeof val!=='undefined'&&val!==null){this.cache[id]=val}
else{Personetics.error(errorMessage,null,options)}
return val};Personetics.processor.PModel.prototype.fetchFromSrc=function(block,src){var errorMessage=null;var result=null;if(src=="query"){var queryObj=new Personetics.processor.PQuery({queryName:block.config.queryName,queryParams:block.config.queryParams},this);this.currentQueryBlock=block;return queryObj.getData(block)}
else{var exp=new Personetics.processor.PExp(src);try{result=exp.eval(this);if(typeof result==='undefined'||result===null){errorMessage=this.err(null,"PStoryModel.fetchFromSrc('"+src+"') - Error: Evaluating as "+"expression returned an invalid result: '"+result+"'",!1)}}
catch(e){errorMessage=this.err(e,"PStoryModel.fetchFromSrc('"+src+"') - Error: Failed to evaluate "+"source as expression \n\t"+e.message,!1)}
if(errorMessage){Personetics.error(errorMessage)}
return result}};Personetics.processor.PModel.prototype.getData=function(){return this.facts};Personetics.processor.PModel.prototype.setVarValue=function(key,value){var me=this;if(!this.varCfgs.hasOwnProperty(key))
this.varCfgs[key]=key;this.cache={};var valueToSet=value?value:null;this.varValues[key]=valueToSet;this.listeners.forEach(function(listenerObj,index){var listener=listenerObj.listener;var callback=listenerObj.callback;callback.call(listener,me.varValues)})};Personetics.processor.PModel.prototype.getVarValue=function(key){return this.varValues[key]};Personetics.processor.PModel.prototype.handleQuery=function(query,queryData){var params;if(typeof queryData!=='undefined'&&queryData!==null&&queryData.hasOwnProperty("story")){if(queryData.story.hasOwnProperty("insightFacts"))
params=queryData.story.insightFacts.query;else params=queryData.story.facts.query;params.name="query";var dataObj=this.createObj(queryData.type,params);query.data=dataObj;var cacheKey=query.getCacheKey();this.queryCfgs[cacheKey]=query;this.factsConfigs.query=dataObj;if(this.currentQueryBlock)
this.parent.handleQueryData(this.currentQueryBlock,dataObj)}
Personetics.error("Personetics.processor.PModel.prototype.handleQuery - Invalid query params: "+JSON.stringify(queryData))};Personetics.processor.PModel.prototype.err=function err(e,errorMessage,throwException){throwException=typeof throwException!=='undefined'&&throwException!==null&&throwException!=!1;var msg=null;var stack=null;if(typeof e!=='undefined'&&e!==null){if(typeof e==="object"){if(e.hasOwnProperty("message"))
msg=e.message;if(e.hasOwnProperty("stack"))
stack=e.stack}
else if(typeof e==="string"){msg=e}}
var result=errorMessage;if(msg&&msg.length>0)
result+=". Cause: "+msg;if(throwException)
throw{message:result,stack:stack};else return result+stack};Personetics.processor.PModel.prototype.addListener=function(listener,callback){this.listeners.push({listener:listener,callback:callback})};var mapObjects=function mapObjects(obj,objConfig){for(var key in obj){if(obj.hasOwnProperty(key)){objConfig[key]=obj[key]}}}})(window,window.Personetics=window.Personetics||{});(function(window,Personetics,undefined){Personetics.processor=Personetics.processor||{};var TemplateStartToken="{{";var TemplateEndToken="}}";var TemlateTokenRegex=/{{([^\n\t\v{}]*)}}/g;Personetics.processor.PTextTemplate=function PTextTemplate(textTemplate,globalContext){this.textTemplate=textTemplate;this.globalContext=globalContext;this.tokens={};this.compile()};Personetics.processor.PTextTemplate.prototype.compile=function(){if(this.textTemplate&&this.textTemplate.length>0){var me=this;var matches=this.textTemplate.match(TemlateTokenRegex);if(matches){matches.forEach(function(match,i){if(!me.tokens.hasOwnProperty(match)){var exp=match.replace(TemplateStartToken,"").replace(TemplateEndToken,"");var token={};token.str=exp;token.exp=new Personetics.processor.PExp(exp);me.tokens[match]=token}})}}};Personetics.processor.PTextTemplate.prototype.process=function(context,parentContext,block){var textTemplate=this.textTemplate;var tokens=this.tokens;var me=this;for(var tokenName in tokens){if(tokens.hasOwnProperty(tokenName)){var token=tokens[tokenName];var value;var data=context?context:me.globalContext;try{value=token.exp.eval(data,parentContext)}
catch(e){Personetics.error("PTextTemplate.process('"+this.textTemplate+"') - Error: Failed to evaluate "+"token '"+token.str+". Error message: "+e.message+e.stack);value="{{"+token.str+"}}"}
var tokenNameEscaped=tokenName.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&");var regexp=new RegExp(tokenNameEscaped,"g");textTemplate=textTemplate.replace(regexp,value)}}
return textTemplate};Personetics.processor.PTextTemplate.prototype.getTextTemplate=function(){return this.textTemplate}})(window,window.Personetics=window.Personetics||{});(function(window,Personetics,undefined){Personetics.processor=Personetics.processor||{};Personetics.processor.BlockProcessor=function BlockProcessor(parent,config,texts,model,dlgId,index){this.parent=parent;this.config=config;this.model=model;this.texts=texts;this.dlgId=dlgId;this.index=index};Personetics.processor.BlockProcessor.prototype.initProcessor=function(){};Personetics.processor.BlockProcessor.prototype.processData=function(){this.layoutInstructions=this.copyConfig(this.config);this.setDefaultSelectedValue();return this.layoutInstructions};Personetics.processor.BlockProcessor.prototype.processText=function(textId,context,parentContext){var pTxt=this.getText(textId);if(!pTxt)
return"-";return pTxt.process(context,parentContext,this)};Personetics.processor.BlockProcessor.prototype.getText=function(textId){var txt;if(this.texts&&this.texts.hasOwnProperty(textId)){txt=new Personetics.processor.PTextTemplate(this.texts[textId],this.model)}
return txt};Personetics.processor.BlockProcessor.prototype.getRealValue=function(simpleValue){return simpleValue};Personetics.processor.BlockProcessor.prototype.setSelectedValue=function(value){this.config.selected=value};Personetics.processor.BlockProcessor.prototype.handleQueryData=function handleQueryData(data){this.doProcessData(data)};Personetics.processor.BlockProcessor.doProcessData=function doProcessData(data){throw "Personetics.processor.BlockProcessor.doProcessData - Not implemented for block class '"+this.config.type+"'"};Personetics.processor.BlockProcessor.prototype.setDefaultSelectedValue=function(){var value=this.getRealValue(this.config.selected);this.parent.setBlockVarValue(this.config,value)};Personetics.processor.BlockProcessor.prototype.copyConfig=function copyConfig(obj){var result={};for(var key in obj){if(obj.hasOwnProperty(key)){var valueObj=obj[key];if(typeof valueObj!=='undefined'&&valueObj!==null){if(valueObj.constructor===[].constructor){var newAr=[];valueObj.forEach(function(item,index){newAr.push(item)});result[key]=newAr}
else if(valueObj.constructor=={}.constructor){var newObj=this.copyConfig(valueObj);result[key]=newObj}
else{result[key]=valueObj}}
else{result[key]=valueObj}}}
return result}})(window,window.Personetics=window.Personetics||{});(function(window,Personetics,undefined){Personetics.processor=Personetics.processor||{};Personetics.processor.TextBlockProcessor=function TextBlockProcessor(parent,config,texts,model,dlgId,index){Personetics.processor.BlockProcessor.call(this,parent,config,texts,model,dlgId,index)};Personetics.processor.TextBlockProcessor.prototype=Object.create(Personetics.processor.BlockProcessor.prototype);Personetics.processor.TextBlockProcessor.prototype.processData=function(){this.layoutInstructions=Personetics.processor.BlockProcessor.prototype.processData.call(this);var textConfig=this.config.txt||this.config.text;if(this.config.hasOwnProperty("txt"))
delete this.layoutInstructions.txt;if(this.config.hasOwnProperty("text"))
delete this.layoutInstructions.text;var txt=this.processText(textConfig,this.model);this.layoutInstructions.text=txt;return this.layoutInstructions}})(window,window.Personetics=window.Personetics||{});(function(window,Personetics,undefined){Personetics.processor=Personetics.processor||{};Personetics.processor.ImageBlock=function ImageBlock(parent,config,texts,model,dlgId,index){Personetics.processor.BlockProcessor.call(this,parent,config,texts,model,dlgId,index)};Personetics.processor.ImageBlock.prototype=Object.create(Personetics.processor.BlockProcessor.prototype);Personetics.processor.ImageBlock.prototype.processData=function(){this.layoutInstructions=Personetics.processor.BlockProcessor.prototype.processData.call(this);var imageSrc=this.processText(this.config.url,this.model);var altText=this.processText(this.config.alt,this.model);this.layoutInstructions.url=imageSrc;this.layoutInstructions.alt=altText;return this.layoutInstructions}})(window,window.Personetics=window.Personetics||{});(function(window,Personetics,undefined){Personetics.processor=Personetics.processor||{};var TYPES={STATIC:"static",NAVIGATE_TO_PAGE:"navigateToPage",DATA:"data"};Personetics.processor.OptionsProcessorBlock=function(parent,config,texts,model,dlgId,index){Personetics.processor.BlockProcessor.call(this,parent,config,texts,model,dlgId,index)};Personetics.processor.OptionsProcessorBlock.prototype=Object.create(Personetics.processor.BlockProcessor.prototype);Personetics.processor.OptionsProcessorBlock.prototype.processData=function(){this.layoutInstructions=Personetics.processor.BlockProcessor.prototype.processData.call(this);var me=this;this.layoutInstructions.options=[];var opts=this.config.options;if(!opts||opts.length==0)
return;this.selectedOptId=null;if(this.config.selected){if(this.config.selected.hasOwnProperty("id"))
this.selectedOptId=this.config.selected.id;else this.selectedOptId=this.config.selected}
this.hasSelected=!1;opts.forEach(function(opt,i){if(!opt.hasOwnProperty("type"))
opt.type="static";me.handleOption(opt)});this.setDefaultSelectedValue();return this.layoutInstructions};Personetics.processor.OptionsProcessorBlock.prototype.addStaticOption=function(opt,selectedOptId){var optObj={};optObj.id=this.getOptId(opt.id);optObj=this.addProperties(opt,optObj,selectedOptId);this.layoutInstructions.options.push(optObj)};Personetics.processor.OptionsProcessorBlock.prototype.addProperties=function(opt,optObj,selectedOptId){optObj.id=(typeof optObj.id==='undefined'||optObj.id==='-')?opt.id:optObj.id;optObj.selected=!1;if(optObj.id==selectedOptId){optObj.selected=!0;this.hasSelected=!0}
if(opt.hasOwnProperty('class')){optObj.class=opt.class}
var optModelObj=new Personetics.processor.POptionModel(opt,this.model);var optText=opt.txt||opt.text;optObj.text=this.processText(optText,optModelObj,this.model);if(typeof opt!=="undefined"&&opt!==null){for(var key in opt)
if(opt.hasOwnProperty(key)&&!optObj.hasOwnProperty(key))
optObj[key]=opt[key]}
return optObj};Personetics.processor.OptionsProcessorBlock.prototype.getOptId=function(optId){return this.processText(optId,this.model)};Personetics.processor.OptionsProcessorBlock.prototype.addDynamicOption=function(opt,selectedOptId){var me=this;if(opt.type==TYPES.DATA&&opt.src&&opt.src.length>0){var table=this.model.fetchFromSrc(this,opt.src);if(typeof table!=='undefined'&&table!==null){table=table.getObjArray();table.forEach(function(dataOpt){dataOpt.text=opt.text||opt.txt;var optObj={};optObj=me.addProperties(dataOpt,optObj,selectedOptId);me.layoutInstructions.options.push(optObj)})}}};Personetics.processor.OptionsProcessorBlock.prototype.getRealValue=function(simpleValue){var realValue=simpleValue;this.layoutInstructions.options.forEach(function(optObj,i){if(optObj.id==simpleValue){realValue=optObj;return!1}});return realValue};Personetics.processor.OptionsProcessorBlock.prototype.setSelectedValue=function(opt){var block=this;this.layoutInstructions.options.forEach(function(optObj,i){if(optObj.id==opt.id){optObj.selected=!0;block.config.selected=optObj}
else{optObj.selected=!1}})};Personetics.processor.OptionsProcessorBlock.prototype.handleOption=function(opt){var me=this;var typeHandled=!1;switch(opt.type){case TYPES.STATIC:me.addStaticOption(opt,me.selectedOptId);typeHandled=!0;break;case TYPES.DATA:me.addDynamicOption(opt,me.selectedOptId);typeHandled=!0;break;default:typeHandled=!1}
return typeHandled}})(window,window.Personetics=window.Personetics||{});(function(window,Personetics,undefined){Personetics.processor=Personetics.processor||{};var TYPES={NAVIGATE_TO_PAGE:"navigateToPage",TOGGLE:"toggle",PAYLOAD:"payload"};Personetics.processor.ButtonsProcessorBlock=function(parent,config,texts,model,dlgId,index){Personetics.processor.OptionsProcessorBlock.call(this,parent,config,texts,model,dlgId,index);this.isAllNavigateTo=!1};Personetics.processor.ButtonsProcessorBlock.prototype=Object.create(Personetics.processor.OptionsProcessorBlock.prototype);Personetics.processor.ButtonsProcessorBlock.prototype.processData=function(){var me=this;if(this.config.hasOwnProperty("buttonType")){var buttonType=this.config.buttonType;if(buttonType=="navigateTo"){this.isAllNavigateTo=!0}}
this.layoutInstructions=Personetics.processor.OptionsProcessorBlock.prototype.processData.call(this);this.layoutInstructions.id=this.config.index;if(this.layoutInstructions.hasOwnProperty("default"))
delete this.layoutInstructions["default"];if(this.layoutInstructions.hasOwnProperty("selected"))
delete this.layoutInstructions.selected;return this.layoutInstructions};Personetics.processor.ButtonsProcessorBlock.prototype.addProperties=function addProperties(opt,optObj,selectedOptId){optObj=Personetics.processor.OptionsProcessorBlock.prototype.addProperties.call(this,opt,optObj,selectedOptId);if(opt.type==TYPES.NAVIGATE_TO_PAGE&&opt.navigateTarget!=null&&opt.navigateTarget.length>0){if(typeof(optObj)!=="undefined"&&optObj!==null){optObj.navigateTarget=this.evalNavigateTarget(opt.navigateTarget);addPayloadToNavigateTo.call(this,opt,optObj)}}
if(this.isAllNavigateTo){if(typeof(optObj)!=="undefined"&&optObj!==null){optObj.navigateTarget=this.evalNavigateTarget(opt.id);addPayloadToNavigateTo.call(this,opt,optObj)}}
return optObj};function addPayloadToNavigateTo(preProccessOpt,newOpt){if(preProccessOpt.hasOwnProperty("payload")&&preProccessOpt.payload){var supportHtmlTagInProcessor=Personetics.processor.PStoryConfig.getConfig("supportHtmlTagInProcessor");Personetics.processor.PStoryConfig.setConfig("supportHtmlTagInProcessor",!1);newOpt.payload={};for(var key in preProccessOpt.payload){if(typeof preProccessOpt.payload[key]==="string"){newOpt.payload[key]=this.processText(preProccessOpt.payload[key],this.model)}else{newOpt.payload[key]={};processObjTexts.call(this,preProccessOpt.payload[key],newOpt.payload[key])}}
Personetics.processor.PStoryConfig.setConfig("supportHtmlTagInProcessor",supportHtmlTagInProcessor)}}
function processObjTexts(currentObj,newObj){for(var key in currentObj){if(typeof currentObj[key]==="string"){newObj[key]=this.processText(currentObj[key],this.model)}
else{newObj[key]={};processObjTexts.call(this,currentObj[key],newObj[key])}}}
Personetics.processor.ButtonsProcessorBlock.prototype.addToggleOption=function(opt,selectedOptId){if(typeof selectedOptId==='undefined'||selectedOptId===null||selectedOptId.length==0)
selectedOptId="off";this.hasSelected=!0;this.prepareToggleButton(opt,selectedOptId)};Personetics.processor.ButtonsProcessorBlock.prototype.addNavigateToOption=function(opt,selectedOptId){var optObj={};optObj.id=this.processText(opt.id,this.model);optObj=this.addProperties(opt,optObj,selectedOptId);this.layoutInstructions.options.push(optObj)};Personetics.processor.ButtonsProcessorBlock.prototype.evalNavigateTarget=function evalNavigateTarget(navIdExpStr){var navIdExp=new Personetics.processor.PExp(navIdExpStr);var navId;try{navId=navIdExp.eval(this.model,null,{shouldDisplayError:!1})}
catch(e){navId=navIdExpStr}
return navId};Personetics.processor.ButtonsProcessorBlock.prototype.prepareToggleButton=function(opt,selectedOptId){var txt;var toggleClass="perso-toggle";var onObj={type:opt.type};var offObj={type:opt.type};onObj.id="on";onObj.class=toggleClass;onObj.on=!0;onObj.off=!1;onObj.selected=selectedOptId=="on";var optionObj=new Personetics.processor.POptionModel(onObj,this.model);var onTxtId=opt.onTxt||opt.onText;txt=this.processText(onTxtId,optionObj);onObj.text=txt;this.layoutInstructions.options.push(onObj);offObj.id="off";offObj.class=toggleClass;offObj.on=!1;offObj.off=!0;offObj.selected=selectedOptId=="off";optionObj=new Personetics.processor.POptionModel(offObj,this.model);var offTxtId=opt.offTxt||opt.offText;txt=this.processText(offTxtId,optionObj);offObj.text=txt;this.layoutInstructions.options.push(offObj);this.model.varValuesForSave[this.config.var]=!0};Personetics.processor.ButtonsProcessorBlock.prototype.handleOption=function(option){var me=this;var isTypeHandled=!1;isTypeHandled=Personetics.processor.OptionsProcessorBlock.prototype.handleOption.call(this,option);if(!isTypeHandled){switch(option.type){case TYPES.TOGGLE:me.addToggleOption(option,me.selectedOptId);isTypeHandled=!0;break;case TYPES.NAVIGATE_TO_PAGE:case TYPES.PAYLOAD:me.addNavigateToOption(option,me.selectedOptId);isTypeHandled=!0;break;default:isTypeHandled=!1}}
return isTypeHandled}})(window,window.Personetics=window.Personetics||{});(function(window,Personetics,undefined){Personetics.processor=Personetics.processor||{};Personetics.processor.AccountSelectorProcessorBlock=function AccountSelectorProcessorBlock(parent,config,texts,model,dlgId,index){Personetics.processor.OptionsProcessorBlock.call(this,parent,config,texts,model,dlgId,index)};Personetics.processor.AccountSelectorProcessorBlock.prototype=Object.create(Personetics.processor.OptionsProcessorBlock.prototype);Personetics.processor.AccountSelectorProcessorBlock.prototype.processData=function(){this.config.options=[{type:'data',src:this.config.src,text:this.config.accountText}];if(this.config.showAll){var all={text:this.config.allAccountsText,id:'all',type:'static'};this.config.options.push(all)}
this.layoutInstructions=Personetics.processor.OptionsProcessorBlock.prototype.processData.call(this);delete this.layoutInstructions.src;delete this.layoutInstructions.allAccountsText;delete this.layoutInstructions.accountText;delete this.layoutInstructions.showAll;if(this.layoutInstructions.hasOwnProperty("default"))
delete this.layoutInstructions.default;if(this.layoutInstructions.hasOwnProperty("selected"))
delete this.layoutInstructions.selected;this.layoutInstructions.id=this.config.index;return this.layoutInstructions};Personetics.processor.AccountSelectorProcessorBlock.prototype.getOptId=function(optId){return optId}})(window,window.Personetics=window.Personetics||{});(function(window,Personetics,undefined){Personetics.processor=Personetics.processor||{};Personetics.processor.TextBoxesProcessorBlock=function(parent,config,texts,model,dlgId,index){Personetics.processor.OptionsProcessorBlock.call(this,parent,config,texts,model,dlgId,index)};Personetics.processor.TextBoxesProcessorBlock.prototype=Object.create(Personetics.processor.OptionsProcessorBlock.prototype);Personetics.processor.TextBoxesProcessorBlock.prototype.processData=function(){this.config.options=this.config.boxes;this.layoutInstructions=Personetics.processor.OptionsProcessorBlock.prototype.processData.call(this);this.layoutInstructions.options.forEach(function(opt){if(opt.selected){delete opt.selected}});delete this.layoutInstructions.boxes;return this.layoutInstructions};Personetics.processor.TextBoxesProcessorBlock.prototype.handleOption=function(opt){this.addStaticOption(opt,this.selectedOptId)};Personetics.processor.TextBoxesProcessorBlock.prototype.addStaticOption=function(opt,selectedOptId){var optObj={};var optModelObj=new Personetics.processor.POptionModel(optObj,this.model);optObj.label=this.processText(opt.label,optModelObj,this.model);if(opt.image){optObj.image=this.processText(opt.image,optModelObj,this.model);if(!this.layoutInstructions.hasOwnProperty("hasImage")){this.layoutInstructions.hasImage=!0}}
var optionObj=new Personetics.processor.POptionModel(opt,this.model);var valueExp=new Personetics.processor.PExp(opt.value);var value;try{value=valueExp.eval(optionObj)}
catch(e){Personetics.error("TextBoxesProcessorBlock.addStaticOption() Error: Failed to evaluate textBox value. "+"Error message: "+e.message+e.stack);value=opt.value}
optObj.value=value;this.layoutInstructions.options.push(optObj)}})(window,window.Personetics=window.Personetics||{});(function(window,Personetics,undefined){Personetics.processor=Personetics.processor||{};Personetics.processor.TabsProcessorBlock=function(parent,config,texts,model,dlgId,index){Personetics.processor.OptionsProcessorBlock.call(this,parent,config,texts,model,dlgId,index)};Personetics.processor.TabsProcessorBlock.prototype=Object.create(Personetics.processor.OptionsProcessorBlock.prototype);Personetics.processor.TabsProcessorBlock.prototype.processData=function(){this.config.options=this.config.tabs;this.layoutInstructions=Personetics.processor.OptionsProcessorBlock.prototype.processData.call(this);this.layoutInstructions.id=this.config.index;this.layoutInstructions.class=this.config.class||"perso-tabs";return this.layoutInstructions}})(window,window.Personetics=window.Personetics||{});(function(window,Personetics,undefined){Personetics.processor=Personetics.processor||{};Personetics.processor.HBoxBlock=function HBoxBlock(parent,config,texts,model,dlgId,index){Personetics.processor.BlockProcessor.call(this,parent,config,texts,model,dlgId,index);this.id="block-layout_"+config.index;this.index=config.index;this.columns=[];this.processorFactory=parent.processorFactory};Personetics.processor.HBoxBlock.prototype=Object.create(Personetics.processor.BlockProcessor.prototype);Personetics.processor.HBoxBlock.prototype.initProcessor=function(){Personetics.processor.BlockProcessor.prototype.initProcessor.call(this);var me=this;this.config.columns.forEach(function(columnConfig,index){var column={width:columnConfig.width,"v-align":columnConfig["v-align"],blocks:[]};if(columnConfig.hasOwnProperty("class"))
column.class=columnConfig.class;columnConfig.blocks.forEach(function(blockCfg,jndex){blockCfg.index=jndex;me.parent.evaluateDefault(blockCfg);var processor=me.parent.createProcessor(blockCfg,me.dlgId);column.blocks.push({processor:processor,config:blockCfg})});me.columns.push(column)})};Personetics.processor.HBoxBlock.prototype.processData=function(){this.layoutInstructions=Personetics.processor.BlockProcessor.prototype.processData.call(this);var me=this;this.layoutInstructions.columns=[];this.columns.forEach(function(column,index){var newColumn={width:column.width,"v-align":column["v-align"],blocks:[]};if(column.hasOwnProperty("class"))
newColumn.class=column.class;column.blocks.forEach(function(block,jndex){var processor=block.processor;var config=block.config;var show=!0;if(config.hasOwnProperty("showIf")&&config.showIf!==null&&config.showIf.length>0){var showIfExp=new Personetics.processor.PExp(config.showIf);try{show=showIfExp.eval(me.model)}
catch(e){show=!1;Personetics.error("HBoxBlock.processData() Error: Failed to evaluate showIf property, not showing block. Error Message: "+e.message+e.stack)}}
if(show){var blockData=processor.processData();newColumn.blocks.push(blockData)}});if(newColumn.blocks.length>0)
me.layoutInstructions.columns.push(newColumn)});return this.layoutInstructions}})(window,window.Personetics=window.Personetics||{});(function(window,Personetics,undefined){Personetics.processor=Personetics.processor||{};Personetics.processor.LayoutBlock=function LayoutBlock(parent,config,texts,model,dlgId,index){Personetics.processor.BlockProcessor.call(this,parent,config,texts,model,dlgId,index);this.id="block-layout_"+config.index;this.index=config.index;this.blocks=[];this.processorFactory=parent.processorFactory};Personetics.processor.LayoutBlock.prototype=Object.create(Personetics.processor.BlockProcessor.prototype);Personetics.processor.LayoutBlock.prototype.initProcessor=function(){Personetics.processor.BlockProcessor.prototype.initProcessor.call(this);var me=this;this.blocks=[];this.config.blocks.forEach(function(blockConfig,index){blockConfig.index=index;var processor=me.parent.createProcessor(blockConfig,me.dlgId);me.blocks.push({processor:processor,config:blockConfig})})};Personetics.processor.LayoutBlock.prototype.processData=function(){this.layoutInstructions=Personetics.processor.BlockProcessor.prototype.processData.call(this);var me=this;this.layoutInstructions.layout=this.config.layout;this.layoutInstructions.blocks=[];this.blocks.forEach(function(block,index){var newBlock={layout:block.layout};var processor=block.processor;var config=block.config;var show=!0;if(config.showIf){var showIfExp=new Personetics.processor.PExp(config.showIf);show=showIfExp.eval(me.model)}
if(show){var blockData=processor.processData();me.layoutInstructions.blocks.push(blockData)}});return this.layoutInstructions}})(window,window.Personetics=window.Personetics||{});(function(window,Personetics,undefined){Personetics.processor=Personetics.processor||{};Personetics.processor.DateBoxBlockProcessor=function DateBoxBlockProcessor(parent,config,texts,model,dlgId,index){Personetics.processor.BlockProcessor.call(this,parent,config,texts,model,dlgId,index)};Personetics.processor.DateBoxBlockProcessor.prototype=Object.create(Personetics.processor.BlockProcessor.prototype);Personetics.processor.DateBoxBlockProcessor.prototype.processData=function(){this.layoutInstructions=Personetics.processor.BlockProcessor.prototype.processData.call(this);var txt=this.processText(this.config.date,this.model);this.layoutInstructions.date=txt;return this.layoutInstructions}})(window,window.Personetics=window.Personetics||{});(function(window,Personetics,undefined){Personetics.processor=Personetics.processor||{};Personetics.processor.TableBlockProcessor=function TableBlockProcessor(parent,config,texts,model,dlgId,index){Personetics.processor.BlockProcessor.call(this,parent,config,texts,model,dlgId,index)};Personetics.processor.TableBlockProcessor.prototype=Object.create(Personetics.processor.BlockProcessor.prototype);Personetics.processor.TableBlockProcessor.prototype.processData=function processData(){var config=this.config;var src=config.src;var table=this.model.fetchFromSrc(this,src);if(table==Personetics.processor.Future){return{type:config.type,future:!0}}
else{return this.doProcessData(table)}};Personetics.processor.TableBlockProcessor.prototype.doProcessData=function doProcessData(table){this.layoutInstructions=Personetics.processor.BlockProcessor.prototype.processData.call(this);delete this.layoutInstructions.src;var rows=[];if(typeof table!=='undefined'&&table!==null&&table.hasOwnProperty("data")){this.layoutInstructions.rows=table.data.rows;this.layoutInstructions.cols=table.data.cols}
return this.layoutInstructions}})(window,window.Personetics=window.Personetics||{});(function(window,Personetics,undefined){Personetics.processor=Personetics.processor||{};Personetics.processor.BarBlockProcessor=function BarBlockProcessor(parent,config,texts,model,dlgId,index){Personetics.processor.BlockProcessor.call(this,parent,config,texts,model,dlgId,index)};Personetics.processor.BarBlockProcessor.prototype=Object.create(Personetics.processor.BlockProcessor.prototype);Personetics.processor.BarBlockProcessor.prototype.processData=function(){this.layoutInstructions=Personetics.processor.BlockProcessor.prototype.processData.call(this);var blockProcessor=this;var config=this.config;var src=config.src;var data=this.model.fetchFromSrc(this,src);this.layoutInstructions.direction=config.direction||"vertical";if(typeof data!=='undefined'&&data!==null){var categories=this.getCategories();var accessibilityCategories=this.getCategories();var series=config.series;if(series){var table=data.groupByExpression(series);var seriesLabels=this.getSeries();this.seriesLabels=seriesLabels;this.layoutInstructions.seriesLabels=seriesLabels;var arr=[];if(typeof seriesLabels!=='undefined'&&seriesLabels!==null&&seriesLabels.length>0){seriesLabels.forEach(function(series,i){var item=table.filter(function(tableRow){return tableRow.seriesName==series})[0];var row=[];if(typeof item!=='undefined'){row=item.table.getObjArray()}
var newItem=blockProcessor.prepareDataByCategories(row,categories);arr.push(newItem)})}
else{table.forEach(function(tableItem,index){var row=tableItem.table.getObjArray();var newItem=blockProcessor.prepareDataByCategories(row,categories);arr.push(newItem)})}
this.layoutInstructions.series=arr}
else{var rows=data.getObjArray();if(categories!=null){var newData=this.prepareDataByCategories(rows,categories)}
else{var newData=this.prepareData(rows)}
this.layoutInstructions.series=[newData];this.seriesLabels=[""]}}
if(this.layoutInstructions.hasOwnProperty("varSource"))
delete this.layoutInstructions.varSource;if(this.layoutInstructions.hasOwnProperty("default"))
delete this.layoutInstructions["default"];if(this.layoutInstructions.hasOwnProperty("selected"))
delete this.layoutInstructions.selected;if(this.layoutInstructions.hasOwnProperty("seriesNames"))
delete this.layoutInstructions.seriesNames;delete this.layoutInstructions.x;delete this.layoutInstructions.y;delete this.layoutInstructions.label;delete this.layoutInstructions.src;this.layoutInstructions.categories=this.categories;if(accessibilityCategories!=null)
accessibilityCategories.categoriesArray.forEach(function(item,index){var i=parseInt(item)-1;accessibilityCategories[index]=Personetics.processor.PUtils.getUtilsInstance("dateUtils").getMonthName(Personetics.processor.PStoryConfig.getConfig("lang"))[i]});else accessibilityCategories=this.layoutInstructions.categories;var accessCat=Object.keys(accessibilityCategories).map(function(key){return accessibilityCategories[key]});accessCat=accessCat.slice(0,accessCat.length-2);this.layoutInstructions.accessibilityCategories=accessCat;this.layoutInstructions.seriesLabels=this.seriesLabels;return this.layoutInstructions};Personetics.processor.BarBlockProcessor.prototype.prepareDataByCategories=function prepareDataByCategories(rows,categories){var blockProcessor=this;var config=this.config;var yFieldExp=new Personetics.processor.PExp(config.y);var xFieldExp=new Personetics.processor.PExp(config.x);var newData=[];this.categories=[];var categoriesKey=categories.key;categories.categoriesArray.forEach(function(category,index){var newItem={};newItem[categoriesKey]=category;newItem.amount=0;newItem.sum=0;rows.forEach(function(row,i){if(row[categoriesKey]==category){newItem=row;return!1}});var newRow=blockProcessor.prepareRow(newItem,xFieldExp,yFieldExp);newData.push(newRow)});return newData};Personetics.processor.BarBlockProcessor.prototype.prepareData=function prepareData(rows){var blockProcessor=this;var config=this.config;var yFieldExp=new Personetics.processor.PExp(config.y);var xFieldExp=new Personetics.processor.PExp(config.x);var newData=[];this.categories=[];rows.forEach(function(row,i){var newRow=blockProcessor.prepareRow(row,xFieldExp,yFieldExp);newData.push(newRow)});return newData};Personetics.processor.BarBlockProcessor.prototype.prepareRow=function prepareRow(row,xFieldExp,yFieldExp){var config=this.config;var newRow={};if(this.config.hasOwnProperty("label")){var label=this.processText(config.label,row,this.model);if(label!="-"){newRow.label=label.replace(/span/g,'tspan')}}
try{var yValue=yFieldExp.eval(row,this.model);newRow.value=yValue}
catch(e){Personetics.error("BarBlockProcessor.prepareRow() Error: failed to evaluate block.y expression. Error message: "+e.message+e.stack);newRow.value=null}
var xValue=null;try{xValue=xFieldExp.eval(row,this.model)}
catch(e){Personetics.error("BarBlockProcessor.prepareRow() Error: failed to evaluate block.x expression. Error message: "+e.message+e.stack)}
this.categories.push(xValue);if(config.hasOwnProperty("var")&&config.hasOwnProperty("default")){newRow.category=row[config.varSource];newRow.selected=!1;if(typeof config.selected!=='undefined'&&row[config.varSource]==config.selected){newRow.selected=!0}}
return newRow};Personetics.processor.BarBlockProcessor.prototype.getCategories=function getCategories(){var result=null;if(this.config.hasOwnProperty("categories")){var configCategories=this.config.categories;var categories=this.model.fetchFromSrc(this,configCategories);if(typeof categories!=='undefined'&&categories!==null){var categoriesArray=categories.getObjArray();var key=categories.data.cols[0];var seriesNamesValues=categoriesArray.map(function(a){return a[key]});result={categoriesArray:seriesNamesValues,key:key}}}
return result};Personetics.processor.BarBlockProcessor.prototype.getSeries=function getSeries(){var result=null;if(!this.config.hasOwnProperty("seriesNames")){Personetics.log("Personetics.processor.BarBlockProcessor - Error: missing 'seriesNames' block property")}
else{var seriesNames=this.model.fetchFromSrc(this,this.config.seriesNames);var seriesNamesArray=seriesNames.getObjArray();var key=seriesNames.data.cols[0];result=seriesNamesArray.map(function(a){return a[key]})}
return result}})(window,window.Personetics=window.Personetics||{});(function(window,Personetics,undefined){Personetics.processor=Personetics.processor||{};Personetics.processor.PieBlockProcessor=function PieBlockProcessor(parent,config,texts,model,dlgId,index){Personetics.processor.BlockProcessor.call(this,parent,config,texts,model,dlgId,index)};Personetics.processor.PieBlockProcessor.prototype=Object.create(Personetics.processor.BlockProcessor.prototype);Personetics.processor.PieBlockProcessor.prototype.processData=function(){this.layoutInstructions=Personetics.processor.BlockProcessor.prototype.processData.call(this);var blockProcessor=this;var config=this.config;var src=config.src;var data=this.model.fetchFromSrc(this,src);if(config.hasOwnProperty("centerText"))
var centerText=this.processText(config.centerText,this.model);if(centerText.length>0){this.layoutInstructions.centerText=centerText.replace(/span/g,'tspan')}
var selected=config.selected;var hasSelected=!1;if(typeof data!=='undefined'&&data!==null){var slices=data.getObjArray();slices.forEach(function(slice,index){slice.highlight=!1;if(typeof selected!=='undefined'&&selected!==null&&config.hasOwnProperty("varSource")&&(slice[config.varSource]==selected||(slice[config.varSource]!=undefined&&slice[config.varSource]==selected[config.varSource]))){slice.highlight=!0;hasSelected=!0}
if(config.hasOwnProperty("label")){var label=blockProcessor.processText(config.label,slice,blockProcessor.model);if(label.length>0&&label!="-")
slice.label=label.replace(/span/g,'tspan')}
if(slice.hasOwnProperty(config.sliceName)){var category=slice[config.sliceName];delete slice[config.sliceName];slice.category=category}
slice.value=slice[config.sliceValue]||slice.amount;slice.index=++index;delete slice[config.sliceValue]});this.layoutInstructions.slices=slices}
if(this.layoutInstructions.hasOwnProperty("varSource"))
delete this.layoutInstructions.varSource;if(this.layoutInstructions.hasOwnProperty("default"))
delete this.layoutInstructions["default"];if(this.layoutInstructions.hasOwnProperty("selected"))
delete this.layoutInstructions.selected;if(this.layoutInstructions.hasOwnProperty("seriesNames"))
delete this.layoutInstructions.seriesNames;delete this.layoutInstructions.sliceName;delete this.layoutInstructions.sliceValue;delete this.layoutInstructions.label;delete this.layoutInstructions.src;return this.layoutInstructions}})(window,window.Personetics=window.Personetics||{});(function(window,Personetics,undefined){Personetics.processor=Personetics.processor||{};Personetics.processor.PinBlockProcessor=function PinBlockProcessor(parent,config,texts,model,dlgId,index){Personetics.processor.BarBlockProcessor.call(this,parent,config,texts,model,dlgId,index)};Personetics.processor.PinBlockProcessor.prototype=Object.create(Personetics.processor.BarBlockProcessor.prototype)})(window,window.Personetics=window.Personetics||{});(function(window,Personetics,undefined){window.PBlockProcessorManager=new function(){var instance=null;this.getInstance=function getInstance(){if(instance==null){instance=new manager()}
return instance}};var manager=function manager(){this.dialogsToBlocksMap={};this.processorFactory={"txt":Personetics.processor.TextBlockProcessor,"text":Personetics.processor.TextBlockProcessor,"image":Personetics.processor.ImageBlock,"buttons":Personetics.processor.ButtonsProcessorBlock,"tabs":Personetics.processor.TabsProcessorBlock,"account-selector":Personetics.processor.AccountSelectorProcessorBlock,"textboxes":Personetics.processor.TextBoxesProcessorBlock,"h-box":Personetics.processor.HBoxBlock,"layout":Personetics.processor.LayoutBlock,"date-box":Personetics.processor.DateBoxBlockProcessor,"tranList":Personetics.processor.TableBlockProcessor,"bar-chart":Personetics.processor.BarBlockProcessor,"pie-chart":Personetics.processor.PieBlockProcessor,"arc-chart":Personetics.processor.PieBlockProcessor,"pin-graph":Personetics.processor.PinBlockProcessor,"pin-chart":Personetics.processor.PinBlockProcessor,"line-chart":Personetics.processor.LineBlockProcessor,"compare-block":Personetics.processor.CompareProcessorBlock}};manager.prototype.start=function start(options){this.storyDefinition=options.story;this.defaultLang="en";if(typeof options.customizationOptions!=='undefined'&&options.customizationOptions!==null){for(var key in options.customizationOptions)
{if(options.customizationOptions.hasOwnProperty(key)){Personetics.processor.PStoryConfig.setConfig(key,options.customizationOptions[key])}}}
this.texts=options.texts;this.model=new Personetics.processor.PModel(this,options);window.model=this.model;this.initProcessors()};manager.prototype.initProcessors=function initProcessors(){var me=this;this.storyDefinition.dialogs.forEach(function(dlgConfig,index){var dlgId=dlgConfig.id;me.dialogsToBlocksMap[dlgId]={};if(dlgConfig.hasOwnProperty("class")){me.dialogsToBlocksMap[dlgId]["class"]=dlgConfig.class}
dlgConfig.blocks.forEach(function(config,jndex){var type=config.type;var processor=me.createProcessor(config,dlgId,jndex);if(processor){me.dialogsToBlocksMap[dlgId][jndex]={processor:processor,previousData:null}}})})};manager.prototype.createProcessor=function createProcessor(config,dlgId,blockIndex){var type=config.type;var processorClass=this.processorFactory[type];if(processorClass){var texts=null;if(this.texts.hasOwnProperty(dlgId)){texts=this.texts[dlgId][this.defaultLang]||{};var lang=Personetics.processor.PStoryConfig.getConfig("lang");if(this.texts[dlgId].hasOwnProperty(lang)){var langTexts=this.texts[dlgId][lang];for(var textId in langTexts){if(langTexts.hasOwnProperty(textId))
texts[textId]=langTexts[textId]}}}
var processor=new processorClass(this,config,texts,this.model,dlgId,blockIndex);processor.initProcessor();return processor}
else{Personetics.log("createProcessor() - invalid processor type '"+type+"'");return null}};manager.prototype.process=function process(){var result=[];for(var dlgId in this.dialogsToBlocksMap){if(this.dialogsToBlocksMap.hasOwnProperty(dlgId)){var dialogBlocks=this.dialogsToBlocksMap[dlgId];var blocks=[];var dialogClass=null;if(dialogBlocks.hasOwnProperty("class")){dialogClass=dialogBlocks.class;delete dialogBlocks.class}
for(var index in dialogBlocks){if(dialogBlocks.hasOwnProperty(index)){var processorObj=dialogBlocks[index].processor;var processor=processorObj;var data=this.processBlock(processorObj,processor);if(data)
blocks.push(data)}}
var hbox={type:"h-box",class:"pstory-dialog-frame",columns:[{width:12,blocks:blocks}]};if(dialogClass!==null)
hbox.class=dialogClass;result.push(hbox)}}
return result};manager.prototype.processBlocks=function processBlocks(dialogConfig){var result=[];var me=this;dialogConfig.blocks.forEach(function(blockCfg,index){var data=me.processBlockConfig(dialogConfig.id,index);if(data)
result.push(data)});return result};manager.prototype.processBlockConfig=function processBlockConfig(dlgId,blockIndex){if(this.dialogsToBlocksMap.hasOwnProperty(dlgId)&&this.dialogsToBlocksMap[dlgId].hasOwnProperty(blockIndex)){var processorObj=this.dialogsToBlocksMap[dlgId][blockIndex];var processor=processorObj.processor;return this.processBlock(processorObj,processor)}};manager.prototype.processBlock=function processBlock(processorObj,processor){var result=null;var config=processor.config;var show=!0;if(config.showIf){var showIfExp=new Personetics.processor.PExp(config.showIf);try{show=showIfExp.eval(this.model)}
catch(e){show=!1;Personetics.error("PBlockProcessorManager.processBlock() Error: Failed to evaluate showIf property, not showing block. Error Message: "+e.message+e.stack)}}
if(show){this.evaluateDefault(config);result=processor.processData();processorObj.previousData=result}
return result};manager.prototype.evaluateDefault=function evaluateDefault(config){var blockDefaultValue=this.getBlockVarValue(config);if(typeof blockDefaultValue!=='undefined'&&blockDefaultValue!==null){config.selected=blockDefaultValue}
else{if(config.hasOwnProperty("default")&&config.default!=null&&config.default.length>0){var defaultStr=config.default;var defaultExp=new Personetics.processor.PExp(defaultStr);try{blockDefaultValue=defaultExp.eval(this.model)}
catch(e){Personetics.error("PBlockProcessorManager.evaluateDefault() Error: Failed to evaluate "+config.type+" block's default expression")}
if(blockDefaultValue){config.selected=blockDefaultValue;this.setBlockVarValue(config,blockDefaultValue)}}}};manager.prototype.resetVariables=function resetVariables(block){if(block.var&&!this.model.varValuesForSave[block.var]){this.model.varValues[block.var]=null}};manager.prototype.getBlockVarValue=function getBlockVarValue(blockConfig){var varKey=blockConfig.var;if(typeof varKey!=='undefined'&&varKey!==null&&varKey.length>0)
return this.model.getVarValue(varKey)};manager.prototype.setBlockVarValue=function setBlockVarValue(blockConfig,value){var varKey=blockConfig.var;if(typeof varKey!=='undefined'&&varKey!==null&&varKey.length>0)
this.model.setVarValue(varKey,value)};manager.prototype.getModel=function getModel(){return this.model};manager.prototype.handleQueryData=function handleQueryData(data,block){var processedData=block.doProcessData(data);this.story.handleQueryData(processedData,block)}})(window,window.Personetics=window.Personetics||{});(function(window,Personetics,$,undefined){var Handlebars=Personetics.UI.Handlebars;Personetics.story=Personetics.story||{};Personetics.story.PCtrlBase=Base.extend({initialize:function(parent){this.parent=parent;this.templates=[];this.partialTemplates=this.getPartialTemplates();this.initHandlebars()},start:function(){},getGraphPalette:function(){return null},handleMessage:function(msg){},initHandlebars:function(){this.handlebars=Handlebars.create();this.registerPartialTemplates()},getTemplateHtml:function(templateId,ctxObj){var tmpl=this.getTemplate(templateId);var html=tmpl(ctxObj);return html},getTemplate:function(templateId){var template=this.templates[templateId];if(!template){template=this.getPrecompiledTemplate(templateId);if(!template){throw "Unknown template '"+templateId+"'"}}
return template},getPrecompiledTemplate:function(templateId){var id=templateId;if(id.substr(0,1)=="#")
id=id.substr(1);var tmpl=Handlebars.templates[id];return tmpl},compileTemplate:function(str){return this.handlebars.compile(str)},getPartialTemplates:function getPartialTemplates(){return[{"name":"innerCard","id":"pstory-block-account-selector-inner-card"},{"name":"innerCardDesktop","id":"pstory-block-account-selector-inner-card-desktop"}]},registerPartialTemplates:function registerPartialTemplates(){var me=this;this.partialTemplates.forEach(function(partial){var partialTemplate=Handlebars.templates[partial.id];if(typeof partialTemplate!=="undefined"&&partialTemplate!==null)
Handlebars.registerPartial(partial.name,partialTemplate)})}})})(window,window.Personetics=window.Personetics||{},jQuery);(function(window,Personetics,$,undefined){Personetics.story=Personetics.story||{};Personetics.story.PBlockFactory=new function(){this.types={"TYPE_CONTAINER":"layout"};this.blockFactoryMap={};this.index="0";this.registerBlock=function(type,config){if(config.blockClass){var entry=this.blockFactoryMap[type];if(!entry){entry={type:type,class:{},widthModes:{}};this.blockFactoryMap[type]=entry}
if(config.class){entry.class[config.class]=config.blockClass}
else if(config.widthMode){entry.widthModes[config.widthMode]=config.blockClass}
else{entry.blockClass=config.blockClass}}};this.createBlock=function(parent,layoutInstructions,story){var block;var blockClass;var storyCfg=story.cfg;var type=layoutInstructions.type;if(type==this.types.TYPE_CONTAINER){blockClass=Personetics.story.LayoutBlock;layoutInstructions.layoutId="layout-"+this.index;this.index++}
else{var chartsLibClass;if(storyCfg!==undefined)
chartsLibClass=storyCfg.chartsLibClass;var cClass=layoutInstructions.class;var cClass=layoutInstructions.class||chartsLibClass;var entry=this.blockFactoryMap[type];if(entry){if(storyCfg.hasOwnProperty("widthMode")&&typeof storyCfg.widthMode!=='undefined'&&storyCfg.widthMode!==null&&storyCfg.widthMode.length>0){blockClass=entry.widthModes[storyCfg.widthMode]}
if(cClass){blockClass=entry.class[cClass]}
if(!blockClass)
blockClass=entry.blockClass}
if(!blockClass){blockClass=Personetics.story.Block;Personetics.log("Invalid block type '"+type+"'")}}
block=new blockClass(parent,layoutInstructions,story);return block}}})(window,window.Personetics=window.Personetics||{},jQuery);(function(window,Personetics,$,undefined){Personetics.story=Personetics.story||{};Personetics.story.PBlockRenderer=Personetics.story.PCtrlBase.extend({initialize:function(){},render:function(element,blockConfig,template){var html=template(blockConfig);element.append(html)},afterRender:function(){}})})(window,window.Personetics=window.Personetics||{},jQuery);(function(window,Personetics,$,undefined){Personetics.story=Personetics.story||{};Personetics.story.Block=Base.extend({initialize:function(parent,layoutInstructions,story){this.parent=parent;this.story=story;this.layoutInstructions=layoutInstructions;this.isFirstBlock=!1;var tmplId=this.getHtmlTemplateId(layoutInstructions.class);if(tmplId)
this.template=this.story.templates[tmplId];if(tmplId&&!this.template){this.template=this.story.getTemplate("#pstory-block-"+tmplId);if(!this.template)
throw "Block template not found for: "+tmplId;this.story.templates[tmplId]=this.template}},getHtmlTemplateId:function(clazz){throw "No template id defined for block"},initBlock:function(){},handleQueryData:function(data){this.renderData(data);this.bindEvents()},setVisible:function(visible){},beforeRender:function(el,layoutInstructions){this.layoutInstructions=layoutInstructions;this.layoutInstructions.isFirstBlock=this.isFirstBlock},render:function(el,layoutInstructions){this.layoutInstructions=this.layoutInstructions||layoutInstructions;this.el=el;var html=this.template(this.layoutInstructions);el.append(html);this.frameEl=el.find(".pstory-block-frame").last()},renderAgain:function(data){var html=this.template(data);$(this.frameEl).replaceWith(html)},renderData:function(data){},afterRender:function(el){if(this.frameEl){this.doScrollEvent(!0)}},bindEvents:function(){},handleEvent:function handleEvent(args){var eventType=args[0];switch(eventType){case "scroll":if(this.frameEl){this.doScrollEvent(args)}}},doScrollEvent:function doScrollEvent(){},notifyReportEvent:function(params){Personetics.utils.PEventReporting.setValue(params);Personetics.utils.PEventReporting.notifyEvent()},setIsFirstBlock:function setIsFirstBlock(valueToSet){this.isFirstBlock=valueToSet}})})(window,window.Personetics=window.Personetics||{},jQuery);(function(window,Personetics,$,undefined){Personetics.story=Personetics.story||{};Personetics.story.LayoutBlock=Personetics.story.Block.extend({getHtmlTemplateId:function(clazz){return"layout"},initialize:function(parent,layoutInstructions,story){Personetics.story.Block.prototype.initialize.call(this,parent,layoutInstructions,story)},render:function(el,layoutInstructions){Personetics.story.Block.prototype.render.call(this,el,layoutInstructions);this.contentEl=this.frameEl.find(".layout-block-content").last();this.renderBlocks(layoutInstructions)},renderBlocks:function(layoutInstructions){var me=this;$.each(layoutInstructions.blocks,function(index,blockLayoutInstructions){var blockRenderer=Personetics.story.PBlockFactory.createBlock(me,blockLayoutInstructions,me.story);blockRenderer.beforeRender(me.contentEl,blockLayoutInstructions);blockRenderer.render(me.contentEl,blockLayoutInstructions);blockRenderer.afterRender(me.contentEl);blockRenderer.bindEvents()})},afterRender:function(){var blockFrames=this.contentEl.children(".pstory-block-frame");var numOfChildren=blockFrames.length;var totalWidth=this.contentEl.width();var childWidth=Math.floor(totalWidth/numOfChildren)-3;var layout=this.layoutInstructions.layout;if(layout=="horizontal"){blockFrames.addClass("perso-horizontal-block");blockFrames.each(function(){$(this).css("width",childWidth)})}}})})(window,window.Personetics=window.Personetics||{},jQuery);(function(window,Personetics,$,undefined){Personetics.story=Personetics.story||{};Personetics.story.HBoxBlock=Personetics.story.Block.extend({getHtmlTemplateId:function(clazz){return"hbox"},initialize:function(parent,layoutInstructions,story){Personetics.story.Block.prototype.initialize.call(this,parent,layoutInstructions,story);this.totalWidth=12;this.colTemplate=this.story.getTemplate("#pstory-block-hbox-columns")},render:function(el,layoutInstructions){Personetics.story.Block.prototype.render.call(this,el,layoutInstructions);this.contentEl=this.frameEl.find(".hbox-block-content").last();this.renderBlocks(layoutInstructions)},renderBlocks:function(layoutInstructions){var me=this;var colHtml=this.colTemplate(layoutInstructions);this.contentEl.append(colHtml);var columnContainers=this.contentEl.find(".pstory-hbox-column-frame");$.each(layoutInstructions.columns,function(index,col){var colEl=columnContainers[index];var blockEl=$(colEl).find(".pstory-hbox-blocks-container");$.each(col.blocks,function(jndex,blockLayoutInstructions){var blockRenderer=Personetics.story.PBlockFactory.createBlock(me,blockLayoutInstructions,me.story);blockRenderer.beforeRender(blockEl,blockLayoutInstructions);blockRenderer.render(blockEl,blockLayoutInstructions);blockRenderer.afterRender(blockEl);blockRenderer.bindEvents()})})},afterRender:function(){var totalWidth=this.totalWidth;var blockWidth=this.contentEl.width();var colEls=this.contentEl.find(".pstory-hbox-column-frame").each(function(){var weight=$(this).data("width");var width=Math.floor(weight/totalWidth*blockWidth);$(this).css("width",width)})}})})(window,window.Personetics=window.Personetics||{},jQuery);(function(window,Personetics,$,undefined){Personetics.story=Personetics.story||{};Personetics.story.TextBlock=Personetics.story.Block.extend({getHtmlTemplateId:function(clazz){switch(clazz){case "note":case "perso-note":return"txt-note";default:return"txt"}},beforeRender:function beforeRender(el,layoutInstructions){var text=layoutInstructions.text.replace(/{{Emoji /g,'<span>&#x');text=text.replace(/}}/g,'</span>');layoutInstructions.text=text;Personetics.story.Block.prototype.beforeRender.call(this,el,layoutInstructions)},render:function(el,layoutInstructions){var param=layoutInstructions;if(layoutInstructions.class=="perso-H4"||layoutInstructions.class=="perso-H5")
param.needAccessibility=!0;var html=this.template(param);el.append(html);this.frameEl=el.find(".pstory-block-frame").last()},})})(window,window.Personetics=window.Personetics||{},jQuery);(function(window,Personetics,$,undefined){Personetics.story=Personetics.story||{};Personetics.story.DateBoxBlock=Personetics.story.Block.extend({getHtmlTemplateId:function(clazz){return"date-box"},render:function(el,layoutInstructions){var monthNames=["January","February","March","April","May","June","July","August","September","October","November","December"];this.layoutInstructions=this.layoutInstructions||layoutInstructions;if(this.layoutInstructions.hasOwnProperty("date")){var dateStr=this.layoutInstructions.date.trim();var date=new Date(dateStr);this.layoutInstructions.day=date.getDate();this.layoutInstructions.month=monthNames[date.getMonth()]}
this.el=el;var html=this.template(this.layoutInstructions);el.append(html);this.frameEl=el.find(".pstory-block-content").last()},})})(window,window.Personetics=window.Personetics||{},jQuery);(function(window,Personetics,$,undefined){Personetics.story=Personetics.story||{};Personetics.story.ImageBlock=Personetics.story.Block.extend({getHtmlTemplateId:function(clazz){return"image"},beforeRender:function(el,layoutInstructions){Personetics.story.Block.prototype.beforeRender.call(this,el,layoutInstructions);var url=this.layoutInstructions.url;if(url.indexOf("http")==0)
this.layoutInstructions.isAbsoluteURL=!0;else this.layoutInstructions.url=url.substr(0,url.lastIndexOf('.'))||url},afterRender:function(el){var element=this.frameEl.find('.pstory-block-content');var backgroundImage=element.css("backgroundImage");var imageSrc=backgroundImage.replace(/url\((['"])?(.*?)\1\)/gi,'$2').split(',')[0];var image=new Image();var height,width;image.src=imageSrc;image.onload=function(){proportionWidth=this.width/element.width();proportionHeight=this.height/proportionWidth;element.css({height:proportionHeight})};this.frameEl.find('.perso-introduce-personetics').attr("aria-label",Personetics.dictionary.getText("accessibilityIntroducePersonetics"));this.frameEl.find('.perso-introduce-personetics').attr("role","img")}})})(window,window.Personetics=window.Personetics||{},jQuery);(function(window,Personetics,$,undefined){Personetics.story=Personetics.story||{};Personetics.story.TableBlock=Personetics.story.Block.extend({getHtmlTemplateId:function(clazz){var template;var classStr;var classes=clazz?clazz.split(" "):[];$.each(classes,function(index,className){if(className.indexOf("perso-txlist")>-1){classStr=className.trim();return!1}});this.classStr=classStr;template=classStr?"table-"+classStr:"table";return template},beforeRender:function(el,layoutInstructions){if(layoutInstructions.rows||layoutInstructions.groups){Personetics.story.Block.prototype.beforeRender.call(this,el,layoutInstructions);this.addTexts();this.parseTableToObj();this.groupTable();this.formatTable();this.texts={tableTitle:Personetics.dictionary.getText("accessibilityTableTitle"),tableStart:Personetics.dictionary.getText("accessibilityTableStart"),tableEnd:Personetics.dictionary.getText("accessibilityTableEnd")};this.layoutInstructions.legendTexts=[{class:Personetics.dictionary.getText("lblScheduled").toLowerCase(),text:Personetics.dictionary.getText("lblScheduled")},{class:Personetics.dictionary.getText("lblEstimated").toLowerCase(),text:Personetics.dictionary.getText("lblEstimated")}]}
else{Personetics.log("TableBlock.beforeRender() Error: invalid rows property - not rendering")}},addTexts:function addTexts(){var balanceLabel=Personetics.dictionary.getText("lblbalance");this.layoutInstructions.balanceLabel=balanceLabel},parseTableToObj:function parseTableToObj(){var block=this;var data=[];$.each(this.layoutInstructions.rows,function(i,row){var newRow={};$.each(block.layoutInstructions.cols,function(j,colName){if(colName==='isScheduled'){if(row[j]==='true'){newRow[colName]=row[j]}else{newRow.isAnticipated=Personetics.dictionary.getText("lblAnticipated")}}else{newRow[colName]=row[j]}});data.push(newRow)});this.layoutInstructions.rows=data},afterRender:function afterRender(el){if(this.frameEl){Personetics.story.Block.prototype.afterRender.call(this,el);this.addRoleAndDataForAccessibility()}},addRoleAndDataForAccessibility:function addRoleAndDataForAccessibility(){this.frameEl.find("table").attr('role','presentation');var valuesElements=this.frameEl.find("td>span");var firstTableValue=valuesElements.first();var lastTableValue=valuesElements.last();firstTableValue.prepend('<span class="perso-accessibility-read">'+this.texts.tableTitle+this.texts.tableStart+'</span>');lastTableValue.append('<span class="perso-accessibility-read">'+this.texts.tableEnd+'</span>');firstTableValue.addClass('perso-accessibility-wrapper').attr('role','text');lastTableValue.addClass('perso-accessibility-wrapper').attr('role','text')},formatTable:function formatTable(){var block=this;var formats=this.story.uxCtrl.getTablesFormat()["table-"+this.classStr];if(!formats)
formats=this.story.uxCtrl.getTablesFormat()["table-default"];if(formats){if(this.isGroup==!0){$.each(this.layoutInstructions.groups,function(i,group){block.formatRow(group,formats);group.rows.forEach(function(row,j){block.formatRow(row,formats)})})}
else{$.each(this.layoutInstructions.rows,function(i,row){block.formatRow(row,formats)})}}},formatRow:function formatRow(row,formats){var block=this;$.each(formats.displayColumns,function(colName,format){if(typeof row[colName]!=='undefined'&&row[colName]!==null){var currencySymbol=row.currencyCD;if(typeof currencySymbol!=='undefined'){format.currencySymbol=currencySymbol}
row[colName]=block.formatTableHelper(colName,format,row[colName])}})},formatTableHelper:function formatTableHelper(type,format,element){var result=element;var utils=Personetics.processor.PUtils.getUtilsInstance("utils",this.model);switch(format.type){case "date":result=utils.formatDate(element,format.format,!0);break;case "amount":result=utils.formatAmount(element,format.currencySymbol,format.format,!0);break}
return result},groupTable:function groupTable(){var block=this;if(typeof this.story.uxCtrl.getTablesFormat=='function'){var formats=this.story.uxCtrl.getTablesFormat();var formatByType=formats["table-"+this.classStr];if(typeof formatByType!='undefined'&&formatByType.isGroup==!0&&typeof formatByType.groupingField!='undefined'){this.isGroup=!0;var groups={};var groupingField=formatByType.groupingField;$.each(this.layoutInstructions.rows,function(i,row){var groupName=row[groupingField];if(typeof groups[groupName]=='undefined'){groups[groupName]={};groups[groupName].rows=[];var groupingValue=groupName.trim();groups[groupName][groupingField]=groupingValue;var groupingValueId=Personetics.utils.string.stripSpecialChars(groupingValue);groups[groupName][groupingField+'Id']=groupingValueId;block.defineOptionalParameter(groups[groupName])}
block.setOptionalParameter(groups[groupName],row);groups[groupName].rows.push(row)});var dataGroup=[];$.each(groups,function(index,group){dataGroup.push(group)});this.layoutInstructions.groups=dataGroup;delete this.layoutInstructions.rows}}},defineOptionalParameter:function defineOptionalParameter(group){},setOptionalParameter:function setOptionalParameter(group,row){},render:function(el,layoutInstructions){if(layoutInstructions.rows||layoutInstructions.groups){Personetics.story.Block.prototype.render.call(this,el,layoutInstructions)}
else{Personetics.log("TableBlock.render() Error: invalid rows property - not rendering")}}})})(window,window.Personetics=window.Personetics||{},jQuery);(function(window,Personetics,$,undefined){Personetics.story=Personetics.story||{};Personetics.story.OptionsBlock=Personetics.story.Block.extend({bindEvents:function(){this.frameEl.find(".pstory-button").bind("click",Personetics.bind(this,this.optionClickEvent));this.bindEvnetsForAnimation()},optionClickEvent:function(e){var target=$(e.currentTarget);var targetId=target.attr('pstory-id');var prevSelected=this.frameEl.find('.pstory-button.selected');if(prevSelected.attr('pstory-id')!=targetId){this.onInputSelect(e);var id=target.attr("pstory-id");this.currentSelectedOption=this.getOptionById(id);this.parent.notifyEvent(this,"setSelectedValue",this.currentSelectedOption);var params={value:this.layoutInstructions.type.toLowerCase()==="quiz"?this.getQuizResult(this.layoutInstructions.options,target):this.getReportValue(target),type:this.layoutInstructions.type};this.notifyReportEvent(params)}},getQuizResult:function(options,target)
{for(var key in options)
{if(options[key].id===target.attr("pstory-id"))
{if(options[key].answer==="true"){return Personetics.dictionary.getText("right")}
else{return Personetics.dictionary.getText("wrong")}}}
return Personetics.dictionary.getText("wrong")},getOptionById:function getOptionById(id){return this.layoutInstructions.options.filter(function(opt){return opt.id==id})[0]},onInputSelect:function(e){var target=$(e.currentTarget);var otherButtons=$(this.frameEl).find('.pstory-button');otherButtons.removeClass('selected');target.addClass('selected')},bindEvnetsForAnimation:function bindEvnetsForAnimation(){}})})(window,window.Personetics=window.Personetics||{},jQuery);(function(window,Personetics,$,undefined){Personetics.story=Personetics.story||{};Personetics.story.TextBoxes=Personetics.story.OptionsBlock.extend({getHtmlTemplateId:function(clazz){return"textboxes"},afterRender:function(){this.boxesHeight()},boxesHeight:function boxesHeight(){var boxesEls=this.frameEl.find(".perso-textbox, .perso-textbox-with-image");var maxHeight=0;boxesEls.each(function(){var height=$(this).height();if(height>=maxHeight)
maxHeight=height});if(maxHeight>0)
boxesEls.css("minHeight",maxHeight)}})})(window,window.Personetics=window.Personetics||{},jQuery);(function(window,Personetics,$,undefined){Personetics.story=Personetics.story||{};Personetics.story.ButtonsBlock=Personetics.story.OptionsBlock.extend({getHtmlTemplateId:function(clazz){return"buttons"},beforeRender:function(el,layoutInstructions){Personetics.story.OptionsBlock.prototype.beforeRender.call(this,el,layoutInstructions);$.each(this.layoutInstructions.options,function(index,option){if(option.type=="toggle"){option.toggleState=option.class+"-"+option.id}});if(this.layoutInstructions.hasOwnProperty('class')&&this.layoutInstructions.class.indexOf('perso-radio-buttons')>-1){this.layoutInstructions.typeRadio=!0;this.layoutInstructions.type="Quiz"}},optionClickEvent:function(e){var target=$(e.target);var navigateToData=typeof target.data("navigateToPayload")=="undefined"?target.children('a').data("navigateToPayload"):target.data("navigateToPayload");if(navigateToData){this.doNavigateToPage(navigateToData)}
else{Personetics.story.OptionsBlock.prototype.optionClickEvent.call(this,e)}},buttonKyedownEvent:function(e){var target=$(e.target);if(target.hasClass('pstory-radio-button')){if([13].indexOf(e.which)!==-1){target.click()}}},afterRender:function(el){Personetics.story.OptionsBlock.prototype.afterRender.call(this,el);if(this.layoutInstructions.buttonType==="navigateTo"&&this.layoutInstructions.options.length){var data={};var buttonId="#pstory-block-buttons_"+this.layoutInstructions.id;var navigateToLink=el.find(buttonId+" .pstory-link-navigateTo");if(this.layoutInstructions.options[0].payload){data.navigateTarget=this.layoutInstructions.options[0].navigateTarget;data.payload=this.layoutInstructions.options[0].payload}else{data.navigateTarget=this.layoutInstructions.options[0].navigateTarget}
navigateToLink.length&&navigateToLink.data("navigateToPayload",data)}
else if(this.layoutInstructions.type==="Quiz"&&this.story.cfg.widthMode==="desktop"){Personetics.utils.accessibility.trackFocus(this.frameEl)}},getReportValue:function(target){var value;if(target.attr("pstory-type-text")!=undefined)
value=target.attr("pstory-type-text");else{value=target.attr("pstory-id")}
return value},doNavigateToPage:function(navigateData){this.parent.notifyEvent(this,"doNavigateToPage",navigateData);var params={value:navigateData.navigateTarget,type:"Navigation"};this.notifyReportEvent(params)},bindEvents:function(){Personetics.story.OptionsBlock.prototype.bindEvents.call(this);var radioButtonsContainer=this.el.find('.pstory-block-buttons.perso-radio-buttons');radioButtonsContainer.bind("keypress",".pstory-radio-button",Personetics.bind(this,this.buttonKyedownEvent))}})})(window,window.Personetics=window.Personetics||{},jQuery);(function(window,Personetics,$,undefined){Personetics.story=Personetics.story||{};Personetics.story.AccountSelectorBlock=Personetics.story.OptionsBlock.extend({getHtmlTemplateId:function(clazz){return"account-selector"}})})(window,window.Personetics=window.Personetics||{},jQuery);(function(window,Personetics,$,undefined){Personetics.story=Personetics.story||{};Personetics.story.TabsBlock=Personetics.story.OptionsBlock.extend({getHtmlTemplateId:function(clazz){return"tabs"},getOptionById:function getOptionById(id){return this.layoutInstructions.options.filter(function(tab){return tab.id==id})[0]},afterRender:function afterRender(el){var selected=this.frameEl.find(".pstory-button.selected");this.changeSelectedTabAnimation(selected)},onInputSelect:function(e){Personetics.story.OptionsBlock.prototype.onInputSelect.call(this,e);var selected=$(e.currentTarget);selected.attr('aria-selected',!0);selected.siblings('[role="tab"]').attr('aria-selected',!1);this.changeSelectedTabAnimation(selected)},changeSelectedTabAnimation:function changeSelectedTabAnimation(selected){if(typeof selected==="undefined"||selected===null||selected.length==0)
return;var tabAnimatedBorder=$(this.frameEl).find(".pstory-tab-animated-border-bottom");var left=selected.offset().left-this.frameEl.offset().left;var width=selected.innerWidth();tabAnimatedBorder.css({"left":left+'px',width:width+'px'})},getReportValue:function(target){var value="Tab "+target.attr("value");return value},})})(window,window.Personetics=window.Personetics||{},jQuery);(function(window,Personetics,$,undefined){Personetics.story=Personetics.story||{};Personetics.story.SelectOneBlock=Personetics.story.OptionsBlock.extend({getHtmlTemplateId:function(clazz){return"selectOne"}})})(window,window.Personetics=window.Personetics||{},jQuery);(function(window,Personetics,$,undefined){var d3=Personetics.persoD3||window.d3;Personetics.story=Personetics.story||{};Personetics.story.D3BarChartBlock=Personetics.story.Block.extend({getHtmlTemplateId:function(clazz){return"bar-chart"},beforeRender:function(el,layoutInstructions){if(layoutInstructions.categories&&layoutInstructions.seriesLabels){Personetics.story.Block.prototype.beforeRender.call(this,el,layoutInstructions);var direction=this.layoutInstructions.direction;this.chartType=this.getChartType(direction,this.layoutInstructions.seriesLabels.length>1);this.setSelected();this.barsDirection();this.beforeRenderChart(el);this.texts={accessibilityBarChartTitle:Personetics.dictionary.getText("accessibilityBarChartTitle"),series:Personetics.dictionary.getText("accessibilitySeries"),selected:Personetics.dictionary.getText("accessibilitySelected"),notSelected:Personetics.dictionary.getText("accessibilityNotSelected")}}
else{Personetics.log("D3BarChartBlock.beforeRender() Error: invalid categories and/or seriesLabels properties - not rendering")}},setSelected:function setSelected(){var block=this;this.hasSelected=!1;$.each(this.layoutInstructions.series,function(i,seriesArray){$.each(seriesArray,function(j,item){if(item.selected==!0){block.hasSelected=!0;return!1}})});if(this.hasSelected==!1){$.each(this.layoutInstructions.series,function(i,seriesArray){if(seriesArray.length>0){seriesArray[seriesArray.length-1].selected=!0}})}},render:function(el,layoutInstructions){if(layoutInstructions.categories&&layoutInstructions.seriesLabels){Personetics.story.Block.prototype.render.call(this,el,layoutInstructions);var chartEl=this.frameEl.find(".pstory-bar-chart");if(chartEl.length>0){this.renderBarChart(chartEl,layoutInstructions)}}
else{Personetics.log("D3BarChartBlock.render() Error: invalid categories and/or seriesLabels properties - not rendering")}},afterRender:function(el){if(this.frameEl){Personetics.story.Block.prototype.afterRender.call(this,el);$(this.chartEl).addClass(this.layoutInstructions.direction);this.renderAccessibilityData()}},renderAccessibilityData:function renderAccessibilityData(el){var id=this.frameEl.parents(".pstory-dialog-frame").attr("id")+this.frameEl.index();var titleContent;var parentNode=this.chartHelper.svg.node().parentNode;if(this.layoutInstructions.type=="pin-graph"){var dataString=this.createDataString();titleContent=this.getAccessibilityTitle()+'. '+dataString}else{titleContent=this.getAccessibilityTitle();d3.select(parentNode).attr("role","application")}
d3.select(parentNode).append("title").attr("id",id+"_title").text(titleContent);this.chartHelper.svg.attr('aria-labelledby',id+'_title');this.chartHelper.svg.selectAll("*").attr('aria-hidden',!0)},getAccessibilityTitle:function getAccessibilityTitle(){return this.texts.accessibilityBarChartTitle},createDataString:function createDataString(){var categories=this.layoutInstructions.categories;var series=this.layoutInstructions.series;var texts=this.texts;var seriesLabels=this.layoutInstructions.seriesLabels;var dataElement=$("<span></span>");var hasMultiSeries=this.layoutInstructions.seriesLabels.length>1;if(hasMultiSeries){$.each(series[0],function(index,item){dataElement.append(' '+texts.series+' '+seriesLabels[0]+', '+categories[index]+', '+item.label+', '+texts.series+' '+seriesLabels[1]+', '+categories[index]+', '+series[1][index].label+',')})}
else{$.each(series,function(index,item){dataElement.prepend(' '+Personetics.utils.date.nthDate(categories[index],Personetics.processor.PStoryConfig.getConfig("lang"))+', '+item.label+',')})}
return dataElement.text()},beforeRenderChart:function(el){if(this.layoutInstructions.series.length==1&&$.isArray(this.layoutInstructions.series[0]))
this.layoutInstructions.series=this.layoutInstructions.series[0];this.chartTypeHelper=this.chartType+"Helper";this.initChartHelper(this.chartTypeHelper);this.initOptions()},initOptions:function(){if(this.chartType=="multiVertical"){this.options=this.story.uxCtrl.getColumnChartMultiSeriesOptions();this.options.palette=this.story.uxCtrl.getMultiVerticalPalette();this.options.paletteLabels=this.story.uxCtrl.getMultiVerticalLabelsPalette()}
else if(this.chartType=="multiHorizontal"){this.options=this.story.uxCtrl.getBarChartOptions()}
else{this.options=this.story.uxCtrl.getColumnChartOptions()}},barsDirection:function barsDirection(){if((this.chartType=="vertical"||this.chartType=="multiVertical")&&Personetics.processor.PStoryConfig.isRtl()){this.barsDirectionRTL()}},barsDirectionRTL:function barsDirectionRTL(){if($.isArray(this.layoutInstructions.categories)){this.layoutInstructions.categories.reverse();this.layoutInstructions.accessibilityCategories.reverse()}
if($.isArray(this.layoutInstructions.series)){$.each(this.layoutInstructions.series,function(i,series){if($.isArray(series)){series.reverse()}})}},renderBarChart:function(el,layoutInstructions){var data=layoutInstructions;this.options.desktopScreenWidth=this.story.uxCtrl.getDesktopScreenWidth();var handleClickBind=Personetics.bind(this,this.handleClick);if(this.chartType=="multiHorizontal"){this.chartHelper.prepareMultiHorizontalChart(this,el);this.chartHelper.renderMultiHorizontalChart(this,el,this.layoutInstructions)}
else{this.chartHelper.prepareChart(data,this.options,handleClickBind);this.chartHelper.renderChart(el)}},handleClick:function(obj,clickedItemIndex){if(this.hasSelected==!1){return}
if(obj.amount==0)
return;var svg;svg=this.frameEl.find('svg .perso-bar, svg .perso-chart-rect')[clickedItemIndex].className.animVal;if(svg.indexOf("selected")!=-1){return}
var highlightedElements=this.frameEl.find('svg .perso-bar.selected, svg .perso-chart-rect.selected');$.each(highlightedElements,function(i,element){element.className.baseVal=Personetics.utils.string.removeClass(element.className,'selected')});var highlightedLabels=this.frameEl.find('svg .perso-label');$.each(highlightedLabels,function(i,label){label.className.baseVal=Personetics.utils.string.removeClass(label.className,'selected')});var highlightedxAxisLabels=this.frameEl.find('svg .perso-xAxis-label');$.each(highlightedxAxisLabels,function(i,xAxisLabel){xAxisLabel.className.baseVal=Personetics.utils.string.removeClass(xAxisLabel.className,'selected')});if(obj.hasOwnProperty("mode")){var highlightSelectedInElements=this.frameEl.find('svg .perso-bar, svg .perso-chart-rect.In')[clickedItemIndex];var highlightSelectedOutElements=this.frameEl.find('svg .perso-bar, svg .perso-chart-rect.Out')[clickedItemIndex];var highlightSelectedInLabels=this.frameEl.find('svg .perso-label.In')[clickedItemIndex];var highlightSelectedOutLabels=this.frameEl.find('svg .perso-label.Out')[clickedItemIndex];var clickedBarxAxis=this.frameEl.find('svg .perso-xAxis-label')[clickedItemIndex];highlightSelectedInElements.className.baseVal=Personetics.utils.string.addClass(highlightSelectedInElements.className,'selected');highlightSelectedOutElements.className.baseVal=Personetics.utils.string.addClass(highlightSelectedOutElements.className,'selected');if(typeof highlightSelectedInLabels!='undefined'){highlightSelectedInLabels.className.baseVal=Personetics.utils.string.addClass(highlightSelectedInLabels.className,'selected')}
if(typeof highlightSelectedOutLabels!='undefined'){highlightSelectedOutLabels.className.baseVal=Personetics.utils.string.addClass(highlightSelectedOutLabels.className,'selected')}
if(clickedBarxAxis){clickedBarxAxis.className.baseVal=Personetics.utils.string.addClass(clickedBarxAxis.className,'selected')}}else{var clickedBar=this.frameEl.find('svg .perso-bar, svg .perso-chart-rect')[clickedItemIndex];var clickedBarLabel=this.frameEl.find('svg .perso-label')[clickedItemIndex];var clickedBarxAxis=this.frameEl.find('svg .perso-xAxis-label')[clickedItemIndex];clickedBar.className.baseVal=Personetics.utils.string.addClass(clickedBar.className,'selected');if(typeof clickedBarLabel!='undefined'){clickedBarLabel.className.baseVal=Personetics.utils.string.addClass(clickedBarLabel.className,'selected')}
if(clickedBarxAxis){clickedBarxAxis.className.baseVal=Personetics.utils.string.addClass(clickedBarxAxis.className,'selected')}}
this.parent.notifyEvent(this,"setSelectedValue",obj.category);var params={value:obj.category,type:this.layoutInstructions.type};this.notifyReportEvent(params)},getChartType:function(direction,hasMultiSeries){var type=null;if(direction=="vertical"&&hasMultiSeries){type="multiVertical"}else if(direction=="horizontal"&&hasMultiSeries){type="multiHorizontal"}else if(direction=="vertical"){type="vertical"}
else if(direction=="horizontal"){type="horizontal"}
return type},initChartHelper:function(type){this.chartHelper=Personetics.story.BlockChartFactory.generateHelperClazz(type,this.story.cfg)}})})(window,window.Personetics=window.Personetics||{},jQuery);(function(window,Personetics,$,undefined){var d3=Personetics.persoD3||window.d3;Personetics.story=Personetics.story||{};Personetics.story.D3PinGraphChartBlock=Personetics.story.D3BarChartBlock.extend({beforeRender:function(el,layoutInstructions){Personetics.story.D3BarChartBlock.prototype.beforeRender.call(this,el,layoutInstructions);this.texts.accessibilityPinGraphTitle=Personetics.dictionary.getText("accessibilityPinGraphTitle")},getHtmlTemplateId:function(clazz){return"pinGraph-chart"},render:function(el,layoutInstructions){Personetics.story.Block.prototype.render.call(this,el,layoutInstructions);var chartEl=this.frameEl.find(".pstory-pinGraph-chart");if(chartEl.length>0){this.renderBarChart(chartEl,layoutInstructions)}},renderBarChart:function(el,data){this.chartHelper.prepareChart(data,this.options);this.chartHelper.renderChart(el)},beforeRenderChart:function(el,layoutInstructions){this.layoutInstructions.series=this.layoutInstructions.series[0];this.chartType=this.getChartType();this.chartTypeHelper=(this.chartType+"Helper");this.initChartHelper(this.chartTypeHelper);this.options=this.story.uxCtrl.getPinGraphChartOptions()},barsDirection:function barsDirection(){if(Personetics.processor.PStoryConfig.isRtl()){this.barsDirectionRTL()}},getChartType:function(){var type='pinGraph';return type},getAccessibilityTitle:function getAccessibilityTitle(){return this.texts.accessibilityPinGraphTitle},})})(window,window.Personetics=window.Personetics||{},jQuery);(function(window,Personetics,$,undefined){var d3=Personetics.persoD3||window.d3;Personetics.story=Personetics.story||{};Personetics.story.PieChartBlock=Personetics.story.Block.extend({getHtmlTemplateId:function(clazz){return"pie-chart"},beforeRender:function(el,layoutInstructions){Personetics.story.Block.prototype.beforeRender.call(this,el,layoutInstructions);this.options=this.story.uxCtrl.getPieOptions();this.setTotal(layoutInstructions);this.colors=d3.scale.ordinal().range(this.getGraphPalette());this.texts={accessibilityPieTitle:Personetics.dictionary.getText("accessibilityPieTitle")};this.grayscaleId="grayscale_"+ +new Date();this.dropShadow='';if(this.options.arcs.filter.dropShadow){this.dropShadowId="drop-shadow_"+ +new Date();this.dropShadow="url(#"+this.dropShadowId+")"}
this.isOldAndroidVersion=Personetics.utils.persoHelper.isOldAndroidVersion();this.layoutInstructions.slices=this.layoutInstructions.slices.sort(function(sliceA,sliceB){return Math.abs(sliceB.value)-Math.abs(sliceA.value)})},setPieDefination:function(){var block=this;var normalizedValue=block.totalAmountInt*0.05;var padAngle=0.04;if(typeof block.options.arcs.padAngle!='undefined'){padAngle=block.options.arcs.padAngle}
return d3.layout.pie().padAngle(padAngle).value(function(d){var value=Math.abs(d.value)+normalizedValue;return value})},sortPie:function(layoutInstructionsSlices){layoutInstructionsSlices.sort(function(a,b){return Math.abs(b.value)-Math.abs(a.value)});return layoutInstructionsSlices},setTotal:function setTotal(layoutInstructions){var totalFromSrc=layoutInstructions.centerText;var totalFromSrcToArr=[];if(totalFromSrc){totalFromSrcToArr=totalFromSrc.split("<br>")}else{Personetics.log("Center text is empty")}
this.totalText=totalFromSrcToArr[0]?totalFromSrcToArr[0]:'';this.totalAmount=totalFromSrcToArr[1]?totalFromSrcToArr[1]:'';if(layoutInstructions.hasOwnProperty('slices')&&layoutInstructions.slices.length>0){var totalAmountObj=layoutInstructions.slices.reduce(function(total,slice){return{value:Math.abs(total.value)+Math.abs(slice.value)}});this.totalAmountInt=totalAmountObj.value}
else{this.totalAmountInt=0}},getGraphPalette:function(){return this.story.uxCtrl.getPieGraphPalette()},render:function(el,layoutInstructions){if(layoutInstructions.slices){layoutInstructions.texts=this.texts;Personetics.story.Block.prototype.render.call(this,el,layoutInstructions);this.frameEl=el.find('.pstory-block-frame').last();var chartEl=this.frameEl.find(".pstory-pie-chart");if(chartEl.length>0){this.renderPieChart(chartEl,layoutInstructions)}}
else{Personetics.log("PieChartBlock.render() Error: invalid slices property - not rendering")}},renderPieChart:function(el,layoutInstructions){var block=this;layoutInstructions.slices=this.sortPie(layoutInstructions.slices);this.setPieSize();d3.selection.prototype.moveToFront=function(){return this.each(function(){var gparent=this.parentNode;gparent.parentNode.appendChild(gparent)})};this.defineArcs();this.renderPieBase(el);this.renderShadowFilter(block);this.renderPie(el,layoutInstructions,block);this.renderAccessibilityData(el,layoutInstructions)},setPieSize:function setPieSize(){this.margin={top:0,right:20,bottom:0,left:20};this.width=this.frameEl.find('.pstory-pie-chart').width();this.height=this.width*0.7;this.radius=this.width/2.5;this.innerRadius=this.radius-26;this.outerRadius=this.radius-36;this.innerRadiusOver=this.radius-23;this.outerRadiusOver=this.radius-43},defineArcs:function defineArcs(){var block=this;this.arc=d3.svg.arc().innerRadius(block.innerRadius).outerRadius(block.outerRadius);this.arcOver=d3.svg.arc().innerRadius(block.innerRadiusOver).outerRadius(block.outerRadiusOver)},renderPieBase:function renderPieBase(el){this.svg=this.renderPieSvgBase(el)},renderPieSvgBase:function(el){var block=this;if(el){return(d3.select(el.get(0)).append("svg").attr("width",block.width).attr("height",block.height).append("g").attr("transform","translate("+block.width/2+","+block.height/2+")"))}},renderPie:function(el,layoutInstructions,block){this.renderArcs(layoutInstructions);this.renderPieTitle(this.totalText);if(this.options.drawCenterLine==!0){this.renderLine()}
this.renderPieAmount(this.totalAmount)},renderArcs:function(layoutInstructions){var block=this;var arcs=block.svg.selectAll(".arc").data(block.setPieDefination()(layoutInstructions.slices)).enter().append("g").attr("class","perso-arc").attr("pstory-id",function(d){return d.data.category});arcs.append("path").attr("d",block.arc).attr("class",function(d){var clazz="";if(d.data.highlight){clazz+="perso-selected"}
return clazz}).style("filter",function(d){if(d.data.highlight){if(block.options.arcs.filter.dropShadow){return"url(#"+block.options.arcs.filter.dropShadow.id+")"}
return""}}).style("fill",function(d,i){return block.colors(d.data.category)}).on("click",function(obj,clickedItemIndex){block.onPieItemClick(obj,clickedItemIndex,this)})},renderTicks:function(block,layoutInstructions){if(block){var ticks=block.svg.append('g').attr('class','perso-ticks').selectAll("line").data(block.setPieDefination()(layoutInstructions)).enter().append("line");ticks.attr('class','perso-tick').attr("x1",0).attr("x2",0).attr("y1",-block.radius*.8).attr("y2",-block.radius*.9).attr("stroke","gray").attr("transform",function(d){return"rotate("+(d.startAngle+d.endAngle)/2*(180/Math.PI)+")"})}},renderPieLabels:function(block,layoutInstructions){if(block){var labels=block.svg.append('g').attr('class','perso-pie-labels').attr("transform","translate(8,0)").selectAll("text").data(block.setPieDefination()(layoutInstructions)).enter().append("text");labels.attr("class","perso-pie-label").attr("transform",function(d){var dist=block.radius+20;var angle=(d.startAngle+d.endAngle)/2;var x=dist*Math.sin(angle);var y=-dist*Math.cos(angle);return"translate("+x+","+y+")"}).attr("dy","-0.5em").attr("text-anchor","middle").html(function(d){return d.data.category}).call(block.wrapLabelText,$(window).width()*.28)}},renderPieTitle:function(totalText){var block=this;var totaltxt_SpaceFromCenter=this.options.totaltxt_SpaceFromCenter||'-.3em';this.svg.append('text').attr('class','perso-total-txt').attr('dy',totaltxt_SpaceFromCenter).html(totalText)},renderPieAmount:function(totalAmount){var block=this;var totalAmount_SpaceFromCenter=this.options.totalAmount_SpaceFromCenter||'.9em';this.svg.append('text').attr('class','perso-total-amount').attr('dy',totalAmount_SpaceFromCenter).html(totalAmount)},renderLine:function(){var lineWidth=this.options.centerLineWidth||0;this.svg.append('line').attr('class','perso-centerLine').attr('x1',lineWidth/2*-1).attr('x2',lineWidth/2)},renderAccessibilityData:function renderAccessibilityData(el){var id=this.frameEl.parents(".pstory-dialog-frame").attr("id")+this.frameEl.index();var titleContent=this.texts.accessibilityPieTitle+'. '+this.createDataString();var parentNode=this.svg.node().parentNode;d3.select(parentNode).append("title").attr("id",id+"_title").text(titleContent);d3.select(parentNode).attr("role","presentation");this.svg.attr('aria-labelledby',id+'_title');this.svg.selectAll("*").attr('aria-hidden',!0)},createDataString:function createDataString(){var dataElement=$("<span></span>");dataElement.append(this.totalText+': '+this.totalAmount+'.');return dataElement.text()},onPieItemClick:function(obj,clickedItemIndex,clickedItem){var block=this;var oldSelectedArc=$('.perso-arc path.perso-selected');if(oldSelectedArc.length){oldSelectedArc[0].className.baseVal=Personetics.utils.string.removeClass(oldSelectedArc[0].className,'perso-selected')}
var oldSelectedArcLabel=this.frameEl.find('.pstory-pie-chart svg .perso-pie-label.selected');if(oldSelectedArcLabel.length){oldSelectedArcLabel[0].className.baseVal=Personetics.utils.string.removeClass(oldSelectedArcLabel[0].className,'selected')}
d3.select(clickedItem).attr("class","perso-selected");var pstoryLabels=this.frameEl.find('.pstory-pie-chart svg .perso-pie-label');if(typeof pstoryLabels!='undefined'&&pstoryLabels.length>clickedItemIndex){var clickedArcLabel=pstoryLabels[clickedItemIndex];clickedArcLabel.className.baseVal=Personetics.utils.string.addClass(clickedArcLabel.className,'selected')}
this.handleClick(obj,clickedItemIndex)},renderShadowFilter:function(block){var filter=block.options.arcs.filter.dropShadow;var svgWithFilters=block.svg;if(filter){var defs=block.svg.append("defs");var filterSvg=defs.append("filter").attr("id",this.dropShadowId).attr("height","130%");filterSvg.append("feGaussianBlur").attr("in",filter.in).attr("stdDeviation",filter.stdDeviation).attr("result","blur");filterSvg.append("feOffset").attr("in","blur").attr("dx",filter.dxOffset).attr("dy",filter.dyOffset).attr("result","offsetBlur");filterSvg.append("feFlood").attr("in","offsetBlur").attr("flood-color",filter.color).attr("flood-opacity","1").attr("result","offsetColor");filterSvg.append("feComposite").attr("in","offsetColor").attr("in2","offsetBlur").attr("operator","in").attr("result","offsetBlur");var feMerge=filterSvg.append("feMerge");feMerge.append("feMergeNode").attr("in","offsetBlur")
feMerge.append("feMergeNode").attr("in",filter.in)}},handleClick:function(obj,clickedItemIndex){var dataObj=obj;if(dataObj.data){dataObj=dataObj.data}
this.parent.notifyEvent(this,"setSelectedValue",dataObj.category);var params={value:dataObj.category,type:this.layoutInstructions.type};this.notifyReportEvent(params)},getSelectedPathIndex:function(paths){var selectedIndex=0;var selectedCategory=this.frameEl.find('path.perso-selected').parent().attr('pstory-id');var selected=this.layoutInstructions.slices.filter(function(slice,i){if(slice.category==selectedCategory){selectedIndex=i;return!0}});return selectedIndex},wrapLabelText:function(text,width){text.each(function(){var text=d3.select(this),words=text.text().split(/\s+/).reverse(),word,line=[],lineNumber=0,lineHeight=.15,y=text.attr("y"),dy=parseFloat(text.attr("dy")),tspan=text.text(null).append("tspan").attr("x",0).attr("y",y).attr("dy",dy+"em");while(word=words.pop()){line.push(word);tspan.text(line.join(" "));if(tspan.node().getComputedTextLength()>width){line.pop();tspan.text(line.join(" "));line=[word];tspan=text.append("tspan").attr("x",0).attr("y",y).attr("dy",++lineNumber*lineHeight+dy+"em").text(word)}}})},})})(window,window.Personetics=window.Personetics||{},jQuery);(function(window,Personetics,$,undefined){var d3=Personetics.persoD3||window.d3;Personetics.story=Personetics.story||{};Personetics.story.WidePieChartBlock=Personetics.story.Block.extend({getHtmlTemplateId:function(clazz){return"pie-chart"},beforeRender:function(el){var block=this;var cfg=block.config;block.margin={top:10,right:10,bottom:10,left:10};block.width=(el.width()-block.margin.left-block.margin.right);block.height=block.width/2;block.radius=block.width/3;block.xFieldExp=new Personetics.processor.PExp(cfg.x);var yExp=block.yFieldExp=new Personetics.processor.PExp(cfg.y);block.xScale=d3.scale.ordinal().rangeRoundBands([0,block.width],.1);block.yScale=d3.scale.linear().range([block.height,0]);block.xAxis=d3.svg.axis().scale(block.xScale).orient("bottom");var deg=(Math.PI/180);block.pie=d3.layout.pie().sort(null).startAngle(-90*deg).endAngle(90*deg).value(function(d){return yExp.eval(d)})},render:function(el){this.el=el;var data=this.story.model.fetchFromSrc(this,this.config.src);if(!data)
return;if(data!==Personetics.processor.Future)
data=data.getObjArray();var html=this.template(data);el.append(html);var chartEl=el.find(".pstory-pie-chart");if(chartEl.length>0){this.renderPieChart(chartEl,data)}},afterRenderPieChart:function(el,data){var block=this;var cfg=block.config;var xScale=block.xScale;var yScale=block.yScale;var xExp=block.xFieldExp;var yExp=block.yFieldExp;xScale.domain(data.map(function(d){return xExp.eval(d)}));yScale.domain([0,d3.max(data,function(d){return yExp.eval(d)})]);block.svg=d3.select(el.get(0)).append("svg").attr("width",block.width+block.margin.left+block.margin.right).attr("height",block.height+block.margin.top+block.margin.bottom).append("g").attr("transform","translate("+(block.width/2+block.margin.left)+","+(block.height+block.margin.top)+")");var colors=this.getGraphPalette();var color=xScale.range(colors);var arc=d3.svg.arc().outerRadius(this.radius).innerRadius(this.radius*0.5);var deg=(Math.PI/180);var pie=d3.layout.pie().sort(null).value(function(d){return yExp.eval(d)}).startAngle(-90*deg).endAngle(90*deg);var svg=block.svg;var g=svg.selectAll(".arc").data(pie(data)).enter().append("g").attr("class","arc");g.append("path").attr("d",arc).style("fill",function(d){return color(xExp.eval(d.data))});var labels=!0;if(labels){var labelRadius=230;g.append("text").attr("x",function(d,i){var centroid=arc.centroid(d);var midAngle=Math.atan2(centroid[1],centroid[0]);var x=Math.cos(midAngle)*labelRadius;var sign=(x>0)?1:-1;var labelX=x+(5*sign);return labelX}).attr("y",function(d,i){var centroid=arc.centroid(d);var midAngle=Math.atan2(centroid[1],centroid[0]);var y=Math.sin(midAngle)*labelRadius;return y}).attr('text-anchor',function(d,i){var centroid=arc.centroid(d);var midAngle=Math.atan2(centroid[1],centroid[0]);var x=Math.cos(midAngle)*labelRadius;return(x>0)?"start":"end"}).text(function(d){var txt=xExp.eval(d.data);return txt});g.append("line").attr({stroke:"black","stroke-width":1,x1:function(d,i){return arc.centroid(d)[0]},y1:function(d,i){return arc.centroid(d)[1]},x2:function(d,i){var centroid=arc.centroid(d);var midAngle=Math.atan2(centroid[1],centroid[0]);var x=Math.cos(midAngle)*labelRadius;return x},y2:function(d,i){var centroid=arc.centroid(d);var midAngle=Math.atan2(centroid[1],centroid[0]);var y=Math.sin(midAngle)*labelRadius;return y},'class':"label-line"})}},getGraphPalette:function(){return this.story.uxCtrl.getPieGraphPalette()},handleClick:function(obj){if(!this.config.var||!this.config.varSource)
return;this.setValue(obj[this.config.varSource]);this.story.fireEvent(this)}})})(window,window.Personetics=window.Personetics||{},jQuery);(function(window,Personetics,$,undefined){Personetics.story=Personetics.story||{};Personetics.story.MapBlock=Personetics.story.Block.extend({getHtmlTemplateId:function(clazz){return"map"},render:function(el,layoutInstructions){Personetics.story.Block.prototype.render.call(this,el,layoutInstructions);this.mapEl=this.frameEl.find(".pstory-map-frame");var mapOptions={scrollwheel:!1,navigationControl:!1,mapTypeControl:!1,scaleControl:!1,draggable:!1,zoom:15,center:new google.maps.LatLng(40.7097798,-73.9624878),mapTypeId:google.maps.MapTypeId.ROADMAP};var mapCanvas=document.createElement("div");mapCanvas.id="map-canvas";mapCanvas.style.width="100%";mapCanvas.style.height="100%";this.mapEl.append(mapCanvas);this.map=new google.maps.Map(mapCanvas,mapOptions)}})})(window,window.Personetics=window.Personetics||{},jQuery);(function(window,Personetics,$,undefined){Personetics.story=Personetics.story||{};Personetics.story.PBlockSessionManager=Base.extend({initialize:function(story){this.story=story;this.blockProcessorManager=PBlockProcessorManager.getInstance();var customizationOptions=story.options;var options={story:story.storyDef,texts:story.texts,facts:story.cfg.data||story.cfg.insightFacts,expressions:story.expressions,customizationOptions:customizationOptions}
this.blockProcessorManager.start(options);this.dialogsToBlocksMap={};this.processedData=[]},reset:function(){this.processedData=[]},resetDialog:function(dlgId){if(this.dialogsToBlocksMap.hasOwnProperty(dlgId))
this.dialogsToBlocksMap[dlgId]=[]},startBlock:function(dlgId,texts,config,index){if(!this.dialogsToBlocksMap.hasOwnProperty(dlgId))
this.dialogsToBlocksMap[dlgId]=[];var layoutInstructions=this.blockProcessorManager.processBlockConfig(dlgId,index);var renderer=Personetics.story.PBlockFactory.createBlock(this,layoutInstructions,this.story);var block={dlgId:dlgId,config:config,layoutInstructions:layoutInstructions,renderer:renderer};this.dialogsToBlocksMap[dlgId].push(block);renderer.initBlock()},renderBlocks:function(dlgId,el,isFirstDialogs){if(this.dialogsToBlocksMap.hasOwnProperty(dlgId)){var me=this;$.each(this.dialogsToBlocksMap[dlgId],function(index,block){var renderer=block.renderer;var layoutInstructions=block.layoutInstructions;if(isFirstDialogs&&index==0)
renderer.setIsFirstBlock(!0);me.processedData.push(layoutInstructions);renderer.beforeRender(el,layoutInstructions);renderer.render(el,layoutInstructions);renderer.afterRender(el);renderer.bindEvents()});if(window.setProcessorData)
window.setProcessorData(this.processedData)}
else{throw "Invalid dialog id '"+dlgId+"'"}},findBlock:function(options){var rendererObj=options.rendererObj;var result=null;$.each(this.dialogsToBlocksMap,function(dlgId,blocks){$.each(blocks,function(index,block){var currObj=block.renderer;if(rendererObj==currObj){result=block;return!1}});if(result)
return!1});return result},notifyEvent:function(renderer,eventName,params){switch(eventName){case "doNavigateToPage":this.doNavigateToPage(params);break;case "setSelectedValue":this.setSelectedValue(renderer,params)}},setSelectedValue:function(renderer,value){var block=this.findBlock({rendererObj:renderer});this.blockProcessorManager.setBlockVarValue(block.config,value);this.story.fireEvent(block)},doNavigateToPage:function(params){var bridge=personetics.getJSBridge();if(bridge&&($.isFunction(bridge.navigateToPage)))
bridge.navigateToPage(params);else Personetics.log("Events Delegate not defined")},setVisible:function(dlgId,visible){if(this.dialogsToBlocksMap.hasOwnProperty(dlgId)){$.each(this.dialogsToBlocksMap[dlgId],function(index,block){block.renderer.setVisible(visible)})}},resetVariables:function(block){this.blockProcessorManager.resetVariables(block)},getModel:function getModel(){return this.blockProcessorManager.getModel()},handleEvent:function handleEvent(eventType){var args=arguments;$.each(this.dialogsToBlocksMap,function(dialogId,dialog){$.each(dialog,function(index,block){block.renderer.handleEvent(args)})})}})})(window,window.Personetics=window.Personetics||{},jQuery);(function(window,Personetics,$,undefined){Personetics.story=Personetics.story||{};Personetics.story.PSkinControler=Base.extend({initialize:function(){},setStory:function(story){this.story=story},registerWidgets:function(){this.registerDefaultWidgets()},registerBlocks:function(){this.registerDefaultBlocks();this.registerDefaultChartHeplers()},getTablesFormat:function(){return Personetics.story.getTablesFormat()},afterRender:function(dlg,callback){if(dlg.shouldShow()){dlg.el.css({opacity:0.0,visibility:"visible"});dlg.el.fadeTo(0,1)}
if(callback)
callback()},beforeRender:function(dlg,callback){callback()},registerBlock:function(type,config){Personetics.story.PBlockFactory.registerBlock(type,config)},registerChartHelper:function(name,clazz){Personetics.story.BlockChartFactory.registerChartHelper(name,clazz)},getAccountSelectorPalette:function(){return['darkBlue','turquoise','grey','red','lightBlue','orange']},getGraphPalette:function(){return['#5D68C2','#3B49B6','#1729AF','#111F88','#08176C']},getColumnGraphPalette:function(){return['#5D68C2','#3B49B6','#1729AF','#111F88','#08176C']},getBarGraphPalette:function(){return['#5D68C2','#3B49B6','#1729AF','#111F88','#08176C']},getPieGraphPalette:function(){return['#5D68C2','#3B49B6','#1729AF','#111F88','#08176C']},getBarChartMultiSeriesLabels:function(labels){return function(){if(labels&&labels.length>0){var label=labels[this.series.index];return("<span class='"+this.series.name+"'>"+label+"</span>")}
else{return""}}},registerDefaultBlocks:function(type){this.registerBlock("txt",{blockClass:Personetics.story.TextBlock});this.registerBlock("text",{blockClass:Personetics.story.TextBlock});this.registerBlock("date-box",{blockClass:Personetics.story.DateBoxBlock});this.registerBlock("image",{blockClass:Personetics.story.ImageBlock});this.registerBlock("textboxes",{blockClass:Personetics.story.TextBoxes});this.registerBlock("compare-block",{blockClass:Personetics.story.CompareBlock});this.registerBlock("buttons",{blockClass:Personetics.story.ButtonsBlock});this.registerBlock("account-selector",{blockClass:Personetics.story.AccountSelectorBlock});this.registerBlock("tabs",{blockClass:Personetics.story.TabsBlock});this.registerBlock("selectOne",{blockClass:Personetics.story.SelectOneBlock});this.registerBlock("external-links",{blockClass:Personetics.story.ButtonsBlock});this.registerBlock("tranList",{blockClass:Personetics.story.TableBlock});this.registerBlock("table",{blockClass:Personetics.story.TableBlock});this.registerBlock("bar-chart",{blockClass:Personetics.story.D3BarChartBlock});this.registerBlock("line-chart",{blockClass:Personetics.story.DotsLineChartBlock});this.registerBlock("bar-chart",{blockClass:Personetics.story.BarChartBlock});this.registerBlock("bar-chart",{blockClass:Personetics.story.BarCharHighchartstBlock,class:"highcharts"});this.registerBlock("pie-chart",{blockClass:Personetics.story.PieChartBlock});this.registerBlock("arc-chart",{blockClass:Personetics.story.PieChartBlock});this.registerBlock("pie-chart",{blockClass:Personetics.story.PieChartBlock,widthMode:"small"});this.registerBlock("pie-chart",{blockClass:Personetics.story.WidePieChartBlock,widthMode:"wide"});this.registerBlock("pie-chart",{blockClass:Personetics.story.PieChartHighchartsBlock,class:"highcharts"});this.registerBlock("spline-chart",{blockClass:Personetics.story.SplineCharHighchartstBlock,class:"highcharts"});this.registerBlock("pinGraph-chart",{blockClass:Personetics.story.PinGraphChartBlock});this.registerBlock("map",{blockClass:Personetics.story.MapBlock});this.registerBlock("pin-graph",{blockClass:Personetics.story.D3PinGraphChartBlock});this.registerBlock("pin-chart",{blockClass:Personetics.story.D3PinGraphChartBlock});this.registerBlock("h-box",{blockClass:Personetics.story.HBoxBlock})},registerDefaultChartHeplers:function(){this.registerChartHelper("verticalHelper",{helperClass:Personetics.utils.d3Helpers.VerticalChartHelper});this.registerChartHelper("horizontalHelper",{helperClass:Personetics.utils.d3Helpers.HorizontalChartHelper});this.registerChartHelper("multiVerticalHelper",{helperClass:Personetics.utils.d3Helpers.MultiVerticalChartHelper});this.registerChartHelper("multiHorizontalHelper",{helperClass:Personetics.utils.d3Helpers.MultiHorizontalChartHelper});this.registerChartHelper("pinGraphHelper",{helperClass:Personetics.utils.d3Helpers.PinGraphChartHelper});this.registerChartHelper("lineChartHelper",{helperClass:Personetics.utils.d3Helpers.LineChartHelper})},registerDefaultWidgets:function(){Personetics.UI.PWidgetFactory.registerWidget("app-ctrl",{widgetClass:Personetics.UI.PAppCtrl,widgetName:"Base app ctrl"});Personetics.UI.PWidgetFactory.registerWidget("master",{widgetClass:Personetics.UI.PAppCtrl,widgetName:"Base master"});Personetics.UI.PWidgetFactory.registerWidget("insights",{widgetClass:Personetics.story.PInsighsCtrl,widgetName:"Base insights"});Personetics.UI.PWidgetFactory.registerWidget("insights-overlay",{widgetClass:Personetics.story.PInsighsOverlayCtrl,widgetName:"Base insights overlay"});Personetics.UI.PWidgetFactory.registerWidget("inbox",{widgetClass:Personetics.story.PInboxCtrl,widgetName:"Base inbox"});Personetics.UI.PWidgetFactory.registerWidget("management",{widgetClass:Personetics.UI.PManagementCtrl,widgetName:"Base management"});Personetics.UI.PWidgetFactory.registerWidget("ratings",{widgetClass:Personetics.UI.PRatingCtrl,widgetName:"Base ratings"});Personetics.UI.PWidgetFactory.registerWidget("story-widget",{widgetClass:Personetics.UI.PStoryWidgetCtrl,widgetName:"Base story widget"});Personetics.UI.PWidgetFactory.registerWidget("loading-animation",{widgetClass:Personetics.UI.PLoadingAnimationCtrl,widgetName:"Base loading"});Personetics.UI.PWidgetFactory.registerWidget("teaser-widget",{widgetClass:Personetics.UI.PTeaserWidgetCtrl,widgetName:"Base teaser widget"});Personetics.UI.PWidgetFactory.registerWidget("teaser-insight-widget",{widgetClass:Personetics.UI.PInsightTeaserWidgetCtrl,widgetName:"Base teaser insight widget"})}});Personetics.story.skinController=Personetics.story.PSkinControler})(window,window.Personetics=window.Personetics||{},jQuery);(function(window,Personetics,$,undefined){Personetics.story=Personetics.story||{};Personetics.story.PDialog=Base.extend({initialize:function(story,config){var dlg=this;this.story=story;this.config=config;this.lang=story.lang;this.id=story.getId()+"_"+this.config.id;this.txts={};this.visible=!1;this.class=this.config.class?this.config.class:"";if(this.config.showIf)
this.showCondExp=new Personetics.processor.PExp(this.config.showIf);this.isShouldShow=null;this.loadTexts(story.texts,story.lang,story.defaultLang);this.initializeBlocks()},loadTexts:function(config,lang,defaultLang){var defaultConfig=this.config.txt||{};var langTexts=config&&config.hasOwnProperty(this.config.id)?config[this.config.id]:null;if(langTexts&&langTexts.hasOwnProperty(defaultLang)){var ar;if(langTexts.hasOwnProperty(lang))
ar=langTexts[lang];else ar=langTexts[defaultLang];$.each(ar,function(textId,textTemplate){defaultConfig[textId]=textTemplate})}
var txts={};var wf=this.story;var dlg=this;if(defaultConfig){$.each(defaultConfig,function(key,txt){var langTxt=txt;if(langTexts){langTxt=langTexts[lang]?langTexts[lang][key]:null;if(!langTxt)
langTxt=langTexts[defaultLang]?langTexts[defaultLang][key]:txt;if(!langTxt)
langTxt=txt}
dlg.txts[key]=langTxt})}
else{Personetics.log("Personetics.story.PDialog.loadTexts: dialog doesn't have any text configuration")}},getId:function(){return this.id},getShortId:function(){return this.config.id},getText:function(txtId){var txt;if(this.txts){var txts=this.txts;if(txts)
txt=txts[txtId]}
return txt},processText:function(txtId,context,parentContext){var pTxt=this.getText(txtId);if(!pTxt)
return"-";if(this.story.mode=="preview")
return pTxt.getTextTemplate();else return pTxt.process(context,parentContext)},shouldShow:function(){if(!this.showCondExp)
return!0;if(this.isShouldShow==null){try{this.isShouldShow=this.showCondExp.eval(this.story.model)}
catch(e){this.isShouldShow=null}}
return this.isShouldShow},generateData:function(){var isFirstDialog=this.isFirstDialog;var data={id:this.getId(),class:this.config.class};if(this.config.isSingleDialogMode){data.btn=[];data.btn.diaogBtn=[];data.btn.showBtn=[];if(this.config.next){data.btn.push({diaogBtn:"Continue",actionBtn:"continue",showBtn:!0})}
else{data.btn.push({diaogBtn:"Close",actionBtn:"close",showBtn:!0})}
if(!isFirstDialog){data.btn.push({diaogBtn:"Previous",actionBtn:"prev",showBtn:!0})}}
return data},render:function(el,isFirstDialog){this.isFirstDialog=isFirstDialog;var shouldShow=this.shouldShow();var isSingleDialogMode=this.config.isSingleDialogMode;if(isSingleDialogMode&&!shouldShow){this.story.renderDialog()}
else{if(shouldShow){var template=this.story.getTemplate("#tmpl-pstory-dialog");if(isSingleDialogMode){template=this.story.getTemplate("#tmpl-pstory-dialog-continue-btn");el.find('.pstory-dialog-frame').hide()}
var data=this.generateData();var html=template(data);var dlgEl=$(html);this.el=dlgEl;el.append(dlgEl)}}},afterRender:function(){var dlg=this;var story=this.story;var dlgEl=this.el;var shouldShow=this.shouldShow();var isSingleDialogMode=this.config.isSingleDialogMode;if(shouldShow){var contentEl=this.el.find('.pstory-dialog-content');if(isSingleDialogMode){if(this.story.parent.scrollTo){this.story.parent.scrollTo(dlgEl.offset().top)}
var dialogButtonsHeight=this.el.find('.pstory-dialog-buttons').height();contentEl.height(contentEl.height()-dialogButtonsHeight)}
if(contentEl.parents('.pstory-dialog-frame').hasClass('horizontal')){this.config.dialogWidth=contentEl.width()}
this.renderBlocks(contentEl);if(contentEl.parents('.pstory-dialog-frame').hasClass('horizontal')){var blocks=contentEl.find('.pstory-block-frame');var width=contentEl.width();var height=0;width/=blocks.length;$.each(blocks,function(i,item){var margin=parseInt($(item).css('margin-left'))+parseInt($(item).css('margin-right'));var itemWidth=width-margin;$(item).width(itemWidth);var itemHeight=$(item).children().first().height();height=itemHeight>height?itemHeight:height});contentEl.height(height)}}},bindEvents:function(){var story=this.story;var shouldShow=this.shouldShow();if(shouldShow){var dlgEl=this.el;var contentEl=this.el.find('.pstory-dialog-content');var dlgClickHandler=story.cfg.dlgClickHandler;if(dlgClickHandler){contentEl.bind("click",function(){dlgClickHandler(this)})}
var continueButtonEl=dlgEl.find(".pstory-dialog-btn");continueButtonEl.bind("click",function(){var opts={};if($(this).data('action')=='prev'){opts.renderPreviousDialog=!0}
else if($(this).data('action')=='close'){story.closeHandler();return}
story.renderDialog(null,opts)})}},initializeBlocks:function(){var dlg=this;var story=this.story;story.blockSessionManager.resetDialog(this.getShortId());this.config.blocks.forEach(function(blockCfg,index){var show=!0;if(blockCfg.showIf){try{var showIfExp=new Personetics.processor.PExp(blockCfg.showIf);show=showIfExp.eval(story.model)}
catch(e){show=!0}}
if(show){blockCfg.index=index;story.blockSessionManager.startBlock(dlg.getShortId(),dlg.txts,blockCfg,index)}})},renderBlocks:function(contentEl){this.story.blockSessionManager.renderBlocks(this.getShortId(),contentEl,this.isFirstDialog)},setIsBlock:function(){if(this.shouldShow()){this.el.addClass("perso-block");$(this.el).find("*").off()}},setVisible:function(visible){if(this.visible==visible)
return;this.visible=visible;var dlg=this;this.story.blockSessionManager.setVisible(this.getShortId,visible)},addBlock:function(block){this.blocks.push(block)}})})(window,window.Personetics=window.Personetics||{},jQuery);(function(window,Personetics,$,undefined){Personetics.story=Personetics.story||{};Personetics.story.PWorkflowCtx=Base.extend({initialize:function(wf,model){this.wf=wf;this.dialogs=[];this.firstDialogId=null},pushDlg:function(dlg){this.dialogs.push(dlg);var isShouldShow=dlg.shouldShow();if(!this.firstDialogId&&isShouldShow)
this.firstDialogId=dlg.getShortId()},getFirstDialogId:function(){return this.firstDialogId},hasDlg:function(dlgId){this.dialogs.forEach(function(dlg,index){if(dlg.getId()==dlgId)
return!0});return!1},getDlg:function(dlgId){var result=null;this.dialogs.forEach(function(dlg,index){if(dlg.getShortId()==dlgId)
result=dlg;return!0});return result},removeDlgsAfter:function(pivotDlgId){if(!pivotDlgId){var after=this.dialogs;this.dialogs=[];return after}
var dlgsBefore=[];var dlgsAfter=[];var before=!0;this.dialogs.forEach(function(dlg,index){if(before)
dlgsBefore.push(dlg);else dlgsAfter.push(dlg);var curDlgId=dlg.getId();if(curDlgId==pivotDlgId)
before=!1});this.dialogs=dlgsBefore;return dlgsAfter}})})(window,window.Personetics=window.Personetics||{},jQuery);(function(window,Personetics,$,undefined){Personetics.story=Personetics.story||{};Personetics.story.PStory=Personetics.story.PCtrlBase.extend({initialize:function(config){this.cfg=config;this.super=Personetics.story.PCtrlBase.prototype;this.super.initialize.call(this,config.parent);this.cfg.chartsLibClass=typeof Highcharts!=='undefined'?"highcharts":null;this.cfg.widthMode="";this.storyDef=config.flowDef||config.storyDefinition;this.id=this.storyDef.storyId;this.insight=config.insight;this.pserver=config.pserver;if(!this.pserver){if(typeof personetics!=='undefined'&&personetics!==null)
this.pserver=personetics.pserverProxy;else this.pserver=null}
var insightFacts=config.data||config.insightFacts;var options={};this.texts=config.texts||config.storyText;this.ctx=new Personetics.story.PWorkflowCtx(this);this.templates={};this.closeHandler=config.closeHandler;this.defaultLang=config.defaultLang||"en";options.lang=config.lang||this.defaultLang;var skinController=config.uxCtrl;if(!skinController)
skinController=new Personetics.story.skinController();this.uxCtrl=skinController;this.desktopScreenWidth=this.uxCtrl.getDesktopScreenWidth();this.screenWidth=$(window).width();if(this.screenWidth>this.desktopScreenWidth){this.cfg.widthMode="desktop"}
this.uxCtrl.registerBlocks();options.useProjectDefaultCurrency=Personetics.projectConfiguration.getConfig("useProjectDefaultCurrency");options.supportHtmlTagInProcessor=Personetics.projectConfiguration.getConfig("supportHtmlTagInProcessor");options.amountFormat=Personetics.projectConfiguration.getConfig("amountFormat");options.dateFormat=Personetics.projectConfiguration.getConfig("dateFormat");options.currencySymbol=Personetics.projectConfiguration.getConfig("currencySymbol");this.options=options;this.expressions=config.expressions;this.blockSessionManager=new Personetics.story.PBlockSessionManager(this);this.model=this.blockSessionManager.getModel();var dlgCfgMap={};this.storyDef.dialogs.forEach(function(cfg){if(dlgCfgMap[cfg.id])
Personetics.log("duplicate dlg found: "+cfg.id);else dlgCfgMap[cfg.id]=cfg});this.dlgCfgMap=dlgCfgMap},getId:function(){return this.id},fireEvent:function(block,e){this.handleEvent(block,e)},start:function(parentEl){this.parentEl=parentEl;var direction=Personetics.processor.PStoryConfig.isRtl()==!0?"rtl":"ltr";var storyData={storyId:this.getId(),langClass:"pstory-lang-"+this.lang,directionClass:"pstory-direction-"+direction,cssClass:this.cfg.cssClass};var html=this.getTemplateHtml("#pstory-frame",storyData);var newEl=$(html);newEl=parentEl.append(newEl);this.frameEl=newEl.find(".pstory-frame");this.el=this.frameEl.find(".pstory-container");var resizedEl=this.el;this.renderTitleText();this.setPlaceHolderForFixedTitle();this.renderDialogs();this.scrollHandler();var contentEl=parentEl},renderDialogs:function(){if(this.cfg.isSingleDialogMode)
this.renderDialog();else this.doNextLoop()},renderTitleText:function(){if(!this.cfg.showTitle)
return;var title=this.getTitle();var subtitle=this.getSubtitle();var iconType=this.cfg.iconType;var pstory_title=this.parentEl.siblings().find('.pstory-title-text');if(pstory_title.length>0){this.parentEl.siblings().find('.pstory-subtitle-text').html(subtitle);this.parentEl.siblings().find('.pstory-title .perso-teaser-image').addClass("perso-"+iconType);this.parentEl.siblings().find('.pstory-title-text').html(title)}
else{var html=this.getTemplateHtml("#tmpl-pstory-title-inside-story",{title:this.getTitle(),backButtonText:'back'});var newEl=$(html);this.el.append(newEl);this.el.find('.pstory-subtitle-text').html(subtitle);this.el.find('.pstory-title .perso-teaser-image').addClass("perso-"+iconType);this.el.find('.pstory-title-text').html(title)}},getTitle:function(){return this.getTitleHelper("title")},getSubtitle:function(){return this.getTitleHelper("subtitle")},getTitleHelper:function(type){var lang=this.options.lang;var defaultLang=this.defaultLang;var titleCfg=this.storyDef[type];if(this.texts.hasOwnProperty(type)&&this.texts[type]){var textTitleCfg=this.texts[type];if(textTitleCfg.hasOwnProperty(lang))
titleCfg=textTitleCfg[lang];else if(textTitleCfg.hasOwnProperty(defaultLang))
titleCfg=textTitleCfg[defaultLang]}
if(!titleCfg)
return null;var titleExp=new Personetics.processor.PTextTemplate(titleCfg.txt,this);var title=titleExp.process(this.model);return title},addTouchScroll:function(){this.frameEl.addClass("pstory-scrolling-touch")},renderDialog:function(startHeight,options){var nextDlg;var flow=this;if(this.current){this.current.setIsBlock();var targetsCfg;if(options&&options.hasOwnProperty("renderPreviousDialog")){var renderPreviousDialog=options.renderPreviousDialog;if(renderPreviousDialog)
targetsCfg=this.findPreviousDialog();else targetsCfg=this.current.config.next}
else{targetsCfg=this.current.config.next}
if(targetsCfg){nextDlg=this.renderNextDlg(targetsCfg,null)}}
else{nextDlg=this.pushDlg(this.storyDef.dialogs[0],null)}
if(!nextDlg){var endHeight=flow.el.height();if(startHeight&&startHeight!=endHeight){if(flow.cfg.resizeHandler)
flow.cfg.resizeHandler(endHeight)}}},findPreviousDialog:function(){var currentDialog=this.current;var dialogsConfig=this.storyDef.dialogs;var res=null;$.each(dialogsConfig,function(index,dialogConfig){var next=dialogConfig.next;if(next){if($.isArray(next)){$.each(next,function(index,nextConfig){if(nextConfig.target==currentDialog.config.id){res={"target":dialogConfig.id};return!1}})}
else{if(next.target==currentDialog.config.id){res={"target":dialogConfig.id};return!1}}}});return res},doNextLoop:function(startHeight){var story=this;var firstNext=this.current;var nextStep=function(){var nextDlg=story.next(nextStep);if(!nextDlg){var endHeight=story.el.height();story.afterLastDialog(endHeight,startHeight)}};nextStep();if(firstNext){var next=firstNext.config.next;if(next){var target;if($.isArray(next)){target=next[0].target}
else{target=next.target}
var id='pdlg-'+story.id+'_'+target;var parent=this.el.parents('.perso-insights-container');this.scrollTo(parent,id);this.setFocus(id)}}},afterLastDialog:function(endHeight,startHeight){var story=this;if(startHeight&&startHeight!=endHeight){if(story.cfg.resizeHandler)
story.cfg.resizeHandler(endHeight,story.el)}
if(story.cfg.onEndHandleEvent){story.cfg.onEndHandleEvent(story.el)}},setPlaceHolderForFixedTitle:function setPlaceForFixedTitle(){var titleEl=$('.pstory-title-wrapper');var height=titleEl.height();if(titleEl.length>0&&titleEl.css('position')=='fixed'){var titleParent=titleEl.parent('.pstory-title-outer-wrapper');titleParent.css('paddingBottom',height+'px')}
var storyFrame=this.el.parents('#story-frame-container');if(storyFrame.length==0){storyFrame=this.el.parents('.pstory-frame')}
var editorFrame=this.el.parents('.pstory-frame');while(editorFrame.height()==0){editorFrame=editorFrame.parent()}
var heightFrame=storyFrame.height()>0?storyFrame.innerHeight():editorFrame.height();storyFrame.height(heightFrame-height)},pushDlg:function(cfg,callback){cfg.isSingleDialogMode=this.cfg.isSingleDialogMode;cfg.widthMode=this.cfg.widthMode;cfg.chartsLibClass=this.cfg.chartsLibClass;var dlg=new Personetics.story.PDialog(this,cfg);this.ctx.pushDlg(dlg);var firstDialogId=this.ctx.getFirstDialogId();var isFirstDialog=firstDialogId==cfg.id;this.current=dlg;var story=this;this.uxCtrl.beforeRender(dlg,function(){dlg.render(story.el,isFirstDialog);dlg.afterRender();dlg.bindEvents();story.uxCtrl.afterRender(dlg,callback)});return dlg},next:function(callback){var nextDlg;if(!this.current)
nextDlg=this.pushDlg(this.storyDef.dialogs[0],callback);var transCfg=this.current.config.next;if(!nextDlg&&transCfg){nextDlg=this.renderNextDlg(transCfg,callback)}
return nextDlg},renderNextDlg:function(transCfg,callback){var trans=transCfg;var isQuiz=!1;for(var i=0;i<this.current.config.blocks.length;i++){if(this.current.config.blocks[i].hasOwnProperty('buttonType')&&this.current.config.blocks[i].hasOwnProperty('class')&&this.current.config.blocks[i].buttonType==="button"&&this.current.config.blocks[i].class==="perso-radio-buttons"){isQuiz=!0;break}}
if(!Array.isArray(transCfg))
trans=[transCfg];if(!isQuiz||(isQuiz&&this.model.getVarValue('selectedAnswer'))){for(var i=0;i<trans.length;i++){var tr=trans[i];var ok=!0;if(tr.cond){var condExp=new Personetics.processor.PExp(tr.cond);try{ok=condExp.eval(this.model)}
catch(e){ok=!1}}
if(ok){if(this.ctx.hasDlg(tr.target))
break;var config=this.dlgCfgMap[tr.target];if(!config){Personetics.utils.PLogger.error("could not find dialog definition for target: "+tr.target)}else{var nextDlg=this.pushDlg(config,callback);break}}}}},handleEvent:function(block){this.el.prevObject.removeClass('pstory-scrolling-touch');var me=this;var startHeight=this.el.height();if(this.cfg.onStartHandleEvent){this.cfg.onStartHandleEvent(startHeight,this.el)}
this.current=null;var dlgId=null;if(block){dlgId=block.dlgId;this.current=this.ctx.getDlg(block.dlgId)}
var after=this.ctx.removeDlgsAfter(this.current.getId());var story=this;after.forEach(function(dlg){if(dlg.el)
dlg.el.remove();$.each(dlg.config.blocks,function(i,block){me.blockSessionManager.resetVariables(block)})});this.blockSessionManager.reset();if(this.cfg.isSingleDialogMode)
this.renderDialog(startHeight);else this.doNextLoop(startHeight);this.el.prevObject.addClass('pstory-scrolling-touch')},handleQueryData:function(data,block){this.blockSessionManager.renderBlock(block.dlgId,block.index,data)},handleScroll:function(scrollTop,scrollBottom){this.ctx.dialogs.forEach(function(dlg,index){var dlgTop=dlg.el.position().top;var dlgBottom=dlgTop+dlg.el.height();var isVisible=!0;if(dlgBottom<=scrollTop||dlgTop>=scrollBottom)
isVisible=!1;dlg.setVisible(isVisible)})},scrollTo:function scrollTo(el,toElementId){},setFocus:function setFocus(elId){},scrollHandler:function(){var story=this;var totalHeight=0;$(this.frameEl).bind("scroll",function(event){var scrollTop=$(this.frameEl).scrollTop();story.blockSessionManager.handleEvent("scroll",scrollTop)})}})})(window,window.Personetics=window.Personetics||{},jQuery);(function(window,Personetics,$,undefined){Personetics.utils=Personetics.utils?Personetics.utils:{};Personetics.utils.accessibility={};Personetics.utils.accessibility.isFocusable=function isFocusable(element){if($(element).is('[aria-hidden="true"], [aria-hidden="true"] *'))
return!1;var hasText=$(element).contents().not($(element).children()).text().trim().length>0;if($(element).is(":input, [role], [aria-label], [aria-labelledby]")||hasText)
return!0;return!1};Personetics.utils.accessibility.firstChildFocusable=function firstChildFocusable(element){if(typeof element=='undefind'||element==null||element.length==0){return!1}
var me=this;var elementChildren=element.find('*');var result=!1;$.each(elementChildren,function(i,elem){result=me.isFocusable(elem);if(result==!0){result=elem;return!1}});return result};Personetics.utils.accessibility.trackFocus=function trackFocus(element){if(typeof element==="undefined"||element.length===0){return}
var usingMouse;var el=element.get(0);var preFocus=function(event){usingMouse=(event.type==='mousedown')};var addFocus=function(event){if(usingMouse){var className=event.target.getAttribute("class");event.target.setAttribute("class",className+' personetics-mouse-focus')}};var removeFocus=function(event){var className=event.target.getAttribute("class");if(className!==null){className=className.replace(/ personetics-mouse-focus/g,'');event.target.setAttribute("class",className)}};var bindEvents=function(){el.removeEventListener('keydown',preFocus);el.removeEventListener('mousedown',preFocus);el.removeEventListener('focusin',addFocus);el.removeEventListener('focusout',removeFocus);el.addEventListener('keydown',preFocus);el.addEventListener('mousedown',preFocus);el.addEventListener('focusin',addFocus);el.addEventListener('focusout',removeFocus)};bindEvents()}})(window,window.Personetics=window.Personetics||{},jQuery);(function(window,Personetics,$,undefined){Personetics.utils=Personetics.utils?Personetics.utils:{};var allAccountsAnimation=function allAccountsAnimation(){var animationMap={};var isValidate=function isValidate(animationObj){var isValid=!1;if(typeof animationObj.type==='undefined'||animationObj.type===null){Personetics.error("Required property 'type' is missing")}
else if(typeof animationObj.doAnimation==='undefined'||animationObj.doAnimation===null){Personetics.error("Required property 'doAnimation' is missing")}
else if(typeof animationObj.cancelAnimation==='undefined'||animationObj.cancelAnimation===null){Personetics.error("Required property 'cancelAnimation' is missing")}
else isValid=!0;return isValid}
function addAnimation(animationObj){if(isValidate(animationObj)){animationMap[animationObj.type]={doAnimation:animationObj.doAnimation,cancelAnimation:animationObj.cancelAnimation}}}
var getAnimation=function getAnimation(type){if(animationMap.hasOwnProperty(type)){return animationMap[type]}
else Personetics.error("All accounts animation doesn't support this type: "+type)}
function init(){addAnimation({type:'heapCards',doAnimation:function allAccountsAnimation_heapCards(selectedCard,cards,params){var cardsLength=cards.length;var totalHeight=params.cardsStackTotalHeight||$(cards).height()/5;var maxSpaceBetweenCards=params.maxSpaceBetweenCards||10;var topSpacing=Math.min(maxSpaceBetweenCards,totalHeight/cardsLength);var realTotalHeight=cardsLength*topSpacing;var topValue=(totalHeight-realTotalHeight)/2;$(selectedCard).css('top',topValue+'px');$(selectedCard).css('zIndex',cardsLength+1);$.each(cards,function(index,card){var selectedCardLeft=$(selectedCard).offset().left;var offsetLeft=$(card).offset().left;var left=parseInt($(card).css('left'));var setLeftValue=selectedCardLeft-offsetLeft+left;$(card).css({'left':setLeftValue+'px','top':((index+1)*topSpacing+topValue)+'px','zIndex':cardsLength-index})});if(params.showBoxShadowForLastCardOnly){cards.last().addClass('pstory-boxshadow-card')}
else cards.add(selectedCard).addClass('pstory-boxshadow-card');if(params.scale){$(selectedCard).css({'transform':'scalex(1)'});$.each(cards,function(index,card){var scaleX=1-(index+1)*params.scale;$(card).css({'transform':'scalex('+scaleX+')'})})}},cancelAnimation:function(cards){cards.css({'left':'','top':''})}});addAnimation({type:'fadingSlidingOut',doAnimation:function allAccountsAnimation_fadingOut(selectedCard,cards,params){var container=params.container||selectedCard.parents('.options-container');$.each(cards.add(selectedCard),function(index,card){var offsetLeft=$(card).offset().left-container.offset().left;var left=parseInt($(card).css('left'));var setLeftValue=$('.options-container').width()-offsetLeft+left;$(card).css('left',setLeftValue+'px')})},cancelAnimation:function(cards){cards.css({'left':''})}})}
init();this.addAnimation=addAnimation;this.getAnimation=getAnimation};Personetics.utils.allAccountsAnimation=new allAccountsAnimation()})(window,window.Personetics=window.Personetics||{},jQuery);(function(window,Personetics,$,undefined){Personetics.utils=Personetics.utils?Personetics.utils:{};Personetics.utils.buttonAnimation={};Personetics.utils.buttonAnimation.bindMaterialButtonEventsForAnimation=function bindMaterialButtonEventsForAnimation(elements){var rplObj,x,y,ink,color,rplDelTimer;$(elements).bind("click",function(e){$('.ink').siblings().one("click",function(e){e.stopPropagation()});$(e.currentTarget).find('.ink').siblings().click()});$(elements).bind("touchend",function(){$('.ink').css({'opacity':'0'});delRipple()});function delRipple(){rplDelTimer=setTimeout(function(){$('.ink').remove()},800)}
$(elements).bind("touchstart",function(e){x=e.originalEvent.touches[0].pageX;y=e.originalEvent.touches[0].pageY;rplObj=$(this);color=$(this).css('color');rippleClosed()})
function rippleClosed(){rplObj.prepend('<span class="ink"></span>');ink=rplObj.find('.ink');ink.css('background',color);if(!ink.height()&&!ink.width()){d=Math.max(rplObj.outerWidth(),rplObj.outerHeight());ink.css({height:d,width:d})}
x=x-rplObj.offset().left-ink.width()/2;y=y-rplObj.offset().top-ink.height()/2;ink.css({top:y+'px',left:x+'px'}).css({'transform':'scale(1.8)'});clearTimeout(rplDelTimer)}
function rippleOpen(){rplObj.prepend('<span class="ink"></span>');ink=rplObj.find('.ink');ink.css('background',color);if(!ink.height()&&!ink.width()){d=Math.max(rplObj.outerWidth(),rplObj.outerHeight());ink.css({height:d,width:d})}
x=rplObj.offset();y=rplObj.offset();ink.css({top:y+'px',left:x+'px'}).css({'transform':'scale(1.8)'});clearTimeout(rplDelTimer)}}})(window,window.Personetics=window.Personetics||{},jQuery);(function(window,Personetics,$,undefined){Personetics.utils=Personetics.utils?Personetics.utils:{};Personetics.utils.carouselAnimation={};Personetics.utils.carouselAnimation.bindCarouselEventsForAnimation=function bindCarouselEventsForAnimation(elementWrapper,param){var innerWrapper;var carouselItems;var carouselItemsBase;var config={};var keyCode={"Space":32,"Enter":13,"LeftArrow":37,"RightArrow":39,"UpArrow":38,"DownArrow":40};init();function init(){innerWrapper=$(elementWrapper).find('.carousel-inner-wrapper');carouselItemsBase=innerWrapper.find('.carousel-item');innerWrapper.attr('num-original-cards',carouselItemsBase.length);if(typeof param=='undefined'){param={}}
if(typeof param.itemWidth!='undefined'){config.itemWidth=param.itemWidth}
if(typeof param.selectedItemWidth!='undefined'){config.selectedItemWidth=param.selectedItemWidth}
if(typeof param.numItemsDispaly=='undefined'){param.numItemsDispaly=3}
if(carouselItemsBase.length>1){var copyData=carouselItemsBase.clone(!0);copyData.attr('clone','true');var copyData2=copyData.clone(!0);innerWrapper.prepend($(copyData));innerWrapper.append($(copyData2).slice(0,2))}
carouselItems=innerWrapper.find('.carousel-item');setConfig(config.itemWidth,config.selectedItemWidth);this.dotAnimation=new Personetics.utils.DotAnimation.bindDotEventsForAnimation(elementWrapper,carouselItemsBase,param);this.dotAnimation.setSelectedDot();setNumItemsToDispaly(param.numItemsDispaly);bindEvents();caruselAccessibility()};function setConfig(itemWidth,selectedItemWidth){if(typeof itemWidth=='undefined'){itemWidth=carouselItemsBase.filter(':not(.selected)').outerWidth(!0)}
if(typeof selectedItemWidth=='undefined'){selectedItemWidth=carouselItemsBase.filter('.selected').outerWidth(!0)}
config.itemWidth=itemWidth;config.selectedItemWidth=selectedItemWidth;var left=0;var left2=0;var selectedIndex=-1;$.each(carouselItemsBase,function(index,item){if($(item).hasClass('selected')){selectedIndex=index}});if(selectedIndex==-1){selectedIndex=0;var pstoryId=carouselItemsBase.first().attr("pstory-id");carouselItems.filter("[pstory-id='"+pstoryId+"']").addClass('selected')}
var carouselItemsBaseLength=carouselItemsBase.length;if(carouselItemsBaseLength>1){left-=itemWidth*(carouselItemsBaseLength-1);left-=selectedItemWidth}
left2=(elementWrapper.width()-selectedItemWidth)/2;left+=left2;var left3=left-(itemWidth*selectedIndex);config.minLeft=left;innerWrapper.css({'transition-duration':'0s','-webkit-transition-duration':'0s'});innerWrapper.css({'left':left3+'px'})};function setNumItemsToDispaly(numItemsDispaly){if(typeof numItemsDispaly=='number'){config.numItemsDispaly=numItemsDispaly;if(numItemsDispaly>carouselItemsBase.length){carouselItems.filter("[clone='true']").addClass('carousel-hide-clone')}
else{carouselItems.removeClass('carousel-hide-clone')}}}
function bindEvents(){if(param.onClick!==!1){carouselItems.bind('click',function(e){if($(elementWrapper).hasClass('carousel-disable')==!1){startCarousel(e)}});$("#personetics-teaser-widget-carousel").bind('keydown',function(e){if(e.target===document.activeElement){if([keyCode.RightArrow].indexOf(e.which)!==-1){onSwipe('right')}
if([keyCode.LeftArrow].indexOf(e.which)!==-1){onSwipe('left')}
if([keyCode.Enter].indexOf(e.which)!==-1){$(this).find(".account-button.selected").click()}}})}
if(param.onSwipe!==!1){$(elementWrapper).swipe(function(e){if($(elementWrapper).hasClass('carousel-disable')==!1){onSwipe(e)}},{preventDefault:!1})}};function startCarousel(e){if(typeof param.beforeCarouselStart=='function'){param.beforeCarouselStart(e)}
doAnimation(e,param.animateDuration);if(param.showIndexDots)
this.dotAnimation.updateIndex(e)};function onSwipe(e){if($(elementWrapper).hasClass('carousel-disable')||this.disableInputSelect){if(param&&param.onAnimationEnd){param.onAnimationEnd()}
return}
if(e=='left'||e=='right'){var carouselItemsLength=carouselItems.length;var indexSelected=carouselItemsBase.filter('.selected').index();var direction=e=='left'?1:-1;indexSelected+=direction;if(indexSelected==carouselItemsLength){indexSelected=0}
if(indexSelected<0){indexSelected=carouselItemsLength-1}
if(carouselItemsBase.length<config.numItemsDispaly&&$(carouselItems[indexSelected]).attr('clone')=='true'){config.swipeDirection=null;if(param&&param.onAnimationEnd){param.onAnimationEnd()}
return}
config.swipeDirection=direction*-1;var event={};event.swipeDirection=e;event.currentTarget=carouselItems[indexSelected];startCarousel(event)}};function caruselAccessibility(){var selectedShow=carouselItems.filter(".selected:not([clone='true'])");selectedShow.siblings().attr("aria-hidden",!0);selectedShow.attr("aria-hidden",!0);selectedShow.prev().addClass("prev");selectedShow.next().addClass("next");selectedShow.prev().addClass("prev");selectedShow.next().addClass("next");carouselItems.removeAttr("aria-label");if(typeof param.text!="undefined"){if(typeof param.text.next!="undefined")
selectedShow.next().attr("aria-label",param.text.next);if(typeof param.text.prev!="undefined")
selectedShow.prev().attr("aria-label",param.text.prev)}};function setAccessibilityFocus(waitTime){var selectedShow=param&&param.isDesktop?null:$(".pstory-account-button.selected");if(selectedShow&&selectedShow.length<1){carouselItems.filter(".selected:not([clone='true'])")}
var focusInterval=10+waitTime;var focusTotalRepetitions=10;if(selectedShow){selectedShow.attr('tabindex','0');selectedShow.blur()}
var focusRepetitions=0;var interval=window.setTimeout(function(){if(selectedShow){selectedShow.focus()}
if(param&&param.onAnimationEnd){param.onAnimationEnd()}},focusInterval)};function doAnimation(e,animateDuration){var target=e.currentTarget;if($(target).hasClass('selected')||config.disableInputSelect==!0){return}
var direction=config.swipeDirection;if(direction==null){direction=$(target).hasClass("prev")?1:-1}
config.disableInputSelect=!0;carouselItems.removeClass('selected');carouselItems.removeClass('prev');carouselItems.removeClass('next');var targetId=$(target).attr('pstory-id');carouselItems.filter('[pstory-id="'+targetId+'"]').addClass('selected');if(typeof animateDuration!='number'){animateDuration=300}
var carouselItemsBaseLength=carouselItemsBase.length;var minLeft=config.minLeft;var maxLeft=minLeft-(config.itemWidth*(carouselItemsBaseLength-1)+config.selectedItemWidth);var oldLeft=0;oldLeft=parseFloat(innerWrapper.css('left'));var newLeft=config.itemWidth*direction+oldLeft;var diff=config.selectedItemWidth-config.itemWidth;var selectedIndex=$(target).index();var prev=innerWrapper.find('.carousel-item:lt('+selectedIndex+')');var numSelect=prev.filter('.selected').length;if(numSelect>1){newLeft=newLeft-diff}
else if(numSelect==0){newLeft=newLeft+diff}
setTimeout(function(){innerWrapper.css({'transition-duration':'0s','-webkit-transition-duration':'0s'});if(Math.abs(newLeft)>=Math.abs(maxLeft)-diff){innerWrapper.css({'left':minLeft+'px'})}
else if(Math.abs(newLeft)<Math.abs(minLeft)-diff){maxLeft=maxLeft+config.itemWidth+diff;innerWrapper.css({'left':maxLeft+'px'})}
config.disableInputSelect=!1;if(typeof param.afterCarouselEnd=='function'){param.afterCarouselEnd()}},animateDuration);innerWrapper.css({'transition-duration':animateDuration+'ms','-webkit-transition-duration':animateDuration+'ms'});innerWrapper.css({'left':newLeft+'px'});config.swipeDirection=null;caruselAccessibility();setAccessibilityFocus(animateDuration)};this.startCarousel=startCarousel;this.setConfig=setConfig;this.setNumItemsToDispaly=setNumItemsToDispaly;this.onSwipe=onSwipe}})(window,window.Personetics=window.Personetics||{},jQuery);(function(window,Personetics,$,undefined){Personetics.utils=Personetics.utils?Personetics.utils:{};Personetics.utils.DotAnimation={};Personetics.utils.DotAnimation.bindDotEventsForAnimation=function bindDotEventsForAnimation(elementWrapper,options,params){this.elementWrapper=elementWrapper;this.params=params;this.setSelectedDot=function setSelectedDot(){var selectedIndex=0;$.each(options,function(index,item){if($(item).hasClass('selected')){selectedIndex=index}});if(params.showIndexDots){var indexDots=this.elementWrapper.find('.carousel-index-wrapper .carousel-index-dot');if(params.firstDot){$(indexDots[0]).addClass('pstory-selected-index');$.each(indexDots,function(index,item){var temp=index;$(item).attr('pstory-id',$(options[temp]).attr('pstory-id'))})}
else{var itemsNum=options.length;var middle=Math.ceil(itemsNum/2)-1;var diff=middle-selectedIndex;if(diff<0)
diff=itemsNum+diff;var index=0;for(var i=0;i<options.length;i++){if($(options[i]).hasClass("selected")){index=i;break}}
$(indexDots[index]).addClass('pstory-selected-index');$.each(indexDots,function(index,item){var temp=index;$(item).attr('pstory-id',$(options[temp]).attr('pstory-id'))})}}};this.updateIndex=function updateIndex(e){var target=e.currentTarget;var id=$(target).attr('pstory-id');var dotsWrapper=this.elementWrapper.find('.carousel-index-wrapper');var indexDots=dotsWrapper.find('.carousel-index-dot');if(this.params&&this.params.updateDotsForAccessibility){this.params.updateDotsForAccessibility(dotsWrapper,id)}
indexDots.removeClass('pstory-selected-index');indexDots.filter('[pstory-id="'+id+'"]').addClass('pstory-selected-index')}}})(window,window.Personetics=window.Personetics||{},jQuery);(function(window,Personetics,undefined){Personetics.utils=Personetics.utils?Personetics.utils:{};Personetics.utils.assert={};Personetics.utils.assert.isUndefined=function isUndefined(obj){return typeof obj==='undefined'};Personetics.utils.assert.isNullOrUndefined=function isNullOrUndefined(obj){return typeof obj==='undefined'||obj==null};Personetics.utils.assert.isTrue=function isTrue(obj){var result=!Personetics.utils.assert.isUndefined(obj);return result&&obj==!0};Personetics.utils.assert.isDefined=function isDefined(obj,nullable){var result=!Personetics.utils.assert.isUndefined(obj);if(result&&!Personetics.utils.assert.isUndefined(nullable)&&nullable!=null){if(!nullable)
result=obj!=null}
return result};Personetics.utils.assert.AssertIsDefined=function AssertIsDefined(obj,errorMessage){if(Personetics.utils.assert.isNullOrUndefined(obj))
{if(errorMessage)
Personetics.utils.PLogger.error(errorMessage,errorMessage);else Personetics.utils.PLogger.error("Object is undefined","Object is undefined")}};Personetics.utils.assert.assignDefaultValue=function assignDefaultValue(variable,defaultValueToSet){var result=null;if(Personetics.utils.assert.isUndefined(variable))
result=defaultValueToSet;else result=variable;return result};Personetics.utils.assert.isObject=function isObject(obj)
{return typeof obj==='object'};Personetics.utils.assert.isString=function isString(obj)
{return typeof obj==='string'};Personetics.utils.assert.isArray=function isArray(obj)
{return Object.prototype.toString.call(obj)==='[object Array]'};Personetics.utils.assert.isFunction=function isFunction(obj)
{return typeof obj==='function'};Personetics.utils.assert.exists=function(first,namespace){var tokens=namespace.split('.');var obj=first;for(var i=1;i<tokens.length;i++){obj=(obj=="undefined")?obj:obj[tokens[i]]}
return obj};Personetics.utils.assert.AssertIsNullOrUndefined=function(obj,message){}})(window,window.Personetics=window.Personetics||{});(function(window,Personetics,$,undefined){Personetics.utils=Personetics.utils||{};Personetics.utils.d3Extensions={};var persoHelper=Personetics.utils.persoHelper;Personetics.utils.d3Extensions.html=function(value){if(typeof value!="string"){return}
else{var rootSpan=$('<span>').html(value).first().children()[0];if(typeof rootSpan=='undefined'){this.text(value)}
else{var tspan=this.append('tspan');var attrs=rootSpan.attributes;$.each(attrs,function(j,attr){tspan.attr(attr.name,attr.value)});var valueChildren=$(rootSpan).children();$.each(valueChildren,function(i,node){var innerTspan=tspan.append('tspan').text($(node).text());var attrs=node.attributes;$.each(attrs,function(j,attr){innerTspan.attr(attr.name,attr.value)})})}}};d3.selection.prototype.html=Personetics.utils.d3Extensions.html;Personetics.utils.d3Extensions.text=function text(value){return arguments.length?this.each(typeof value==="function"?function(){var v=value.apply(this,arguments);v=$(v).length>0?$(v)[0].innerText:v;this.textContent=v==null?"":v}:value==null?function(){this.textContent=""}:function(){this.textContent=$(value).length>0?$(value)[0].innerText:value}):this.textContent};if(typeof persoHelper!=='undefined'&&(persoHelper.isOldAndroidVersion())){d3.selection.prototype.text=Personetics.utils.d3Extensions.text}})(window,window.Personetics=window.Personetics||{},jQuery);(function(window,Personetics,undefined){var monthNumbers=[1,2,3,4,5,6,7,8,9,10,11,12];var monthNames={"en-short":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"en":["January","February","March","April","May","June","July","August","September","October","November","December"],"he":["ינואר","פברואר","מרץ","אפריל","מאי","יוני","יולי","אוגוסט","ספטמבר","אוקטובר","נובמבר","דצמבר"],"he-short":["ינו'","פבר'","מרץ","אפר'","מאי","יונ'","יול'","אוג'","ספט'","אוק'","נוב'","דצמ'"],"fr":["Janvier","Février","Mars","Avril","Mai","Juin","Juillet","Août","Septembre","Octobre","Novembre","Décembre"],"fr-short":["Jan","Fév","Mar","Avr","Mai","Jun","Jul","Aoû","Sep","Oct","Nov","Déc"],"es":["enero","febrero","marzo","abril","mayo","junio","julio","agosto","septiembre","octubre","noviembre","diciembre"],"es-short":["Ene","Feb","Mar","Abr","May","Jun","Jul","Ago","Sep","Oct","Nov","Dic"],};Personetics.utils=Personetics.utils?Personetics.utils:{};Personetics.utils.date={};Personetics.utils.date.monthName=function monthName(dateStr,lang,short){if(!(parseInt(dateStr)==dateStr)){var d=new Date(dateStr);var month=d.getMonth();if(month!=undefined&&month!=null&&!isNaN(month)){month=d.getMonth()}}
else{try{var dn=parseInt(dateStr);if(dn>=1&&dn<=12){month=dn-1}
else{return dateStr}}catch(e){return dateStr}}
if(short==!0)
lang=lang+"-short";var names=monthNames[lang];if(!names){if(short==!0)
names=monthNames["en-short"];else names=monthNames.en}
return names[month]};Personetics.utils.date.dayNumber=function dayNumber(dateStr,dayFormat){var result=dateStr;var date=new Date(dateStr);var day=date.getDate();if(!isNaN(day))
result=date.getDate();if(dayFormat&&dayFormat=="DD"){if(result<10)
result="0"+result}
return result};Personetics.utils.date.monthNumber=function monthNumber(dateStr){if(!(parseInt(dateStr)==dateStr)){var d=new Date(dateStr);var month=d.getMonth();if(month!=undefined&&month!=null&&!isNaN(month)){month=d.getMonth()}}
else{try{var dn=parseInt(dateStr);if(dn>=1&&dn<=12){month=dn-1}
else{return dateStr}}catch(e){return dateStr}}
var monthNum=monthNumbers[month];var result=monthNum;if(monthNum<10)
result="0"+result;return result};Personetics.utils.date.yearNumber=function yearNumber(dateStr,isShort){var result="";var d=new Date(dateStr);var fullYear=d.getFullYear().toString();if(isShort){result=fullYear.substring(2)}
else result=fullYear;return result};Personetics.utils.date.nthDate=function nthDate(dateStr,lang){dateStr=dateStr.toLowerCase();var shortKey=lang+"-short";for(var i=0;i<monthNames[shortKey].length;i++){if(dateStr.indexOf(monthNames[shortKey][i].toLowerCase())!==-1){break}}
var dayNumber=dateStr.replace(monthNames[shortKey][i].toLowerCase(),"");var month=monthNames[lang][i];function nth(d){if(d>3&&d<21)return'th';switch(d%10){case 1:return"st";case 2:return"nd";case 3:return"rd";default:return"th"}}
var isnum=/^\d+$/.test(dayNumber);if(!isnum){return month}
dayNumber=parseInt(dayNumber,10);var result=month+" "+dayNumber+nth(dayNumber);return result}})(window,window.Personetics=window.Personetics||{});(function(window,Personetics,$,undefined){Personetics.utils=Personetics.utils?Personetics.utils:{};Personetics.utils.dictionary={};Personetics.utils.dictionary.overrideObjectProperties=function(original,override,overrideDefinedVals)
{Personetics.utils.assert.assignDefaultValue(overrideDefinedVals,!0);var originalCopy=$.extend({},!0,original);if(Personetics.utils.assert.isNullOrUndefined(override))
return originalCopy;if(Personetics.utils.assert.isNullOrUndefined(originalCopy))
return override;$.each(override,function(key,value){if(!originalCopy.hasOwnProperty(key)||originalCopy[key]==null||overrideDefinedVals)
originalCopy[key]=value});return originalCopy};Personetics.utils.dictionary.hasItem=function hasItem(obj,key,nullable)
{var hasItem=Personetics.utils.assert.isObject(obj)&&Personetics.utils.string.isValidString(key)&&obj.hasOwnProperty(key);return nullable?hasItem:hasItem&&obj[key]!=null};Personetics.utils.dictionary.exists=function exists(obj)
{var args=Array.prototype.slice.call(arguments,1);for(var i=0;i<args.length;i++){if(!obj||!obj.hasOwnProperty(args[i])){return!1}
obj=obj[args[i]]}
return!0};Personetics.utils.dictionary.removeInvalids=function removeInvalids(obj)
{var result={};if(typeof obj!=='undefined'&&obj)
{$.each(obj,function(key,value){if(value!=null)
{if(Personetics.utils.assert.isObject(value)&&!Personetics.utils.assert.isArray(value))
result[key]=Personetics.utils.dictionary.removeInvalids(value);else result[key]=value}})}
return result}})(window,window.Personetics=window.Personetics||{},jQuery);(function(window,Personetics,$,undefined){Personetics.utils=Personetics.utils?Personetics.utils:{};Personetics.utils.encodeDecode={};Personetics.utils.encodeDecode.Base64={codex:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encode:function(input){var output=new Personetics.utils.string.StringBuffer();var enumerator=new Personetics.utils.encodeDecode.Utf8EncodeEnumerator(input);while(enumerator.moveNext()){var chr1=enumerator.current;enumerator.moveNext();var chr2=enumerator.current;enumerator.moveNext();var chr3=enumerator.current;var enc1=chr1>>2;var enc2=((chr1&3)<<4)|(chr2>>4);var enc3=((chr2&15)<<2)|(chr3>>6);var enc4=chr3&63;if(isNaN(chr2)){enc3=enc4=64}else if(isNaN(chr3)){enc4=64}
output.append(this.codex.charAt(enc1)+this.codex.charAt(enc2)+this.codex.charAt(enc3)+this.codex.charAt(enc4))}
return output.toString()},decode:function(input){var output=new Personetics.utils.string.StringBuffer();var enumerator=new Personetics.utils.encodeDecode.Base64DecodeEnumerator(input);while(enumerator.moveNext()){var charCode=enumerator.current;if(charCode<128)
output.append(String.fromCharCode(charCode));else if((charCode>191)&&(charCode<224)){enumerator.moveNext();var charCode2=enumerator.current;output.append(String.fromCharCode(((charCode&31)<<6)|(charCode2&63)))}else{enumerator.moveNext();var charCode2=enumerator.current;enumerator.moveNext();var charCode3=enumerator.current;output.append(String.fromCharCode(((charCode&15)<<12)|((charCode2&63)<<6)|(charCode3&63)))}}
return output.toString()}};Personetics.utils.encodeDecode.Utf8EncodeEnumerator=function Utf8EncodeEnumerator(input){this._input=input;this._index=-1;this._buffer=[];this.current=Number.NaN;this.moveNext=function(){if(this._buffer.length>0){this.current=this._buffer.shift();return!0}else if(this._index>=(this._input.length-1)){this.current=Number.NaN;return!1}else{var charCode=this._input.charCodeAt(++this._index);if((charCode==13)&&(this._input.charCodeAt(this._index+1)==10)){charCode=10;this._index+=2}
if(charCode<128){this.current=charCode}else if((charCode>127)&&(charCode<2048)){this.current=(charCode>>6)|192;this._buffer.push((charCode&63)|128)}else{this.current=(charCode>>12)|224;this._buffer.push(((charCode>>6)&63)|128);this._buffer.push((charCode&63)|128)}
return!0}}};Personetics.utils.encodeDecode.Base64DecodeEnumerator=function Base64DecodeEnumerator(input){this._input=input;this._index=-1;this._buffer=[];this.current=64;this.moveNext=function(){if(this._buffer.length>0){this.current=this._buffer.shift();return!0}else if(this._index>=(this._input.length-1)){this.current=64;return!1}else{var enc1=Personetics.utils.encodeDecode.Base64.codex.indexOf(this._input.charAt(++this._index));var enc2=Personetics.utils.encodeDecode.Base64.codex.indexOf(this._input.charAt(++this._index));var enc3=Personetics.utils.encodeDecode.Base64.codex.indexOf(this._input.charAt(++this._index));var enc4=Personetics.utils.encodeDecode.Base64.codex.indexOf(this._input.charAt(++this._index));var chr1=(enc1<<2)|(enc2>>4);var chr2=((enc2&15)<<4)|(enc3>>2);var chr3=((enc3&3)<<6)|enc4;this.current=chr1;if(enc3!=64)
this._buffer.push(chr2);if(enc4!=64)
this._buffer.push(chr3);return!0}}}})(window,window.Personetics=window.Personetics||{},jQuery);(function(window,Personetics,$,undefined){Personetics.utils=Personetics.utils?Personetics.utils:{};Personetics.utils.PEvent=Base.extend({initialize:function(){this.eventMessage={"type":"sendEvents","eventInfo":{},"checkInPastEvent":!0}},setParam:function(paramName,paramValue){this.eventMessage.eventInfo.params[paramName]=paramValue},getJsonMessageEvent:function(){return JSON.stringify(this.eventMessage)},onSuccessCallback:function(){},onErrorCallback:function(){}})})(window,window.Personetics=window.Personetics||{},jQuery);(function(window,Personetics,$,undefined){Personetics.utils=Personetics.utils?Personetics.utils:{};Personetics.utils.PEventsBuffer=function(){this.sendEventsTypesMapping={"account-selector":"AccountSelector","bar-chart":"BarChart","pie-chart":"PieChart","tabs":"Button","buttons":"Button","Navigation":"NavigateButton"}
this.pastEvents=[];this.eventToSend=[];this.eventDelayInterval=Personetics.projectConfiguration.getConfig("eventDelayInterval");this.start=function(){var me=this;this.intervalId=setInterval(function(){me.sendEvents()},this.eventDelayInterval)};this.stop=function(){if(this.intervalId)
clearInterval(this.intervalId)};this.addEventToSend=function(event,success_callback,error_callback){var shouldAddEvent=this.shouldSendEvent(event);if(shouldAddEvent==!0){this.eventToSend.push({eventData:event,onSuccessCallback:success_callback,onErrorCallback:error_callback});if(event.eventMessage.eventInfo.type==="Navigation")
{this.sendEvents()}}};this.sendEvents=function(){var me=this;var didSendEvents=!1;var requestMsg={};var eventsInfoList=[];if(this.eventToSend.length)
{requestMsg.type=this.eventToSend[0].eventData.eventMessage.type;requestMsg.ctxId="dashboard";requestMsg.lang=Personetics.processor.PStoryConfig.getConfig("lang");requestMsg.protocolVersion=this.eventToSend[0].eventData.eventMessage.protocolVersion}
$.each(this.eventToSend,function(key,pevent){if(typeof me.sendEventsTypesMapping[pevent.eventData.eventMessage.eventInfo.type]!=="undefined")
{pevent.eventData.eventMessage.eventInfo.type=me.sendEventsTypesMapping[pevent.eventData.eventMessage.eventInfo.type]}
eventsInfoList.push(pevent.eventData.eventMessage.eventInfo);me.pastEvents.push(pevent)});if(eventsInfoList.length){didSendEvents=!0;requestMsg.eventsInfoList=eventsInfoList;personetics.pserverProxy.notifyEvent(requestMsg,this.onSuccess,this.onError)}
if(didSendEvents==!0){this.eventToSend=[]}};this.onSuccess=function()
{};this.onError=function()
{};this.shouldSendEvent=function(pevent){var shouldSendEvent=!0;var currentEventInfo=JSON.stringify(pevent.eventMessage.eventInfo);if(pevent.eventMessage.checkInPastEvent==!0){$.each(this.pastEvents,function(key,aPastEvent){var pastEventInfo=aPastEvent.eventData.eventMessage.eventInfo;if(JSON.stringify(pastEventInfo)===currentEventInfo){shouldSendEvent=!1;return!1}})}
if(shouldSendEvent==!1)
return shouldSendEvent;$.each(this.eventToSend,function(key,anEventToSend){var pastEventInfo=anEventToSend.eventData.eventMessage.eventInfo;if(JSON.stringify(pastEventInfo)===JSON.stringify(currentEventInfo)){shouldSendEvent=!1;return!1}});return shouldSendEvent};this.onEventSendSuccess=function(){};this.onEventSendError=function(){Personetics.log("Error on sending events to PServer....")}}})(window,window.Personetics=window.Personetics||{},jQuery);(function(window,Personetics,$,undefined){Personetics.utils=Personetics.utils?Personetics.utils:{};Personetics.utils.PEventOptInOut=Personetics.utils.PEvent.extend({initialize:function(){this.eventMessage={"type":"sendEvents","eventInfo":{"type":"opt-in","params":{}},"checkInPastEvent":!1}},setOptInParam:function(isOptIn){var mode="in";if(isOptIn==!0)
mode="in";else mode="out";this.eventMessage.eventInfo.params.isOptIn=mode},setSentTime:function(){this.eventMessage.eventInfo.params.timestamp=new Date()},getJsonMessageEvent:function(){return JSON.stringify(this.eventMessage)},onSuccessCallback:function(){},onErrorCallback:function(){}})})(window,window.Personetics=window.Personetics||{},jQuery);(function(window,Personetics,$,undefined){Personetics.utils=Personetics.utils?Personetics.utils:{};var pEventReporting=Personetics.utils.PEvent.extend({initialize:function(){this.params={"eventType":"sendEvents","checkInPastEvent":"false","protocolVersion":Personetics.projectConfiguration.getConfig("protocolVersion"),"userId":"","type":"","value":"","insightId":"","instanceId":""}},setValue:function(parameters){var me=this;$.each(parameters,function(key,value){if(me.params.hasOwnProperty(key)&&value!='undefined'&&value!=null){me.params[key]=value}})},createMessage:function(){var params=this.params;var eventMessage={"type":params.eventType,"userId":params.userId,"checkInPastEvent":params.checkInPastEvent,"protocolVersion":params.protocolVersion,"eventInfo":{"type":params.type,"eventDateTime":new Date(),"params":{"value":params.value,"insightId":params.insightId,"instanceId":params.instanceId}},}
return eventMessage},notifyEvent:function(){var pevent={eventMessage:this.createMessage()}
personetics.notifyEvent(pevent)},});Personetics.utils.PEventReporting=new pEventReporting()})(window,window.Personetics=window.Personetics||{},jQuery);(function(window,Personetics,$,undefined){Personetics.utils=Personetics.utils?Personetics.utils:{};Personetics.utils.json={};var JSON=window.JSON||{};window.JSON=JSON;JSON.stringify=JSON.stringify||function(obj){var t=typeof(obj);if(t!="object"||obj===null){if(t=="string")
obj='"'+obj+'"';return String(obj)}else{var n,v,json=[],arr=(obj&&obj.constructor==Array);for(n in obj){if(obj.hasOwnProperty(n)){v=obj[n];t=typeof(v);if(t=="string")
v='"'+v+'"';else if(t=="object"&&v!==null)
v=JSON.stringify(v);json.push((arr?"":'"'+n+'":')+String(v))}}
return(arr?"[":"{")+String(json)+(arr?"]":"}")}};Personetics.utils.json.getJsonStringifyMethod=function getJsonStringifyMethod(){if($.toJSON){return $.toJSON}
else{return JSON.stringify}};Personetics.utils.json.toJSON=function toJSON(value){var _json_stringify=Personetics.utils.json.getJsonStringifyMethod();if(typeof Prototype!=='undefined'&&typeof Array.prototype.toJSON!=='undefined'){var _array_tojson=Array.prototype.toJSON;delete Array.prototype.toJSON;var r=_json_stringify(value);Array.prototype.toJSON=_array_tojson;return r}
else return _json_stringify(value)};Personetics.utils.json.replacer=function replacer(match,pIndent,pKey,pVal,pEnd){var key='<span class=json-key>';var val='<span class=json-value>';var str='<span class=json-string>';var r=pIndent||'';if(pKey)
r=r+key+pKey.replace(/[": ]/g,'')+'</span>: ';if(pVal)
r=r+(pVal[0]=='"'?str:val)+pVal+'</span>';return r+(pEnd||'')};Personetics.utils.json.prettyPrint=function prettyPrint(obj){var jsonLine=/^( *)("[\w.+-]+": )?("[^"]*"|[\w.+-]*)?([,[{])?$/mg;return JSON.stringify(obj,null,3).replace(/&/g,'&amp;').replace(/\\"/g,'&quot;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(jsonLine,Personetics.utils.json.replacer)};Personetics.utils.json.mergeString=function merge(firstjsonString,secondJsonString){var json1=JSON.parse(firstjsonString);var json2=JSON.parse(secondJsonString);var result=Personetics.utils.json.mergeObject(json1,json2);var objectString=Personetics.utils.json.toJSON(result);return objectString}
Personetics.utils.json.mergeObject=function merge(firstjson,secondJson){var mergedJson=$.extend({},firstjson,secondJson);return mergedJson};Personetics.utils.json.mergeDeepObject=function merge(firstjson,secondJson){var mergedJson=$.extend(!0,{},firstjson,secondJson);return mergedJson}})(window,window.Personetics=window.Personetics||{},jQuery);(function(window,Personetics,undefined){Personetics.utils=Personetics.utils||{};Personetics.PLoggerModes={VERBOSE:{name:"VERBOSE",value:1},DEBUG:{name:"DEBUG",value:2},ALERT:{name:"ALERT",value:3},ERROR:{name:"ERROR",value:4},PRODUCTION:{name:"PRODUCTION",value:5}};var logger=function logger(){this.mode=Personetics.PLoggerModes.ERROR.value};logger.prototype.setDebugMode=function setDebugMode(mode){if(typeof mode!=='undefined'&&mode!==null&&mode.hasOwnProperty("name")&&Personetics.PLoggerModes.hasOwnProperty(mode.name))
this.mode=mode.value};logger.prototype.verbose=function verbose(msg){if(this.mode<=Personetics.PLoggerModes.VERBOSE.value)
console.log(msg)};logger.prototype.debug=function debug(msg){if(this.mode<=Personetics.PLoggerModes.DEBUG.value)
console.log(msg)};logger.prototype.error=function(msg,exception,options){if(this.mode<=Personetics.PLoggerModes.ERROR.value){var shouldDisplayError=typeof options!=="undefined"&&options.hasOwnProperty("shouldDisplayError")&&typeof options.shouldDisplayError!=="undefined"?options.shouldDisplayError:!0;if(shouldDisplayError){var context=Personetics.processor.PStoryConfig.getConfig("context");if(context){throwExceptionToServer(msg)}else{console.error("<< ERROR >>: "+msg)}}
if(Personetics.utils.assert.isDefined(exception,!1))
throw exception}};logger.prototype.alert=function(msg){if(this.mode<=Personetics.PLoggerModes.ALERT.value)
alert(msg)};var throwExceptionToServer=function(msg){var context=Personetics.processor.PStoryConfig.getConfig("context").toLowerCase();var func=this[Personetics.processor.PStoryConfig.getConfig("serverCallBack")];if(context==='server'){if(typeof func==='function'){func(msg)}else{throw msg}}else{if(typeof func==='function'){func('Error - invalid value for key "context", it should be "SERVER"'+' \nProcessor error - '+msg)}else{throw('Error - invalid value for key "context", it should be "SERVER"'+' \nProcessor error - '+msg)}}};Personetics.utils.PLogger=new logger();Personetics.verbose=Personetics.utils.PLogger.verbose.bind(Personetics.utils.PLogger);Personetics.log=Personetics.utils.PLogger.debug.bind(Personetics.utils.PLogger);Personetics.debug=Personetics.utils.PLogger.debug.bind(Personetics.utils.PLogger);Personetics.error=Personetics.utils.PLogger.error.bind(Personetics.utils.PLogger);Personetics.alert=Personetics.utils.PLogger.alert.bind(Personetics.utils.PLogger)})(window,window.Personetics=window.Personetics||{});(function(window,Personetics,$,undefined){Personetics.utils=Personetics.utils?Personetics.utils:{};Personetics.utils.messages={};Personetics.utils.messages.errorMessage=function errorMessage(params){var errorMsgTemplate=Personetics.UI.Handlebars.templates[params?params.templateId?params.templateId:'error-msg':'error-msg'];if(typeof personetics!=='undefined'&&personetics!==null&&personetics.hasOwnProperty("getDeviceType")){var deviceType=personetics.getDeviceType()||"web"}
var html;if(deviceType==='web'){html=errorMsgTemplate({textLarge:params.textLarge,textSmall:params.textSmall,imgClass:params.imgClass})}
else{html=errorMsgTemplate({textLarge:params.textLarge,textSmall:params.textSmall,imgClass:params.imgClass,isMobileDevice:!0})}
return html};Personetics.utils.messages.noInsightsMessage=function noInsightsMessage(params){var errorMsgTemplate=Personetics.UI.Handlebars.templates[params?params.templateId?params.templateId:'no-insights-message':'no-insights-message'];if(typeof personetics!=='undefined'&&personetics!==null&&personetics.hasOwnProperty("getDeviceType")){var deviceType=personetics.getDeviceType()||"web"}
var html;if(deviceType==='web'){html=errorMsgTemplate({textLarge:params.textLarge,textSmall:params.textSmall,imgClass:params.imgClass})}
else{html=errorMsgTemplate({textLarge:params.textLarge,textSmall:params.textSmall,imgClass:params.imgClass,isMobileDevice:!0})}
return html};Personetics.utils.messages.noFilteredInsightsMessage=function noFilteredInsightsMessage(params){var noFileredMsgTemplate=Personetics.UI.Handlebars.templates[params?params.templateId?params.templateId:'no-filtered-insights-msg':'no-filtered-insights-msg'];if(typeof personetics!=='undefined'&&personetics!==null&&personetics.hasOwnProperty("getDeviceType")){var deviceType=personetics.getDeviceType()||"web"}
var html;if(deviceType==='web'){html=noFileredMsgTemplate({text:params.text})}
else{html=noFileredMsgTemplate({text:params.text,isMobileDevice:!0})}
return html}})(window,window.Personetics=window.Personetics||{},jQuery);(function(window,Personetics,$,undefined){Personetics.utils=Personetics.utils?Personetics.utils:{};Personetics.utils.network={};Personetics.utils.network.consts={base64EncodeResponse:!1,requestTimeoutInMillis:300000,dataType:"json",async:!0,onComplete:function(){},onSuccess:function(data,textStatus,jqXHR){Personetics.log("request success")},onFailure:function(jqXHR,textStatus,errorThrown){Personetics.log("request failed: "+textStatus+", "+errorThrown)}};Personetics.utils.network.doAjaxGet=function doAjaxGet(url,data,requestOptions){var finalRequestOptions=Personetics.utils.dictionary.overrideObjectProperties(requestOptions,Personetics.utils.network.consts,!1);Personetics.utils.assert.AssertIsDefined(url,"Personetics.utils.network.doAjaxGet: invalid request URL: "+url);var config={type:"GET",url:url,dataType:finalRequestOptions.dataType,async:finalRequestOptions.async,timeout:finalRequestOptions.requestTimeoutInMillis,complete:finalRequestOptions.onComplete,success:onDoAjaxGetSuccess,error:onDoAjaxGetError};if(!Personetics.utils.assert.isNullOrUndefined(data))
config.data=data;$.ajax(config);function onDoAjaxGetSuccess(response){var processedResponse=response;if(finalRequestOptions.base64EncodeResponse==!0){processedResponse=Personetics.utils.network.decodeDataWithBase64(response);processedResponse=$.parseJSON(processedResponse)}
finalRequestOptions.onSuccess(processedResponse)}
function onDoAjaxGetError(XMLHttpRequest,textStatus,errorThrown){finalRequestOptions.onFailure(XMLHttpRequest,textStatus,errorThrown)}};Personetics.utils.network.doAjaxPost=function doAjaxPost(url,postData,requestOptions){var finalRequestOptions=Personetics.utils.dictionary.overrideObjectProperties(requestOptions,Personetics.utils.network.consts,!1);Personetics.utils.assert.AssertIsNullOrUndefined(url,"Personetics.utils.network.doAjaxPost: invalid request URL: "+url);$.ajax({type:"POST",url:url,data:postData,dataType:finalRequestOptions.dataType,async:finalRequestOptions.async,headers:finalRequestOptions.headers,timeout:finalRequestOptions.requestTimeoutInMillis,complete:finalRequestOptions.onComplete,success:onDoAjaxPostSuccess,error:onDoAjaxPostError});function onDoAjaxPostSuccess(response){var processedResponse=response;if(finalRequestOptions.base64EncodeResponse==!0){processedResponse=Personetics.utils.network.decodeDataWithBase64(response);processedResponse=$.parseJSON(processedResponse)}
finalRequestOptions.onSuccess(processedResponse)}
function onDoAjaxPostError(XMLHttpRequest,textStatus,errorThrown){finalRequestOptions.onFailure(XMLHttpRequest,textStatus,errorThrown)}};Personetics.utils.network.queueAjaxPost=function queueAjaxPost(queueId,url,postData,requestOptions){var finalRequestOptions=Personetics.utils.dictionary.overrideObjectProperties(requestOptions,Personetics.utils.network.consts,!1);return $.ajaxq(queueId,{type:"POST",url:url,data:postData,dataType:finalRequestOptions.dataType,timeout:finalRequestOptions.requestTimeoutInMillis,success:onDoAjaxQueuePostSuccess,error:onDoAjaxQueuePostError});function onDoAjaxQueuePostSuccess(response){var processedResponse=response;if(finalRequestOptions.base64EncodeResponse==!0){processedResponse=Personetics.utils.network.decodeDataWithBase64(response);processedResponse=$.parseJSON(processedResponse)}
finalRequestOptions.onSuccess(processedResponse)}
function onDoAjaxQueuePostError(XMLHttpRequest,textStatus,errorThrown){finalRequestOptions.onFailure(XMLHttpRequest,textStatus,errorThrown)}};Personetics.utils.network.removeAjaxPostQueue=function(queueId){$.ajaxq(queueId)};Personetics.utils.network.wasUserAborted=function wasUserAborted(xhr,textStatus){return!xhr.getAllResponseHeaders()&&textStatus!='timeout'};Personetics.utils.network.createPostform=function createPostform(params,absoluteUrl,newDoc,win,pageInfo){newDoc.charset="utf-8";var formId="hintForm";var form=newDoc.createElement("form");form.setAttribute("id",formId);form.setAttribute("method","post");form.setAttribute("action",absoluteUrl);for(var i in params){if(params.hasOwnProperty(i)){var input=newDoc.createElement('input');input.type='hidden';input.name=i;input.value=params[i];form.appendChild(input)}}
newDoc.body.appendChild(form);form.submit();newDoc.body.removeChild(form)}
Personetics.utils.network.decodeDataWithBase64=function(data){data=data.replace(/(\r\n|\n|\r)/gm,"");data=data.replace(/"/g,'');var decodedData=Personetics.utils.encodeDecode.Base64.decode(data);return decodedData}})(window,window.Personetics=window.Personetics||{},jQuery);(function(window,Personetics,undefined){Personetics.utils=Personetics.utils?Personetics.utils:{};Personetics.utils.persoHelper={};Personetics.utils.persoHelper.constants={ANDROID_VERSIONS:{OLD_VERSION_MIN_TARGET:4.4,OLD_VERSION_MAX_TARGET:5.0}}
Personetics.utils.persoHelper.getAndroidVersionNumber=function getAndroidVersionNumber(){var androidVersionNumber;var androidVersionString=getAndroidVersion();if(androidVersionString){androidVersionNumber=parseFloat(getAndroidVersion())}
return androidVersionNumber};Personetics.utils.persoHelper.isOldAndroidVersion=function isOldAndriodVersion(){var androidVersion=this.getAndroidVersionNumber();var isOldAndroidVersion=!1;if(typeof androidVersion!=='undefined'&&androidVersion>0){if(androidVersion<this.constants.ANDROID_VERSIONS.OLD_VERSION_MAX_TARGET&&androidVersion>=this.constants.ANDROID_VERSIONS.OLD_VERSION_MIN_TARGET){isOldAndroidVersion=!0}}
return isOldAndroidVersion};var getAndroidVersion=function getAndroidVersion(){var userAgent=navigator.userAgent.toLowerCase();var match=userAgent.match(/android\s([0-9\.]*)/);return match?match[1]:!1}})(window,window.Personetics=window.Personetics||{});(function(window,Personetics,$,undefined){Personetics.utils=Personetics.utils?Personetics.utils:{};Personetics.utils.print={};Personetics.utils.print.printHtmlToPdf=function printHtmlToPdf(config){var pdf=new jsPDF('p','pt','a4');pdf.addFont('Roboto');pdf.setFont('Roboto');var element=config.parent;if(!config.page||!config.page.el){var children=config.parent.getElementsByTagName("*");config.beforeExportCallback&&config.beforeExportCallback(children);pdf.internal.scaleFactor=config.internalScaleFactor;addHtml(element,pdf,config)}else{var elemFromHtml=config.page.el;var children=config.parent.getElementsByTagName("*");config.beforeExportCallback&&config.beforeExportCallback(children);html2canvas(elemFromHtml,{allowTaint:!1,useCORS:!0,}).then(function(canvas){pdf.internal.scaleFactor=config.page.internalScaleFactor;var newCanvas=copyCanvas(canvas,elemFromHtml.clientWidth,elemFromHtml.clientHeight);config.parent.appendChild(newCanvas);var x=config.x?config.x:0;var y=config.y?config.y:0;pdf.addHTML(newCanvas,x,y,{pagesplit:!0,allowTaint:!1,useCORS:!0},function(){if(newCanvas.parentElement){config.parent.removeChild(newCanvas)}
elemFromHtml.parentNode.removeChild(elemFromHtml);pdf.addPage();pdf.internal.scaleFactor=config.internalScaleFactor;addHtml(element,pdf,config)})})}}
function addHtml(element,pdf,config){var newCanvas=createCanvas({width:element.clientWidth,height:element.clientHeight,totalHeight:config.height});var x=config.x?config.x:0;var y=config.y?config.y:0;pdf.addHTML(element,x,y,{pagesplit:!0,canvas:newCanvas},function(){if(newCanvas.parentElement){config.parent.removeChild(newCanvas)}
pdf.save(config.fileName+config.format);config.callback&&config.callback()})}
Personetics.utils.print.printHtmlToPdfWithLoop=function printHtmlToPdf(config){var pdf=new jsPDF('p','pt','a4');var element=config.parent;if(!config.page||!config.page.html){pdf.internal.scaleFactor=3.75;var frame=config.parent.getElementsByClassName("pstory-dialog-content");var newCanvas=createCanvas({width:element.clientWidth,height:element.clientHeight,totalHeight:config.height});pdf.addHTML(frame[0],{pagesplit:!0,canvas:newCanvas},function(){if(newCanvas.parentElement){config.parent.removeChild(newCanvas)}
loopElements(pdf,frame,1,config)})}else{pdf.internal.scaleFactor=2.5;var elemFromHtml=document.createElement("div");elemFromHtml.innerHTML=config.page.html;var newElement=elemFromHtml.firstChild;newElement.style.width=config.page.width;config.parent.appendChild(newElement);var children=newElement.getElementsByTagName("*");for(var i=0;i<children.length;i++){if(window.getComputedStyle(children[i],null).getPropertyValue("background-image")!=="none"){children[i].style.backgroundImage="none"}}
html2canvas(newElement,{allowTaint:!1,useCORS:!0,}).then(function(canvas){pdf.internal.scaleFactor=1;var newCanvas=copyCanvas(canvas,newElement.clientWidth,newElement.clientHeight);config.parent.appendChild(newCanvas);pdf.addHTML(newCanvas,0,0,{pagesplit:!0,allowTaint:!1,useCORS:!0},function(){if(newCanvas.parentElement){config.parent.removeChild(newCanvas)}
newElement.parentNode.removeChild(newElement);pdf.addPage();pdf.internal.scaleFactor=3.75;var canvas=createCanvas({width:element.clientWidth,height:element.clientHeight,totalHeight:config.height});pdf.addHTML(element,{pagesplit:!0,canvas:canvas},function(){pdf.save(config.fileName+config.format);config.callback&&config.callback()})})})}}
function createCanvas(options){var canvas=document.createElement('canvas');canvas.width=options.width*3;canvas.height=options.totalHeight*3;canvas.style.width=options.width+'px';canvas.style.height=options.height+'px';var context=canvas.getContext('2d');context.scale(3,3);context.fillStyle="rgba(255, 255, 255, 1)";context.fillRect(0,0,canvas.width,canvas.height);return canvas}
function updateCanvas(canvas,options){canvas.width=options.width*3;canvas.height=options.totalHeight*3;canvas.style.width=options.width+'px';canvas.style.height=options.height+'px';var context=canvas.getContext('2d');context.scale(3,3);context.fillStyle="rgba(255, 255, 255, 1)";context.fillRect(0,0,canvas.width,canvas.height)}
function copyCanvas(canvas,width,height){var newCanvas=document.createElement('canvas');newCanvas.width=width*3;newCanvas.height=height*3;newCanvas.style.width=width+'px';newCanvas.style.height=height+'px';var destCtx=newCanvas.getContext('2d');destCtx.scale(3,3);destCtx.fillStyle="rgba(255, 255, 255, 1)";destCtx.fillRect(0,0,newCanvas.width,newCanvas.height);destCtx.drawImage(canvas,0,0);return newCanvas}
function loopElements(pdf,elemnts,index,config){if(index==elemnts.length){pdf.save(config.fileName+config.format);config.callback&&config.callback();return}
pdf.addPage();html2canvas(elemnts[index],{allowTaint:!1,useCORS:!0,}).then(function(canvas){pdf.internal.scaleFactor=1;var newCanvas=copyCanvas(canvas,elemnts[index].clientWidth,elemnts[index].clientHeight);config.parent.appendChild(newCanvas);pdf.addHTML(newCanvas,0,0,{pagesplit:!0,allowTaint:!1,useCORS:!0},function(){if(newCanvas.parentElement){config.parent.removeChild(newCanvas)}
loopElements(pdf,elemnts,index+1,config)})})}})(window,window.Personetics=window.Personetics||{},jQuery);(function(window,Personetics,$,undefined){Personetics.utils=Personetics.utils?Personetics.utils:{};Personetics.utils.scope={};Personetics.utils.scope.bind=function bind(scope,fn){return function(){return fn.apply(scope,arguments)}};Personetics.bind=Personetics.utils.scope.bind;Personetics.utils.scope.Callback=function Callback(f,parameters){this.parameters=parameters;this.f=f;var me=this;this.invoke=function(){me.f.apply(me,me.parameters)}}})(window,window.Personetics=window.Personetics||{},jQuery);(function(window,Personetics,$,undefined){Personetics.utils=Personetics.utils?Personetics.utils:{};Personetics.utils.string={};Personetics.utils.string.isString=function isString(str){return typeof str==='string'};Personetics.utils.string.isEmpty=function isString(str){return Personetics.utils.string.isString(str)&&str.length==0};Personetics.utils.string.isValidString=function isValidString(str){return Personetics.utils.assert.isString(str)&&str!=null&&str.length>0};Personetics.utils.string.truncateLongWords=function truncateLongWords(setnece,maxWordLength){if(typeof setnece!=='undefined'&&setnece&&setnece.length>0&&setnece.replace(/ /g,'').length>0){var words=setnece.split(' ');var processedWords=[];$.each(words,function(i,word){if(word.length>maxWordLength){processedWords.push(word.substring(0,maxWordLength-6)+'...')}
else{processedWords.push(word)}});return processedWords.join(' ')}
else{return""}};Personetics.utils.string.stripTags=function stripTags(input){var tagsToReplace=["script"];var result=input;if(typeof input!=='undefined'&&input!=null&&input.length>0){$.each(tagsToReplace,function(i,tagToReplace){var tagRegex=new RegExp("<"+tagsToReplace+".*>.*</"+tagToReplace+">","ig");result=result.replace(tagRegex,"")})}
return result};Personetics.utils.string.replaceNewLine=function replaceNewLine(element){if(!element)
return element;var typeOf=typeof(element);if(typeOf=='string'){var regex=new RegExp("^<([A-Z][A-Z0-9]*)[^>]*>(.*?)</\\1>$","gim");var res=regex.exec(element.replace(/\n/g,""));if(res){element=element.replace(/\n/g,"")}
else{element=element.replace(/\n/g,"<br />")}}else if(typeOf=='object')
$.each(element,function(key,value){if(!value)
return;if(typeof(key)=='string'&&key.toLowerCase().indexOf('speaking')!=-1)
return;var typeOfValue=typeof(value);element[key]=Personetics.utils.string.replaceNewLine(value)});return element};Personetics.utils.string.StringBuffer=function StringBuffer(){this.buffer=[];this.append=function append(string){this.buffer.push(string);return this};this.toString=function toString(){return this.buffer.join("")}};Personetics.utils.string.decodeHTMLSpecialCharecters=function decodeHTMLSpecialCharecters(input){var decodedString=input.replace("&amp;","&");return decodedString};Personetics.utils.string.stripSpecialChars=function stripSpecialChars(val){return val.replace(/[^a-z0-9\s]/gi,'').replace(/[_\s]/g,'-')};Personetics.utils.string.removeClass=function removeClass(className,clazz){var _classname=className;if(typeof className==='object')
_classname=_classname.animVal;_classname=_classname.replace(new RegExp('(?:^|\\s)'+clazz+'(?:\\s|$)'),' ');return _classname};Personetics.utils.string.addClass=function addClass(className,clazz){className=Personetics.utils.string.removeClass(className,clazz);var _classname=className;if(typeof className==='object')
_classname=_classname.animVal;_classname+=" "+clazz;return _classname}})(window,window.Personetics=window.Personetics||{},jQuery);(function(window,Personetics,$,undefined){Personetics.utils=Personetics.utils?Personetics.utils:{};Personetics.utils.url={};Personetics.utils.url.getParameterByName=function getParameterByName(name){name=name.replace(/[\[]/,"\\\[").replace(/[\]]/,"\\\]");var regex=new RegExp("[\\?&]"+name+"=([^&#]*)"),results=regex.exec(location.search);return results==null?null:decodeURIComponent(results[1].replace(/\+/g," "))};Personetics.utils.url.getAbsoluteUrl=function getAbsoluteUrl(localurl){if(/^(https?|file|ftps?|mailto|javascript|data:image\/[^;]{2,9};):/i.test(localurl))
return localurl;var href=window.location.href;var pathArray=href.split('/');var newPathname="";for(var i=0;i<pathArray.length-1;i++){if(i!=0)
newPathname+="/";newPathname+=pathArray[i]}
return newPathname+'/'+localurl};Personetics.utils.url.openTabWithPost=function openTabWithPost(localUrl,windowoption,params){var absoluteUrl=Personetics.utils.url.getAbsoluteUrl(localUrl);var newWin=window.open("","_blank");newWin.opener=null;newWin.focus();var newDoc=newWin.document;Personetics.utils.network.createPostform(name,params,absoluteUrl,newDoc)};Personetics.utils.url.iframeWithPost=function iframeWithPost(url,name,params){var form=document.createElement("form");form.setAttribute("method","post");form.setAttribute("action",url);form.setAttribute("target",name);for(var i in params){if(params.hasOwnProperty(i)){var input=document.createElement('input');input.type='hidden';input.name=i;input.value=params[i];form.appendChild(input)}}
document.body.appendChild(form);form.submit();document.body.removeChild(form)};Personetics.utils.url.urlCheck=function urlCheck(s){var regexp=/(ftp|http|https):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?/
return regexp.test(s)};Personetics.utils.url.encodePostParams=function encodePostParams(parameterObject){var postParamObject={};$.each(parameterObject,Personetics.bind(this,function(key,value){if(key.indexOf("64")>=0){var paramsJson=Personetics.utils.json.toJSON(parameterObject[key]);var str64=Personetics.utils.encodeDecode.Base64.encode(paramsJson);parameterObject[key]=str64}}));return parameterObject}})(window,window.Personetics=window.Personetics||{},jQuery);(function(window,Personetics,$,undefined){Personetics.story=Personetics.story||{};Personetics.story.PWebAnalytics=Base.extend({reportWidgetActive:function(options){},reportWidgetLoaded:function(options){},reportOverlayLoaded:function(options){},reportRatingsSent:function(options){}})})(window,window.Personetics=window.Personetics||{},jQuery);(function(window,Personetics,$,undefined){Personetics.utils=Personetics.utils||{};Personetics.utils.d3Extensions={};var persoHelper=Personetics.utils.persoHelper;Personetics.utils.d3Extensions.html=function(value){if(typeof value!="string"){return}
else{var rootSpan=$('<span>').html(value).first().children()[0];if(typeof rootSpan=='undefined'){return this.text(value)}
else{var tspan=this.append('tspan');var attrs=rootSpan.attributes;$.each(attrs,function(j,attr){tspan.attr(attr.name,attr.value)});var valueChildren=$(rootSpan).children();$.each(valueChildren,function(i,node){var innerTspan=tspan.append('tspan').text($(node).text());var attrs=node.attributes;$.each(attrs,function(j,attr){innerTspan.attr(attr.name,attr.value)})});return this}}};d3.selection.prototype.html=Personetics.utils.d3Extensions.html;Personetics.utils.d3Extensions.text=function text(value){return arguments.length?this.each(typeof value==="function"?function(){var v=value.apply(this,arguments);v=$(v).length>0?$(v)[0].innerText:v;this.textContent=v==null?"":v}:value==null?function(){this.textContent=""}:function(){this.textContent=$(value).length>0?$(value)[0].innerText:value}):this.textContent};if(typeof persoHelper!=='undefined'&&(persoHelper.isOldAndroidVersion())){d3.selection.prototype.text=Personetics.utils.d3Extensions.text}})(window,window.Personetics=window.Personetics||{},jQuery);(function(window,Personetics,$,undefined){Personetics.story=Personetics.story||{};Personetics.story.PStoryPreview=Personetics.story.PStory.extend({initialize:function(config){this.super=Personetics.story.PStory.prototype;this.super.initialize.call(this,config);this.previewDialogId=config.dialogId;this.previewBlockIndex=config.blockIndex;this.mode=config.mode},renderDialogs:function(){var me=this;var dialogsConfig=this.storyDef.dialogs;var previewDialogConfig=null;$.each(dialogsConfig,function(index,dialogConfig){if(dialogConfig.id==me.previewDialogId){previewDialogConfig=dialogConfig;return!1}});if(previewDialogConfig){this.pushDlg(previewDialogConfig,Personetics.bind(this,this.highlightBlock))}},fireEvent:function(block,e){},highlightBlock:function(){var dlgEl=this.frameEl.find(".pstory-dialog-frame");var blockEl=dlgEl.find('.pstory-block-frame').eq(this.previewBlockIndex);blockEl.addClass("pstory-preview-block")}})})(window,window.Personetics=window.Personetics||{},jQuery);(function(window,Personetics,$,undefined){Personetics.story=Personetics.story||{};Personetics.story.AccountSelectorBlockProduct=Personetics.story.AccountSelectorBlock.extend({beforeRender:function(el,layoutInstructions){Personetics.story.AccountSelectorBlock.prototype.beforeRender.call(this,el,layoutInstructions);var options=$.extend(!0,[],layoutInstructions.options);var optAllIndex;var me=this;this.showHeaderTabs=!1;this.defaultTab='choose-account';$.each(options,function(index,opt){if(opt.id=='all'){optAllIndex=index;me.showHeaderTabs=!0;me.all=$.extend(!0,{},(opt));if(opt.selected)
me.defaultTab='all';return!1}});if(typeof optAllIndex!=='undefined'){options.splice(optAllIndex,1)}
options.cardsLength=options.length;this.options=options;if(this.story.cfg.widthMode==='desktop'){this.config=this.story.uxCtrl.getAccountSelectorConfigDesktop();this.isDesktopMode=!0}
else{this.config=this.story.uxCtrl.getAccountSelectorConfig();this.isDesktopMode=!1}
this.showArrows=this.config.showArrows&&this.options.cardsLength>=this.config.minAccountsForDisplayingArrows},render:function(el,layoutInstructions){this.el=el;var text=this.getAccountSelectorText();this.setImageValueForOptions();var param={options:this.options,class:layoutInstructions.class,showHeaderTabs:this.showHeaderTabs,headersArray:this.getHeadersArray(),showIndexDots:this.config.showIndexDots,isDesktopMode:this.isDesktopMode};param=$.extend(param,text);var html=this.template(param);el.append(html);this.frameEl=el.find(".pstory-block-frame").last()},getHeadersArray:function getHeadersArray(){var result=[{text:Personetics.dictionary.getText("lblaccSelectAll"),isAll:!0},{text:Personetics.dictionary.getText("lblaccSelectChoose"),isAll:!1}];return result},getAccountSelectorText:function getAccountSelectorText(){var text={allAccountsTxt:this.all?this.all.text:"",next:Personetics.dictionary.getText("lblaccSelectNextAcc"),prev:Personetics.dictionary.getText("lblaccSelectPreviousAcc"),allAccountsName:Personetics.dictionary.getText("lblaccSelectAll"),numberPref:Personetics.dictionary.getText("lblaccSelectAccount"),numberPrefAccessibility:Personetics.dictionary.getText("lblaccSelectAccountAccessibility"),accountSelectorText:Personetics.dictionary.getText("lblAccessibiliotyAccountSelectorText"),}
return text},setImageValueForOptions:function setImageValueForOptions(){$.each(this.options,function(i,opt){var urlObj=Personetics.imageMap.getImageClass(opt.image,"account_selector");opt.isAbsoluteURL=urlObj.isAbsoluteURL;opt.image=urlObj.url})},bindEvents:function bindEvents(){Personetics.story.OptionsBlock.prototype.bindEvents.call(this);var block=this;this.frameEl.find(".pstory-header-button").bind("click",Personetics.bind(this,this.optionHeaderClickEvent));this.frameEl.find('.pstory-prev-account-button').bind('click',function(e){var selected=block.frameEl.find(".pstory-button.selected:not([clone='true'])");if(selected.parents('.carousel-disable').length>0){return}
if(block.showArrows&&block.config.nextArrowDir=="ltr")
selected.next().click();else selected.prev().click()});this.frameEl.find('.pstory-next-account-button').bind('click',function(e){var selected=block.frameEl.find(".pstory-button.selected:not([clone='true'])");if(selected.parents('.carousel-disable').length>0){return}
if(block.showArrows&&block.config.nextArrowDir=="ltr")
selected.prev().click();else selected.next().click()})},onInputSelect:function onInputSelect(e){},optionClickEvent:function optionClickEvent(e){},getReportValue:function(target){return"Switch"},optionHeaderClickEvent:function optionHeaderClickEvent(e){var target=$(e.currentTarget);var allAccounts=target.data('all');if(this.frameEl.find(".options-container").hasClass("allAccounts")==allAccounts){this.setFocusOnRelevantElement(allAccounts);return}
this.headerTabsAnimation(target);if(allAccounts){this.onAllAccountsClick(!0)}
else{this.onChooseAccountClick(target)}
this.updateAccessibilityButtons(allAccounts);this.setFocusOnRelevantElement(allAccounts);this.frameEl.find(".pstory-header-button").attr('aria-selected','false');target.attr('aria-selected','true');this.notifyReportHeaderEvent(allAccounts)},setFocusOnRelevantElement:function setFocusOnRelevantElement(isAllAccountsState){var focusedElement;if(isAllAccountsState){focusedElement=this.frameEl.find(".pstory-all-accounts-txt")}
else{focusedElement=this.frameEl.find(".pstory-account-button.selected")}
this.putFocusAccessibility(focusedElement)},notifyReportHeaderEvent:function notifyReportHeaderEvent(allAccounts){var params={};params.type=this.layoutInstructions.type;if(allAccounts){params.value="All"}
else{params.value="Specific"}
this.notifyReportEvent(params)},headerTabsAnimation:function headerTabsAnimation(selected){if(typeof selected==="undefined"||selected===null||selected.length==0)
return;var tabAnimatedBorder=$(this.frameEl).find(".pstory-tab-animated-border-bottom");var left=selected.offset().left-this.frameEl.offset().left;var width=selected.innerWidth();tabAnimatedBorder.css({"left":left+'px',width:width+'px'})},onAllAccountsClick:function onAllAccountsClick(doAnimation){this.frameEl.find('.options-container').addClass('allAccounts');this.frameEl.find('.options-container').addClass('carousel-disable');this.frameEl.find('.options-container').addClass('on-animation');this.carouselAnimation.setConfig();this.allAccountsSelectedAnimation(doAnimation);this.parent.notifyEvent(this,"setSelectedValue",this.all);this.frameEl.find('.pstory-all-accounts-txt').removeAttr("aria-hidden")},onChooseAccountClick:function onChooseAccountClick(target){this.chooseAccountSelectedAnimation();this.frameEl.find('.options-container').removeClass('allAccounts');this.frameEl.find('.options-container').removeClass('carousel-disable');this.carouselAnimation.setConfig();var selected=this.frameEl.find('.pstory-button.selected:not([clone="true"])');selected.prev().addClass("prev");selected.next().addClass("next");var selectedOpt=this.getOptionById(selected.attr('pstory-id'));this.parent.notifyEvent(this,"setSelectedValue",selectedOpt);this.frameEl.find('.pstory-all-accounts-txt').attr("aria-hidden",!0)},setAccessibility:function setAccessibility(isAllAccountsMode){if(this.options.cardsLength==1){var prevNextAccountButtons=this.frameEl.find(".pstory-prev-account-button, .pstory-next-account-button");prevNextAccountButtons.css('display','none');prevNextAccountButtons.attr('aria-hidden',!0);this.setAccSelectedButtonAriaLabel()}
else this.updateAccessibilityButtons(isAllAccountsMode)},updateAccessibilityButtons:function updateAccessibilityButtons(isAllAccountsMode,selectedCard){var accountButtons=this.frameEl.find(".pstory-account-button");if(isAllAccountsMode)
accountButtons.attr('aria-hidden',!0);else{accountButtons.attr('aria-hidden',!1);var accPrevAccount=accountButtons.filter('.pstory-prev-account-button');var accNextAccount=accountButtons.filter('.pstory-next-account-button');if(accNextAccount.hasClass('pstory-disable'))
accNextAccount.attr('aria-hidden',!0);else accPrevAccount.attr('aria-hidden',!0);this.setAccSelectedButtonAriaLabel(selectedCard)}},setAccSelectedButtonAriaLabel:function setAccSelectedButtonAriaLabel(selectedCard){if(typeof selectedCard==='undefined'||selectedCard===null)
selectedCard=this.frameEl.find('.pstory-button.selected:not([clone="true"])');var selectedOpt=this.getOptionById(selectedCard.attr('pstory-id'));var cards=this.frameEl.find('.pstory-button:not([clone="true"])')
var index=cards.index(selectedCard)+1;index=index==0?1:index;var text=$('<span>'+selectedOpt.text+'</span>');if(text.find('br').length>0){text.find('br').replaceWith(' ')}
this.frameEl.find(".pstory-account-button.selected .perso-accessibility-read").attr('aria-label',''+selectedOpt.name+'. '+Personetics.dictionary.getText("lblaccSelectAccountAccessibility")+': '+selectedOpt.number+'. '+text.text()+'. '+index+' '+Personetics.dictionary.getText("accessibilityOutOfTxt")+' '+cards.length+'. '+Personetics.dictionary.getText("accessibilitySelected")).attr("id","perso-accessibility-read-"+selectedOpt.id)},putFocusAccessibility:function putFocusAccessibility(elementForFocus){var focusInterval=10;var focusTotalRepetitions=10;elementForFocus.attr('tabindex','0');elementForFocus.blur();var focusRepetitions=0;var interval=window.setTimeout(function(){elementForFocus.focus()},focusInterval)},allAccountsSelectedAnimation:function allAccountsSelectedAnimation(doAnimation){var allTextEl=this.frameEl.find('.pstory-all-accounts-txt');var cardsForAnimation=this.getAllAccountsAnimationCards();var selectedCard=cardsForAnimation.filter('.selected');var notSelectedCards=cardsForAnimation.filter(':not(.selected)');var cardsLength=notSelectedCards.length;if(selectedCard.length==0)
return;if(doAnimation==!0)
cardsForAnimation.add(allTextEl).addClass("pstory-card-transition");else cardsForAnimation.add(allTextEl).removeClass("pstory-card-transition");cardsForAnimation.addClass('pstory-all-animated');this.frameEl.find('.options-container .pstory-button:not(.pstory-all-animated)').addClass('pstory-button-hidden');cardsForAnimation.removeClass('pstory-all-animated-last');notSelectedCards.last().addClass('pstory-all-animated-last');this.allAccountsAnimation.doAnimation(selectedCard,notSelectedCards,this.config.allAnimation)},chooseAccountSelectedAnimation:function chooseAccountSelectedAnimation(){var allTextEl=this.frameEl.find('.pstory-all-accounts-txt');this.frameEl.find(".pstory-button").add(allTextEl).addClass("pstory-card-transition");var cards=this.frameEl.find('.options-container .pstory-button');cards.removeClass("pstory-all-animated").removeClass('pstory-button-hidden');this.allAccountsAnimation.cancelAnimation(cards)},getAllAccountsAnimationCards:function getAllAccountsAnimationCards(){var cards=this.frameEl.find('.options-container .pstory-button:not(.carousel-hide-clone)');var startIndex,endIndex;var selectedItem=this.frameEl.find('.options-container .pstory-button.selected:not([clone="true"])')
var selectedIndex=cards.index(selectedItem);startIndex=selectedIndex-Math.floor((this.options.cardsLength)/2);endIndex=selectedIndex+Math.ceil((this.options.cardsLength)/2);if(startIndex<0){endIndex+=Math.abs(startIndex);startIndex=0}
else if(endIndex>cards.length){startIndex+=endIndex-cards.length;endIndex=cards.length}
return cards.slice(startIndex,endIndex)},afterRender:function afterRender(el){this.frameEl.parents('.pstory-dialog-frame').addClass('perso-account-selector');this.setDefaultSelect();this.setAccountSelectorColors();this.bindCarousel();this.setDisableArrows();this.accSelectedAccountButtons();if(this.showArrows){this.frameEl.find('.pstory-account-button:not(.selected)').addClass('pstory-arrow')}
else{this.accPrevNextAccountButtons()}
if(this.showHeaderTabs){this.setCssForAllAnimation();this.allAccountsAnimation=Personetics.utils.allAccountsAnimation.getAnimation(this.config.allAnimation.type);var selecteTabAll=this.defaultTab==='all';this.frameEl.find(".pstory-header-button[data-all='true']").attr('aria-selected',selecteTabAll);this.frameEl.find(".pstory-header-button[data-all='false']").attr('aria-selected',!selecteTabAll);this.frameEl.find(".cards-wrapper").attr("aria-hidden",selecteTabAll);var selectedHeader=this.frameEl.find("[aria-selected='true']");this.headerTabsAnimation(selectedHeader);if(this.defaultTab==='all'){this.onAllAccountsClick()}}
Personetics.story.AccountSelectorBlock.prototype.afterRender.call(this,el);this.setAccessibility(this.defaultTab==='all');var frameEl=this.frameEl;this.el.find(".perso-accessibility-account-selector").css({'height':frameEl.outerHeight(),'width':frameEl.width()})},accSelectedAccountButtons:function accSelectedAccountButtons(){var relativeContainer=this.frameEl.find('.options-container');var selectedCardWrapper=this.frameEl.find('.pstory-button.selected:not([clone=true])');var selectedCard=selectedCardWrapper.find('.card');var accAccountButtonSelected=this.frameEl.find('.pstory-account-button.selected');accAccountButtonSelected.css({'top':selectedCard.offset().top-relativeContainer.offset().top,'height':selectedCard.outerHeight(!0),'width':selectedCard.outerWidth(!0),'left':selectedCard.offset().left-relativeContainer.offset().left})},accPrevNextAccountButtons:function accPrevNextAccountButton(){var relativeContainer=this.frameEl.find('.options-container');var selectedCardWrapper=this.frameEl.find('.pstory-button.selected:not([clone=true])');var prevNextCards=this.frameEl.find('.pstory-button.next .card, .pstory-button.prev .card');var accAccountButtons=this.frameEl.find('.pstory-account-button:not(.selected)');$.each(prevNextCards,function(i,card){var $card=$(card);var pstoryButtonPadding=$card.parent().outerWidth()-$card.parent().width();var accAccountButtonWidth=(relativeContainer.width()-selectedCardWrapper.outerWidth())/2-pstoryButtonPadding/2;$(accAccountButtons[i]).css({'top':$card.offset().top-relativeContainer.offset().top,'height':$card.outerHeight(),'width':accAccountButtonWidth,'left':Math.max($card.offset().left-relativeContainer.offset().left,0)})})},setDefaultSelect:function(doAnimation){var target=this.frameEl.find('.pstory-button.selected');if(target.length==0){$(this.frameEl.find('.pstory-button')[0]).addClass('selected')}},bindCarousel:function bindCarousel(){var param=this.prepareCarouselParam();this.carouselAnimation=new Personetics.utils.carouselAnimation.bindCarouselEventsForAnimation(this.frameEl.find(".options-container"),param)},prepareCarouselParam:function prepareCarouselParam(){var param=this.getOptionsWidth();param.showIndexDots=this.config.showIndexDots;param.beforeCarouselStart=Personetics.bind(this,this.beforeCarouselStart);return param},beforeCarouselStart:function beforeCarouselStart(e){Personetics.story.AccountSelectorBlock.prototype.optionClickEvent.call(this,e);this.optionClickEvent(e);this.setDisableArrows(e.currentTarget);this.updateAccessibilityButtons(!1,$(e.currentTarget))},setDisableArrows:function setDisableArrows(selectedItem){if(typeof selectedItem==='undefined'||selectedItem===null)
selectedItem=this.frameEl.find('.pstory-button.selected:not([clone="true"])');if(!this.config.enableInfiniteCarousel||this.options.cardsLength==2){var prevArrow=this.el.find('.pstory-prev-account-button');var nextArrow=this.el.find('.pstory-next-account-button');if($(selectedItem).prev().attr('clone')=="true"){if(this.config.nextArrowDir=="ltr"&&this.showArrows){nextArrow.addClass('pstory-disable');prevArrow.removeClass('pstory-disable')}
else{prevArrow.addClass('pstory-disable');nextArrow.removeClass('pstory-disable')}}
else if($(selectedItem).next().attr('clone')=="true"){if(this.config.nextArrowDir=="ltr"&&this.showArrows){prevArrow.addClass('pstory-disable');nextArrow.removeClass('pstory-disable')}
else{nextArrow.addClass('pstory-disable');prevArrow.removeClass('pstory-disable')}}}},getOptionsWidth:function getOptionsWidth(){var container=this.frameEl.find('.options-container');var allAccounts=container.hasClass("allAccounts");container.removeClass("allAccounts");var buttonWidth=container.find('.pstory-button:not(.selected)').outerWidth(!0);if(typeof buttonWidth=='undefined'){buttonWidth=null}
var selectedWidth=container.find('.pstory-button.selected').outerWidth(!0);if(typeof selectedWidth=='undefined'){selectedWidth=null}
if(allAccounts==!0)
container.addClass("allAccounts");return{itemWidth:buttonWidth,selectedItemWidth:selectedWidth}},setAccountSelectorColors:function(){var listCards=this.frameEl.find(".pstory-button");var colors=this.story.uxCtrl.getAccountSelectorPalette();var sum=Math.ceil(listCards.length/colors.length);var newColors=[];for(var i=0;i<sum;i++){newColors=newColors.concat(colors)}
listCards.each(function(i,opt){$(opt).addClass(newColors[i])})},setCssForAllAnimation:function setCssForAllAnimation(){var container=this.frameEl.find('.options-container');container.addClass('pstory-all-animation-'+this.config.allAnimation.type);container.height(container.height())},doScrollEvent:function(skipAnimation){if(Personetics.projectConfiguration.getConfig("supportCollapse")==!0){var collapseHelper=Personetics.story.BlockChartFactory.generateHelperClazz("collapseHelper",this.story.cfg);this.collapseHelper=typeof this.collapseHelper=="undefined"?collapseHelper:this.collapseHelper;var block=this;var elementDisplayed=this.frameEl.find('.carousel-outer-wrapper');this.collapseHelper.scrollEvent(block,elementDisplayed,skipAnimation)}},onCollapsed:function(elementDisplayed,heightForElementDisplayed,fixedContainer){},onUnCollapsed:function(elementDisplayed){}})})(window,window.Personetics=window.Personetics||{},jQuery);(function(window,Personetics,$,undefined){Personetics.story=Personetics.story||{};Personetics.story.D3BarChartBlockProduct=Personetics.story.D3BarChartBlock.extend({beforeRender:function(el,layoutInstructions){Personetics.story.D3BarChartBlock.prototype.beforeRender.call(this,el,layoutInstructions)},afterRender:function afterRender(el){if(this.chartType=="vertical"||this.chartType=="multiVertical"||this.chartType=="pinGraph"){this.xAxis=this.frameEl.find('.x.axis')[0]}
Personetics.story.D3BarChartBlock.prototype.afterRender.call(this,el);var baseValWidth=el.find(".pstory-bar-chart svg, .pstory-pinGraph-chart svg").attr('width').baseVal;var widthSVG;if(typeof baseValWidth!=='undefined'&&baseValWidth!==null)
widthSVG=baseValWidth.value;else widthSVG=el.find(".pstory-bar-chart svg, .pstory-pinGraph-chart svg").attr('width');var halfWidthSVG=widthSVG/2+'px';el.find(".pstory-bar-chart, .pstory-pinGraph-chart svg").css('padding-left',"calc(50% - "+halfWidthSVG+")");this.renderAccessibility(el,this.chartType)},renderAccessibility:function renderAccessibility(el,chartType){var element=$("<div class='accessibility-chart-wrapper'></div>");var layoutInstructions=this.layoutInstructions;var block=this;var chartSvg=$(el).find("svg.perso-svg-chart-container");var chartSvgOffset=chartSvg.offset();var buttonHeight;var buttonTop;var buttonLeft;var button;if(chartType!="pinGraph"){el.find("svg .x.axis .tick").each(function(index,item){button=$("<input type='button' id='accessibility-chart-button_"+layoutInstructions.categories[index]+"' class='accessibility-chart-button'/>");block.setUnclickableClass(button,chartType,index);buttonHeight=$(item).get(0).getBBox().height;button.css('width',$(item).get(0).getBBox().width+"px");buttonTop=$(item).offset().top-chartSvgOffset.top;buttonLeft=$(item).offset().left-chartSvgOffset.left;button.css({'left':buttonLeft+"px",'top':buttonTop+'px'});button.height(buttonHeight);block.ariaLabelAccessibilityButtons(button,layoutInstructions,index,chartType);block.ariaLabelSetSelected(el,item,button);$(button).bind('click',function(e){block.handleClickAccessibilityButtons(layoutInstructions,index,chartType);block.ariaLabelSetSelected(el,item,$(this))});element.prepend(button)});el.find(".pstory-bar-chart, .pstory-pinGraph-chart").append(element)}},getETransform:function getETransform(el){var innerWrapper=el.find("svg .perso-bar, svg .perso-chart-rect").parent();var innerWrapperTransform=innerWrapper.css('transform');if(innerWrapperTransform!="none"){if(typeof innerWrapperTransform===undefined||innerWrapperTransform===null)
innerWrapperTransform=innerWrapper.css('-webkit-transform');if(typeof WebKitCSSMatrix!=='undefined')
var oldTransition=new WebKitCSSMatrix(innerWrapperTransform)['e'];else var oldTransition=new MSCSSMatrix(innerWrapperTransform)['e']}
else{innerWrapperTransform=innerWrapper.attr('transform');if(typeof innerWrapperTransform.baseVal!=="undefined")
var oldTransition=innerWrapperTransform.baseVal.getItem(0).matrix.e}
return oldTransition},ariaLabelSetSelected:function ariaLabelSetSelected(el,item,button){var classSelected=$(item).find('.perso-xAxis-label.selected').length>0?" selected":"";var selected=el.find(".accessibility-chart-button.selected");if(selected.length>0){var ariaLabel=selected.attr('aria-label').split('selected');selected.attr('aria-label',ariaLabel[0]+'');selected.removeClass("selected")}
if(classSelected==" selected"){button.addClass("selected")}
button.attr('aria-label',button.attr('aria-label')+classSelected)},ariaLabelAccessibilityButtons:function ariaLabelAccessibilityButtons(button,layoutInstructions,index,chartType){var i=layoutInstructions.categories.length-index;var monthNumber=Personetics.processor.PUtils.getUtilsInstance("dateUtils").getMonthNumber(Personetics.processor.PStoryConfig.getConfig("lang")+"-short",layoutInstructions.categories[index])
var fullMonthName=Personetics.processor.PUtils.getUtilsInstance("dateUtils").getMonthName(Personetics.processor.PStoryConfig.getConfig("lang"))[monthNumber]
fullMonthName=fullMonthName||layoutInstructions.categories[index]
var currencySymbol=Personetics.projectConfiguration.getConfig("currencySymbol");if(chartType=="multiVertical"){button.attr("aria-label",''+fullMonthName+', '+Personetics.dictionary.getText("accessibilitySeriesIn")+': '+currencySymbol+Math.round(layoutInstructions.series[0][index].value).toLocaleString("en")+', '+Personetics.dictionary.getText("accessibilitySeriesOut")+': -'+currencySymbol+Math.round(layoutInstructions.series[1][index].value).toLocaleString("en")+', '+i+" "+Personetics.dictionary.getText("accessibilityOutOfTxt")+" "+layoutInstructions.categories.length+'')}else{button.attr("aria-label",fullMonthName+', '+currencySymbol+Math.round(layoutInstructions.series[index].value).toLocaleString("en")+', '+i+" "+Personetics.dictionary.getText("accessibilityOutOfTxt")+" "+layoutInstructions.categories.length+'')}},handleClickAccessibilityButtons:function handleClickAccessibilityButtons(layoutInstructions,index,chartType){var seriesData=layoutInstructions.series;if(chartType=="multiVertical"){var clickedObj=layoutInstructions.series[0][index];if((seriesData[1][index].value!==0||seriesData[0][index].value!==0)&&seriesData[1][index].category===clickedObj.category&&seriesData[0][index].category===clickedObj.category){this.handleClick.call(this,clickedObj,index)}}
else{var clickedObj=layoutInstructions.series[index];this.handleClick.call(this,clickedObj,index)}
var nextElementForFocus;var blockElements=this.el.parents(".pstory-dialog-frame").next().find(".pstory-block-content, .pstory-block-content *");if(!this.frameEl.hasClass('perso-collapsed')){if(typeof Personetics.utils.accessibility!=='undefined'&&Personetics.utils.accessibility!==null){$.each(blockElements,function(index,element){if(Personetics.utils.accessibility.isFocusable(element)){nextElementForFocus=$(element);return!1}});if(typeof nextElementForFocus!=="undefined"&&nextElementForFocus.length>0)
this.putFocusAccessibility(nextElementForFocus)}}},putFocusAccessibility:function putFocusAccessibility(elementForFocus){var focusInterval=10;var focusTotalRepetitions=10;elementForFocus.attr('tabindex','0');elementForFocus.blur();var focusRepetitions=0;var interval=window.setTimeout(function(){elementForFocus.focus()},focusInterval)},doScrollEvent:function(skipAnimation){if(Personetics.projectConfiguration.getConfig("supportCollapse")==!0){if(this.chartType=="vertical"||this.chartType=="multiVertical"){this.collapseHelper=typeof this.collapseHelper=="undefined"?new Personetics.story.CollapseHelper():this.collapseHelper;var block=this;var elementDisplayed=$(this.xAxis);this.collapseHelper.scrollEvent(block,elementDisplayed,skipAnimation)}}},onCollapsed:function(elementDisplayed,heightForElementDisplayed,fixedContainer){},onUnCollapsed:function(elementDisplayed,heightForElementDisplayed,fixedContainer){elementDisplayed[0].setAttribute("transform",elementDisplayed[0].getAttribute("transform"))},handleClick:function(obj,clickedItemIndex){Personetics.story.D3BarChartBlock.prototype.handleClick.call(this,obj,clickedItemIndex)},setUnclickableClass:function(el,chartType,index){var block=this;var seriesData=block.layoutInstructions.series;if(chartType=="multiVertical"){if(seriesData[0][index].value===0&&seriesData[1][index].value===0){el.addClass('perso-unclickable')}}else{if(seriesData[index].value===0){el.addClass('perso-unclickable')}}}})})(window,window.Personetics=window.Personetics||{},jQuery);(function(window,Personetics,$,undefined){Personetics.story=Personetics.story||{};Personetics.story.ButtonsBlockProduct=Personetics.story.ButtonsBlock.extend({bindEvnetsForAnimation:function bindEvnetsForAnimation(){if(Personetics.utils.buttonAnimation&&$.isFunction(Personetics.utils.buttonAnimation.bindMaterialButtonEventsForAnimation))
Personetics.utils.buttonAnimation.bindMaterialButtonEventsForAnimation(this.frameEl.find(".pstory-button"))},})})(window,window.Personetics=window.Personetics||{},jQuery);(function(window,Personetics,$,undefined){var d3=Personetics.persoD3||window.d3;Personetics.story=Personetics.story||{};Personetics.story.PieChartBlockProduct=Personetics.story.PieChartBlock.extend({beforeRender:function beforeRender(el,layoutInstructions){Personetics.story.PieChartBlock.prototype.beforeRender.call(this,el,layoutInstructions);var previousDialogs=el.parents('.pstory-dialog-frame').prev('.pstory-dialog-frame');var tabsBlock=previousDialogs.find('.pstory-block-tabs');var selectedTab=tabsBlock.find('.pstory-button.selected');var selectedTabId=selectedTab.attr("pstory-id");if(typeof this.story.uxCtrl.getPieOptions=="function")
if(typeof this.story.uxCtrl.getPieOptions().arcs!="undefined")
this.cornerRadiusPie=typeof this.story.uxCtrl.getPieOptions().arcs.cornerRadius!="undefined"?this.story.uxCtrl.getPieOptions().arcs.cornerRadius.radiusCorner:9;this.colors=d3.scale.ordinal().range(this.getGraphPalette(selectedTabId));this.selectedTabId=selectedTabId;this.texts=$.extend(!0,this.texts,{nextCategory:Personetics.dictionary.getText("accessibilityNextCategory"),previousCategory:Personetics.dictionary.getText("accessibilityPreviousCategory"),selectedCategoryTitle:Personetics.dictionary.getText("accessibilitySelectedCategoryTitle")})},getGraphPalette:function(selectedTabId){return this.story.uxCtrl.getPieGraphPalette(selectedTabId)},renderPieBase:function renderPieBase(el){Personetics.story.PieChartBlock.prototype.renderPieBase.call(this,el);if(this.options.arcs.filter.grayFilter==!0){this.renderGrayFilter()}},renderGrayFilter:function renderGrayFilter(){this.svg.append("filter").attr("id",this.grayscaleId).append("feColorMatrix").attr("type","matrix").attr("values","0.3333 0.3333 0.3333 0 0 0.3333 0.3333 0.3333 0 0 0.3333 0.3333 0.3333 0 0 0 0 0 1 0")},renderGradient:function(){var gradients=this.options.arcs.gradients;var defWithGradients=this.svg.append("defs");if(gradients){$.each(gradients,function(i,gradient){if(gradient){defWithGradients=defWithGradients.append("linearGradient").attr("id",gradient.id).attr("x1","0").attr("x2","0").attr("y1","0").attr("y2","1");$.each(gradient.stopColors,function(i,stopColor){defWithGradients.append("stop").attr("offset",gradient.offset[i]).attr("stop-color",stopColor)})}})}},renderArcs:function(layoutInstructions){Personetics.story.PieChartBlock.prototype.renderArcs.call(this,layoutInstructions);var grayscaleId=this.grayscaleId;if(this.options.arcs.filter.grayFilter==!0){var arcs=this.frameEl.find('.pstory-pie-chart svg .perso-arc path');$.each(arcs,function(i,arc){d3.select(arc).style("filter","url(#"+grayscaleId+")")})}
this.arcs=arcs},afterRender:function(el){var block=this;if(this.frameEl){this.frameEl.addClass(this.selectedTabId);var defaultPath=this.frameEl.find('.pstory-pie-chart svg .perso-arc path.perso-selected')[0];var radius=this.story.uxCtrl.getPieOptions().arcs.cornerRadius?this.story.uxCtrl.getPieOptions().arcs.cornerRadius.radiusCorner:9;d3.select(defaultPath).attr("d",block.arcOver.cornerRadius(this.cornerRadiusPie)).style("filter",this.dropShadow).style("fill",function(d,i){return block.colorArcs(d.data.category)});this.renderGradient();block.arcPaths=block.frameEl.find('.pstory-pie-chart svg .perso-arc path');d3.select(defaultPath).moveToFront();var selected=this.layoutInstructions.slices[this.getSelectedPathIndex(block.arcPaths)];block.initPieInfoValues(selected);if(this.layoutInstructions.slices.length>1){this.frameEl.find('.pstory-pie-data .pstory-arrow').show()}
else{this.frameEl.find('.pstory-pie-data .pstory-arrow').hide()}
Personetics.story.PieChartBlock.prototype.afterRender.call(this,el)}},bindEvents:function(){if(this.frameEl){var block=this;var $nextArrow=this.frameEl.find('.pstory-next-arrow');var $previousArrow=this.frameEl.find('.pstory-previous-arrow');var $paths=block.arcPaths;$nextArrow.bind('click',function(e){var currentItemIndex=block.getSelectedPathIndex($paths);if(currentItemIndex==($paths.length-1)){block.moveArcs(0);block.handleClick(block.layoutInstructions.slices[0],0)}else{block.moveArcs(++currentItemIndex);block.handleClick(block.layoutInstructions.slices[currentItemIndex],currentItemIndex)}
if(document.activeElement==this){block.putFocusAccessibility($(this).closest(".pstory-block-content"))}});$previousArrow.bind('click',function(e){var currentItemIndex=block.getSelectedPathIndex($paths);if(currentItemIndex==0){block.moveArcs($paths.length-1);block.handleClick(block.layoutInstructions.slices[$paths.length-1],$paths.length-1)}else{block.moveArcs(--currentItemIndex);block.handleClick(block.layoutInstructions.slices[currentItemIndex],currentItemIndex)}
if(document.activeElement==this){block.putFocusAccessibility($(this).closest(".pstory-block-content"))}})}},putFocusAccessibility:function putFocusAccessibility(elementForFocus){var focusInterval=10;var focusTotalRepetitions=10;elementForFocus.attr('tabindex','0');elementForFocus.blur();var focusRepetitions=0;var interval=window.setTimeout(function(){elementForFocus.focus()},focusInterval)},onPieItemClick:function onPieItemClick(obj,clickedItemIndex,clickedItem){var block=this;var oldSelectedArc=this.el.find('.perso-arc path.perso-selected');var filter='';if(this.options.arcs.filter.grayFilter==!0){filter="url(#"+this.grayscaleId+")"}
if(oldSelectedArc[0]!=clickedItem){if(oldSelectedArc.length){oldSelectedArc[0].className.baseVal=Personetics.utils.string.removeClass(oldSelectedArc[0].className,'perso-selected');d3.select(oldSelectedArc[0]).attr("d",block.arc).style("filter",filter)}
d3.select(clickedItem).attr("d",block.arcOver.cornerRadius(this.cornerRadiusPie)).attr("class","perso-selected").style("filter",this.dropShadow).style("fill",function(d,i){return block.colorArcs(d.data.category)});d3.select(clickedItem).moveToFront();this.handleClick(obj,clickedItemIndex);this.updatePieInfoValues(obj.data)}},updatePieInfoValues:function(obj){var block=this;if(obj){var amountDiv='<div class="pstory-pie-amount perso-accessibility-no-read"><span>'+obj.label+'</span></div>';var categoryDiv='<div class="pstory-pie-category perso-accessibility-no-read"><span>'+obj.category+'</span></div>';var $infoContainer=this.frameEl.find('.pstory-pie-info');$infoContainer.empty();$infoContainer.append(amountDiv);$infoContainer.append(categoryDiv);this.addInfoTextForAccessibility($infoContainer,obj);if(this.options.arcs.filter.grayFilter==!0){$('.pstory-pie-amount').css('color',block.colors(obj.category))}}},initPieInfoValues:function(obj){this.updatePieInfoValues(obj)},addInfoTextForAccessibility:function addInfoTextForAccessibility($infoContainer,obj){$infoContainer.prepend('<span class="perso-accessibility-read">'+obj.label+', '+obj.category+'</span>');$infoContainer.find(".perso-accessibility-no-read").attr('aria-hidden',!0)},moveArcs:function(index){var block=this;var path=block.arcPaths[index];var filter='';if(this.options.arcs.filter.grayFilter==!0){filter="url(#"+this.grayscaleId+")"}
var oldSelectedArc=this.el.find('.perso-arc path.perso-selected');if(path){d3.select('.pstory-frame .perso-arc path.perso-selected').attr("d",block.arc).style("filter",filter)
oldSelectedArc[0].className.baseVal=Personetics.utils.string.removeClass(oldSelectedArc[0].className,'perso-selected');d3.select(path).attr("d",block.arcOver.cornerRadius(this.cornerRadiusPie)).attr("class","perso-selected").style("filter",this.dropShadow).style("fill",function(d,i){return block.colorArcs(d.data.category)});d3.select(path).moveToFront();block.updatePieInfoValues(block.layoutInstructions.slices[index])}},colorArcs:function(category){var block=this;var color=block.colors(category);if(block.selectedTabId){if(block.selectedTabId=="Out"&&block.options.arcs.selectedOutflowPrimaryColor!=null){color=block.options.arcs.selectedOutflowPrimaryColor}else if(block.selectedTabId=="In"&&block.options.arcs.selectedInflowPrimaryColor!=null){color=block.options.arcs.selectedInflowPrimaryColor}}else if(block.options.arcs.selctedPrimaryColor!=null){color=block.options.arcs.selctedPrimaryColor}
return color},doScrollEvent:function(skipAnimation){if(Personetics.projectConfiguration.getConfig("supportCollapse")==!0){this.collapseHelper=typeof this.collapseHelper=="undefined"?new Personetics.story.CollapseHelper():this.collapseHelper;var block=this;var elementDisplayed=this.frameEl.find('.pstory-pie-data');this.collapseHelper.scrollEvent(block,elementDisplayed,skipAnimation)}}})})(window,window.Personetics=window.Personetics||{},jQuery);(function(window,Personetics,$,undefined){Personetics.story=Personetics.story||{};Personetics.story.D3PinGraphChartBlockProduct=Personetics.story.D3BarChartBlockProduct.extend({beforeRender:function(el,layoutInstructions){Personetics.story.D3BarChartBlockProduct.prototype.beforeRender.call(this,el,layoutInstructions);this.texts.accessibilityPinGraphTitle=Personetics.dictionary.getText("accessibilityPinGraphTitle")},getHtmlTemplateId:function(clazz){return"pinGraph-chart"},render:function(el,layoutInstructions){Personetics.story.Block.prototype.render.call(this,el,layoutInstructions);var chartEl=this.frameEl.find(".pstory-pinGraph-chart");if(chartEl.length>0){this.renderBarChart(chartEl,layoutInstructions)}},renderBarChart:function(el,data){this.chartHelper.prepareChart(data,this.options);this.chartHelper.renderChart(el)},beforeRenderChart:function(el,layoutInstructions){this.layoutInstructions.series=this.layoutInstructions.series[0];this.chartType=this.getChartType();this.chartTypeHelper=(this.chartType+"Helper");this.initChartHelper(this.chartTypeHelper);this.options=this.story.uxCtrl.getPinGraphChartOptions()},barsDirection:function barsDirection(){if(Personetics.processor.PStoryConfig.isRtl()){this.barsDirectionRTL()}},getChartType:function(){var type='pinGraph';return type},getAccessibilityTitle:function getAccessibilityTitle(){return this.texts.accessibilityPinGraphTitle},})})(window,window.Personetics=window.Personetics||{},jQuery);(function(window,Personetics,$,undefined){Personetics.story=Personetics.story||{};Personetics.story.TableBlockProduct=Personetics.story.TableBlock.extend({getHtmlTemplateId:function(clazz){var template;var classStr;var classes=clazz?clazz.split(" "):[];$.each(classes,function(index,className){if(className.indexOf("perso-txlist")>-1){classStr=className.trim();return!1}});this.classStr=classStr;if(typeof(this.classStr)=="undefined"){var numColumns=this.layoutInstructions.columns.length;switch(numColumns){case 3:this.classStr="perso-txlist4";break;case 4:this.classStr="perso-txlist1";break;case 6:this.classStr="perso-txlist3";break;default:this.classStr="perso-txlist1"}}
template="table-"+this.classStr;return template},afterRender:function(el){Personetics.story.TableBlock.prototype.afterRender.call(this,el);if(Personetics.projectConfiguration.getConfig("supportCollapse")==!0){var collapseHelper=Personetics.story.BlockChartFactory.generateHelperClazz("collapseHelper",this.story.cfg);this.collapseHelper=typeof this.collapseHelper=="undefined"?collapseHelper:this.collapseHelper;var heightPrevFixedElements=this.collapseHelper.getHeightPrevFixedElements();var scrollTopDiff=heightPrevFixedElements-this.frameEl.offset().top;var pstoryFrame=this.frameEl.parents('.pstory-frame');var pstoryContainer=pstoryFrame.find('.pstory-container');var siblingsHeight=pstoryFrame[0].scrollHeight-pstoryContainer.height();if(scrollTopDiff>0)
pstoryFrame.scrollTop(pstoryFrame.scrollTop()-scrollTopDiff);pstoryContainer.css('min-height',pstoryFrame.height()+pstoryFrame.scrollTop()-siblingsHeight)}}})})(window,window.Personetics=window.Personetics||{},jQuery);(function(window,Personetics,$,Handlebars,undefined){this["Personetics"]=this["Personetics"]||{};this["Personetics"].UI=this["Personetics"].UI||{};this["Personetics"].UI.Handlebars=this["Personetics"].UI.Handlebars||{};this["Personetics"].UI.Handlebars.templates=this["Personetics"].UI.Handlebars.templates||{};this["Personetics"].UI.Handlebars.templates["error-msg"]=Handlebars.template({"1":function(container,depth0,helpers,partials,data){return"class=\"mobile-err\""},"compiler":[7,">= 4.0.0"],"main":function(container,depth0,helpers,partials,data){var stack1,helper,alias1=depth0!=null?depth0:(container.nullContext||{}),alias2=helpers.helperMissing,alias3="function",alias4=container.escapeExpression;return"<div id=\"personetics-error-container\" "+((stack1=helpers["if"].call(alias1,(depth0!=null?depth0.isMobileDevice:depth0),{"name":"if","hash":{},"fn":container.program(1,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+">\r\n    <div class=\"personetics-error-img "+alias4(((helper=(helper=helpers.imgClass||(depth0!=null?depth0.imgClass:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"imgClass","hash":{},"data":data}):helper)))+"\"></div>\r\n    <div class=\"personetics-error-larg\">"+alias4(((helper=(helper=helpers.textLarge||(depth0!=null?depth0.textLarge:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"textLarge","hash":{},"data":data}):helper)))+"</div>\r\n    <div class=\"personetics-error-small\">"+alias4(((helper=(helper=helpers.textSmall||(depth0!=null?depth0.textSmall:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"textSmall","hash":{},"data":data}):helper)))+"</div>\r\n\r\n</div>"},"useData":!0});this["Personetics"].UI.Handlebars.templates["flow-selector-tmpl"]=Handlebars.template({"1":function(container,depth0,helpers,partials,data){var helper,alias1=depth0!=null?depth0:(container.nullContext||{}),alias2=helpers.helperMissing,alias3="function",alias4=container.escapeExpression;return"    <option value=\""+alias4(((helper=(helper=helpers.key||(data&&data.key))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"key","hash":{},"data":data}):helper)))+"\">"+alias4(((helper=(helper=helpers.name||(depth0!=null?depth0.name:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"name","hash":{},"data":data}):helper)))+"</option>\r\n"},"compiler":[7,">= 4.0.0"],"main":function(container,depth0,helpers,partials,data){var stack1;return"<select id=\"flow-selector\">\r\n"+((stack1=helpers.each.call(depth0!=null?depth0:(container.nullContext||{}),depth0,{"name":"each","hash":{},"fn":container.program(1,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"</select>\r\n"},"useData":!0});this["Personetics"].UI.Handlebars.templates["no-filtered-insights-msg"]=Handlebars.template({"1":function(container,depth0,helpers,partials,data){return"class=\"mobile-msg\""},"compiler":[7,">= 4.0.0"],"main":function(container,depth0,helpers,partials,data){var stack1,helper,alias1=depth0!=null?depth0:(container.nullContext||{});return"<div id=\"personetics-no-insights-filter-container\" "+((stack1=helpers["if"].call(alias1,(depth0!=null?depth0.isMobileDevice:depth0),{"name":"if","hash":{},"fn":container.program(1,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+">\r\n    <div class=\"personetics-nothing-toshow-msg\">"+container.escapeExpression(((helper=(helper=helpers.text||(depth0!=null?depth0.text:depth0))!=null?helper:helpers.helperMissing),(typeof helper==="function"?helper.call(alias1,{"name":"text","hash":{},"data":data}):helper)))+"</div>\r\n</div>"},"useData":!0});this["Personetics"].UI.Handlebars.templates["no-insights-message"]=Handlebars.template({"1":function(container,depth0,helpers,partials,data){return"class=\"mobile-err\""},"compiler":[7,">= 4.0.0"],"main":function(container,depth0,helpers,partials,data){var stack1,helper,alias1=depth0!=null?depth0:(container.nullContext||{}),alias2=helpers.helperMissing,alias3="function",alias4=container.escapeExpression;return"<div id=\"personetics-no-insights-container\" "+((stack1=helpers["if"].call(alias1,(depth0!=null?depth0.isMobileDevice:depth0),{"name":"if","hash":{},"fn":container.program(1,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+">\r\n    <div class=\"personetics-no-insights-img "+alias4(((helper=(helper=helpers.imgClass||(depth0!=null?depth0.imgClass:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"imgClass","hash":{},"data":data}):helper)))+"\"></div>\r\n    <div class=\"personetics-no-insights-small\">"+alias4(((helper=(helper=helpers.textSmall||(depth0!=null?depth0.textSmall:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"textSmall","hash":{},"data":data}):helper)))+"</div>\r\n    <div class=\"personetics-no-insights-larg\">"+alias4(((helper=(helper=helpers.textLarge||(depth0!=null?depth0.textLarge:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"textLarge","hash":{},"data":data}):helper)))+"</div>\r\n</div>"},"useData":!0});this["Personetics"].UI.Handlebars.templates["pstory-block-account-selector"]=Handlebars.template({"1":function(container,depth0,helpers,partials,data){return"				<div class=\"header-container\">\r\n					<input type=\"button\" value=\"All accounts\" class=\"pstory-header-button selected\" data-all=\"true\" pstory-id=\"all\"/>				\r\n					<input type=\"button\" value=\"Choose account\" class=\"pstory-header-button\" data-all=\"false\"/>\r\n					\r\n					<div class=\"pstory-header-button on-select no-select\" data-all=\"false\" pstory-id=\"all\"></div><!--pstory-id for first time-->\r\n					<div class=\"pstory-header-button on-select select\" data-all=\"true\"></div>\r\n				</div>\r\n				<div class=\"options-container show-all allAccounts\">\r\n"},"3":function(container,depth0,helpers,partials,data){return"        		<div class=\"options-container\">\r\n"},"5":function(container,depth0,helpers,partials,data,blockParams,depths){var stack1,helper,alias1=depth0!=null?depth0:(container.nullContext||{}),alias2=helpers.helperMissing,alias3="function",alias4=container.escapeExpression,alias5=container.lambda;return"					<div class=\"pstory-button "+((stack1=helpers["if"].call(alias1,(depth0!=null?depth0.selected:depth0),{"name":"if","hash":{},"fn":container.program(6,data,0,blockParams,depths),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\" pstory-id=\""+alias4(((helper=(helper=helpers.id||(depth0!=null?depth0.id:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"id","hash":{},"data":data}):helper)))+"\"  pstory-event=\""+alias4(((helper=(helper=helpers.event||(depth0!=null?depth0.event:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"event","hash":{},"data":data}):helper)))+"\" role=\""+alias4(alias5((depths[1]!=null?depths[1].role:depths[1]),depth0))+"\">\r\n						<div class=\"card card_"+alias4(((helper=(helper=helpers.typeImage||(depth0!=null?depth0.typeImage:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"typeImage","hash":{},"data":data}):helper)))+" cards"+alias4(((helper=(helper=helpers.numCards||(depth0!=null?depth0.numCards:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"numCards","hash":{},"data":data}):helper)))+"\" pstory-id=\""+alias4(((helper=(helper=helpers.id||(depth0!=null?depth0.id:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"id","hash":{},"data":data}):helper)))+"\">							\r\n							<div class=\"perso-card-img\" ></div>\r\n							<span class=\"perso-account-name\">"+alias4(((helper=(helper=helpers.name||(depth0!=null?depth0.name:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"name","hash":{},"data":data}):helper)))+"</span>\r\n"+((stack1=helpers["if"].call(alias1,(depth0!=null?depth0.number:depth0),{"name":"if","hash":{},"fn":container.program(8,data,0,blockParams,depths),"inverse":container.noop,"data":data}))!=null?stack1:"")+"						</div>\r\n						 <div id=\"pop-"+alias4(alias5(depth0,depth0))+"\" class=\"pstory-button-txt-wrapper\" pstory-id=\""+alias4(((helper=(helper=helpers.id||(depth0!=null?depth0.id:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"id","hash":{},"data":data}):helper)))+"\"><span class=\"pstory-button-txt\">"+((stack1=((helper=(helper=helpers.text||(depth0!=null?depth0.text:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"text","hash":{},"data":data}):helper)))!=null?stack1:"")+"</span></div>		           \r\n					</div>\r\n"},"6":function(container,depth0,helpers,partials,data){return"selected"},"8":function(container,depth0,helpers,partials,data){var helper;return"							<span class=\"perso-account-number\">Account No. "+container.escapeExpression(((helper=(helper=helpers.number||(depth0!=null?depth0.number:depth0))!=null?helper:helpers.helperMissing),(typeof helper==="function"?helper.call(depth0!=null?depth0:(container.nullContext||{}),{"name":"number","hash":{},"data":data}):helper)))+"</span>\r\n"},"compiler":[7,">= 4.0.0"],"main":function(container,depth0,helpers,partials,data,blockParams,depths){var stack1,helper,alias1=depth0!=null?depth0:(container.nullContext||{}),alias2=helpers.helperMissing,alias3="function",alias4=container.escapeExpression;return"<div id=\"pstory-block-account-selector\" class=\"pstory-block-frame pstory-block-account-selector "+alias4(((helper=(helper=helpers["class"]||(depth0!=null?depth0["class"]:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"class","hash":{},"data":data}):helper)))+"\"  data-show-header-tabs="+alias4(((helper=(helper=helpers.showHeaderTabs||(depth0!=null?depth0.showHeaderTabs:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"showHeaderTabs","hash":{},"data":data}):helper)))+">\r\n    <div class=\"pstory-block-container\">\r\n        <div class=\"pstory-block-content\">\r\n"+((stack1=helpers["if"].call(alias1,(depth0!=null?depth0.showHeaderTabs:depth0),{"name":"if","hash":{},"fn":container.program(1,data,0,blockParams,depths),"inverse":container.program(3,data,0,blockParams,depths),"data":data}))!=null?stack1:"")+"	        	<div class=\"cards-wrapper\">\r\n"+((stack1=helpers.each.call(alias1,(depth0!=null?depth0.options:depth0),{"name":"each","hash":{},"fn":container.program(5,data,0,blockParams,depths),"inverse":container.noop,"data":data}))!=null?stack1:"")+"	        	</div>\r\n				<div class=\"pstory-all-accounts-txt\">"+((stack1=((helper=(helper=helpers.allAccountsTxt||(depth0!=null?depth0.allAccountsTxt:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"allAccountsTxt","hash":{},"data":data}):helper)))!=null?stack1:"")+"</div>\r\n            </div>\r\n            <div class=\"pstory-comment\">"+((stack1=((helper=(helper=helpers.comment||(depth0!=null?depth0.comment:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"comment","hash":{},"data":data}):helper)))!=null?stack1:"")+"</div>\r\n        </div>\r\n    </div>\r\n</div>"},"useData":!0,"useDepths":!0});this["Personetics"].UI.Handlebars.templates["pstory-block-bar-chart-collapse"]=Handlebars.template({"compiler":[7,">= 4.0.0"],"main":function(container,depth0,helpers,partials,data){var helper,alias1=depth0!=null?depth0:(container.nullContext||{}),alias2=helpers.helperMissing,alias3="function",alias4=container.escapeExpression;return"<div class=\"pstory-block-frame pstory-block-bar-chart-collapse pstory-inner-"+alias4(((helper=(helper=helpers["class"]||(depth0!=null?depth0["class"]:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"class","hash":{},"data":data}):helper)))+"\">\r\n    <div class=\"pstory-block-contanier\">\r\n        <div class=\"pstory-block-content\">\r\n            <div class=\"pstory-button-collapse\">\r\n            	<div class=\"pstory-inner-title\">\r\n            		"+alias4(((helper=(helper=helpers.txt||(depth0!=null?depth0.txt:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"txt","hash":{},"data":data}):helper)))+"\r\n        		</div>\r\n        		<div class=\"pstory-button-collapse-icon\"></div>\r\n        	</div>\r\n            <div class=\"pstory-bar-chart-collapse-content\">\r\n           		<div class=\"image\"></div>\r\n       		</div>\r\n        </div>\r\n    </div>\r\n</div>\r\n"},"useData":!0});this["Personetics"].UI.Handlebars.templates["pstory-block-bar-chart"]=Handlebars.template({"compiler":[7,">= 4.0.0"],"main":function(container,depth0,helpers,partials,data){var helper,alias1=depth0!=null?depth0:(container.nullContext||{}),alias2=helpers.helperMissing,alias3="function",alias4=container.escapeExpression;return"<div class=\"pstory-block-frame pstory-block-bar-chart pstory-block-bar-chart "+alias4(((helper=(helper=helpers["class"]||(depth0!=null?depth0["class"]:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"class","hash":{},"data":data}):helper)))+" "+alias4(((helper=(helper=helpers.direction||(depth0!=null?depth0.direction:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"direction","hash":{},"data":data}):helper)))+"\">\r\n    <div class=\"pstory-block-container\">\r\n        <div class=\"pstory-block-content\">\r\n            <div class=\"pstory-bar-chart\"></div>\r\n        </div>\r\n    </div>\r\n</div>"},"useData":!0});this["Personetics"].UI.Handlebars.templates["pstory-block-buttons"]=Handlebars.template({"1":function(container,depth0,helpers,partials,data,blockParams,depths){var stack1;return((stack1=helpers["if"].call(depth0!=null?depth0:(container.nullContext||{}),(depth0!=null?depth0.navigateTarget:depth0),{"name":"if","hash":{},"fn":container.program(2,data,0,blockParams,depths),"inverse":container.program(4,data,0,blockParams,depths),"data":data}))!=null?stack1:"")},"2":function(container,depth0,helpers,partials,data){var stack1,helper,alias1=depth0!=null?depth0:(container.nullContext||{}),alias2=helpers.helperMissing,alias3="function";return"		    <a href=\"#!\" class=\"pstory-link-navigateTo pstory-button ripple-closed\" pnavigate-id=\""+container.escapeExpression(((helper=(helper=helpers.navigateTarget||(depth0!=null?depth0.navigateTarget:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"navigateTarget","hash":{},"data":data}):helper)))+"\" >"+((stack1=((helper=(helper=helpers.text||(depth0!=null?depth0.text:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"text","hash":{},"data":data}):helper)))!=null?stack1:"")+"</a>\r\n"},"4":function(container,depth0,helpers,partials,data,blockParams,depths){var stack1;return((stack1=helpers["if"].call(depth0!=null?depth0:(container.nullContext||{}),(depth0!=null?depth0.toggleState:depth0),{"name":"if","hash":{},"fn":container.program(5,data,0,blockParams,depths),"inverse":container.program(8,data,0,blockParams,depths),"data":data}))!=null?stack1:"")},"5":function(container,depth0,helpers,partials,data){var stack1,helper,alias1=depth0!=null?depth0:(container.nullContext||{}),alias2=helpers.helperMissing,alias3="function",alias4=container.escapeExpression;return"		                <input type=\"button\" class=\"pstory-button pstory-toggle-button "+alias4(((helper=(helper=helpers.toggleState||(depth0!=null?depth0.toggleState:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"toggleState","hash":{},"data":data}):helper)))+" "+((stack1=helpers["if"].call(alias1,(depth0!=null?depth0.selected:depth0),{"name":"if","hash":{},"fn":container.program(6,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\" value=\""+((stack1=((helper=(helper=helpers.text||(depth0!=null?depth0.text:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"text","hash":{},"data":data}):helper)))!=null?stack1:"")+"\" pstory-type-text=\"Toggle "+((stack1=((helper=(helper=helpers.text||(depth0!=null?depth0.text:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"text","hash":{},"data":data}):helper)))!=null?stack1:"")+"\" pstory-id=\""+alias4(((helper=(helper=helpers.toggleState||(depth0!=null?depth0.toggleState:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"toggleState","hash":{},"data":data}):helper)))+"\"/>\r\n"},"6":function(container,depth0,helpers,partials,data){return"selected"},"8":function(container,depth0,helpers,partials,data,blockParams,depths){var stack1;return((stack1=helpers["if"].call(depth0!=null?depth0:(container.nullContext||{}),(depths[1]!=null?depths[1].typeRadio:depths[1]),{"name":"if","hash":{},"fn":container.program(9,data,0,blockParams,depths),"inverse":container.program(12,data,0,blockParams,depths),"data":data}))!=null?stack1:"")},"9":function(container,depth0,helpers,partials,data,blockParams,depths){var stack1,helper,alias1=depth0!=null?depth0:(container.nullContext||{}),alias2=helpers.helperMissing,alias3="function",alias4=container.escapeExpression;return"                                <div class=\"pstory-button pstory-radio-button "+((stack1=helpers["if"].call(alias1,(depth0!=null?depth0.selected:depth0),{"name":"if","hash":{},"fn":container.program(6,data,0,blockParams,depths),"inverse":container.noop,"data":data}))!=null?stack1:"")+"  ripple-closed\" tabindex=\"0\" pstory-id=\""+alias4(((helper=(helper=helpers.id||(depth0!=null?depth0.id:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"id","hash":{},"data":data}):helper)))+"\"  pstory-event=\""+alias4(((helper=(helper=helpers.event||(depth0!=null?depth0.event:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"event","hash":{},"data":data}):helper)))+"\">\r\n                                    <input id=\"pstory-radio-"+alias4(((helper=(helper=helpers.id||(depth0!=null?depth0.id:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"id","hash":{},"data":data}):helper)))+"\" name=\"radio-"+alias4(container.lambda((depths[1]!=null?depths[1].id:depths[1]),depth0))+"\" type=\"radio\" "+((stack1=helpers["if"].call(alias1,(depth0!=null?depth0.selected:depth0),{"name":"if","hash":{},"fn":container.program(10,data,0,blockParams,depths),"inverse":container.noop,"data":data}))!=null?stack1:"")+"/>\r\n                                    <label for=\"pstory-radio-"+alias4(((helper=(helper=helpers.id||(depth0!=null?depth0.id:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"id","hash":{},"data":data}):helper)))+"\" role=\"text\">"+((stack1=((helper=(helper=helpers.text||(depth0!=null?depth0.text:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"text","hash":{},"data":data}):helper)))!=null?stack1:"")+"</label>\r\n                                </div>\r\n"},"10":function(container,depth0,helpers,partials,data){return"checked"},"12":function(container,depth0,helpers,partials,data){var stack1,helper,alias1=container.escapeExpression,alias2=depth0!=null?depth0:(container.nullContext||{}),alias3=helpers.helperMissing,alias4="function";return"                                    <button id=\"pop-"+alias1(container.lambda(depth0,depth0))+"\" class=\"pstory-button pstory-regular-button "+((stack1=helpers["if"].call(alias2,(depth0!=null?depth0.selected:depth0),{"name":"if","hash":{},"fn":container.program(6,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+" ripple-closed\" pstory-type-text=\"Button "+((stack1=((helper=(helper=helpers.text||(depth0!=null?depth0.text:depth0))!=null?helper:alias3),(typeof helper===alias4?helper.call(alias2,{"name":"text","hash":{},"data":data}):helper)))!=null?stack1:"")+"\" pstory-id=\""+alias1(((helper=(helper=helpers.id||(depth0!=null?depth0.id:depth0))!=null?helper:alias3),(typeof helper===alias4?helper.call(alias2,{"name":"id","hash":{},"data":data}):helper)))+"\" pstory-event=\""+alias1(((helper=(helper=helpers.event||(depth0!=null?depth0.event:depth0))!=null?helper:alias3),(typeof helper===alias4?helper.call(alias2,{"name":"event","hash":{},"data":data}):helper)))+"\">\r\n                                        "+((stack1=((helper=(helper=helpers.text||(depth0!=null?depth0.text:depth0))!=null?helper:alias3),(typeof helper===alias4?helper.call(alias2,{"name":"text","hash":{},"data":data}):helper)))!=null?stack1:"")+"\r\n                                    </button>\r\n"},"compiler":[7,">= 4.0.0"],"main":function(container,depth0,helpers,partials,data,blockParams,depths){var stack1,helper,alias1=depth0!=null?depth0:(container.nullContext||{}),alias2=helpers.helperMissing,alias3="function",alias4=container.escapeExpression;return"<div id=\"pstory-block-buttons_"+alias4(((helper=(helper=helpers.id||(depth0!=null?depth0.id:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"id","hash":{},"data":data}):helper)))+"\" class=\"pstory-block-frame pstory-block-buttons "+alias4(((helper=(helper=helpers["class"]||(depth0!=null?depth0["class"]:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"class","hash":{},"data":data}):helper)))+"\">\r\n    <div class=\"pstory-block-container\">\r\n        <div class=\"pstory-block-content\">\r\n"+((stack1=helpers.each.call(alias1,(depth0!=null?depth0.options:depth0),{"name":"each","hash":{},"fn":container.program(1,data,0,blockParams,depths),"inverse":container.noop,"data":data}))!=null?stack1:"")+"        </div>\r\n    </div>\r\n</div>"},"useData":!0,"useDepths":!0});this["Personetics"].UI.Handlebars.templates["pstory-block-compare-block"]=Handlebars.template({"1":function(container,depth0,helpers,partials,data){var stack1,helper,alias1=depth0!=null?depth0:(container.nullContext||{}),alias2=helpers.helperMissing,alias3="function";return"                        <div class=\"perso-compare\" role=\"text\">\r\n                            <div class=\"perso-compare-text label\">"+((stack1=((helper=(helper=helpers.label1||(depth0!=null?depth0.label1:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"label1","hash":{},"data":data}):helper)))!=null?stack1:"")+"</div>\r\n                            <div class=\"perso-compare-text value\">"+((stack1=((helper=(helper=helpers.label2||(depth0!=null?depth0.label2:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"label2","hash":{},"data":data}):helper)))!=null?stack1:"")+"</div>\r\n                        </div>\r\n                <div id=\""+((stack1=((helper=(helper=helpers.id||(depth0!=null?depth0.id:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"id","hash":{},"data":data}):helper)))!=null?stack1:"")+"_wrapper\" class=\"perso-compare-bar-wrapper\">\r\n                    <div id=\""+((stack1=((helper=(helper=helpers.id||(depth0!=null?depth0.id:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"id","hash":{},"data":data}):helper)))!=null?stack1:"")+"\" class=\"perso-compare-bar\"></div>\r\n                </div>\r\n\r\n"},"compiler":[7,">= 4.0.0"],"main":function(container,depth0,helpers,partials,data){var stack1,helper,alias1=depth0!=null?depth0:(container.nullContext||{});return"<div class=\"pstory-block-frame pstory-block-compareBlock "+container.escapeExpression(((helper=(helper=helpers["class"]||(depth0!=null?depth0["class"]:depth0))!=null?helper:helpers.helperMissing),(typeof helper==="function"?helper.call(alias1,{"name":"class","hash":{},"data":data}):helper)))+"\">\r\n    <div class=\"pstory-block-contanier\">\r\n        <div class=\"pstory-block-content\">\r\n            <div class=\"perso-compareBlock-wrapper\" role=\"text\">\r\n"+((stack1=helpers.each.call(alias1,(depth0!=null?depth0.options:depth0),{"name":"each","hash":{},"fn":container.program(1,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"            </div>\r\n        </div>\r\n    </div>\r\n</div>\r\n"},"useData":!0});this["Personetics"].UI.Handlebars.templates["pstory-block-date-box"]=Handlebars.template({"compiler":[7,">= 4.0.0"],"main":function(container,depth0,helpers,partials,data){var helper,alias1=depth0!=null?depth0:(container.nullContext||{}),alias2=helpers.helperMissing,alias3="function",alias4=container.escapeExpression;return"<div class=\"pstory-block-frame pstory-block-date-box "+alias4(((helper=(helper=helpers["class"]||(depth0!=null?depth0["class"]:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"class","hash":{},"data":data}):helper)))+"\">\r\n    <div class=\"pstory-block-contanier\">\r\n        <div class=\"pstory-block-content\" tabindex=\"0\">\r\n            <div class=\"pstory-block-date-month\">"+alias4(((helper=(helper=helpers.month||(depth0!=null?depth0.month:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"month","hash":{},"data":data}):helper)))+"</div>\r\n            <div class=\"pstory-block-date-day\">"+alias4(((helper=(helper=helpers.day||(depth0!=null?depth0.day:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"day","hash":{},"data":data}):helper)))+"</div>\r\n        </div>\r\n    </div>\r\n</div>\r\n\r\n"},"useData":!0});this["Personetics"].UI.Handlebars.templates["pstory-block-hbox-columns"]=Handlebars.template({"1":function(container,depth0,helpers,partials,data){var helper,alias1=depth0!=null?depth0:(container.nullContext||{}),alias2=helpers.helperMissing,alias3="function",alias4=container.escapeExpression;return"        <div class=\"pstory-hbox-column-frame "+alias4(((helper=(helper=helpers["class"]||(depth0!=null?depth0["class"]:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"class","hash":{},"data":data}):helper)))+"\" data-v-align=\""+alias4(((helper=(helper=helpers["v-align"]||(depth0!=null?depth0["v-align"]:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"v-align","hash":{},"data":data}):helper)))+"\" data-width=\""+alias4(((helper=(helper=helpers.width||(depth0!=null?depth0.width:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"width","hash":{},"data":data}):helper)))+"\" >\r\n            <div class=\"pstory-hbox-blocks-container\"></div>\r\n        </div>\r\n"},"compiler":[7,">= 4.0.0"],"main":function(container,depth0,helpers,partials,data){var stack1,helper,alias1=depth0!=null?depth0:(container.nullContext||{});return"<div class=\"pstory-block-hbox-columns-frame "+container.escapeExpression(((helper=(helper=helpers["class"]||(depth0!=null?depth0["class"]:depth0))!=null?helper:helpers.helperMissing),(typeof helper==="function"?helper.call(alias1,{"name":"class","hash":{},"data":data}):helper)))+"\">\r\n"+((stack1=helpers.each.call(alias1,(depth0!=null?depth0.columns:depth0),{"name":"each","hash":{},"fn":container.program(1,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"</div>\r\n"},"useData":!0});this["Personetics"].UI.Handlebars.templates["pstory-block-hbox"]=Handlebars.template({"compiler":[7,">= 4.0.0"],"main":function(container,depth0,helpers,partials,data){return"<div class=\"pstory-block-frame pstory-block-hbox\">\r\n    <div class=\"pstory-block-contanier\">\r\n        <div class=\"pstory-block-content\">\r\n            <div class=\"hbox-block-content\"></div>\r\n        </div>\r\n    </div>\r\n</div>\r\n"},"useData":!0});this["Personetics"].UI.Handlebars.templates["pstory-block-image"]=Handlebars.template({"1":function(container,depth0,helpers,partials,data){var helper,alias1=depth0!=null?depth0:(container.nullContext||{}),alias2=helpers.helperMissing,alias3="function",alias4=container.escapeExpression;return"            <div class=\"pstory-block-content\" id=\""+alias4(((helper=(helper=helpers.id||(depth0!=null?depth0.id:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"id","hash":{},"data":data}):helper)))+"\" style=\"background-image:url('"+alias4(((helper=(helper=helpers.url||(depth0!=null?depth0.url:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"url","hash":{},"data":data}):helper)))+"')\"></div>\r\n"},"3":function(container,depth0,helpers,partials,data){var helper,alias1=depth0!=null?depth0:(container.nullContext||{}),alias2=helpers.helperMissing,alias3="function",alias4=container.escapeExpression;return"            <div class=\"pstory-block-content perso-image perso-"+alias4(((helper=(helper=helpers.url||(depth0!=null?depth0.url:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"url","hash":{},"data":data}):helper)))+"\" id=\""+alias4(((helper=(helper=helpers.id||(depth0!=null?depth0.id:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"id","hash":{},"data":data}):helper)))+"\"></div>\r\n"},"compiler":[7,">= 4.0.0"],"main":function(container,depth0,helpers,partials,data){var stack1,helper,alias1=depth0!=null?depth0:(container.nullContext||{});return"<div class=\"pstory-block-frame pstory-block-image "+container.escapeExpression(((helper=(helper=helpers["class"]||(depth0!=null?depth0["class"]:depth0))!=null?helper:helpers.helperMissing),(typeof helper==="function"?helper.call(alias1,{"name":"class","hash":{},"data":data}):helper)))+"\">\r\n    <div class=\"pstory-block-contanier\">\r\n"+((stack1=helpers["if"].call(alias1,(depth0!=null?depth0.isAbsoluteURL:depth0),{"name":"if","hash":{},"fn":container.program(1,data,0),"inverse":container.program(3,data,0),"data":data}))!=null?stack1:"")+"    </div>\r\n</div>\r\n"},"useData":!0});this["Personetics"].UI.Handlebars.templates["pstory-block-layout"]=Handlebars.template({"compiler":[7,">= 4.0.0"],"main":function(container,depth0,helpers,partials,data){var helper;return"<div class=\"pstory-block-frame pstory-block-layout\">\r\n    <div class=\"pstory-block-contanier\">\r\n        <div class=\"pstory-block-content\">\r\n            <div class=\"layout-block-content\" id=\""+container.escapeExpression(((helper=(helper=helpers.id||(depth0!=null?depth0.id:depth0))!=null?helper:helpers.helperMissing),(typeof helper==="function"?helper.call(depth0!=null?depth0:(container.nullContext||{}),{"name":"id","hash":{},"data":data}):helper)))+"\"></div>\r\n        </div>\r\n    </div>\r\n</div>\r\n"},"useData":!0});this["Personetics"].UI.Handlebars.templates["pstory-block-line-chart"]=Handlebars.template({"compiler":[7,">= 4.0.0"],"main":function(container,depth0,helpers,partials,data){var helper;return"<div class=\"pstory-block-frame pstory-block-line-chart pstory-block-line-chart "+container.escapeExpression(((helper=(helper=helpers["class"]||(depth0!=null?depth0["class"]:depth0))!=null?helper:helpers.helperMissing),(typeof helper==="function"?helper.call(depth0!=null?depth0:(container.nullContext||{}),{"name":"class","hash":{},"data":data}):helper)))+"\">\r\n    <div class=\"pstory-block-container\">\r\n        <div class=\"pstory-block-content\">\r\n            <div class=\"pstory-line-chart\"></div>\r\n        </div>\r\n    </div>\r\n</div>"},"useData":!0});this["Personetics"].UI.Handlebars.templates["pstory-block-map"]=Handlebars.template({"compiler":[7,">= 4.0.0"],"main":function(container,depth0,helpers,partials,data){return"<div class=\"pstory-block-frame pstory-block-map\">\r\n    <div class=\"pstory-block-container\">\r\n        <div class=\"pstory-block-content\">\r\n            <div class=\"pstory-map-frame\"></div>\r\n        </div>\r\n    </div>\r\n</div>\r\n"},"useData":!0});this["Personetics"].UI.Handlebars.templates["pstory-block-pie-chart"]=Handlebars.template({"compiler":[7,">= 4.0.0"],"main":function(container,depth0,helpers,partials,data){return"<div class=\"pstory-block-frame pstory-block-pie-chart\">\r\n    <div class=\"pstory-block-container\">\r\n        <div class=\"pstory-block-content\">\r\n            <div class=\"pstory-pie-chart\"></div>\r\n            <div class=\"pstory-pie-data\">\r\n                <div class=\"pstory-next-arrow\"></div>\r\n                <div class=\"pstory-pie-info\">\r\n                </div>\r\n                <div class=\"pstory-previous-arrow\"></div>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</div>"},"useData":!0});this["Personetics"].UI.Handlebars.templates["pstory-block-pinGraph-chart"]=Handlebars.template({"compiler":[7,">= 4.0.0"],"main":function(container,depth0,helpers,partials,data){var helper;return"<div class=\"pstory-block-frame pstory-block-pinGraph-chart_"+container.escapeExpression(((helper=(helper=helpers.index||(depth0!=null?depth0.index:depth0))!=null?helper:helpers.helperMissing),(typeof helper==="function"?helper.call(depth0!=null?depth0:(container.nullContext||{}),{"name":"index","hash":{},"data":data}):helper)))+" pstory-block-pinGraph-chart\">\r\n    <div class=\"pstory-block-container\">\r\n        <div class=\"pstory-block-content\">\r\n            <div class=\"pstory-pinGraph-chart\"></div>\r\n        </div>\r\n    </div>\r\n</div>"},"useData":!0});this["Personetics"].UI.Handlebars.templates["pstory-block-selectOne"]=Handlebars.template({"1":function(container,depth0,helpers,partials,data){var helper,alias1=depth0!=null?depth0:(container.nullContext||{}),alias2=helpers.helperMissing,alias3="function",alias4=container.escapeExpression;return"	            <div class=\"pstory-selectOne-wrapper\">\r\n		            <span class=\"pstory-selectOne\" pstory-id=\""+alias4(((helper=(helper=helpers.id||(depth0!=null?depth0.id:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"id","hash":{},"data":data}):helper)))+"\"\r\n		                   pstory-event=\""+alias4(((helper=(helper=helpers.event||(depth0!=null?depth0.event:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"event","hash":{},"data":data}):helper)))+"\">"+alias4(((helper=(helper=helpers.txt||(depth0!=null?depth0.txt:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"txt","hash":{},"data":data}):helper)))+"</span>\r\n                    <input type=\"button\" class=\"pstory-button pstory-selectOne-icon\" pstory-id=\""+alias4(((helper=(helper=helpers.id||(depth0!=null?depth0.id:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"id","hash":{},"data":data}):helper)))+"\"\r\n		                   pstory-event=\""+alias4(((helper=(helper=helpers.event||(depth0!=null?depth0.event:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"event","hash":{},"data":data}):helper)))+"\"/>\r\n	            </div>\r\n"},"compiler":[7,">= 4.0.0"],"main":function(container,depth0,helpers,partials,data){var stack1;return"<div class=\"pstory-block-frame pstory-block-selectOne\">\r\n    <div class=\"pstory-block-container\">\r\n        <div class=\"pstory-block-content\">\r\n"+((stack1=helpers.each.call(depth0!=null?depth0:(container.nullContext||{}),depth0,{"name":"each","hash":{},"fn":container.program(1,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"        </div>\r\n    </div>\r\n</div>"},"useData":!0});this["Personetics"].UI.Handlebars.templates["pstory-block-spline-chart"]=Handlebars.template({"compiler":[7,">= 4.0.0"],"main":function(container,depth0,helpers,partials,data){return"<div class=\"pstory-block-frame pstory-block-spline-chart\">\r\n    <div class=\"pstory-block-container\">\r\n        <div class=\"pstory-block-content\">\r\n            <div class=\"pstory-spline-chart\"></div>\r\n        </div>\r\n    </div>\r\n</div>"},"useData":!0});this["Personetics"].UI.Handlebars.templates["pstory-block-table"]=Handlebars.template({"1":function(container,depth0,helpers,partials,data){return"                    <tr>\r\n                        <td class=\"perso-loading-table\">Loading...</td>\r\n                    </tr>\r\n"},"3":function(container,depth0,helpers,partials,data,blockParams,depths){var stack1;return((stack1=helpers["if"].call(depth0!=null?depth0:(container.nullContext||{}),(depth0!=null?depth0.twoCols:depth0),{"name":"if","hash":{},"fn":container.program(4,data,0,blockParams,depths),"inverse":container.program(10,data,0,blockParams,depths),"data":data}))!=null?stack1:"")},"4":function(container,depth0,helpers,partials,data){var stack1,alias1=depth0!=null?depth0:(container.nullContext||{});return((stack1=helpers["if"].call(alias1,(depth0!=null?depth0.showHeaders:depth0),{"name":"if","hash":{},"fn":container.program(5,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+((stack1=helpers.each.call(alias1,(depth0!=null?depth0.rows:depth0),{"name":"each","hash":{},"fn":container.program(8,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")},"5":function(container,depth0,helpers,partials,data){var stack1;return"                            <tr>\r\n"+((stack1=helpers.each.call(depth0!=null?depth0:(container.nullContext||{}),(depth0!=null?depth0.displayedCols:depth0),{"name":"each","hash":{},"fn":container.program(6,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"                            </tr>\r\n"},"6":function(container,depth0,helpers,partials,data){var stack1;return"                                    <th role=\"cell\">"+((stack1=container.lambda(depth0,depth0))!=null?stack1:"")+"</th>\r\n"},"8":function(container,depth0,helpers,partials,data){var stack1,alias1=container.lambda;return"                            <tr>\r\n                                <td class=\"perso-td-first\" role=\"cell\">"+((stack1=alias1((depth0!=null?depth0["0"]:depth0),depth0))!=null?stack1:"")+"</td>\r\n                                <td align=\"right\">\r\n                                    <span class=\"perso-td-second\" role=\"cell\">\r\n                                        "+((stack1=alias1((depth0!=null?depth0["1"]:depth0),depth0))!=null?stack1:"")+"\r\n                                    </span>\r\n                                </td>\r\n                            </tr>\r\n"},"10":function(container,depth0,helpers,partials,data,blockParams,depths){var stack1,alias1=depth0!=null?depth0:(container.nullContext||{});return((stack1=helpers["if"].call(alias1,(depth0!=null?depth0.showHeaders:depth0),{"name":"if","hash":{},"fn":container.program(11,data,0,blockParams,depths),"inverse":container.noop,"data":data}))!=null?stack1:"")+((stack1=helpers.each.call(alias1,(depth0!=null?depth0.rows:depth0),{"name":"each","hash":{},"fn":container.program(16,data,0,blockParams,depths),"inverse":container.noop,"data":data}))!=null?stack1:"")},"11":function(container,depth0,helpers,partials,data){var stack1;return"                            <tr>\r\n                                <th role=\"cell\">"+container.escapeExpression(container.lambda(((stack1=(depth0!=null?depth0.displayedCols:depth0))!=null?stack1["1"]:stack1),depth0))+"</th>                           \r\n"+((stack1=helpers["if"].call(depth0!=null?depth0:(container.nullContext||{}),(depth0!=null?depth0.fourCols:depth0),{"name":"if","hash":{},"fn":container.program(12,data,0),"inverse":container.program(14,data,0),"data":data}))!=null?stack1:"")+"                            </tr>\r\n"},"12":function(container,depth0,helpers,partials,data){var stack1;return"                                <th align=\"right\" role=\"cell\">"+container.escapeExpression(container.lambda(((stack1=(depth0!=null?depth0.displayedCols:depth0))!=null?stack1["3"]:stack1),depth0))+"</th>\r\n"},"14":function(container,depth0,helpers,partials,data){var stack1;return"                                    <th align=\"right\" role=\"cell\">"+container.escapeExpression(container.lambda(((stack1=(depth0!=null?depth0.displayedCols:depth0))!=null?stack1["2"]:stack1),depth0))+"</th>\r\n"},"16":function(container,depth0,helpers,partials,data,blockParams,depths){var stack1,alias1=container.lambda,alias2=depth0!=null?depth0:(container.nullContext||{});return"                            <tr>\r\n                                <td>\r\n                                    <span class=\"perso-td-date\" role=\"cell\">\r\n                                        "+((stack1=alias1((depth0!=null?depth0["0"]:depth0),depth0))!=null?stack1:"")+"\r\n                                        </span>\r\n                                    <span class=\"perso-td-first\" role=\"cell\">\r\n                                        "+((stack1=alias1((depth0!=null?depth0["1"]:depth0),depth0))!=null?stack1:"")+"\r\n                                    </span>\r\n                                </td>\r\n                                <td align=\"right\">\r\n                                    <span class=\"perso-td-second\" role=\"cell\">\r\n                                        "+((stack1=alias1((depth0!=null?depth0["2"]:depth0),depth0))!=null?stack1:"")+"\r\n                                    </span>\r\n"+((stack1=helpers["if"].call(alias2,(depths[1]!=null?depths[1].fourCols:depths[1]),{"name":"if","hash":{},"fn":container.program(17,data,0,blockParams,depths),"inverse":container.noop,"data":data}))!=null?stack1:"")+"                                </td>\r\n"+((stack1=helpers["if"].call(alias2,(depths[1]!=null?depths[1].fourCols:depths[1]),{"name":"if","hash":{},"fn":container.program(19,data,0,blockParams,depths),"inverse":container.noop,"data":data}))!=null?stack1:"")+"                            </tr>\r\n"},"17":function(container,depth0,helpers,partials,data){var stack1;return"                                        <span class=\"perso-td-last\" role=\"cell\">\r\n                                            "+((stack1=container.lambda((depth0!=null?depth0["3"]:depth0),depth0))!=null?stack1:"")+"\r\n                                        </span>\r\n"},"19":function(container,depth0,helpers,partials,data){var stack1;return"                                    <!--<td align=\"right\">\r\n                                        <span class=\"perso-td-last\" role=\"cell\">\r\n                                            "+((stack1=container.lambda((depth0!=null?depth0["3"]:depth0),depth0))!=null?stack1:"")+"\r\n                                        </span>\r\n                                    </td>-->\r\n"},"compiler":[7,">= 4.0.0"],"main":function(container,depth0,helpers,partials,data,blockParams,depths){var stack1;return"<div class=\"pstory-block-frame pstory-block-table\">\r\n    <div class=\"pstory-block-container\">\r\n        <div class=\"pstory-block-content\">\r\n            <table class=\"pstory-table\">\r\n"+((stack1=helpers["if"].call(depth0!=null?depth0:(container.nullContext||{}),(depth0!=null?depth0.future:depth0),{"name":"if","hash":{},"fn":container.program(1,data,0,blockParams,depths),"inverse":container.program(3,data,0,blockParams,depths),"data":data}))!=null?stack1:"")+"            </table>\r\n        </div>\r\n    </div>\r\n</div>"},"useData":!0,"useDepths":!0});this["Personetics"].UI.Handlebars.templates["pstory-block-tabs"]=Handlebars.template({"1":function(container,depth0,helpers,partials,data){var stack1,helper,alias1=depth0!=null?depth0:(container.nullContext||{}),alias2=helpers.helperMissing,alias3="function";return"            \r\n                <input type=\"button\" class=\"pstory-tab pstory-button "+((stack1=helpers["if"].call(alias1,(depth0!=null?depth0.selected:depth0),{"name":"if","hash":{},"fn":container.program(2,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\" value=\""+((stack1=((helper=(helper=helpers.text||(depth0!=null?depth0.text:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"text","hash":{},"data":data}):helper)))!=null?stack1:"")+"\" pstory-id=\""+container.escapeExpression(((helper=(helper=helpers.id||(depth0!=null?depth0.id:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"id","hash":{},"data":data}):helper)))+"\" />\r\n            "},"2":function(container,depth0,helpers,partials,data){return"selected"},"4":function(container,depth0,helpers,partials,data){var stack1,helper,alias1=depth0!=null?depth0:(container.nullContext||{}),alias2=helpers.helperMissing,alias3="function",alias4=container.escapeExpression;return"                    <li  class=\"pstory-tab pstory-button "+((stack1=helpers["if"].call(alias1,(depth0!=null?depth0.selected:depth0),{"name":"if","hash":{},"fn":container.program(2,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\" aria-selected=\""+alias4(((helper=(helper=helpers.selected||(depth0!=null?depth0.selected:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"selected","hash":{},"data":data}):helper)))+"\" role=\"tab\" tabindex=\""+alias4(((helper=(helper=helpers.index||(data&&data.index))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"index","hash":{},"data":data}):helper)))+"\" pstory-id=\""+alias4(((helper=(helper=helpers.id||(depth0!=null?depth0.id:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"id","hash":{},"data":data}):helper)))+"\">"+((stack1=((helper=(helper=helpers.text||(depth0!=null?depth0.text:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"text","hash":{},"data":data}):helper)))!=null?stack1:"")+"</li>\r\n"},"compiler":[7,">= 4.0.0"],"main":function(container,depth0,helpers,partials,data){var stack1,helper,alias1=depth0!=null?depth0:(container.nullContext||{}),alias2=helpers.helperMissing,alias3="function",alias4=container.escapeExpression;return"<div id=\"pstory-block-tabs_"+alias4(((helper=(helper=helpers.id||(depth0!=null?depth0.id:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"id","hash":{},"data":data}):helper)))+"\" class=\"pstory-block-frame pstory-block-tabs "+alias4(((helper=(helper=helpers["class"]||(depth0!=null?depth0["class"]:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"class","hash":{},"data":data}):helper)))+"\">\r\n    <div class=\"pstory-block-container\">\r\n        <div class=\"pstory-block-content\">\r\n            <!--"+((stack1=helpers.each.call(alias1,(depth0!=null?depth0.options:depth0),{"name":"each","hash":{},"fn":container.program(1,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"-->\r\n            <div class=\"pstory-tab-animated-border-bottom\"></div>            \r\n            <ul class=\"tablist\" role=\"tablist\">\r\n"+((stack1=helpers.each.call(alias1,(depth0!=null?depth0.options:depth0),{"name":"each","hash":{},"fn":container.program(4,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"            </ul>\r\n        </div>\r\n    </div>\r\n</div>"},"useData":!0});this["Personetics"].UI.Handlebars.templates["pstory-block-textboxes"]=Handlebars.template({"1":function(container,depth0,helpers,partials,data){return"with-image"},"3":function(container,depth0,helpers,partials,data){var stack1;return((stack1=helpers["if"].call(depth0!=null?depth0:(container.nullContext||{}),(depth0!=null?depth0.image:depth0),{"name":"if","hash":{},"fn":container.program(4,data,0),"inverse":container.program(6,data,0),"data":data}))!=null?stack1:"")},"4":function(container,depth0,helpers,partials,data){var stack1,helper,alias1=depth0!=null?depth0:(container.nullContext||{}),alias2=helpers.helperMissing,alias3="function";return"                       <div class=\"perso-textbox-with-image\" role=\"text\">\r\n                           <div class=\"perso-textbox-image "+((stack1=((helper=(helper=helpers.image||(depth0!=null?depth0.image:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"image","hash":{},"data":data}):helper)))!=null?stack1:"")+"\"></div>\r\n                           <div class=\"perso-value\">"+((stack1=((helper=(helper=helpers.value||(depth0!=null?depth0.value:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"value","hash":{},"data":data}):helper)))!=null?stack1:"")+"</div>\r\n                           <div class=\"perso-label\">"+((stack1=((helper=(helper=helpers.label||(depth0!=null?depth0.label:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"label","hash":{},"data":data}):helper)))!=null?stack1:"")+"</div>\r\n                       </div>\r\n"},"6":function(container,depth0,helpers,partials,data){var stack1,helper,alias1=depth0!=null?depth0:(container.nullContext||{}),alias2=helpers.helperMissing,alias3="function";return"                       <div class=\"perso-textbox\" role=\"text\">\r\n                           <div class=\"perso-value\">"+((stack1=((helper=(helper=helpers.value||(depth0!=null?depth0.value:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"value","hash":{},"data":data}):helper)))!=null?stack1:"")+"</div>\r\n                           <div class=\"perso-label\">"+((stack1=((helper=(helper=helpers.label||(depth0!=null?depth0.label:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"label","hash":{},"data":data}):helper)))!=null?stack1:"")+"</div>\r\n                       </div>\r\n"},"compiler":[7,">= 4.0.0"],"main":function(container,depth0,helpers,partials,data){var stack1,helper,alias1=depth0!=null?depth0:(container.nullContext||{});return"<div class=\"pstory-block-frame pstory-block-textboxes "+container.escapeExpression(((helper=(helper=helpers["class"]||(depth0!=null?depth0["class"]:depth0))!=null?helper:helpers.helperMissing),(typeof helper==="function"?helper.call(alias1,{"name":"class","hash":{},"data":data}):helper)))+"\">\r\n    <div class=\"pstory-block-contanier\">\r\n        <div class=\"pstory-block-content\">\r\n           <div class=\"perso-textboxes-wrapper "+((stack1=helpers["if"].call(alias1,(depth0!=null?depth0.hasImage:depth0),{"name":"if","hash":{},"fn":container.program(1,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\" role=\"text\">\r\n"+((stack1=helpers.each.call(alias1,(depth0!=null?depth0.options:depth0),{"name":"each","hash":{},"fn":container.program(3,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"           </div>\r\n        </div>\r\n    </div>\r\n</div>\r\n"},"useData":!0});this["Personetics"].UI.Handlebars.templates["pstory-block-txt-note"]=Handlebars.template({"compiler":[7,">= 4.0.0"],"main":function(container,depth0,helpers,partials,data){var stack1,helper,alias1=depth0!=null?depth0:(container.nullContext||{}),alias2=helpers.helperMissing,alias3="function";return"<div class=\"pstory-block-frame pstory-block-text "+container.escapeExpression(((helper=(helper=helpers["class"]||(depth0!=null?depth0["class"]:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"class","hash":{},"data":data}):helper)))+"\">\r\n    <div class=\"pstory-block-contanier\">\r\n        <div class=\"pstory-block-content\">\r\n            <div class=\"pstory-block-note-icon\"></div>\r\n            <div class=\"pstory-block-note-txt\" role=\"text\">\r\n                "+((stack1=((helper=(helper=helpers.text||(depth0!=null?depth0.text:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"text","hash":{},"data":data}):helper)))!=null?stack1:"")+"\r\n            </div>\r\n        </div>\r\n    </div>\r\n</div>\r\n"},"useData":!0});this["Personetics"].UI.Handlebars.templates["pstory-block-txt"]=Handlebars.template({"1":function(container,depth0,helpers,partials,data){return"        <div class=\"pstory-block-content\" aria-level=\"2\" role=\"heading\">\r\n"},"3":function(container,depth0,helpers,partials,data){return"        <div class=\"pstory-block-content\" role=\"text\">\r\n"},"compiler":[7,">= 4.0.0"],"main":function(container,depth0,helpers,partials,data){var stack1,helper,alias1=depth0!=null?depth0:(container.nullContext||{}),alias2=helpers.helperMissing,alias3="function";return"<div class=\"pstory-block-frame pstory-block-text "+container.escapeExpression(((helper=(helper=helpers["class"]||(depth0!=null?depth0["class"]:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"class","hash":{},"data":data}):helper)))+"\">\r\n    <div class=\"pstory-block-contanier\">\r\n"+((stack1=helpers["if"].call(alias1,(depth0!=null?depth0.needAccessibility:depth0),{"name":"if","hash":{},"fn":container.program(1,data,0),"inverse":container.program(3,data,0),"data":data}))!=null?stack1:"")+"            "+((stack1=((helper=(helper=helpers.text||(depth0!=null?depth0.text:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"text","hash":{},"data":data}):helper)))!=null?stack1:"")+"\r\n        </div>\r\n    </div>\r\n</div>\r\n"},"useData":!0});this["Personetics"].UI.Handlebars.templates["pstory-frame"]=Handlebars.template({"compiler":[7,">= 4.0.0"],"main":function(container,depth0,helpers,partials,data){var helper,alias1=depth0!=null?depth0:(container.nullContext||{}),alias2=helpers.helperMissing,alias3="function",alias4=container.escapeExpression;return"<div class=\"pstory-frame "+alias4(((helper=(helper=helpers.langClass||(depth0!=null?depth0.langClass:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"langClass","hash":{},"data":data}):helper)))+" "+alias4(((helper=(helper=helpers.directionClass||(depth0!=null?depth0.directionClass:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"directionClass","hash":{},"data":data}):helper)))+" "+alias4(((helper=(helper=helpers.cssClass||(depth0!=null?depth0.cssClass:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"cssClass","hash":{},"data":data}):helper)))+"\" data-id=\"pstory-frame_"+alias4(((helper=(helper=helpers.storyId||(depth0!=null?depth0.storyId:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"storyId","hash":{},"data":data}):helper)))+"\">\r\n    <div class=\"pstory-container\"></div>\r\n</div>\r\n"},"useData":!0});this["Personetics"].UI.Handlebars.templates["tmpl-perso-post"]=Handlebars.template({"compiler":[7,">= 4.0.0"],"main":function(container,depth0,helpers,partials,data){return"<div class=\"post-frame\">\r\n    <div class=\"post-container\">\r\n    </div>\r\n</div>"},"useData":!0});this["Personetics"].UI.Handlebars.templates["tmpl-perso-rating"]=Handlebars.template({"compiler":[7,">= 4.0.0"],"main":function(container,depth0,helpers,partials,data){var helper;return"<div class=\"perso-ratings-wrapper\">\r\n   <div class='perso-ratings-text'>"+container.escapeExpression(((helper=(helper=helpers.ratingTitle||(depth0!=null?depth0.ratingTitle:depth0))!=null?helper:helpers.helperMissing),(typeof helper==="function"?helper.call(depth0!=null?depth0:(container.nullContext||{}),{"name":"ratingTitle","hash":{},"data":data}):helper)))+"</div>\r\n   <div class='perso-ratings-icons' data-rating-max='5'></div>\r\n</div>\r\n\r\n"},"useData":!0});this["Personetics"].UI.Handlebars.templates["tmpl-perso-teasers"]=Handlebars.template({"1":function(container,depth0,helpers,partials,data){var stack1,helper,alias1=container.escapeExpression;return"<div class=\"perso-teaser\" id=\""+alias1(((helper=(helper=helpers.id||(depth0!=null?depth0.id:depth0))!=null?helper:helpers.helperMissing),(typeof helper==="function"?helper.call(depth0!=null?depth0:(container.nullContext||{}),{"name":"id","hash":{},"data":data}):helper)))+"\">"+alias1(container.lambda(((stack1=(depth0!=null?depth0.teaser:depth0))!=null?stack1.title:stack1),depth0))+"</div>\r\n"},"compiler":[7,">= 4.0.0"],"main":function(container,depth0,helpers,partials,data){var stack1;return((stack1=helpers.each.call(depth0!=null?depth0:(container.nullContext||{}),(depth0!=null?depth0.posts:depth0),{"name":"each","hash":{},"fn":container.program(1,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")},"useData":!0});this["Personetics"].UI.Handlebars.templates["tmpl-pfeed"]=Handlebars.template({"compiler":[7,">= 4.0.0"],"main":function(container,depth0,helpers,partials,data){return"<div>\r\n    <div class=\"perso-header\">\r\n        Feed by <!--<img src=\"resources/images/perso-logo.png\" class=\"perso-logo\">-->\r\n        <svg  xmlns:svg=\"http://www.w3.org/2000/svg\" xmlns=\"http://www.w3.org/2000/svg\" width=\"187\" height=\"37\" viewBox=\"0 0 187 37\">\r\n            <image width=\"187\" height=\"37\" preserveAspectRatio=\"none\" id=\"image10\" x=\"0\" y=\"0\"\r\n                    xlink:href=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAALsAAAAlCAYAAAAa/JhZAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyNpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNS1jMDE0IDc5LjE1MTQ4MSwgMjAxMy8wMy8xMy0xMjowOToxNSAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIChNYWNpbnRvc2gpIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjRCQjk1MzY1QkU4NjExRTU4OTQzRThGMDA3MzBBMTYxIiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOjRCQjk1MzY2QkU4NjExRTU4OTQzRThGMDA3MzBBMTYxIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6NEJCOTUzNjNCRTg2MTFFNTg5NDNFOEYwMDczMEExNjEiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6NEJCOTUzNjRCRTg2MTFFNTg5NDNFOEYwMDczMEExNjEiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz5K1DUkAAAMWElEQVR42uxcTXLruBGGX7x/yjqVMl05gOVdMrMwdQLLJ7B8AlknkHUCWScQfQLLJxC9mEl2pg+QMl9+1o/ZT8oBlK+tVhsNgpRdzzNPqGJJokigu/Hh60YD5J7ZlV0JlIM//HFpP1JxOv/y73/2PqrMfzpIXuT95Zf/FlbWyn3f33XndwfexH4k4nRlAVH8BnTr2o+5BXi+v/+7O/vp9Bzb8zdWv2wH9u+vDBwAJFPbo/crB3rHAd2CfGRBPraHA/69PS6cvpbtyx3Yv30HuU55cbW7stUgnuF7akHfs4Af2u9TB3j7fb4D+7d1uS4e7uD3wgL+7AOKOiIZedjzAeV0MmYgDxerjxGuuRCmsvZ93A91gGMcKFba4xETk6JBh7qJwikJALeS2TrKNwZOiknUCWS+t20sfi1AR+k7PazceQOdu6KvCs22LFY/8AEF9fli+KoN2KFjl80PKiZj7P0J6qB7yxB2LJt32c8bsDrh4GiPVd53MY9HMVlKVHStCW3rorgw8fzt7hm5CcMbTbbmnmyBM8qhYsCU6ehkWbz14IsIXR4U2zgiuKi599Iew0A/ucEykYPG3nvlidW18pJtUe5z9V8F5DtX9HvRE3WUnjr6AKl2fwH8ZRx/DAvOE02d/PbcJezkrqs+MYVuI4BuIIRT/gmCGY9R5wFhVxMJDIht2fHBA/SVjCSb6wDXlj2ecP0U8o/x/QGd9G7ZD1H/OGCbfoS+45p+cvZY2uun38hbjWuATvH1g8QAwHlbc38X/faENlcFA4fYfITTjtU/O1Z35LqHRp630HNjlNu6vkYOGjfajgNudwDBO/AmZ+RalTCA1+tkusZ1txHGv4j1NKizj3AgQXv3kmlYqHHLdFiA+ULlWIaKYK2HSLtuxNvODu/N7DX9EcSAref3zFbLBvdq3jvBYKLQJv/7l3Ll5fbxpwm4xA6LuX3F5TFdwxkElgo7Y9/B9fYFw4+RGvKVc1ZXAuD3agy7AHArxoS1RoNrjAH6AF7Lx8jODj0B1KXwiJeegdnxMLOUZx7Q9xEDr++5ZoqJ73uHaaHwl+Z9qUd3nu48DehnMB9LxcT5VYGuV96YPjQa+SoZwoKhEjZMEYf5yg0AkCOUSIRLii1pDdDdHIIb4FZh/QJMTBOeIgLkxBbjmmzArb32uEEa8cwTPh4ok++gN7LXjWAbadMhGN4B4Eph6tYroiCArgLUEQ00Fs+PCejC9l1Fx8rTD0dtEhD7rkHXQXUsiMoXCrvJ2Ty/rxAGuGwJdhMAus+tJorx2mRplp76KgZyzt79wMCXk1FHAIUAc9fj4Xz6ZsLOFQO89Dqjd2T1oRIGnUn5MNgWHlxoxcX1EyQRqhBrx5RPDRomoTPF7acICXyza36NDCG0rIPGnj7QXEVcZ8C8c9/EuobVE4/ch3DDVQQ4vRkp5uZlAsAEbLa635GLPJS0YFITqm6bWfIR1iSAn0LBW6EkQxyxfrVt3SLR0DqZsC/i87SmcSp3PiXdyLPC+GJ6ykLIe24UAy4jWb9UWKtQ4mHKBAwgUwG978FGlTL7fxV+4FrnFTPhrVI2SLQyY2091oA9UcLGJiXRiGXL0lUAnbdJdKBvOoFMVR/zkJkv9RnF7AH2UQd14L/CY5Bbj2FeMXJDoL+K6YTLPAaQ6zqL0l0v7FHXoYKZ7gMA0+x6HfJu78XEH7mgz3oRyYIOCHS+DdjTBq6rr7CsiQBYCZBeKLP6WKDnIQZxXgaTrh5i6JhJ42phzU2keQ43gjWbFM7qGgvW1UkeKfZ4r+X9MhD6tQG8C3GOkaGrm1sNmq7VtNkbo6WZqNNmRs8lv+R9PQaai0FUmnBeehJpQOrwC7aCSmmsTgDAbmHmMMJznTSYX0hW53V2hTfJlfCSBkxmvnFB2OoLF4ehSbEbDKF0KHTL2JzvRAlxziOTAbVhjBSwi438fYVlSzJAAIjncoKBFcYHwxYC2AROCxHKBntIpjSxAXO4FOUZFjPOAqzfUbxdV6QF+8qg96bjlHmB7Pijmrh4qnkeTFaXDTzTq4HZkJl9YLvEaqjx9PUSWZaujBjgUaccIy57hpTy4baDM8TsaeTKamXEwpCLxe29BwLA1HFPmNT9B53aVzzAImD0RSTQB8wzzJH2umfsXNVkbxIlpqZB4Mvl3wTmNRoJ3As7DMCYXUW2DjxPhmQBnTtlNnf/x6ZauyCciukcm3efKazrQDtk9pB9vRSLcLTN4BKDhXQrIVe/4bzyVdljnbdsOWDUpXaEJoOG9W1shlK2H/RimF15pKxJITZ5ahDDHiPnLRfQ1IWbBqu9bcqGrSL7uul2gYHxryzHEOUhBvXyLbG3VRjTpjGA9qLBCBx5Jq7FFqmtYkvdaEtp1uCeSpmoB3PPNbJWsXMUD3HkHtu96YQVGLhoceuI2aupTEXTeUtbsBODZZGGOKzJiKyuUSavsy06Z9LiXpKF6zYy4Tx1BaDnou0cIF5EDNBJDSgck8akU+syXsb4F8Nahwesn5vI1yMbwzaHsEEZ2UeNtzeEwpjS0/DWD0bIbQWR4Qi5OdfuTdNFC/Ggw5EIi5yOX+pSmYG985lR9ma3sE3fbC6+LZB5yT326Ht0ie4fTAIHqCMBwB/BmAthu9QT5uQ1/eWT7x4Dv4jor9Ssd5ZSPz2aLZ4/2IuNy3ZlA/RJw3BqVz5A2T2D2txdl+Z9lt535Z3Lp50JdmUH9l3Zld8o2IudKXblewH77gU9u/LdTFCjmf2HH/7s0kryecHHn3/+2wL/0XOlNIAoBUV5ZLcXe5WCMv9fbqcctkvr3Zn1VgBXzyN+u/QVPRLo6nW591zIQO1QuUG9CdqkJ2cSs16aLs06t8uvc0vWn0X9lO+fQq6M/cf1kIVkp+K2SfD1BJ/NUtzDZSbZpF3mrG2So8L3CyYTl1GzAS/cBl+YvtI29J88fwdc8b4rYceC6T6EHIVZr4uE9DdM7wmra+Mai0c/s2MVK4/EewJhBlAwZSAb4zffx3Bk1nlauocDNGH/8R2VvF7a4z5hHZkIufjzsbT8npj1o3Ik+wPrYNprb8R1tCvyCudSs37wfGBep2n7Rt+W2zWbj5LRK9lMwGYn+D32yMbtMjWbOXCSg3Z3zj3/hWzAC393y5TJor3ThZ/nzwpP0faEDTrSacnkoN91+hNWUkEi8hqV2Q3YNhUgfVUcgztWsSy+6iT7uwfGp33u1xAiE7cSmOv2Ko/N5vZQ6iRa9ctNzQuC2AAZmvVGKQJawa45M/6nfohBniFLzjp0YdZPzTRZXJswVkrYd81mFYjhRqmPtkT3jJ4K7XrkjLUBececDbKJ57x2/bNZvxGsRJsFA6iUw31/YoAN6X/OvMkoNgzn2ZiMCVq2CIn6EHhmNl97RkafQ6hFDSAuzea21iOz+ZhdauK2EOTm9fZYvk+cWG7WUEcKtU4b2meJY8DaDNmMHtDwAfES9dTtqZmY9bt32tigy7xOKVic68NBOAZ705scRqjjKzBw75HDsOuPavRPmJcv69jcC3b2ZI/bo3Dc4iWb5xAw8QjRYTFp6HUUBVhOY5qUGXO45XyFOiZ2Z2Rq1svqjYzMgDfBQBlH2MwwoJwo3ietkeMa8g5b2oD+L4S3vWH65MoAOUbbtLPxjA36JNJmPv3JZl18RpPOp+fnZ8OP8l//KO1RyfPyoOK+2xAmYWAYewycw3OMWJwfAkWXXXPH6l6YuOcUCZzyujvGRBPTbDPROQA5FnOQ2JLjuGH6hGxGHvbavH59xDVscW3q3885Evc3scEI/8udq/yxwFIMgjOWcODh1kJMOO+E/cgedzX6D1i429HmSz7MvtV2gZWb++mnv64M9+OPf0kQf8kwYgEDzY3+5Ak9pTRnhs3ACBkzykwBOLFLF52UiFDtHHXlLLtTRrANvX8lY514yn5PGSBmnnBtzOrJWWjQY53tsxk9dZ8oxDBA2xeBQZYxkIRs0GTgnyjZJRokSxaqOPkOGAHl+ORyDCCbZGuuP4V6h0zeJxYOkudwGHQfFxaTpW+C2rTcmfVrIHLOoq4B2xilufh1Bp3SZ0YpPN8zjNpc3HOEug49nTMT8R61z9/RQk+w07saiYkqcZ3xyDQRE8gZA+BIpN1KwYJXgv0ylm7j92g2O2MDecbqr/BfR7En16Nkcx/NBpru8vxn5XzB8EDeYII4/QR6ZUpfjBhBaPqXIp3KdSs9HnBDp/8JMAAoWRW8rHmVTQAAAABJRU5ErkJggg==\"/>\r\n        </svg>\r\n    </div>\r\n    <div class=\"perso-main\">\r\n        <div class=\"nano perso-container\">\r\n            <div class=\"nano-content perso-scroll\">\r\n            </div>\r\n        </div>\r\n    </div>\r\n    <div class=\"perso-footer\">\r\n        <div class=\"footer-button\">Close</div>\r\n    </div>\r\n</div>\r\n"},"useData":!0});this["Personetics"].UI.Handlebars.templates["tmpl-pslide"]=Handlebars.template({"compiler":[7,">= 4.0.0"],"main":function(container,depth0,helpers,partials,data){var helper;return"<div class=\""+container.escapeExpression(((helper=(helper=helpers["class"]||(depth0!=null?depth0["class"]:depth0))!=null?helper:helpers.helperMissing),(typeof helper==="function"?helper.call(depth0!=null?depth0:(container.nullContext||{}),{"name":"class","hash":{},"data":data}):helper)))+"\">\r\n    <div class=\"perso-header\">\r\n        <sup><sup>Feed by </sup><!--<img src=\"resources/images/perso-logo.png\" class=\"perso-logo\">-->\r\n            <svg  xmlns:svg=\"http://www.w3.org/2000/svg\" xmlns=\"http://www.w3.org/2000/svg\" width=\"187\" height=\"37\" viewBox=\"0 0 187 37\">\r\n                <image width=\"187\" height=\"37\" preserveAspectRatio=\"none\" id=\"image10\" x=\"0\" y=\"0\"\r\n                       xlink:href=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAALsAAAAlCAYAAAAa/JhZAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyNpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNS1jMDE0IDc5LjE1MTQ4MSwgMjAxMy8wMy8xMy0xMjowOToxNSAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIChNYWNpbnRvc2gpIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjRCQjk1MzY1QkU4NjExRTU4OTQzRThGMDA3MzBBMTYxIiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOjRCQjk1MzY2QkU4NjExRTU4OTQzRThGMDA3MzBBMTYxIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6NEJCOTUzNjNCRTg2MTFFNTg5NDNFOEYwMDczMEExNjEiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6NEJCOTUzNjRCRTg2MTFFNTg5NDNFOEYwMDczMEExNjEiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz5K1DUkAAAMWElEQVR42uxcTXLruBGGX7x/yjqVMl05gOVdMrMwdQLLJ7B8AlknkHUCWScQfQLLJxC9mEl2pg+QMl9+1o/ZT8oBlK+tVhsNgpRdzzNPqGJJokigu/Hh60YD5J7ZlV0JlIM//HFpP1JxOv/y73/2PqrMfzpIXuT95Zf/FlbWyn3f33XndwfexH4k4nRlAVH8BnTr2o+5BXi+v/+7O/vp9Bzb8zdWv2wH9u+vDBwAJFPbo/crB3rHAd2CfGRBPraHA/69PS6cvpbtyx3Yv30HuU55cbW7stUgnuF7akHfs4Af2u9TB3j7fb4D+7d1uS4e7uD3wgL+7AOKOiIZedjzAeV0MmYgDxerjxGuuRCmsvZ93A91gGMcKFba4xETk6JBh7qJwikJALeS2TrKNwZOiknUCWS+t20sfi1AR+k7PazceQOdu6KvCs22LFY/8AEF9fli+KoN2KFjl80PKiZj7P0J6qB7yxB2LJt32c8bsDrh4GiPVd53MY9HMVlKVHStCW3rorgw8fzt7hm5CcMbTbbmnmyBM8qhYsCU6ehkWbz14IsIXR4U2zgiuKi599Iew0A/ucEykYPG3nvlidW18pJtUe5z9V8F5DtX9HvRE3WUnjr6AKl2fwH8ZRx/DAvOE02d/PbcJezkrqs+MYVuI4BuIIRT/gmCGY9R5wFhVxMJDIht2fHBA/SVjCSb6wDXlj2ecP0U8o/x/QGd9G7ZD1H/OGCbfoS+45p+cvZY2uun38hbjWuATvH1g8QAwHlbc38X/faENlcFA4fYfITTjtU/O1Z35LqHRp630HNjlNu6vkYOGjfajgNudwDBO/AmZ+RalTCA1+tkusZ1txHGv4j1NKizj3AgQXv3kmlYqHHLdFiA+ULlWIaKYK2HSLtuxNvODu/N7DX9EcSAref3zFbLBvdq3jvBYKLQJv/7l3Ll5fbxpwm4xA6LuX3F5TFdwxkElgo7Y9/B9fYFw4+RGvKVc1ZXAuD3agy7AHArxoS1RoNrjAH6AF7Lx8jODj0B1KXwiJeegdnxMLOUZx7Q9xEDr++5ZoqJ73uHaaHwl+Z9qUd3nu48DehnMB9LxcT5VYGuV96YPjQa+SoZwoKhEjZMEYf5yg0AkCOUSIRLii1pDdDdHIIb4FZh/QJMTBOeIgLkxBbjmmzArb32uEEa8cwTPh4ok++gN7LXjWAbadMhGN4B4Eph6tYroiCArgLUEQ00Fs+PCejC9l1Fx8rTD0dtEhD7rkHXQXUsiMoXCrvJ2Ty/rxAGuGwJdhMAus+tJorx2mRplp76KgZyzt79wMCXk1FHAIUAc9fj4Xz6ZsLOFQO89Dqjd2T1oRIGnUn5MNgWHlxoxcX1EyQRqhBrx5RPDRomoTPF7acICXyza36NDCG0rIPGnj7QXEVcZ8C8c9/EuobVE4/ch3DDVQQ4vRkp5uZlAsAEbLa635GLPJS0YFITqm6bWfIR1iSAn0LBW6EkQxyxfrVt3SLR0DqZsC/i87SmcSp3PiXdyLPC+GJ6ykLIe24UAy4jWb9UWKtQ4mHKBAwgUwG978FGlTL7fxV+4FrnFTPhrVI2SLQyY2091oA9UcLGJiXRiGXL0lUAnbdJdKBvOoFMVR/zkJkv9RnF7AH2UQd14L/CY5Bbj2FeMXJDoL+K6YTLPAaQ6zqL0l0v7FHXoYKZ7gMA0+x6HfJu78XEH7mgz3oRyYIOCHS+DdjTBq6rr7CsiQBYCZBeKLP6WKDnIQZxXgaTrh5i6JhJ42phzU2keQ43gjWbFM7qGgvW1UkeKfZ4r+X9MhD6tQG8C3GOkaGrm1sNmq7VtNkbo6WZqNNmRs8lv+R9PQaai0FUmnBeehJpQOrwC7aCSmmsTgDAbmHmMMJznTSYX0hW53V2hTfJlfCSBkxmvnFB2OoLF4ehSbEbDKF0KHTL2JzvRAlxziOTAbVhjBSwi438fYVlSzJAAIjncoKBFcYHwxYC2AROCxHKBntIpjSxAXO4FOUZFjPOAqzfUbxdV6QF+8qg96bjlHmB7Pijmrh4qnkeTFaXDTzTq4HZkJl9YLvEaqjx9PUSWZaujBjgUaccIy57hpTy4baDM8TsaeTKamXEwpCLxe29BwLA1HFPmNT9B53aVzzAImD0RSTQB8wzzJH2umfsXNVkbxIlpqZB4Mvl3wTmNRoJ3As7DMCYXUW2DjxPhmQBnTtlNnf/x6ZauyCciukcm3efKazrQDtk9pB9vRSLcLTN4BKDhXQrIVe/4bzyVdljnbdsOWDUpXaEJoOG9W1shlK2H/RimF15pKxJITZ5ahDDHiPnLRfQ1IWbBqu9bcqGrSL7uul2gYHxryzHEOUhBvXyLbG3VRjTpjGA9qLBCBx5Jq7FFqmtYkvdaEtp1uCeSpmoB3PPNbJWsXMUD3HkHtu96YQVGLhoceuI2aupTEXTeUtbsBODZZGGOKzJiKyuUSavsy06Z9LiXpKF6zYy4Tx1BaDnou0cIF5EDNBJDSgck8akU+syXsb4F8Nahwesn5vI1yMbwzaHsEEZ2UeNtzeEwpjS0/DWD0bIbQWR4Qi5OdfuTdNFC/Ggw5EIi5yOX+pSmYG985lR9ma3sE3fbC6+LZB5yT326Ht0ie4fTAIHqCMBwB/BmAthu9QT5uQ1/eWT7x4Dv4jor9Ssd5ZSPz2aLZ4/2IuNy3ZlA/RJw3BqVz5A2T2D2txdl+Z9lt535Z3Lp50JdmUH9l3Zld8o2IudKXblewH77gU9u/LdTFCjmf2HH/7s0kryecHHn3/+2wL/0XOlNIAoBUV5ZLcXe5WCMv9fbqcctkvr3Zn1VgBXzyN+u/QVPRLo6nW591zIQO1QuUG9CdqkJ2cSs16aLs06t8uvc0vWn0X9lO+fQq6M/cf1kIVkp+K2SfD1BJ/NUtzDZSbZpF3mrG2So8L3CyYTl1GzAS/cBl+YvtI29J88fwdc8b4rYceC6T6EHIVZr4uE9DdM7wmra+Mai0c/s2MVK4/EewJhBlAwZSAb4zffx3Bk1nlauocDNGH/8R2VvF7a4z5hHZkIufjzsbT8npj1o3Ik+wPrYNprb8R1tCvyCudSs37wfGBep2n7Rt+W2zWbj5LRK9lMwGYn+D32yMbtMjWbOXCSg3Z3zj3/hWzAC393y5TJor3ThZ/nzwpP0faEDTrSacnkoN91+hNWUkEi8hqV2Q3YNhUgfVUcgztWsSy+6iT7uwfGp33u1xAiE7cSmOv2Ko/N5vZQ6iRa9ctNzQuC2AAZmvVGKQJawa45M/6nfohBniFLzjp0YdZPzTRZXJswVkrYd81mFYjhRqmPtkT3jJ4K7XrkjLUBececDbKJ57x2/bNZvxGsRJsFA6iUw31/YoAN6X/OvMkoNgzn2ZiMCVq2CIn6EHhmNl97RkafQ6hFDSAuzea21iOz+ZhdauK2EOTm9fZYvk+cWG7WUEcKtU4b2meJY8DaDNmMHtDwAfES9dTtqZmY9bt32tigy7xOKVic68NBOAZ705scRqjjKzBw75HDsOuPavRPmJcv69jcC3b2ZI/bo3Dc4iWb5xAw8QjRYTFp6HUUBVhOY5qUGXO45XyFOiZ2Z2Rq1svqjYzMgDfBQBlH2MwwoJwo3ietkeMa8g5b2oD+L4S3vWH65MoAOUbbtLPxjA36JNJmPv3JZl18RpPOp+fnZ8OP8l//KO1RyfPyoOK+2xAmYWAYewycw3OMWJwfAkWXXXPH6l6YuOcUCZzyujvGRBPTbDPROQA5FnOQ2JLjuGH6hGxGHvbavH59xDVscW3q3885Evc3scEI/8udq/yxwFIMgjOWcODh1kJMOO+E/cgedzX6D1i429HmSz7MvtV2gZWb++mnv64M9+OPf0kQf8kwYgEDzY3+5Ak9pTRnhs3ACBkzykwBOLFLF52UiFDtHHXlLLtTRrANvX8lY514yn5PGSBmnnBtzOrJWWjQY53tsxk9dZ8oxDBA2xeBQZYxkIRs0GTgnyjZJRokSxaqOPkOGAHl+ORyDCCbZGuuP4V6h0zeJxYOkudwGHQfFxaTpW+C2rTcmfVrIHLOoq4B2xilufh1Bp3SZ0YpPN8zjNpc3HOEug49nTMT8R61z9/RQk+w07saiYkqcZ3xyDQRE8gZA+BIpN1KwYJXgv0ylm7j92g2O2MDecbqr/BfR7En16Nkcx/NBpru8vxn5XzB8EDeYII4/QR6ZUpfjBhBaPqXIp3KdSs9HnBDp/8JMAAoWRW8rHmVTQAAAABJRU5ErkJggg==\"/>\r\n            </svg>\r\n        </sup>\r\n    </div>\r\n    <div class=\"perso-main\">\r\n        <div class=\"nano perso-container\">\r\n            <div  class=\"nano-content perso-scroll\"></div>\r\n        </div>\r\n    </div>\r\n    <div class=\"perso-footer\"><div class=\"footer-button\">Close</div></div>\r\n</div>"},"useData":!0});this["Personetics"].UI.Handlebars.templates["tmpl-pstory-dialog-continue-btn"]=Handlebars.template({"1":function(container,depth0,helpers,partials,data){var stack1;return"        		"+((stack1=helpers["if"].call(depth0!=null?depth0:(container.nullContext||{}),(depth0!=null?depth0.showBtn:depth0),{"name":"if","hash":{},"fn":container.program(2,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\r\n"},"2":function(container,depth0,helpers,partials,data){var helper,alias1=depth0!=null?depth0:(container.nullContext||{}),alias2=helpers.helperMissing,alias3="function",alias4=container.escapeExpression;return"<div class=\"pstory-dialog-btn\" data-action=\""+alias4(((helper=(helper=helpers.actionBtn||(depth0!=null?depth0.actionBtn:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"actionBtn","hash":{},"data":data}):helper)))+"\">"+alias4(((helper=(helper=helpers.diaogBtn||(depth0!=null?depth0.diaogBtn:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"diaogBtn","hash":{},"data":data}):helper)))+"</div>"},"compiler":[7,">= 4.0.0"],"main":function(container,depth0,helpers,partials,data){var stack1,helper,alias1=depth0!=null?depth0:(container.nullContext||{}),alias2=helpers.helperMissing,alias3="function",alias4=container.escapeExpression;return"<div class=\"pstory-dialog-frame perso-dialog-actions-btn "+alias4(((helper=(helper=helpers["class"]||(depth0!=null?depth0["class"]:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"class","hash":{},"data":data}):helper)))+"\" id=\"pdlg-"+alias4(((helper=(helper=helpers.id||(depth0!=null?depth0.id:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"id","hash":{},"data":data}):helper)))+"\">\r\n    <div class=\"pstory-dialog-container\">\r\n        <div class=\"pstory-dialog-content\" ></div>\r\n        <div class=\"pstory-dialog-buttons\" data-numOfDialogBtn=\""+alias4(container.lambda(((stack1=(depth0!=null?depth0.btn:depth0))!=null?stack1.length:stack1),depth0))+"\">\r\n"+((stack1=helpers.each.call(alias1,(depth0!=null?depth0.btn:depth0),{"name":"each","hash":{},"fn":container.program(1,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"		</div>\r\n    </div>\r\n</div>"},"useData":!0});this["Personetics"].UI.Handlebars.templates["tmpl-pstory-dialog"]=Handlebars.template({"compiler":[7,">= 4.0.0"],"main":function(container,depth0,helpers,partials,data){var helper,alias1=depth0!=null?depth0:(container.nullContext||{}),alias2=helpers.helperMissing,alias3="function",alias4=container.escapeExpression;return"<div class=\"pstory-dialog-frame "+alias4(((helper=(helper=helpers["class"]||(depth0!=null?depth0["class"]:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"class","hash":{},"data":data}):helper)))+"\" id=\"pdlg-"+alias4(((helper=(helper=helpers.id||(depth0!=null?depth0.id:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"id","hash":{},"data":data}):helper)))+"\">\r\n    <div class=\"pstory-dialog-container\">\r\n        <div class=\"pstory-dialog-content\" />\r\n    </div>\r\n</div>"},"useData":!0});this["Personetics"].UI.Handlebars.templates["tmpl-pstory-title-inside-story"]=Handlebars.template({"compiler":[7,">= 4.0.0"],"main":function(container,depth0,helpers,partials,data){var stack1,helper;return"<div class=\"pstory-title-outer-wrapper\">\r\n    <div class=\"pstory-fixed pstory-title-wrapper\">\r\n        <div class=\"pstory-title\">\r\n            <div class=\"pstory-title-text pstory-title-inside-story\">"+((stack1=((helper=(helper=helpers.title||(depth0!=null?depth0.title:depth0))!=null?helper:helpers.helperMissing),(typeof helper==="function"?helper.call(depth0!=null?depth0:(container.nullContext||{}),{"name":"title","hash":{},"data":data}):helper)))!=null?stack1:"")+"</div>\r\n        </div>\r\n    </div>\r\n</div>\r\n"},"useData":!0});this["Personetics"].UI.Handlebars.templates["tmpl-pstory-title"]=Handlebars.template({"compiler":[7,">= 4.0.0"],"main":function(container,depth0,helpers,partials,data){var stack1,helper;return"<div class=\"pstory-title-outer-wrapper\">\r\n    <div class=\"pstory-fixed pstory-title-wrapper\">\r\n        <div class=\"pstory-title\">\r\n            <div class=\"pstory-title-text\">"+((stack1=((helper=(helper=helpers.title||(depth0!=null?depth0.title:depth0))!=null?helper:helpers.helperMissing),(typeof helper==="function"?helper.call(depth0!=null?depth0:(container.nullContext||{}),{"name":"title","hash":{},"data":data}):helper)))!=null?stack1:"")+"</div>\r\n        </div>\r\n    </div>\r\n</div>\r\n<div id=\"story-frame-container\"></div>"},"useData":!0});this["Personetics"].UI.Handlebars.templates["block-bar-chart"]=Handlebars.template({"compiler":[7,">= 4.0.0"],"main":function(container,depth0,helpers,partials,data){var helper,alias1=depth0!=null?depth0:(container.nullContext||{}),alias2=helpers.helperMissing,alias3="function",alias4=container.escapeExpression;return"<div class=\"pstory-block-frame pstory-block-bar-chart pstory-block-bar-chart "+alias4(((helper=(helper=helpers["class"]||(depth0!=null?depth0["class"]:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"class","hash":{},"data":data}):helper)))+" "+alias4(((helper=(helper=helpers.direction||(depth0!=null?depth0.direction:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"direction","hash":{},"data":data}):helper)))+"\">\r\n    <div class=\"pstory-block-container\">\r\n        <div class=\"pstory-block-content\">\r\n            <div class=\"pstory-bar-chart\"></div>\r\n        </div>\r\n    </div>\r\n</div>"},"useData":!0});this["Personetics"].UI.Handlebars.templates["block-line-chart"]=Handlebars.template({"compiler":[7,">= 4.0.0"],"main":function(container,depth0,helpers,partials,data){var helper;return"<div class=\"pstory-block-frame pstory-block-line-chart pstory-block-line-chart "+container.escapeExpression(((helper=(helper=helpers["class"]||(depth0!=null?depth0["class"]:depth0))!=null?helper:helpers.helperMissing),(typeof helper==="function"?helper.call(depth0!=null?depth0:(container.nullContext||{}),{"name":"class","hash":{},"data":data}):helper)))+"\">\r\n    <div class=\"pstory-block-container\">\r\n        <div class=\"pstory-block-content\">\r\n            <div class=\"pstory-line-chart\"></div>\r\n        </div>\r\n    </div>\r\n</div>"},"useData":!0});this["Personetics"].UI.Handlebars.templates["block-pie-chart"]=Handlebars.template({"compiler":[7,">= 4.0.0"],"main":function(container,depth0,helpers,partials,data){return"<div class=\"pstory-block-frame pstory-block-pie-chart\">\r\n    <div class=\"pstory-block-container\">\r\n        <div class=\"pstory-block-content\">\r\n            <div class=\"pstory-pie-chart\"></div>\r\n            <div class=\"pstory-pie-data\">\r\n                <div class=\"pstory-next-arrow\"></div>\r\n                <div class=\"pstory-pie-info\">\r\n                </div>\r\n                <div class=\"pstory-previous-arrow\"></div>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</div>"},"useData":!0});this["Personetics"].UI.Handlebars.templates["block-pinGraph-chart"]=Handlebars.template({"compiler":[7,">= 4.0.0"],"main":function(container,depth0,helpers,partials,data){var helper;return"<div class=\"pstory-block-frame pstory-block-pinGraph-chart_"+container.escapeExpression(((helper=(helper=helpers.index||(depth0!=null?depth0.index:depth0))!=null?helper:helpers.helperMissing),(typeof helper==="function"?helper.call(depth0!=null?depth0:(container.nullContext||{}),{"name":"index","hash":{},"data":data}):helper)))+" pstory-block-pinGraph-chart\">\r\n    <div class=\"pstory-block-container\">\r\n        <div class=\"pstory-block-content\">\r\n            <div class=\"pstory-pinGraph-chart\"></div>\r\n        </div>\r\n    </div>\r\n</div>"},"useData":!0});this["Personetics"].UI.Handlebars.templates["block-spline-chart"]=Handlebars.template({"compiler":[7,">= 4.0.0"],"main":function(container,depth0,helpers,partials,data){return"<div class=\"pstory-block-frame pstory-block-spline-chart\">\r\n    <div class=\"pstory-block-container\">\r\n        <div class=\"pstory-block-content\">\r\n            <div class=\"pstory-spline-chart\"></div>\r\n        </div>\r\n    </div>\r\n</div>"},"useData":!0});this["Personetics"].UI.Handlebars.templates["tmpl-perso-widget-story-error"]=Handlebars.template({"1":function(container,depth0,helpers,partials,data){return"class=\"mobile-err\""},"compiler":[7,">= 4.0.0"],"main":function(container,depth0,helpers,partials,data){var stack1,helper,alias1=depth0!=null?depth0:(container.nullContext||{}),alias2=helpers.helperMissing,alias3="function";return"<div id=\"personetics-error-container\" "+((stack1=helpers["if"].call(alias1,(depth0!=null?depth0.isMobileDevice:depth0),{"name":"if","hash":{},"fn":container.program(1,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+">\r\n    <div class=\"personetics-error-img "+container.escapeExpression(((helper=(helper=helpers.imgClass||(depth0!=null?depth0.imgClass:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"imgClass","hash":{},"data":data}):helper)))+"\"></div> \r\n    <div class=\"personetics-error-large\">"+((stack1=((helper=(helper=helpers.textLarge||(depth0!=null?depth0.textLarge:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"textLarge","hash":{},"data":data}):helper)))!=null?stack1:"")+"</div>\r\n    <div class=\"personetics-error-small\">"+((stack1=((helper=(helper=helpers.textSmall||(depth0!=null?depth0.textSmall:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"textSmall","hash":{},"data":data}):helper)))!=null?stack1:"")+"</div>\r\n   \r\n\r\n</div>"},"useData":!0});this["Personetics"].UI.Handlebars.templates["p-story-widget-ctrl.js"]=Handlebars.template({"compiler":[7,">= 4.0.0"],"main":function(container,depth0,helpers,partials,data){return"(function(window, Personetics, $, undefined){\r\n    Personetics.story = Personetics.story || {};\r\n    Personetics.UI.PStoryWidgetCtrlProduct = Personetics.UI.PStoryWidgetCtrl.extend({\r\n\r\n        initialize: function(config) {\r\n            this.super = Personetics.UI.PStoryWidgetCtrl.prototype;\r\n            this.super.initialize.call(this, config);\r\n\r\n            this.uxCtrl = new Personetics.story.skinController();\r\n        }\r\n    });\r\n})(window, window.Personetics = window.Personetics || {}, jQuery);"},"useData":!0});this["Personetics"].UI.Handlebars.templates["tmpl-perso-widget-story-error"]=Handlebars.template({"compiler":[7,">= 4.0.0"],"main":function(container,depth0,helpers,partials,data){var helper,alias1=depth0!=null?depth0:(container.nullContext||{}),alias2=helpers.helperMissing,alias3="function",alias4=container.escapeExpression;return"<div class='story-widget-error'>\r\n    <div class='story-widget-error-title'>\r\n        "+alias4(((helper=(helper=helpers.errorTextTitle||(depth0!=null?depth0.errorTextTitle:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"errorTextTitle","hash":{},"data":data}):helper)))+"\r\n    </div>\r\n    <div class='story-widget-error-body'>\r\n        "+alias4(((helper=(helper=helpers.errorTextBody||(depth0!=null?depth0.errorTextBody:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"errorTextBody","hash":{},"data":data}):helper)))+"\r\n    </div>\r\n</div>"},"useData":!0});this["Personetics"].UI.Handlebars.templates["tmpl-perso-feedback"]=Handlebars.template({"compiler":[7,">= 4.0.0"],"main":function(container,depth0,helpers,partials,data){var stack1,helper,alias1=depth0!=null?depth0:(container.nullContext||{}),alias2=helpers.helperMissing,alias3="function";return"<div class=\"perso-feedback-wrapper\">\r\n    <div class=\"textarea-wrapper\">\r\n        <div class=\"textarea-container\">\r\n            <textarea class=\"perso-feedback-text direction-text-left\" maxlength=\"500\" placeholder=\""+((stack1=((helper=(helper=helpers.lblfeedbackprompt||(depth0!=null?depth0.lblfeedbackprompt:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"lblfeedbackprompt","hash":{},"data":data}):helper)))!=null?stack1:"")+"\"></textarea>\r\n            <div class=\"textarea-size\" ></div>\r\n        </div>\r\n        <input class=\"perso-feedback-submit\" type=\"button\" value=\""+((stack1=((helper=(helper=helpers.btnsubmit||(depth0!=null?depth0.btnsubmit:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"btnsubmit","hash":{},"data":data}):helper)))!=null?stack1:"")+"\"/>\r\n    </div>\r\n    <div class=\"perso-feedback-reaction\">"+((stack1=((helper=(helper=helpers.lblreactionFeedback||(depth0!=null?depth0.lblreactionFeedback:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"lblreactionFeedback","hash":{},"data":data}):helper)))!=null?stack1:"")+"</div>\r\n</div>\r\n"},"useData":!0});this["Personetics"].UI.Handlebars.templates["filter-inbox-template"]=Handlebars.template({"compiler":[7,">= 4.0.0"],"main":function(container,depth0,helpers,partials,data){var stack1,alias1=container.lambda,alias2=container.escapeExpression;return"<ul role=\"tablist\">\r\n	<li role=\"tab\" class =\"perso-teaser-filter-tab selected\" data-id=\"all\" aria-selected=\"true\" aria-label=\""+alias2(alias1(((stack1=(depth0!=null?depth0.texts:depth0))!=null?stack1.ttlinboxAll:stack1),depth0))+"\">"+alias2(alias1(((stack1=(depth0!=null?depth0.texts:depth0))!=null?stack1.ttlinboxAll:stack1),depth0))+"</li>\r\n	<li role=\"tab\" class =\"perso-teaser-filter-tab\" data-id=\"unread\" aria-selected=\"false\" aria-label=\""+alias2(alias1(((stack1=(depth0!=null?depth0.texts:depth0))!=null?stack1.ttlinboxUnread:stack1),depth0))+"\">"+alias2(alias1(((stack1=(depth0!=null?depth0.texts:depth0))!=null?stack1.ttlinboxUnread:stack1),depth0))+"</li>\r\n	<li role=\"tab\" class =\"perso-teaser-filter-tab\" data-id=\"flagged\" aria-selected=\"false\" aria-label=\""+alias2(alias1(((stack1=(depth0!=null?depth0.texts:depth0))!=null?stack1.ttlinboxHighlighted:stack1),depth0))+"\">"+alias2(alias1(((stack1=(depth0!=null?depth0.texts:depth0))!=null?stack1.ttlinboxHighlighted:stack1),depth0))+"</li>\r\n</ul>\r\n"},"useData":!0});this["Personetics"].UI.Handlebars.templates.inboxContainer=Handlebars.template({"compiler":[7,">= 4.0.0"],"main":function(container,depth0,helpers,partials,data){return"<div id=\"personetics-inbox-container\">\r\n</div>\r\n<div id=\"personetics-story-inner-container\">\r\n    <div class=\"perso-story-inner-top\">\r\n        <div class=\"story-top-title\"></div>\r\n        <div class=\"story-top-buttons-wrapper\">\r\n            <div class=\"story-top-button story-top-button-inbox\">\r\n                <input id=\"story-button-inbox\" type=\"button\" class=\"story-top-button-circle\">\r\n                <div class=\"story-top-button-circle-img\"></div>\r\n                </input>\r\n                <div class=\"story-top-button-text\">INSIGHTS INBOX</div>\r\n            </div>\r\n        </div>\r\n    </div>\r\n    <div class=\"perso-story-inner\">\r\n        <div id=\"personetics-story\"></div>\r\n    </div>\r\n</div>"},"useData":!0});this["Personetics"].UI.Handlebars.templates["pstory-block-account-selector-accessibility"]=Handlebars.template({"1":function(container,depth0,helpers,partials,data){var stack1,helper,alias1=depth0!=null?depth0:(container.nullContext||{}),alias2=helpers.helperMissing,alias3="function",alias4=container.escapeExpression,alias5=container.lambda;return"				<div class=\"header-container\">\r\n					<div class=\"pstory-tab-animated-border-bottom\"></div>\r\n					<ul class=\"tablist\" role=\"tablist\">\r\n						<li  class=\"pstory-header-button\" role=\"tab\" tabindex=\""+alias4(((helper=(helper=helpers.index||(data&&data.index))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"index","hash":{},"data":data}):helper)))+"\" data-all=\"true\" pstory-id=\"all\">"+((stack1=alias5(((stack1=(depth0!=null?depth0.headerTexts:depth0))!=null?stack1["0"]:stack1),depth0))!=null?stack1:"")+"</li>\r\n						<li  class=\"pstory-header-button\" role=\"tab\" tabindex=\""+alias4(((helper=(helper=helpers.index||(data&&data.index))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"index","hash":{},"data":data}):helper)))+"\"  data-all=\"false\">"+((stack1=alias5(((stack1=(depth0!=null?depth0.headerTexts:depth0))!=null?stack1["1"]:stack1),depth0))!=null?stack1:"")+"</li>\r\n					</ul>\r\n				</div>\r\n				<div class=\"carousel-animate carousel-wrapper options-container show-all\">\r\n"},"3":function(container,depth0,helpers,partials,data){return"        		<div class=\"carousel-animate carousel-wrapper options-container\">\r\n"},"5":function(container,depth0,helpers,partials,data,blockParams,depths){var stack1,helper,alias1=depth0!=null?depth0:(container.nullContext||{}),alias2=helpers.helperMissing,alias3="function",alias4=container.escapeExpression,alias5=container.lambda;return"					<div class=\"carousel-item pstory-button "+((stack1=helpers["if"].call(alias1,(depth0!=null?depth0.selected:depth0),{"name":"if","hash":{},"fn":container.program(6,data,0,blockParams,depths),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\" pstory-id=\""+alias4(((helper=(helper=helpers.id||(depth0!=null?depth0.id:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"id","hash":{},"data":data}):helper)))+"\" aria-hidden=\"true\" pstory-event=\""+alias4(((helper=(helper=helpers.event||(depth0!=null?depth0.event:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"event","hash":{},"data":data}):helper)))+"\" role=\""+alias4(alias5((depths[1]!=null?depths[1].role:depths[1]),depth0))+"\">\r\n						<div class=\"card card_"+alias4(((helper=(helper=helpers.typeImage||(depth0!=null?depth0.typeImage:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"typeImage","hash":{},"data":data}):helper)))+" cards"+alias4(((helper=(helper=helpers.numCards||(depth0!=null?depth0.numCards:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"numCards","hash":{},"data":data}):helper)))+"\" pstory-id=\""+alias4(((helper=(helper=helpers.id||(depth0!=null?depth0.id:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"id","hash":{},"data":data}):helper)))+"\">							\r\n"+((stack1=container.invokePartial(partials.innerCard,depth0,{"name":"innerCard","hash":{"numberPrefAccessibility":(depths[1]!=null?depths[1].numberPrefAccessibility:depths[1]),"numberPref":(depths[1]!=null?depths[1].numberPref:depths[1])},"data":data,"indent":"\t\t\t\t\t\t\t","helpers":helpers,"partials":partials,"decorators":container.decorators}))!=null?stack1:"")+"						</div>\r\n						 <div id=\"pop-"+alias4(alias5(depth0,depth0))+"\" class=\"pstory-button-txt-wrapper\" pstory-id=\""+alias4(((helper=(helper=helpers.id||(depth0!=null?depth0.id:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"id","hash":{},"data":data}):helper)))+"\"><span class=\"pstory-button-txt\">\r\n                             "+((stack1=((helper=(helper=helpers.text||(depth0!=null?depth0.text:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"text","hash":{},"data":data}):helper)))!=null?stack1:"")+"</span></div>		           \r\n					</div>\r\n"},"6":function(container,depth0,helpers,partials,data){return"selected"},"compiler":[7,">= 4.0.0"],"main":function(container,depth0,helpers,partials,data,blockParams,depths){var stack1,helper,alias1=depth0!=null?depth0:(container.nullContext||{}),alias2=helpers.helperMissing,alias3="function",alias4=container.escapeExpression;return"<div class=\"perso-accessibility-wrapper perso-accessibility-account-selector\" role=\"text\">\r\n	<span class=\"perso-accessibility-read\">"+alias4(((helper=(helper=helpers.accountSelectorText||(depth0!=null?depth0.accountSelectorText:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"accountSelectorText","hash":{},"data":data}):helper)))+"</span> \r\n</div>\r\n<div id=\"pstory-block-account-selector_"+alias4(((helper=(helper=helpers.index||(depth0!=null?depth0.index:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"index","hash":{},"data":data}):helper)))+"\" class=\"pstory-block-frame pstory-block-account-selector "+alias4(((helper=(helper=helpers["class"]||(depth0!=null?depth0["class"]:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"class","hash":{},"data":data}):helper)))+"\" data-showAll="+alias4(((helper=(helper=helpers.showAll||(depth0!=null?depth0.showAll:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"showAll","hash":{},"data":data}):helper)))+">\r\n    <div class=\"pstory-block-container\">\r\n        <div class=\"pstory-block-content\">\r\n"+((stack1=helpers["if"].call(alias1,(depth0!=null?depth0.showAll:depth0),{"name":"if","hash":{},"fn":container.program(1,data,0,blockParams,depths),"inverse":container.program(3,data,0,blockParams,depths),"data":data}))!=null?stack1:"")+"	        	<div class=\"carousel-inner-wrapper cards-wrapper\">\r\n"+((stack1=helpers.each.call(alias1,(depth0!=null?depth0.options:depth0),{"name":"each","hash":{},"fn":container.program(5,data,0,blockParams,depths),"inverse":container.noop,"data":data}))!=null?stack1:"")+"	        	</div>\r\n				<div class=\"perso-accessibility-wrapper account-button selected\" role=\"text\">\r\n					<span class=\"perso-accessibility-read\">"+alias4(((helper=(helper=helpers.accountName||(depth0!=null?depth0.accountName:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"accountName","hash":{},"data":data}):helper)))+". "+alias4(((helper=(helper=helpers.numberPrefAccessibility||(depth0!=null?depth0.numberPrefAccessibility:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"numberPrefAccessibility","hash":{},"data":data}):helper)))+" "+alias4(((helper=(helper=helpers.accountNumber||(depth0!=null?depth0.accountNumber:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"accountNumber","hash":{},"data":data}):helper)))+"</span>\r\n				</div>\r\n                <input class=\"account-button prev\" id=\"prev\" type=\"button\" value=\"\" aria-label=\""+alias4(((helper=(helper=helpers.next||(depth0!=null?depth0.next:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"next","hash":{},"data":data}):helper)))+"\"/>\r\n				<input class=\"account-button next\" id=\"next\" type=\"button\" value=\"\" aria-label=\""+alias4(((helper=(helper=helpers.next||(depth0!=null?depth0.next:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"next","hash":{},"data":data}):helper)))+"\"/>\r\n				<div class=\"pstory-all-accounts-txt\" role=\"text\">"+((stack1=((helper=(helper=helpers.allAccountsTxt||(depth0!=null?depth0.allAccountsTxt:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"allAccountsTxt","hash":{},"data":data}):helper)))!=null?stack1:"")+"</div>\r\n            </div>\r\n            <div class=\"pstory-comment\">"+((stack1=((helper=(helper=helpers.comment||(depth0!=null?depth0.comment:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"comment","hash":{},"data":data}):helper)))!=null?stack1:"")+"</div>\r\n        </div>\r\n    </div>\r\n</div>"},"usePartial":!0,"useData":!0,"useDepths":!0});this["Personetics"].UI.Handlebars.templates["pstory-block-account-selector-inner-card"]=Handlebars.template({"1":function(container,depth0,helpers,partials,data){var helper,alias1=depth0!=null?depth0:(container.nullContext||{}),alias2=helpers.helperMissing,alias3="function",alias4=container.escapeExpression;return"			<span class=\"perso-account-number\" aria-label=\""+alias4(((helper=(helper=helpers.numberPrefAccessibility||(depth0!=null?depth0.numberPrefAccessibility:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"numberPrefAccessibility","hash":{},"data":data}):helper)))+" "+alias4(((helper=(helper=helpers.number||(depth0!=null?depth0.number:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"number","hash":{},"data":data}):helper)))+".\">"+alias4(((helper=(helper=helpers.number||(depth0!=null?depth0.number:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"number","hash":{},"data":data}):helper)))+"</span>\r\n"},"compiler":[7,">= 4.0.0"],"main":function(container,depth0,helpers,partials,data){var stack1,helper,alias1=depth0!=null?depth0:(container.nullContext||{}),alias2=helpers.helperMissing,alias3="function",alias4=container.escapeExpression;return"<div class=\"card card_"+alias4(((helper=(helper=helpers.typeImage||(depth0!=null?depth0.typeImage:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"typeImage","hash":{},"data":data}):helper)))+" cards"+alias4(((helper=(helper=helpers.numCards||(depth0!=null?depth0.numCards:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"numCards","hash":{},"data":data}):helper)))+"\" pstory-id=\""+alias4(((helper=(helper=helpers.id||(depth0!=null?depth0.id:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"id","hash":{},"data":data}):helper)))+"\">							\r\n		<span class=\"perso-account-name\" aria-label=\""+alias4(((helper=(helper=helpers.name||(depth0!=null?depth0.name:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"name","hash":{},"data":data}):helper)))+".\">"+alias4(((helper=(helper=helpers.name||(depth0!=null?depth0.name:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"name","hash":{},"data":data}):helper)))+"</span>\r\n"+((stack1=helpers["if"].call(alias1,(depth0!=null?depth0.number:depth0),{"name":"if","hash":{},"fn":container.program(1,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"		<div id=\"pop-"+alias4(container.lambda(depth0,depth0))+"\" class=\"pstory-button-txt-wrapper\" pstory-id=\""+alias4(((helper=(helper=helpers.id||(depth0!=null?depth0.id:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"id","hash":{},"data":data}):helper)))+"\"><span class=\"pstory-button-txt\">"+((stack1=((helper=(helper=helpers.text||(depth0!=null?depth0.text:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"text","hash":{},"data":data}):helper)))!=null?stack1:"")+"</span></div>	\r\n	</div>\r\n\r\n"},"useData":!0});this["Personetics"].UI.Handlebars.templates["pstory-block-account-selector"]=Handlebars.template({"1":function(container,depth0,helpers,partials,data,blockParams,depths){var stack1;return"			<div class=\"header-container\">\r\n				<div class=\"pstory-tab-animated-border-bottom\"></div>\r\n				<ul class=\"tablist\" role=\"tablist\">\r\n"+((stack1=helpers.each.call(depth0!=null?depth0:(container.nullContext||{}),(depth0!=null?depth0.headersArray:depth0),{"name":"each","hash":{},"fn":container.program(2,data,0,blockParams,depths),"inverse":container.noop,"data":data}))!=null?stack1:"")+"				</ul>\r\n			</div>\r\n			<div class=\"carousel-outer-wrapper\">\r\n				<div class=\"carousel-animate options-container carousel-wrapper pstory-show-header-tabs\">\r\n"},"2":function(container,depth0,helpers,partials,data,blockParams,depths){var stack1,helper,alias1=depth0!=null?depth0:(container.nullContext||{}),alias2=helpers.helperMissing,alias3="function";return"						<li class=\"pstory-header-button\" "+((stack1=helpers["if"].call(alias1,(depths[1]!=null?depths[1].isDesktopMode:depths[1]),{"name":"if","hash":{},"fn":container.program(3,data,0,blockParams,depths),"inverse":container.noop,"data":data}))!=null?stack1:"")+" role=\"tab\" data-all=\""+container.escapeExpression(((helper=(helper=helpers.isAll||(depth0!=null?depth0.isAll:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"isAll","hash":{},"data":data}):helper)))+"\" "+((stack1=helpers["if"].call(alias1,(depth0!=null?depth0.isAll:depth0),{"name":"if","hash":{},"fn":container.program(5,data,0,blockParams,depths),"inverse":container.noop,"data":data}))!=null?stack1:"")+">"+((stack1=((helper=(helper=helpers.text||(depth0!=null?depth0.text:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"text","hash":{},"data":data}):helper)))!=null?stack1:"")+"</li>\r\n"},"3":function(container,depth0,helpers,partials,data){var stack1,helper;return" tabindex=\"0\"  aria-label=\""+((stack1=((helper=(helper=helpers.text||(depth0!=null?depth0.text:depth0))!=null?helper:helpers.helperMissing),(typeof helper==="function"?helper.call(depth0!=null?depth0:(container.nullContext||{}),{"name":"text","hash":{},"data":data}):helper)))!=null?stack1:"")+"\" "},"5":function(container,depth0,helpers,partials,data){return"pstory-id=\"all\""},"7":function(container,depth0,helpers,partials,data){return"					<div class=\"carousel-outer-wrapper\">\r\n						<div class=\"carousel-animate options-container carousel-wrapper\">\r\n"},"9":function(container,depth0,helpers,partials,data,blockParams,depths){var stack1,helper,alias1=depth0!=null?depth0:(container.nullContext||{}),alias2=helpers.helperMissing,alias3="function",alias4=container.escapeExpression;return"								<div class=\"carousel-item pstory-button "+((stack1=helpers["if"].call(alias1,(depth0!=null?depth0.selected:depth0),{"name":"if","hash":{},"fn":container.program(10,data,0,blockParams,depths),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\" aria-hidden=\"true\" pstory-id=\""+alias4(((helper=(helper=helpers.id||(depth0!=null?depth0.id:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"id","hash":{},"data":data}):helper)))+"\" pstory-event=\""+alias4(((helper=(helper=helpers.event||(depth0!=null?depth0.event:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"event","hash":{},"data":data}):helper)))+"\"\r\n								 role=\""+alias4(container.lambda((depths[1]!=null?depths[1].role:depths[1]),depth0))+"\">\r\n									"+((stack1=helpers["if"].call(alias1,(depths[1]!=null?depths[1].isDesktopMode:depths[1]),{"name":"if","hash":{},"fn":container.program(12,data,0,blockParams,depths),"inverse":container.program(14,data,0,blockParams,depths),"data":data}))!=null?stack1:"")+"\r\n								</div>\r\n"},"10":function(container,depth0,helpers,partials,data){return"selected"},"12":function(container,depth0,helpers,partials,data,blockParams,depths){var stack1;return" "+((stack1=container.invokePartial(partials.innerCardDesktop,depth0,{"name":"innerCardDesktop","hash":{"numberPrefAccessibility":(depths[1]!=null?depths[1].numberPrefAccessibility:depths[1]),"numberPref":(depths[1]!=null?depths[1].numberPref:depths[1])},"data":data,"helpers":helpers,"partials":partials,"decorators":container.decorators}))!=null?stack1:"")+"\r\n									"},"14":function(container,depth0,helpers,partials,data,blockParams,depths){var stack1;return" "+((stack1=container.invokePartial(partials.innerCard,depth0,{"name":"innerCard","hash":{"numberPrefAccessibility":(depths[1]!=null?depths[1].numberPrefAccessibility:depths[1]),"numberPref":(depths[1]!=null?depths[1].numberPref:depths[1])},"data":data,"helpers":helpers,"partials":partials,"decorators":container.decorators}))!=null?stack1:"")+" "},"16":function(container,depth0,helpers,partials,data){var stack1,alias1=depth0!=null?depth0:(container.nullContext||{});return"							<div class=\"carousel-index-wrapper\" "+((stack1=helpers["if"].call(alias1,(depth0!=null?depth0.isDesktopMode:depth0),{"name":"if","hash":{},"fn":container.program(17,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+">\r\n								<div class=\"carousel-index-container\">\r\n"+((stack1=helpers.each.call(alias1,(depth0!=null?depth0.options:depth0),{"name":"each","hash":{},"fn":container.program(19,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"								</div>\r\n							</div>\r\n"},"17":function(container,depth0,helpers,partials,data){var stack1;return" role=\"application\" aria-labelledby=\"perso-accessibility-read-"+container.escapeExpression(container.lambda(((stack1=((stack1=(depth0!=null?depth0.options:depth0))!=null?stack1["0"]:stack1))!=null?stack1.id:stack1),depth0))+"\""},"19":function(container,depth0,helpers,partials,data){return"									<div class=\"carousel-index-dot\">\r\n										<div class=\"carousel-index-dot-circle\"></div>\r\n									</div> \r\n"},"21":function(container,depth0,helpers,partials,data){return" tabindex=\"-1\" "},"compiler":[7,">= 4.0.0"],"main":function(container,depth0,helpers,partials,data,blockParams,depths){var stack1,helper,alias1=depth0!=null?depth0:(container.nullContext||{}),alias2=helpers.helperMissing,alias3="function",alias4=container.escapeExpression;return"<div class=\"perso-accessibility-wrapper perso-accessibility-account-selector\" role=\"text\">\r\n	<span class=\"perso-accessibility-read\">"+alias4(((helper=(helper=helpers.accountSelectorText||(depth0!=null?depth0.accountSelectorText:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"accountSelectorText","hash":{},"data":data}):helper)))+"</span>\r\n</div>\r\n<div id=\"pstory-block-account-selector_"+alias4(((helper=(helper=helpers.index||(depth0!=null?depth0.index:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"index","hash":{},"data":data}):helper)))+"\" class=\"pstory-block-frame pstory-block-account-selector "+alias4(((helper=(helper=helpers["class"]||(depth0!=null?depth0["class"]:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"class","hash":{},"data":data}):helper)))+"\" data-show-header-tabs="+alias4(((helper=(helper=helpers.showHeaderTabs||(depth0!=null?depth0.showHeaderTabs:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"showHeaderTabs","hash":{},"data":data}):helper)))+">\r\n	<div class=\"pstory-block-container\">\r\n		<div class=\"pstory-block-content\">\r\n"+((stack1=helpers["if"].call(alias1,(depth0!=null?depth0.showHeaderTabs:depth0),{"name":"if","hash":{},"fn":container.program(1,data,0,blockParams,depths),"inverse":container.program(7,data,0,blockParams,depths),"data":data}))!=null?stack1:"")+"							<div class=\"carousel-inner-wrapper cards-wrapper\" aria-hidden=\"true\">\r\n"+((stack1=helpers.each.call(alias1,(depth0!=null?depth0.options:depth0),{"name":"each","hash":{},"fn":container.program(9,data,0,blockParams,depths),"inverse":container.noop,"data":data}))!=null?stack1:"")+"							</div>\r\n\r\n							<div class=\"perso-accessibility-wrapper pstory-account-button selected\" role=\"text\">\r\n								<span class=\"perso-accessibility-read\">"+alias4(((helper=(helper=helpers.accountName||(depth0!=null?depth0.accountName:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"accountName","hash":{},"data":data}):helper)))+". "+alias4(((helper=(helper=helpers.numberPrefAccessibility||(depth0!=null?depth0.numberPrefAccessibility:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"numberPrefAccessibility","hash":{},"data":data}):helper)))+" "+alias4(((helper=(helper=helpers.accountNumber||(depth0!=null?depth0.accountNumber:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"accountNumber","hash":{},"data":data}):helper)))+"</span>\r\n							</div>\r\n\r\n"+((stack1=helpers["if"].call(alias1,(depth0!=null?depth0.showIndexDots:depth0),{"name":"if","hash":{},"fn":container.program(16,data,0,blockParams,depths),"inverse":container.noop,"data":data}))!=null?stack1:"")+"							<div class=\"pstory-all-accounts-txt\" role=\"text\">"+((stack1=((helper=(helper=helpers.allAccountsTxt||(depth0!=null?depth0.allAccountsTxt:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"allAccountsTxt","hash":{},"data":data}):helper)))!=null?stack1:"")+"</div>\r\n						</div>\r\n						<input type=\"button\" class=\"pstory-account-button pstory-prev-account-button\" aria-label=\""+alias4(((helper=(helper=helpers.next||(depth0!=null?depth0.next:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"next","hash":{},"data":data}):helper)))+"\" "+((stack1=helpers["if"].call(alias1,(depth0!=null?depth0.isDesktopMode:depth0),{"name":"if","hash":{},"fn":container.program(21,data,0,blockParams,depths),"inverse":container.noop,"data":data}))!=null?stack1:"")+" />\r\n						<input type=\"button\" class=\"pstory-account-button pstory-next-account-button\" aria-label=\""+alias4(((helper=(helper=helpers.next||(depth0!=null?depth0.next:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"next","hash":{},"data":data}):helper)))+"\" "+((stack1=helpers["if"].call(alias1,(depth0!=null?depth0.isDesktopMode:depth0),{"name":"if","hash":{},"fn":container.program(21,data,0,blockParams,depths),"inverse":container.noop,"data":data}))!=null?stack1:"")+"/>\r\n					</div>\r\n					<div class=\"pstory-comment\">"+((stack1=((helper=(helper=helpers.comment||(depth0!=null?depth0.comment:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"comment","hash":{},"data":data}):helper)))!=null?stack1:"")+"</div>\r\n				</div>\r\n			</div>\r\n		</div>"},"usePartial":!0,"useData":!0,"useDepths":!0});this["Personetics"].UI.Handlebars.templates["pstory-block-pie-chart"]=Handlebars.template({"compiler":[7,">= 4.0.0"],"main":function(container,depth0,helpers,partials,data){var stack1;return"<div class=\"pstory-block-frame pstory-block-pie-chart\">\r\n    <div class=\"pstory-block-container\">\r\n        <div class=\"pstory-block-content\">\r\n            <div class=\"pstory-pie-chart\"></div>\r\n            <div class=\"pstory-pie-data\">\r\n                <input type=\"button\" class=\"pstory-arrow pstory-next-arrow\" aria-hidden=\"true\"/>\r\n                <div class=\"pstory-pie-info perso-accessibility-wrapper\" role=\"text\">\r\n                </div>\r\n                <input type=\"button\" class=\"pstory-arrow pstory-previous-arrow\" aria-label=\""+container.escapeExpression(container.lambda(((stack1=(depth0!=null?depth0.texts:depth0))!=null?stack1.nextCategory:stack1),depth0))+"\"/>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</div>"},"useData":!0});this["Personetics"].UI.Handlebars.templates["pstory-block-table-minimal"]=Handlebars.template({"1":function(container,depth0,helpers,partials,data){return"                    <tr>\r\n                        <td class=\"perso-loading-table\">Loading...</td>\r\n                    </tr>\r\n"},"3":function(container,depth0,helpers,partials,data,blockParams,depths){var stack1;return((stack1=helpers.each.call(depth0!=null?depth0:(container.nullContext||{}),(depth0!=null?depth0.rows:depth0),{"name":"each","hash":{},"fn":container.program(4,data,0,blockParams,depths),"inverse":container.noop,"data":data}))!=null?stack1:"")},"4":function(container,depth0,helpers,partials,data,blockParams,depths){var stack1,alias1=container.lambda;return"                            <tr class=\""+container.escapeExpression(alias1((depths[1]!=null?depths[1]["class"]:depths[1]),depth0))+"\">\r\n                                <td role=\"cell\" class=\"perso-td-date\">"+((stack1=alias1((depth0!=null?depth0.date:depth0),depth0))!=null?stack1:"")+"</td>\r\n                                <td  align=\"right\" role=\"cell\" class=\"perso-td-amount-balance\">"+((stack1=alias1((depth0!=null?depth0.amount:depth0),depth0))!=null?stack1:"")+" </td>                                \r\n                                <td  align=\"right\" class=\"perso-td-amount-balance  \" role=\"cell\"> "+((stack1=alias1((depth0!=null?depth0.account:depth0),depth0))!=null?stack1:"")+"</td>\r\n\r\n                            </tr>\r\n"},"compiler":[7,">= 4.0.0"],"main":function(container,depth0,helpers,partials,data,blockParams,depths){var stack1;return"<div class=\"pstory-block-frame pstory-block-table\">\r\n    <div class=\"pstory-block-container\">\r\n        <div class=\"pstory-block-content\">\r\n            <table class=\"pstory-table\">\r\n"+((stack1=helpers["if"].call(depth0!=null?depth0:(container.nullContext||{}),(depth0!=null?depth0.future:depth0),{"name":"if","hash":{},"fn":container.program(1,data,0,blockParams,depths),"inverse":container.program(3,data,0,blockParams,depths),"data":data}))!=null?stack1:"")+"            </table>\r\n        </div>\r\n    </div>\r\n</div>"},"useData":!0,"useDepths":!0});this["Personetics"].UI.Handlebars.templates["pstory-block-table-perso-txlist1"]=Handlebars.template({"1":function(container,depth0,helpers,partials,data){return"                    <tr>\r\n                        <td class=\"perso-loading-table\">Loading...</td>\r\n                    </tr>\r\n"},"3":function(container,depth0,helpers,partials,data){var stack1;return((stack1=helpers.each.call(depth0!=null?depth0:(container.nullContext||{}),(depth0!=null?depth0.rows:depth0),{"name":"each","hash":{},"fn":container.program(4,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")},"4":function(container,depth0,helpers,partials,data){var stack1,alias1=container.lambda;return"                            <tr>\r\n                                <td>\r\n                                   <span class=\"perso-td-first-row perso-td-account-number\">\r\n                                       "+((stack1=alias1((depth0!=null?depth0.accountNumber:depth0),depth0))!=null?stack1:"")+"\r\n                                   </span>\r\n                                    <span class=\"perso-td-transaction\">\r\n                                        "+((stack1=alias1((depth0!=null?depth0.transaction:depth0),depth0))!=null?stack1:"")+"\r\n                                    </span>\r\n                                </td>\r\n                                <td  class=\"rightAlign\" >\r\n                                     <span class=\"perso-td-first-row perso-td-date\">\r\n                                         "+((stack1=alias1((depth0!=null?depth0.date:depth0),depth0))!=null?stack1:"")+"\r\n                                     </span>\r\n                                    <span class=\"perso-td-amount-balance perso-td-amount\">\r\n                                        "+((stack1=alias1((depth0!=null?depth0.amount:depth0),depth0))!=null?stack1:"")+"\r\n                                    </span>\r\n                                </td>\r\n                            </tr>\r\n\r\n"},"compiler":[7,">= 4.0.0"],"main":function(container,depth0,helpers,partials,data){var stack1;return"<div class=\"pstory-block-frame pstory-block-table\">\r\n    <div class=\"pstory-block-container\">\r\n        <div class=\"pstory-block-content\">\r\n            <table class=\"pstory-table pstory-table-txlist1\">\r\n"+((stack1=helpers["if"].call(depth0!=null?depth0:(container.nullContext||{}),(depth0!=null?depth0.future:depth0),{"name":"if","hash":{},"fn":container.program(1,data,0),"inverse":container.program(3,data,0),"data":data}))!=null?stack1:"")+"            </table>\r\n        </div>\r\n    </div>\r\n</div>"},"useData":!0});this["Personetics"].UI.Handlebars.templates["pstory-block-table-perso-txlist2"]=Handlebars.template({"1":function(container,depth0,helpers,partials,data){return"                    <tr>\r\n                        <td class=\"perso-loading-table\">Loading...</td>\r\n                    </tr>\r\n"},"3":function(container,depth0,helpers,partials,data){var stack1;return((stack1=helpers.each.call(depth0!=null?depth0:(container.nullContext||{}),(depth0!=null?depth0.rows:depth0),{"name":"each","hash":{},"fn":container.program(4,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")},"4":function(container,depth0,helpers,partials,data){var stack1,alias1=container.lambda;return"                            <tr>\r\n                                <td>\r\n                                    <span class=\"perso-td-first-row perso-td-transaction\">\r\n                                        "+((stack1=alias1((depth0!=null?depth0.transaction:depth0),depth0))!=null?stack1:"")+"\r\n                                    </span>\r\n                                </td>\r\n                                <td  class=\"rightAlign\" >\r\n                                    <span class=\"perso-td-first-row perso-td-date\">\r\n                                        "+((stack1=alias1((depth0!=null?depth0.date:depth0),depth0))!=null?stack1:"")+"\r\n                                    </span>\r\n                                    <span class=\"perso-td-amount-balance perso-td-amount\">\r\n                                        "+((stack1=alias1((depth0!=null?depth0.amount:depth0),depth0))!=null?stack1:"")+"\r\n                                    </span>\r\n                                </td>\r\n                            </tr>\r\n\r\n"},"compiler":[7,">= 4.0.0"],"main":function(container,depth0,helpers,partials,data){var stack1;return"<div class=\"pstory-block-frame pstory-block-table\">\r\n    <div class=\"pstory-block-container\">\r\n        <div class=\"pstory-block-content\">\r\n            <table class=\"pstory-table pstory-table-txlist2\">\r\n"+((stack1=helpers["if"].call(depth0!=null?depth0:(container.nullContext||{}),(depth0!=null?depth0.future:depth0),{"name":"if","hash":{},"fn":container.program(1,data,0),"inverse":container.program(3,data,0),"data":data}))!=null?stack1:"")+"            </table>\r\n        </div>\r\n    </div>\r\n</div>"},"useData":!0});this["Personetics"].UI.Handlebars.templates["pstory-block-table-perso-txlist3"]=Handlebars.template({"1":function(container,depth0,helpers,partials,data){return"                    <tr>\r\n                        <td class=\"perso-loading-table\">Loading...</td>\r\n                    </tr>\r\n"},"3":function(container,depth0,helpers,partials,data,blockParams,depths){var stack1;return((stack1=helpers.each.call(depth0!=null?depth0:(container.nullContext||{}),(depth0!=null?depth0.rows:depth0),{"name":"each","hash":{},"fn":container.program(4,data,0,blockParams,depths),"inverse":container.noop,"data":data}))!=null?stack1:"")},"4":function(container,depth0,helpers,partials,data,blockParams,depths){var stack1,alias1=container.lambda;return"                            <tr >\r\n                                <td>\r\n                                    <span class=\"perso-td-first-row perso-td-date\">\r\n                                        "+((stack1=alias1((depth0!=null?depth0.date:depth0),depth0))!=null?stack1:"")+"\r\n                                    </span>                                    \r\n                                </td>\r\n                                <td> \r\n                                    <span class=\"perso-td-first-row perso-td-account-number\">\r\n                                        "+((stack1=alias1((depth0!=null?depth0.accountNumber:depth0),depth0))!=null?stack1:"")+"\r\n                                    </span>\r\n                                    <span class=\"perso-td-transaction\">\r\n                                        "+((stack1=alias1((depth0!=null?depth0.transaction:depth0),depth0))!=null?stack1:"")+"\r\n                                    </span>                           \r\n                                </td>\r\n                                <td class=\"rightAlign\" >\r\n                                     <span class=\"perso-td-first-row perso-td-balance-title perso-td-small\">\r\n                                        "+container.escapeExpression(alias1((depths[1]!=null?depths[1].balanceLabel:depths[1]),depth0))+"\r\n                                    </span>\r\n                                    <span class=\"perso-td-amount-balance perso-td-balance\">\r\n                                        "+((stack1=alias1((depth0!=null?depth0.balance:depth0),depth0))!=null?stack1:"")+"\r\n                                    </span>\r\n                                </td>   \r\n                                \r\n                            </tr>\r\n"},"compiler":[7,">= 4.0.0"],"main":function(container,depth0,helpers,partials,data,blockParams,depths){var stack1;return"<div class=\"pstory-block-frame pstory-block-table\">\r\n    <div class=\"pstory-block-container\">\r\n        <div class=\"pstory-block-content\">\r\n            <table class=\"pstory-table pstory-table-txlist3\">\r\n"+((stack1=helpers["if"].call(depth0!=null?depth0:(container.nullContext||{}),(depth0!=null?depth0.future:depth0),{"name":"if","hash":{},"fn":container.program(1,data,0,blockParams,depths),"inverse":container.program(3,data,0,blockParams,depths),"data":data}))!=null?stack1:"")+"            </table>\r\n        </div>\r\n    </div>\r\n</div>"},"useData":!0,"useDepths":!0});this["Personetics"].UI.Handlebars.templates["pstory-block-table-perso-txlist4"]=Handlebars.template({"1":function(container,depth0,helpers,partials,data){var stack1;return"                <div id=\"perso-legend-wrapper\">\r\n"+((stack1=helpers.each.call(depth0!=null?depth0:(container.nullContext||{}),(depth0!=null?depth0.legendTexts:depth0),{"name":"each","hash":{},"fn":container.program(2,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"                </div>\r\n"},"2":function(container,depth0,helpers,partials,data){var stack1,helper,alias1=depth0!=null?depth0:(container.nullContext||{}),alias2=helpers.helperMissing,alias3="function";return"                        <div class=\"perso-legend-container\">\r\n                            <div class=\"perso-legend-dot "+((stack1=((helper=(helper=helpers["class"]||(depth0!=null?depth0["class"]:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"class","hash":{},"data":data}):helper)))!=null?stack1:"")+"-dot\"></div>\r\n                            <span class=\"perso-legend-text\">"+((stack1=((helper=(helper=helpers.text||(depth0!=null?depth0.text:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"text","hash":{},"data":data}):helper)))!=null?stack1:"")+"</span>\r\n                        </div>\r\n"},"4":function(container,depth0,helpers,partials,data){return"                    <div class=\"perso-table-row\">\r\n                        <div class=\"perso-loading-tbl\">\r\n                            <span>Loading...</span>\r\n                        </div>\r\n                    </div>\r\n"},"6":function(container,depth0,helpers,partials,data){var stack1;return((stack1=helpers.each.call(depth0!=null?depth0:(container.nullContext||{}),(depth0!=null?depth0.rows:depth0),{"name":"each","hash":{},"fn":container.program(7,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")},"7":function(container,depth0,helpers,partials,data){var stack1,alias1=container.lambda;return"                    <div class=\"perso-table-row scheduled-"+((stack1=alias1((depth0!=null?depth0.isScheduled:depth0),depth0))!=null?stack1:"")+"\">\r\n"+((stack1=helpers["if"].call(depth0!=null?depth0:(container.nullContext||{}),(depth0!=null?depth0.isScheduled:depth0),{"name":"if","hash":{},"fn":container.program(8,data,0),"inverse":container.program(10,data,0),"data":data}))!=null?stack1:"")+"                        <div class=\"perso-table-cell perso-cell-1\">\r\n                            <div class=\"perso-transaction-title\">"+((stack1=alias1((depth0!=null?depth0.transaction:depth0),depth0))!=null?stack1:"")+"</div>\r\n                            <div class=\"perso-transaction-date\">"+((stack1=alias1((depth0!=null?depth0.isAnticipated:depth0),depth0))!=null?stack1:"")+" "+((stack1=alias1((depth0!=null?depth0.date:depth0),depth0))!=null?stack1:"")+"</div>\r\n                        </div>\r\n                        <div class=\"perso-table-cell perso-cell-2\">\r\n                            <div class=\"perso-td-amount-balance perso-td-amount\">"+((stack1=alias1((depth0!=null?depth0.amount:depth0),depth0))!=null?stack1:"")+"</div>\r\n                        </div>\r\n                    </div>\r\n"},"8":function(container,depth0,helpers,partials,data){var stack1;return"                            <div class=\"perso-large-legend-dot scheduled-dot "+((stack1=container.lambda((depth0!=null?depth0.debitOrCredit:depth0),depth0))!=null?stack1:"")+"\"></div>\r\n"},"10":function(container,depth0,helpers,partials,data){var stack1;return"                            <div class=\"perso-large-legend-dot estimated-dot "+((stack1=container.lambda((depth0!=null?depth0.debitOrCredit:depth0),depth0))!=null?stack1:"")+"\"></div>\r\n"},"compiler":[7,">= 4.0.0"],"main":function(container,depth0,helpers,partials,data){var stack1,alias1=depth0!=null?depth0:(container.nullContext||{});return"<div class=\"pstory-block-frame pstory-block-table\">\r\n    <div class=\"pstory-block-container\">\r\n        <div class=\"pstory-block-content\">\r\n"+((stack1=helpers["if"].call(alias1,(depth0!=null?depth0.legendTexts:depth0),{"name":"if","hash":{},"fn":container.program(1,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"            <div class=\"pstory-table-type-2 pstory-table-txlist4\">\r\n"+((stack1=helpers["if"].call(alias1,(depth0!=null?depth0.future:depth0),{"name":"if","hash":{},"fn":container.program(4,data,0),"inverse":container.program(6,data,0),"data":data}))!=null?stack1:"")+"            </div>\r\n        </div>\r\n    </div>\r\n</div>"},"useData":!0});this["Personetics"].UI.Handlebars.templates["pstory-block-table-perso-txlist5"]=Handlebars.template({"1":function(container,depth0,helpers,partials,data){return"                    <tr>\r\n                        <td class=\"perso-loading-table\">Loading...</td>\r\n                    </tr>\r\n"},"3":function(container,depth0,helpers,partials,data,blockParams,depths){var stack1;return((stack1=helpers.each.call(depth0!=null?depth0:(container.nullContext||{}),(depth0!=null?depth0.rows:depth0),{"name":"each","hash":{},"fn":container.program(4,data,0,blockParams,depths),"inverse":container.noop,"data":data}))!=null?stack1:"")},"4":function(container,depth0,helpers,partials,data,blockParams,depths){var stack1,alias1=container.lambda;return"                            <tr >\r\n                                <td>\r\n                                    <span class=\"perso-td-first-row perso-td-date\">\r\n                                        "+((stack1=alias1((depth0!=null?depth0.date:depth0),depth0))!=null?stack1:"")+"\r\n                                    </span>\r\n                                </td>\r\n                                <td  class=\"leftAlign\">\r\n                                    <span class=\"perso-td-first-row perso-td-transaction perso-td-small\">\r\n                                        "+((stack1=alias1((depth0!=null?depth0.transaction:depth0),depth0))!=null?stack1:"")+"\r\n                                    </span>\r\n                                      <span class=\"perso-td-amount-balance perso-td-amount\">\r\n                                        "+((stack1=alias1((depth0!=null?depth0.amount:depth0),depth0))!=null?stack1:"")+"\r\n                                    </span>\r\n                                </td>\r\n                                <td  class=\"leftAlign\" role=\"cell\">\r\n                                    <span class=\"perso-td-first-row perso-td-balance-title perso-td-small\">\r\n                                        "+container.escapeExpression(alias1((depths[1]!=null?depths[1].balanceLabel:depths[1]),depth0))+"\r\n                                    </span>\r\n                                      <span class=\"perso-td-amount-balance perso-td-balance\">\r\n                                          "+((stack1=alias1((depth0!=null?depth0.balance:depth0),depth0))!=null?stack1:"")+"\r\n                                      </span>\r\n                                </td>\r\n                            </tr>\r\n"},"compiler":[7,">= 4.0.0"],"main":function(container,depth0,helpers,partials,data,blockParams,depths){var stack1;return"<div class=\"pstory-block-frame pstory-block-table\">\r\n    <div class=\"pstory-block-container\">\r\n        <div class=\"pstory-block-content\">\r\n            <table class=\"pstory-table pstory-table-txlist5\">\r\n"+((stack1=helpers["if"].call(depth0!=null?depth0:(container.nullContext||{}),(depth0!=null?depth0.future:depth0),{"name":"if","hash":{},"fn":container.program(1,data,0,blockParams,depths),"inverse":container.program(3,data,0,blockParams,depths),"data":data}))!=null?stack1:"")+"            </table>\r\n        </div>\r\n    </div>\r\n</div>"},"useData":!0,"useDepths":!0});this["Personetics"].UI.Handlebars.templates["pstory-block-table-perso-txlist6"]=Handlebars.template({"1":function(container,depth0,helpers,partials,data){return"                    <tr>\r\n                        <td class=\"perso-loading-table\">Loading...</td>\r\n                    </tr>\r\n"},"3":function(container,depth0,helpers,partials,data){var stack1;return((stack1=helpers.each.call(depth0!=null?depth0:(container.nullContext||{}),(depth0!=null?depth0.rows:depth0),{"name":"each","hash":{},"fn":container.program(4,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")},"4":function(container,depth0,helpers,partials,data){var stack1,alias1=container.lambda;return"                            <tr>\r\n                                <td>\r\n                                    <span class=\"perso-td-date\">\r\n                                        "+((stack1=alias1((depth0!=null?depth0.date:depth0),depth0))!=null?stack1:"")+"\r\n                                    </span>\r\n                                </td>\r\n                                <td >\r\n                                    <span class=\"perso-td-transaction\">\r\n                                        "+((stack1=alias1((depth0!=null?depth0.transaction:depth0),depth0))!=null?stack1:"")+"\r\n                                    </span>\r\n                                </td>\r\n                                <td  class=\"rightAlign\">\r\n                                       <span class=\"perso-td-amount-balance perso-td-amount\">\r\n                                           "+((stack1=alias1((depth0!=null?depth0.amount:depth0),depth0))!=null?stack1:"")+"\r\n                                       </span>\r\n                                </td>\r\n                            </tr>\r\n"},"compiler":[7,">= 4.0.0"],"main":function(container,depth0,helpers,partials,data){var stack1;return"<div class=\"pstory-block-frame pstory-block-table\">\r\n    <div class=\"pstory-block-container\">\r\n        <div class=\"pstory-block-content\">\r\n            <table class=\"pstory-table pstory-table-txlist6\">\r\n"+((stack1=helpers["if"].call(depth0!=null?depth0:(container.nullContext||{}),(depth0!=null?depth0.future:depth0),{"name":"if","hash":{},"fn":container.program(1,data,0),"inverse":container.program(3,data,0),"data":data}))!=null?stack1:"")+"            </table>\r\n        </div>\r\n    </div>\r\n</div>"},"useData":!0});this["Personetics"].UI.Handlebars.templates["tmpl-pstory-title"]=Handlebars.template({"compiler":[7,">= 4.0.0"],"main":function(container,depth0,helpers,partials,data){var stack1,helper,alias1=depth0!=null?depth0:(container.nullContext||{}),alias2=helpers.helperMissing,alias3="function";return"<div class=\"pstory-title-outer-wrapper\">\r\n    <div class=\"pstory-title-wrapper pstory-fixed\">\r\n        <div class=\"pstory-title\">\r\n            <input aria-label=\""+container.escapeExpression(((helper=(helper=helpers.backButtonText||(depth0!=null?depth0.backButtonText:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"backButtonText","hash":{},"data":data}):helper)))+"\" type=\"button\" class=\"pstory-title-close\"/>\r\n            <div role=\"heading\" aria-level=\"1\" class=\"pstory-title-text\">"+((stack1=((helper=(helper=helpers.title||(depth0!=null?depth0.title:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"title","hash":{},"data":data}):helper)))!=null?stack1:"")+"</div>\r\n        </div>\r\n    </div>\r\n</div>\r\n<div id=\"story-frame-container\"></div>"},"useData":!0});this["Personetics"].UI.Handlebars.templates.doubleBox=Handlebars.template({"1":function(container,depth0,helpers,partials,data){var stack1,alias1=container.lambda,alias2=container.escapeExpression;return((stack1=container.invokePartial(partials.teaserHeader,depth0,{"name":"teaserHeader","data":data,"indent":"    ","helpers":helpers,"partials":partials,"decorators":container.decorators}))!=null?stack1:"")+"\r\n    <div class=\"perso-teaser-border\">\r\n        <div class=\"pstory-block-hbox-columns-frame teaser-body\" aria-hidden=\"true\">\r\n            <div class=\"pstory-hbox-column-frame\" data-width=\"6\">\r\n\r\n                <div class=\"pstory-hbox-column-frame perso-double-box perso-double-box-left\" data-v-align=\"middle\" data-width=\"12\">\r\n                    <div class=\"pstory-block-frame pstory-block-text\">\r\n                        <div class=\"pstory-block-content perso-double-box-value\">\r\n                            "+((stack1=alias1(((stack1=(depth0!=null?depth0["box-value1"]:depth0))!=null?stack1.text:stack1),depth0))!=null?stack1:"")+"\r\n                        </div>\r\n                    </div>\r\n                    <div class=\"pstory-block-frame pstory-block-text\">\r\n                        <div class=\"pstory-block-content perso-double-box-text\">\r\n                            "+alias2(alias1(((stack1=(depth0!=null?depth0["box-label1"]:depth0))!=null?stack1.text:stack1),depth0))+"\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n\r\n            </div>\r\n            <div class=\"pstory-hbox-column-frame\" data-width=\"6\">\r\n\r\n                <div class=\"pstory-hbox-column-frame perso-double-box perso-double-box-right\" data-v-align=\"middle\" data-width=\"12\">\r\n                    <div class=\"pstory-block-frame pstory-block-text\">\r\n                        <div class=\"pstory-block-content perso-double-box-value \">\r\n                            "+((stack1=alias1(((stack1=(depth0!=null?depth0["box-value2"]:depth0))!=null?stack1.text:stack1),depth0))!=null?stack1:"")+"\r\n                        </div>\r\n                    </div>\r\n                    <div class=\"pstory-block-frame pstory-block-text\">\r\n                        <div class=\"pstory-block-content perso-double-box-text\">\r\n                            "+alias2(alias1(((stack1=(depth0!=null?depth0["box-label2"]:depth0))!=null?stack1.text:stack1),depth0))+"\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n\r\n            </div>\r\n        </div>\r\n    </div>\r\n"},"compiler":[7,">= 4.0.0"],"main":function(container,depth0,helpers,partials,data){var stack1;return((stack1=container.invokePartial(partials.teaserWrapperPartial,depth0,{"name":"teaserWrapperPartial","fn":container.program(1,data,0),"inverse":container.noop,"data":data,"helpers":helpers,"partials":partials,"decorators":container.decorators}))!=null?stack1:"")},"usePartial":!0,"useData":!0});this["Personetics"].UI.Handlebars.templates.horizontalBar=Handlebars.template({"1":function(container,depth0,helpers,partials,data){var stack1,helper,alias1=container.escapeExpression;return((stack1=container.invokePartial(partials.teaserHeader,depth0,{"name":"teaserHeader","data":data,"indent":"    ","helpers":helpers,"partials":partials,"decorators":container.decorators}))!=null?stack1:"")+"    <div class=\"perso-teaser-border\">\r\n        <div class=\"pstory-block-hbox-columns-frame teaser-body multi-horizontal-bar\" aria-hidden=\"true\">\r\n            <div class=\"pstory-hbox-column-frame\" data-width=\"12\" id=\""+alias1(((helper=(helper=helpers.insightId||(depth0!=null?depth0.insightId:depth0))!=null?helper:helpers.helperMissing),(typeof helper==="function"?helper.call(depth0!=null?depth0:(container.nullContext||{}),{"name":"insightId","hash":{},"data":data}):helper)))+"_"+alias1(container.lambda(((stack1=(depth0!=null?depth0.chart:depth0))!=null?stack1.blockId:stack1),depth0))+"\"></div>\r\n        </div>\r\n    </div>\r\n"},"compiler":[7,">= 4.0.0"],"main":function(container,depth0,helpers,partials,data){var stack1;return((stack1=container.invokePartial(partials.teaserWrapperPartial,depth0,{"name":"teaserWrapperPartial","fn":container.program(1,data,0),"inverse":container.noop,"data":data,"helpers":helpers,"partials":partials,"decorators":container.decorators}))!=null?stack1:"")},"usePartial":!0,"useData":!0});this["Personetics"].UI.Handlebars.templates.horizontalBarAndBox=Handlebars.template({"1":function(container,depth0,helpers,partials,data){var stack1,helper,alias1=container.escapeExpression,alias2=container.lambda;return((stack1=container.invokePartial(partials.teaserHeader,depth0,{"name":"teaserHeader","data":data,"indent":"    ","helpers":helpers,"partials":partials,"decorators":container.decorators}))!=null?stack1:"")+"\r\n    <div class=\"perso-teaser-border\">\r\n        <div class=\"pstory-block-hbox-columns-frame teaser-body multi-horizontal-bar-box\" aria-hidden=\"true\">\r\n            <div class=\"pstory-hbox-column-frame\" data-width=\"8\">\r\n                <div id=\""+alias1(((helper=(helper=helpers.insightId||(depth0!=null?depth0.insightId:depth0))!=null?helper:helpers.helperMissing),(typeof helper==="function"?helper.call(depth0!=null?depth0:(container.nullContext||{}),{"name":"insightId","hash":{},"data":data}):helper)))+"_"+alias1(alias2(((stack1=(depth0!=null?depth0.chart:depth0))!=null?stack1.blockId:stack1),depth0))+"\"></div>\r\n            </div>\r\n\r\n           <div class=\"pstory-hbox-column-frame\" data-width=\"4\">\r\n                <!--<div class=\"pstory-block-hbox-columns-frame\">-->\r\n\r\n                <div class=\"pstory-hbox-column-frame\" data-v-align=\"middle\" data-width=\"12\">\r\n                    <div class=\"pstory-block-frame pstory-block-text perso-percent-large\">\r\n                        <div class=\"pstory-block-content\">\r\n                            "+alias1(alias2(((stack1=(depth0!=null?depth0["box-value"]:depth0))!=null?stack1.text:stack1),depth0))+"\r\n                        </div>\r\n                    </div>\r\n                    <div class=\"pstory-block-frame pstory-block-text\">\r\n                        <div class=\"pstory-block-content\">\r\n                            "+alias1(alias2(((stack1=(depth0!=null?depth0["box-label"]:depth0))!=null?stack1.text:stack1),depth0))+"\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n\r\n            </div>\r\n        </div>\r\n    </div>\r\n\r\n"},"compiler":[7,">= 4.0.0"],"main":function(container,depth0,helpers,partials,data){var stack1;return((stack1=container.invokePartial(partials.teaserWrapperPartial,depth0,{"name":"teaserWrapperPartial","fn":container.program(1,data,0),"inverse":container.noop,"data":data,"helpers":helpers,"partials":partials,"decorators":container.decorators}))!=null?stack1:"")},"usePartial":!0,"useData":!0});this["Personetics"].UI.Handlebars.templates.image=Handlebars.template({"1":function(container,depth0,helpers,partials,data){var stack1;return((stack1=container.invokePartial(partials.teaserHeader,depth0,{"name":"teaserHeader","data":data,"indent":"    ","helpers":helpers,"partials":partials,"decorators":container.decorators}))!=null?stack1:"")+"    <div class=\"perso-teaser-border\">\r\n        <div class=\"teaser-body\" aria-hidden=\"true\">\r\n"+((stack1=helpers["if"].call(depth0!=null?depth0:(container.nullContext||{}),((stack1=(depth0!=null?depth0["main-image"]:depth0))!=null?stack1.isAbsoluteURL:stack1),{"name":"if","hash":{},"fn":container.program(2,data,0),"inverse":container.program(4,data,0),"data":data}))!=null?stack1:"")+"        </div>\r\n    </div>\r\n"},"2":function(container,depth0,helpers,partials,data){var stack1,alias1=container.lambda,alias2=container.escapeExpression;return"                <img src=\""+alias2(alias1(((stack1=(depth0!=null?depth0["main-image"]:depth0))!=null?stack1.absUrl:stack1),depth0))+"\" alt=\""+alias2(alias1(((stack1=(depth0!=null?depth0["main-image"]:depth0))!=null?stack1.alt:stack1),depth0))+"\" />\r\n"},"4":function(container,depth0,helpers,partials,data){var stack1;return"                <div class=\"image "+container.escapeExpression(container.lambda(((stack1=(depth0!=null?depth0["main-image"]:depth0))!=null?stack1.absUrl:stack1),depth0))+"\"></div>\r\n"},"compiler":[7,">= 4.0.0"],"main":function(container,depth0,helpers,partials,data){var stack1;return((stack1=container.invokePartial(partials.teaserWrapperPartial,depth0,{"name":"teaserWrapperPartial","fn":container.program(1,data,0),"inverse":container.noop,"data":data,"helpers":helpers,"partials":partials,"decorators":container.decorators}))!=null?stack1:"")},"usePartial":!0,"useData":!0});this["Personetics"].UI.Handlebars.templates.imageAndBox=Handlebars.template({"1":function(container,depth0,helpers,partials,data){var stack1,alias1=container.lambda,alias2=container.escapeExpression;return((stack1=container.invokePartial(partials.teaserHeader,depth0,{"name":"teaserHeader","data":data,"indent":"    ","helpers":helpers,"partials":partials,"decorators":container.decorators}))!=null?stack1:"")+"\r\n    <div class=\"pstory-block-hbox-columns-frame teaser-body\" aria-hidden=\"true\">\r\n        <div class=\"pstory-hbox-column-frame\" data-width=\"6\">\r\n            <img src=\""+alias2(alias1(((stack1=(depth0!=null?depth0.image:depth0))!=null?stack1.url:stack1),depth0))+"\" alt=\""+alias2(alias1(((stack1=(depth0!=null?depth0.image:depth0))!=null?stack1.alt:stack1),depth0))+"\" style=\"max-height: 100%; max-width: 100%\" />\r\n        </div>\r\n        <div class=\"pstory-hbox-column-frame\" data-v-align=\"middle\" data-width=\"6\">\r\n            \r\n            <div class=\"pstory-block-hbox-columns-frame\">\r\n\r\n                <div class=\"pstory-block-frame pstory-block-text\">\r\n                    <div class=\"pstory-block-content\">\r\n                        "+alias2(alias1(((stack1=(depth0!=null?depth0["box-label"]:depth0))!=null?stack1.text:stack1),depth0))+"\r\n                    </div>\r\n                </div>\r\n                <div class=\"pstory-block-frame pstory-block-text perso-percent-large\">\r\n                    <div class=\"pstory-block-content\">\r\n                        "+((stack1=alias1(((stack1=(depth0!=null?depth0["box-value"]:depth0))!=null?stack1.text:stack1),depth0))!=null?stack1:"")+"\r\n                    </div>\r\n                </div>\r\n\r\n            </div>\r\n        </div>\r\n    </div>\r\n"},"compiler":[7,">= 4.0.0"],"main":function(container,depth0,helpers,partials,data){var stack1;return((stack1=container.invokePartial(partials.teaserWrapperPartial,depth0,{"name":"teaserWrapperPartial","fn":container.program(1,data,0),"inverse":container.noop,"data":data,"helpers":helpers,"partials":partials,"decorators":container.decorators}))!=null?stack1:"")},"usePartial":!0,"useData":!0});this["Personetics"].UI.Handlebars.templates.multiVerticalBar=Handlebars.template({"1":function(container,depth0,helpers,partials,data){var stack1,helper,alias1=container.escapeExpression;return((stack1=container.invokePartial(partials.teaserHeader,depth0,{"name":"teaserHeader","data":data,"indent":"    ","helpers":helpers,"partials":partials,"decorators":container.decorators}))!=null?stack1:"")+"    <div class=\"perso-teaser-border\">\r\n        <div class=\"teaser-body multi-vertical-bar-chart\" id=\""+alias1(((helper=(helper=helpers.insightId||(depth0!=null?depth0.insightId:depth0))!=null?helper:helpers.helperMissing),(typeof helper==="function"?helper.call(depth0!=null?depth0:(container.nullContext||{}),{"name":"insightId","hash":{},"data":data}):helper)))+"_"+alias1(container.lambda(((stack1=(depth0!=null?depth0.chart:depth0))!=null?stack1.blockId:stack1),depth0))+"\"  aria-hidden=\"true\"></div>\r\n    </div>\r\n"},"compiler":[7,">= 4.0.0"],"main":function(container,depth0,helpers,partials,data){var stack1;return((stack1=container.invokePartial(partials.teaserWrapperPartial,depth0,{"name":"teaserWrapperPartial","fn":container.program(1,data,0),"inverse":container.noop,"data":data,"helpers":helpers,"partials":partials,"decorators":container.decorators}))!=null?stack1:"")},"usePartial":!0,"useData":!0});this["Personetics"].UI.Handlebars.templates.pie=Handlebars.template({"1":function(container,depth0,helpers,partials,data){var stack1,helper,alias1=depth0!=null?depth0:(container.nullContext||{}),alias2=container.escapeExpression;return((stack1=container.invokePartial(partials.teaserHeader,depth0,{"name":"teaserHeader","data":data,"indent":"    ","helpers":helpers,"partials":partials,"decorators":container.decorators}))!=null?stack1:"")+"    <div class=\"perso-teaser-border\">\r\n        <div class=\"pstory-block-hbox-columns-frame teaser-body pie-chart\" aria-hidden=\"true\">\r\n                <div class=\"pstory-hbox-column-frame\" data-width=\"4\">\r\n                    <div id=\""+alias2(((helper=(helper=helpers.insightId||(depth0!=null?depth0.insightId:depth0))!=null?helper:helpers.helperMissing),(typeof helper==="function"?helper.call(alias1,{"name":"insightId","hash":{},"data":data}):helper)))+"_"+alias2(container.lambda(((stack1=(depth0!=null?depth0.chart1:depth0))!=null?stack1.blockId:stack1),depth0))+"\"></div>\r\n\r\n                </div>\r\n"+((stack1=helpers["if"].call(alias1,(depth0!=null?depth0.chart2:depth0),{"name":"if","hash":{},"fn":container.program(2,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+((stack1=helpers["if"].call(alias1,(depth0!=null?depth0.chart3:depth0),{"name":"if","hash":{},"fn":container.program(4,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"        </div>\r\n    </div>\r\n"},"2":function(container,depth0,helpers,partials,data){var stack1,helper,alias1=container.escapeExpression;return"                <div class=\"pstory-hbox-column-frame\" data-width=\"4\">\r\n                    <div id=\""+alias1(((helper=(helper=helpers.insightId||(depth0!=null?depth0.insightId:depth0))!=null?helper:helpers.helperMissing),(typeof helper==="function"?helper.call(depth0!=null?depth0:(container.nullContext||{}),{"name":"insightId","hash":{},"data":data}):helper)))+"_"+alias1(container.lambda(((stack1=(depth0!=null?depth0.chart2:depth0))!=null?stack1.blockId:stack1),depth0))+"\"></div>\r\n\r\n                </div>\r\n"},"4":function(container,depth0,helpers,partials,data){var stack1,helper,alias1=container.escapeExpression;return"                <div class=\"pstory-hbox-column-frame\" data-width=\"4\">\r\n                    <div id=\""+alias1(((helper=(helper=helpers.insightId||(depth0!=null?depth0.insightId:depth0))!=null?helper:helpers.helperMissing),(typeof helper==="function"?helper.call(depth0!=null?depth0:(container.nullContext||{}),{"name":"insightId","hash":{},"data":data}):helper)))+"_"+alias1(container.lambda(((stack1=(depth0!=null?depth0.chart3:depth0))!=null?stack1.blockId:stack1),depth0))+"\"></div>\r\n\r\n                </div>\r\n"},"compiler":[7,">= 4.0.0"],"main":function(container,depth0,helpers,partials,data){var stack1;return((stack1=container.invokePartial(partials.teaserWrapperPartial,depth0,{"name":"teaserWrapperPartial","fn":container.program(1,data,0),"inverse":container.noop,"data":data,"helpers":helpers,"partials":partials,"decorators":container.decorators}))!=null?stack1:"")},"usePartial":!0,"useData":!0});this["Personetics"].UI.Handlebars.templates.pinChart=Handlebars.template({"1":function(container,depth0,helpers,partials,data){var stack1,helper,alias1=container.escapeExpression;return((stack1=container.invokePartial(partials.teaserHeader,depth0,{"name":"teaserHeader","data":data,"indent":"    ","helpers":helpers,"partials":partials,"decorators":container.decorators}))!=null?stack1:"")+"    <div class=\"perso-teaser-border\">\r\n        <div class=\"teaser-body pin-chart\" id=\""+alias1(((helper=(helper=helpers.insightId||(depth0!=null?depth0.insightId:depth0))!=null?helper:helpers.helperMissing),(typeof helper==="function"?helper.call(depth0!=null?depth0:(container.nullContext||{}),{"name":"insightId","hash":{},"data":data}):helper)))+"_"+alias1(container.lambda(((stack1=(depth0!=null?depth0.chart:depth0))!=null?stack1.blockId:stack1),depth0))+"\"  aria-hidden=\"true\"></div>\r\n    </div>\r\n"},"compiler":[7,">= 4.0.0"],"main":function(container,depth0,helpers,partials,data){var stack1;return((stack1=container.invokePartial(partials.teaserWrapperPartial,depth0,{"name":"teaserWrapperPartial","fn":container.program(1,data,0),"inverse":container.noop,"data":data,"helpers":helpers,"partials":partials,"decorators":container.decorators}))!=null?stack1:"")},"usePartial":!0,"useData":!0});this["Personetics"].UI.Handlebars.templates.simpleText=Handlebars.template({"1":function(container,depth0,helpers,partials,data){var stack1;return((stack1=container.invokePartial(partials.teaserHeader,depth0,{"name":"teaserHeader","data":data,"indent":"    ","helpers":helpers,"partials":partials,"decorators":container.decorators}))!=null?stack1:"")},"compiler":[7,">= 4.0.0"],"main":function(container,depth0,helpers,partials,data){var stack1;return((stack1=container.invokePartial(partials.teaserWrapperPartial,depth0,{"name":"teaserWrapperPartial","fn":container.program(1,data,0),"inverse":container.noop,"data":data,"helpers":helpers,"partials":partials,"decorators":container.decorators}))!=null?stack1:"")},"usePartial":!0,"useData":!0});this["Personetics"].UI.Handlebars.templates.teaserHeader=Handlebars.template({"1":function(container,depth0,helpers,partials,data){var stack1,alias1=container.lambda,alias2=container.escapeExpression;return"                        <img class=\"pstory-block-image-icon\" src=\""+alias2(alias1(((stack1=(depth0!=null?depth0.icon:depth0))!=null?stack1.absUrl:stack1),depth0))+"\" alt=\""+alias2(alias1(((stack1=(depth0!=null?depth0.icon:depth0))!=null?stack1.alt:stack1),depth0))+"\" />\r\n"},"3":function(container,depth0,helpers,partials,data){var stack1,alias1=container.lambda,alias2=container.escapeExpression;return"                        <div class=\"pstory-block-image-icon "+alias2(alias1(((stack1=(depth0!=null?depth0.icon:depth0))!=null?stack1.absUrl:stack1),depth0))+"\" title=\""+alias2(alias1(((stack1=(depth0!=null?depth0.icon:depth0))!=null?stack1.alt:stack1),depth0))+"\"></div>\r\n"},"compiler":[7,">= 4.0.0"],"main":function(container,depth0,helpers,partials,data){var stack1,alias1=container.lambda;return"<div class=\"teaser-header\" aria-hidden=\"true\">\r\n    <div class=\"pstory-block-hbox-columns-frame teaser-top\">\r\n        <div class=\"pstory-hbox-column-frame\" data-width=\"1.5\">\r\n            <div class=\"pstory-block-frame pstory-block-icon\">\r\n                <div class=\"pstory-block-content\">\r\n"+((stack1=helpers["if"].call(depth0!=null?depth0:(container.nullContext||{}),((stack1=(depth0!=null?depth0["main-image"]:depth0))!=null?stack1.isAbsoluteURL:stack1),{"name":"if","hash":{},"fn":container.program(1,data,0),"inverse":container.program(3,data,0),"data":data}))!=null?stack1:"")+"                </div>\r\n            </div>\r\n        </div>\r\n\r\n        <div class=\"pstory-hbox-column-frame\" data-width=\"9\" data-v-align=\"middle\">\r\n            <div class=\"pstory-block-frame pstory-block-text insight-title-text block-title\">\r\n                <div class=\"pstory-block-content\">\r\n                    "+container.escapeExpression(alias1(((stack1=(depth0!=null?depth0.title:depth0))!=null?stack1.text:stack1),depth0))+"\r\n                </div>\r\n            </div>\r\n        </div>\r\n\r\n    </div>\r\n\r\n    <div class=\"pstory-block-frame pstory-block-text teaser-text\">\r\n        <div class=\"pstory-block-content\">\r\n           "+((stack1=alias1(((stack1=(depth0!=null?depth0["teaser-text"]:depth0))!=null?stack1.text:stack1),depth0))!=null?stack1:"")+"\r\n        </div>\r\n    </div>\r\n</div>"},"useData":!0});this["Personetics"].UI.Handlebars.templates.teaserWrapperPartial=Handlebars.template({"1":function(container,depth0,helpers,partials,data){return"perso-highlighted"},"3":function(container,depth0,helpers,partials,data){return"not "},"compiler":[7,">= 4.0.0"],"main":function(container,depth0,helpers,partials,data){var stack1,helper,alias1=depth0!=null?depth0:(container.nullContext||{}),alias2=helpers.helperMissing,alias3="function",alias4=container.escapeExpression,alias5=container.lambda;return"<div class=\"perso-teaser-template perso-teaser-template-bar-box perso-"+alias4(((helper=(helper=helpers.status||(depth0!=null?depth0.status:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"status","hash":{},"data":data}):helper)))+"  "+((stack1=helpers["if"].call(alias1,(depth0!=null?depth0.highlighted:depth0),{"name":"if","hash":{},"fn":container.program(1,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\" id=\"perso-teaser-template_"+alias4(((helper=(helper=helpers.insightId||(depth0!=null?depth0.insightId:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"insightId","hash":{},"data":data}):helper)))+"\"\r\n role=\"button\" aria-label=\""+alias4(alias5(((stack1=(depth0!=null?depth0.date:depth0))!=null?stack1.month:stack1),depth0))+" "+alias4(alias5(((stack1=(depth0!=null?depth0.date:depth0))!=null?stack1.day:stack1),depth0))+"."+alias4(alias5(((stack1=(depth0!=null?depth0.title:depth0))!=null?stack1.text:stack1),depth0))+"."+alias4(((helper=(helper=helpers.status||(depth0!=null?depth0.status:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"status","hash":{},"data":data}):helper)))+"."+((stack1=helpers.unless.call(alias1,(depth0!=null?depth0.highlighted:depth0),{"name":"unless","hash":{},"fn":container.program(3,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"highlighted."+((stack1=alias5(((stack1=(depth0!=null?depth0["teaser-text"]:depth0))!=null?stack1.text:stack1),depth0))!=null?stack1:"")+"\">\r\n"+((stack1=container.invokePartial(partials["@partial-block"],depth0,{"name":"@partial-block","data":data,"indent":"    ","helpers":helpers,"partials":partials,"decorators":container.decorators}))!=null?stack1:"")+"</div>"},"usePartial":!0,"useData":!0});this["Personetics"].UI.Handlebars.templates.textAndButton=Handlebars.template({"1":function(container,depth0,helpers,partials,data){var stack1,alias1=container.lambda,alias2=container.escapeExpression;return((stack1=container.invokePartial(partials.teaserHeader,depth0,{"name":"teaserHeader","data":data,"indent":"    ","helpers":helpers,"partials":partials,"decorators":container.decorators}))!=null?stack1:"")+"\r\n    <div class=\"teaser-body\" aria-hidden=\"true\">\r\n        <div id=\"pstory-block-buttons_"+alias2(alias1(((stack1=(depth0!=null?depth0.buttons:depth0))!=null?stack1.blockId:stack1),depth0))+"\" class=\"pstory-block-frame pstory-block-buttons\">\r\n            <div class=\"pstory-block-content\">\r\n                <a href=\"#!\" class=\"pstory-link-navigateTo pstory-button ripple-closed\" pnavigate-id=\""+alias2(alias1(((stack1=((stack1=((stack1=(depth0!=null?depth0.buttons:depth0))!=null?stack1.options:stack1))!=null?stack1["0"]:stack1))!=null?stack1.navigateTarget:stack1),depth0))+"\" >"+((stack1=alias1(((stack1=((stack1=((stack1=(depth0!=null?depth0.buttons:depth0))!=null?stack1.options:stack1))!=null?stack1["0"]:stack1))!=null?stack1.text:stack1),depth0))!=null?stack1:"")+"</a>\r\n            </div>\r\n        </div>\r\n    </div>\r\n"},"compiler":[7,">= 4.0.0"],"main":function(container,depth0,helpers,partials,data){var stack1;return((stack1=container.invokePartial(partials.teaserWrapperPartial,depth0,{"name":"teaserWrapperPartial","fn":container.program(1,data,0),"inverse":container.noop,"data":data,"helpers":helpers,"partials":partials,"decorators":container.decorators}))!=null?stack1:"")},"usePartial":!0,"useData":!0});this["Personetics"].UI.Handlebars.templates.verticalBar=Handlebars.template({"1":function(container,depth0,helpers,partials,data){var stack1,helper,alias1=container.escapeExpression;return((stack1=container.invokePartial(partials.teaserHeader,depth0,{"name":"teaserHeader","data":data,"indent":"    ","helpers":helpers,"partials":partials,"decorators":container.decorators}))!=null?stack1:"")+"    <div class=\"perso-teaser-border\">\r\n        <div class=\"teaser-body bar-chart\" id=\""+alias1(((helper=(helper=helpers.insightId||(depth0!=null?depth0.insightId:depth0))!=null?helper:helpers.helperMissing),(typeof helper==="function"?helper.call(depth0!=null?depth0:(container.nullContext||{}),{"name":"insightId","hash":{},"data":data}):helper)))+"_"+alias1(container.lambda(((stack1=(depth0!=null?depth0.chart:depth0))!=null?stack1.blockId:stack1),depth0))+"\"  aria-hidden=\"true\"></div>\r\n    </div>\r\n"},"compiler":[7,">= 4.0.0"],"main":function(container,depth0,helpers,partials,data){var stack1;return((stack1=container.invokePartial(partials.teaserWrapperPartial,depth0,{"name":"teaserWrapperPartial","fn":container.program(1,data,0),"inverse":container.noop,"data":data,"helpers":helpers,"partials":partials,"decorators":container.decorators}))!=null?stack1:"")},"usePartial":!0,"useData":!0});this["Personetics"].UI.Handlebars.templates.verticalBarAndBox=Handlebars.template({"1":function(container,depth0,helpers,partials,data){var stack1,helper,alias1=container.escapeExpression,alias2=container.lambda;return((stack1=container.invokePartial(partials.teaserHeader,depth0,{"name":"teaserHeader","data":data,"indent":"    ","helpers":helpers,"partials":partials,"decorators":container.decorators}))!=null?stack1:"")+"\r\n    <div class=\"perso-teaser-border\">\r\n        <div class=\"pstory-block-hbox-columns-frame teaser-body bar-chart-box\" aria-hidden=\"true\">\r\n            <div class=\"pstory-hbox-column-frame\" data-width=\"8\">\r\n                <div id=\""+alias1(((helper=(helper=helpers.insightId||(depth0!=null?depth0.insightId:depth0))!=null?helper:helpers.helperMissing),(typeof helper==="function"?helper.call(depth0!=null?depth0:(container.nullContext||{}),{"name":"insightId","hash":{},"data":data}):helper)))+"_"+alias1(alias2(((stack1=(depth0!=null?depth0.chart:depth0))!=null?stack1.blockId:stack1),depth0))+"\"></div>\r\n            </div>\r\n            <div class=\"pstory-hbox-column-frame\" data-width=\"4\">\r\n                <!--<div class=\"pstory-block-hbox-columns-frame\">-->\r\n\r\n                <div class=\"pstory-hbox-column-frame\" data-v-align=\"middle\" data-width=\"12\">\r\n                    <div class=\"pstory-block-frame pstory-block-text perso-percent-large\">\r\n                        <div class=\"pstory-block-content\">\r\n                            "+alias1(alias2(((stack1=(depth0!=null?depth0["box-value"]:depth0))!=null?stack1.text:stack1),depth0))+"\r\n                        </div>\r\n                    </div>\r\n                    <div class=\"pstory-block-frame pstory-block-text\">\r\n                        <div class=\"pstory-block-content\">\r\n                            "+alias1(alias2(((stack1=(depth0!=null?depth0["box-label"]:depth0))!=null?stack1.text:stack1),depth0))+"\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n\r\n            </div>\r\n        </div>\r\n    </div>\r\n"},"compiler":[7,">= 4.0.0"],"main":function(container,depth0,helpers,partials,data){var stack1;return((stack1=container.invokePartial(partials.teaserWrapperPartial,depth0,{"name":"teaserWrapperPartial","fn":container.program(1,data,0),"inverse":container.noop,"data":data,"helpers":helpers,"partials":partials,"decorators":container.decorators}))!=null?stack1:"")},"usePartial":!0,"useData":!0});this["Personetics"].UI.Handlebars.templates["tmpl-perso-loading-animation"]=Handlebars.template({"compiler":[7,">= 4.0.0"],"main":function(container,depth0,helpers,partials,data){var stack1,helper;return"<div id='perso-loading-widget'>\r\n    <div class='perso-loading'></div>\r\n    <div class='perso-loading-text' >\r\n         "+((stack1=((helper=(helper=helpers.loadingText||(depth0!=null?depth0.loadingText:depth0))!=null?helper:helpers.helperMissing),(typeof helper==="function"?helper.call(depth0!=null?depth0:(container.nullContext||{}),{"name":"loadingText","hash":{},"data":data}):helper)))!=null?stack1:"")+"\r\n    </div>\r\n</div>"},"useData":!0});this["Personetics"].UI.Handlebars.templates["pstory-block-account-selector-inner-card-desktop"]=Handlebars.template({"1":function(container,depth0,helpers,partials,data){var helper,alias1=depth0!=null?depth0:(container.nullContext||{}),alias2=helpers.helperMissing,alias3="function",alias4=container.escapeExpression;return"		<span class=\"perso-account-number\" aria-label=\""+alias4(((helper=(helper=helpers.numberPrefAccessibility||(depth0!=null?depth0.numberPrefAccessibility:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"numberPrefAccessibility","hash":{},"data":data}):helper)))+" "+alias4(((helper=(helper=helpers.number||(depth0!=null?depth0.number:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"number","hash":{},"data":data}):helper)))+".\">"+alias4(((helper=(helper=helpers.id||(depth0!=null?depth0.id:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"id","hash":{},"data":data}):helper)))+"</span>\r\n"},"compiler":[7,">= 4.0.0"],"main":function(container,depth0,helpers,partials,data){var stack1,helper,alias1=depth0!=null?depth0:(container.nullContext||{}),alias2=helpers.helperMissing,alias3="function",alias4=container.escapeExpression;return"<div class=\"card card_"+alias4(((helper=(helper=helpers.typeImage||(depth0!=null?depth0.typeImage:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"typeImage","hash":{},"data":data}):helper)))+" cards"+alias4(((helper=(helper=helpers.numCards||(depth0!=null?depth0.numCards:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"numCards","hash":{},"data":data}):helper)))+"\" pstory-id=\""+alias4(((helper=(helper=helpers.id||(depth0!=null?depth0.id:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"id","hash":{},"data":data}):helper)))+"\">	\r\n"+((stack1=helpers["if"].call(alias1,(depth0!=null?depth0.id:depth0),{"name":"if","hash":{},"fn":container.program(1,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"	<span class=\"perso-account-name\" aria-label=\""+alias4(((helper=(helper=helpers.name||(depth0!=null?depth0.name:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"name","hash":{},"data":data}):helper)))+".\">"+alias4(((helper=(helper=helpers.name||(depth0!=null?depth0.name:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"name","hash":{},"data":data}):helper)))+"</span>\r\n	<div class=\"perso-account-selector-card-line\"></div>\r\n	<div id=\"pop-"+alias4(container.lambda(depth0,depth0))+"\" class=\"pstory-button-txt-wrapper\" pstory-id=\""+alias4(((helper=(helper=helpers.id||(depth0!=null?depth0.id:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"id","hash":{},"data":data}):helper)))+"\">\r\n		<span class=\"pstory-button-txt\">"+((stack1=((helper=(helper=helpers.text||(depth0!=null?depth0.text:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"text","hash":{},"data":data}):helper)))!=null?stack1:"")+"</span>\r\n	</div>\r\n</div>"},"useData":!0});this["Personetics"].UI.Handlebars.templates["pstory-block-pie-chart"]=Handlebars.template({"compiler":[7,">= 4.0.0"],"main":function(container,depth0,helpers,partials,data){var stack1,alias1=container.lambda,alias2=container.escapeExpression;return"<div class=\"pstory-block-frame pstory-block-pie-chart\">\r\n    <div class=\"pstory-block-container\">\r\n        <div class=\"pstory-block-content\" tabindex=\"0\">\r\n            <div class=\"pstory-pie-chart\"></div>\r\n            <div class=\"pstory-pie-data\">\r\n                <input type=\"button\" class=\"pstory-arrow pstory-next-arrow\" tabindex=\"-1\" aria-label=\""+alias2(alias1(((stack1=(depth0!=null?depth0.texts:depth0))!=null?stack1.nextCategory:stack1),depth0))+"\"/>\r\n                <div class=\"pstory-pie-info perso-accessibility-wrapper\" role=\"text\">\r\n                </div>\r\n                <input type=\"button\" class=\"pstory-arrow pstory-previous-arrow\" tabindex=\"-1\" aria-label=\""+alias2(alias1(((stack1=(depth0!=null?depth0.texts:depth0))!=null?stack1.previousCategory:stack1),depth0))+"\"/>\r\n                <div class=\"carousel-animate carousel-wrapper\">\r\n                    <div class=\"carousel-index-wrapper\">\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</div>"},"useData":!0});this["Personetics"].UI.Handlebars.templates["pstory-block-table-perso-txlist3-desktop"]=Handlebars.template({"1":function(container,depth0,helpers,partials,data){return"                    <tr>\r\n                        <td class=\"perso-loading-table\">Loading...</td>\r\n                    </tr>\r\n"},"3":function(container,depth0,helpers,partials,data,blockParams,depths){var stack1;return((stack1=helpers.each.call(depth0!=null?depth0:(container.nullContext||{}),(depth0!=null?depth0.rows:depth0),{"name":"each","hash":{},"fn":container.program(4,data,0,blockParams,depths),"inverse":container.noop,"data":data}))!=null?stack1:"")},"4":function(container,depth0,helpers,partials,data,blockParams,depths){var stack1,alias1=container.lambda;return"                            <tr >\r\n                                <td>\r\n                                    <span class=\"perso-td-first-row perso-td-date\">\r\n                                        "+((stack1=alias1((depth0!=null?depth0.date:depth0),depth0))!=null?stack1:"")+"\r\n                                    </span>\r\n                                </td>\r\n                                <td  class=\"leftAlign\"> \r\n                                    <span class=\"perso-td-first-row perso-td-account-number\">\r\n                                        "+((stack1=alias1((depth0!=null?depth0.accountNumber:depth0),depth0))!=null?stack1:"")+"\r\n                                    </span>\r\n                                    <span class=\"perso-td-transaction\">\r\n                                        "+((stack1=alias1((depth0!=null?depth0.transaction:depth0),depth0))!=null?stack1:"")+"\r\n                                    </span>\r\n                                </td>\r\n                                <td class=\"leftAlign\" >\r\n                                    <span class=\"perso-td-first-row\">\r\n                                        "+container.escapeExpression(alias1((depths[1]!=null?depths[1].balanceLabel:depths[1]),depth0))+"\r\n                                    </span>\r\n                                    <span class=\"perso-td-amount-balance\">\r\n                                        "+((stack1=alias1((depth0!=null?depth0.balance:depth0),depth0))!=null?stack1:"")+"\r\n                                    </span>\r\n                                </td>   \r\n                            </tr>\r\n"},"compiler":[7,">= 4.0.0"],"main":function(container,depth0,helpers,partials,data,blockParams,depths){var stack1;return"<div class=\"pstory-block-frame pstory-block-table\">\r\n    <div class=\"pstory-block-container\">\r\n        <div class=\"pstory-block-content\">\r\n            <table class=\"pstory-table pstory-table-txlist3\">\r\n"+((stack1=helpers["if"].call(depth0!=null?depth0:(container.nullContext||{}),(depth0!=null?depth0.future:depth0),{"name":"if","hash":{},"fn":container.program(1,data,0,blockParams,depths),"inverse":container.program(3,data,0,blockParams,depths),"data":data}))!=null?stack1:"")+"            </table>\r\n        </div>\r\n    </div>\r\n</div>\r\n"},"useData":!0,"useDepths":!0});this["Personetics"].UI.Handlebars.templates["pstory-block-table-perso-txlist4-desktop"]=Handlebars.template({"1":function(container,depth0,helpers,partials,data){return"                    <tr>\r\n                        <td class=\"perso-loading-table\">Loading...</td>\r\n                    </tr>\r\n"},"3":function(container,depth0,helpers,partials,data){var stack1;return((stack1=helpers.each.call(depth0!=null?depth0:(container.nullContext||{}),(depth0!=null?depth0.rows:depth0),{"name":"each","hash":{},"fn":container.program(4,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")},"4":function(container,depth0,helpers,partials,data){var stack1,alias1=container.lambda;return"                            <tr >\r\n                                <td>\r\n                                    <span class=\"perso-td-first-row perso-td-date\">\r\n                                        "+((stack1=alias1((depth0!=null?depth0.date:depth0),depth0))!=null?stack1:"")+"\r\n                                    </span>\r\n                                    <span class=\"perso-td-transaction\">\r\n                                        "+((stack1=alias1((depth0!=null?depth0.transaction:depth0),depth0))!=null?stack1:"")+"\r\n                                    </span>\r\n                                </td>\r\n                                <td  class=\"leftAlign\">\r\n                                      <span class=\"perso-td-first-row perso-td-amount-balance\">\r\n                                          "+((stack1=alias1((depth0!=null?depth0.balance:depth0),depth0))!=null?stack1:"")+"\r\n                                      </span>\r\n                                </td>\r\n                            </tr>\r\n"},"compiler":[7,">= 4.0.0"],"main":function(container,depth0,helpers,partials,data){var stack1;return"<div class=\"pstory-block-frame pstory-block-table\">\r\n    <div class=\"pstory-block-container\">\r\n        <div class=\"pstory-block-content\">\r\n            <table class=\"pstory-table pstory-table-txlist4\">\r\n"+((stack1=helpers["if"].call(depth0!=null?depth0:(container.nullContext||{}),(depth0!=null?depth0.future:depth0),{"name":"if","hash":{},"fn":container.program(1,data,0),"inverse":container.program(3,data,0),"data":data}))!=null?stack1:"")+"            </table>\r\n        </div>\r\n    </div>\r\n</div>\r\n"},"useData":!0});this["Personetics"].UI.Handlebars.templates["tmpl-perso-rating-desktop"]=Handlebars.template({"compiler":[7,">= 4.0.0"],"main":function(container,depth0,helpers,partials,data){var helper;return"<div class=\"perso-ratings-wrapper perso-rating-close-state\">\r\n   <div class='perso-ratings-text'>"+container.escapeExpression(((helper=(helper=helpers.ratingTitle||(depth0!=null?depth0.ratingTitle:depth0))!=null?helper:helpers.helperMissing),(typeof helper==="function"?helper.call(depth0!=null?depth0:(container.nullContext||{}),{"name":"ratingTitle","hash":{},"data":data}):helper)))+"</div>\r\n   <div class='perso-ratings-icons' data-rating-max='5'></div>\r\n</div>\r\n\r\n"},"useData":!0});this["Personetics"].UI.Handlebars.templates["pstory-block-account-selector-inner-card-desktop"]=Handlebars.template({"1":function(container,depth0,helpers,partials,data){var helper,alias1=depth0!=null?depth0:(container.nullContext||{}),alias2=helpers.helperMissing,alias3="function",alias4=container.escapeExpression;return"        <span>"+alias4(((helper=(helper=helpers.accountNumberTxt||(depth0!=null?depth0.accountNumberTxt:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"accountNumberTxt","hash":{},"data":data}):helper)))+" - "+alias4(((helper=(helper=helpers.number||(depth0!=null?depth0.number:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"number","hash":{},"data":data}):helper)))+"</span> "},"compiler":[7,">= 4.0.0"],"main":function(container,depth0,helpers,partials,data){var stack1,helper,alias1=depth0!=null?depth0:(container.nullContext||{}),alias2=helpers.helperMissing,alias3="function",alias4=container.escapeExpression;return"<div class=\"card card_"+alias4(((helper=(helper=helpers.typeImage||(depth0!=null?depth0.typeImage:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"typeImage","hash":{},"data":data}):helper)))+" cards"+alias4(((helper=(helper=helpers.numCards||(depth0!=null?depth0.numCards:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"numCards","hash":{},"data":data}):helper)))+"\" pstory-id=\""+alias4(((helper=(helper=helpers.id||(depth0!=null?depth0.id:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"id","hash":{},"data":data}):helper)))+"\">	\r\n    <div class=\"perso-card-img "+alias4(((helper=(helper=helpers.image||(depth0!=null?depth0.image:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"image","hash":{},"data":data}):helper)))+"\" ></div>\r\n</div>\r\n<div id=\"pop-"+alias4(container.lambda(depth0,depth0))+"\" class=\"pstory-button-txt-wrapper\" pstory-id=\""+alias4(((helper=(helper=helpers.id||(depth0!=null?depth0.id:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"id","hash":{},"data":data}):helper)))+"\">\r\n    <span class=\"pstory-button-txt account-number\">\r\n"+((stack1=helpers["if"].call(alias1,(depth0!=null?depth0.number:depth0),{"name":"if","hash":{},"fn":container.program(1,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\r\n    </span>\r\n    <span class=\"pstory-button-txt\">\r\n    "+((stack1=((helper=(helper=helpers.text||(depth0!=null?depth0.text:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"text","hash":{},"data":data}):helper)))!=null?stack1:"")+"\r\n    </span>\r\n</div>"},"useData":!0});this["Personetics"].UI.Handlebars.templates["pstory-block-account-selector"]=Handlebars.template({"1":function(container,depth0,helpers,partials,data,blockParams,depths){var stack1;return"			<div class=\"header-container\">\r\n				<div class=\"pstory-tab-animated-border-bottom\"></div>\r\n				<ul class=\"tablist\" role=\"tablist\">\r\n"+((stack1=helpers.each.call(depth0!=null?depth0:(container.nullContext||{}),(depth0!=null?depth0.headersArray:depth0),{"name":"each","hash":{},"fn":container.program(2,data,0,blockParams,depths),"inverse":container.noop,"data":data}))!=null?stack1:"")+"				</ul>\r\n			</div>\r\n			<div class=\"carousel-outer-wrapper\">\r\n				<div class=\"carousel-animate options-container carousel-wrapper pstory-show-header-tabs\">\r\n"},"2":function(container,depth0,helpers,partials,data,blockParams,depths){var stack1,helper,alias1=depth0!=null?depth0:(container.nullContext||{}),alias2=helpers.helperMissing,alias3="function";return"						<li class=\"pstory-header-button\" "+((stack1=helpers["if"].call(alias1,(depths[1]!=null?depths[1].isDesktopMode:depths[1]),{"name":"if","hash":{},"fn":container.program(3,data,0,blockParams,depths),"inverse":container.noop,"data":data}))!=null?stack1:"")+" role=\"tab\" data-all=\""+container.escapeExpression(((helper=(helper=helpers.isAll||(depth0!=null?depth0.isAll:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"isAll","hash":{},"data":data}):helper)))+"\" "+((stack1=helpers["if"].call(alias1,(depth0!=null?depth0.isAll:depth0),{"name":"if","hash":{},"fn":container.program(5,data,0,blockParams,depths),"inverse":container.noop,"data":data}))!=null?stack1:"")+">"+((stack1=((helper=(helper=helpers.text||(depth0!=null?depth0.text:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"text","hash":{},"data":data}):helper)))!=null?stack1:"")+"\r\n							<span class=\"pstory-header-button-arrow\"></span>\r\n						</li>\r\n"},"3":function(container,depth0,helpers,partials,data){var stack1,helper;return" tabindex=\"0\"  aria-label=\""+((stack1=((helper=(helper=helpers.text||(depth0!=null?depth0.text:depth0))!=null?helper:helpers.helperMissing),(typeof helper==="function"?helper.call(depth0!=null?depth0:(container.nullContext||{}),{"name":"text","hash":{},"data":data}):helper)))!=null?stack1:"")+"\" "},"5":function(container,depth0,helpers,partials,data){return"pstory-id=\"all\""},"7":function(container,depth0,helpers,partials,data){return"					<div class=\"carousel-outer-wrapper\">\r\n						<div class=\"carousel-animate options-container carousel-wrapper\">\r\n"},"9":function(container,depth0,helpers,partials,data,blockParams,depths){var stack1,helper,alias1=depth0!=null?depth0:(container.nullContext||{}),alias2=helpers.helperMissing,alias3="function",alias4=container.escapeExpression;return"								<div class=\"carousel-item pstory-button "+((stack1=helpers["if"].call(alias1,(depth0!=null?depth0.selected:depth0),{"name":"if","hash":{},"fn":container.program(10,data,0,blockParams,depths),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\" aria-hidden=\"true\" pstory-id=\""+alias4(((helper=(helper=helpers.id||(depth0!=null?depth0.id:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"id","hash":{},"data":data}):helper)))+"\" pstory-event=\""+alias4(((helper=(helper=helpers.event||(depth0!=null?depth0.event:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"event","hash":{},"data":data}):helper)))+"\"\r\n								 role=\""+alias4(container.lambda((depths[1]!=null?depths[1].role:depths[1]),depth0))+"\">\r\n									"+((stack1=helpers["if"].call(alias1,(depths[1]!=null?depths[1].isDesktopMode:depths[1]),{"name":"if","hash":{},"fn":container.program(12,data,0,blockParams,depths),"inverse":container.program(14,data,0,blockParams,depths),"data":data}))!=null?stack1:"")+"\r\n								</div>\r\n"},"10":function(container,depth0,helpers,partials,data){return"selected"},"12":function(container,depth0,helpers,partials,data,blockParams,depths){var stack1;return" "+((stack1=container.invokePartial(partials.innerCardDesktop,depth0,{"name":"innerCardDesktop","hash":{"accountNumberTxt":(depths[1]!=null?depths[1].accountNumberTxt:depths[1]),"numberPrefAccessibility":(depths[1]!=null?depths[1].numberPrefAccessibility:depths[1]),"numberPref":(depths[1]!=null?depths[1].numberPref:depths[1])},"data":data,"helpers":helpers,"partials":partials,"decorators":container.decorators}))!=null?stack1:"")+"\r\n									"},"14":function(container,depth0,helpers,partials,data,blockParams,depths){var stack1;return" "+((stack1=container.invokePartial(partials.innerCard,depth0,{"name":"innerCard","hash":{"numberPrefAccessibility":(depths[1]!=null?depths[1].numberPrefAccessibility:depths[1]),"numberPref":(depths[1]!=null?depths[1].numberPref:depths[1])},"data":data,"helpers":helpers,"partials":partials,"decorators":container.decorators}))!=null?stack1:"")+" "},"16":function(container,depth0,helpers,partials,data){var stack1,alias1=depth0!=null?depth0:(container.nullContext||{});return"							<div class=\"carousel-index-wrapper\" "+((stack1=helpers["if"].call(alias1,(depth0!=null?depth0.isDesktopMode:depth0),{"name":"if","hash":{},"fn":container.program(17,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+">\r\n								<div class=\"carousel-index-container\">\r\n"+((stack1=helpers.each.call(alias1,(depth0!=null?depth0.options:depth0),{"name":"each","hash":{},"fn":container.program(19,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"								</div>\r\n							</div>\r\n"},"17":function(container,depth0,helpers,partials,data){var stack1;return" role=\"application\" aria-labelledby=\"perso-accessibility-read-"+container.escapeExpression(container.lambda(((stack1=((stack1=(depth0!=null?depth0.options:depth0))!=null?stack1["0"]:stack1))!=null?stack1.id:stack1),depth0))+"\""},"19":function(container,depth0,helpers,partials,data){return"									<div class=\"carousel-index-dot\">\r\n										<div class=\"carousel-index-dot-circle\"></div>\r\n									</div> \r\n"},"21":function(container,depth0,helpers,partials,data){return" tabindex=\"-1\" "},"compiler":[7,">= 4.0.0"],"main":function(container,depth0,helpers,partials,data,blockParams,depths){var stack1,helper,alias1=depth0!=null?depth0:(container.nullContext||{}),alias2=helpers.helperMissing,alias3="function",alias4=container.escapeExpression;return"<div id=\"pstory-block-account-selector_"+alias4(((helper=(helper=helpers.index||(depth0!=null?depth0.index:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"index","hash":{},"data":data}):helper)))+"\" class=\"pstory-block-frame pstory-block-account-selector "+alias4(((helper=(helper=helpers["class"]||(depth0!=null?depth0["class"]:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"class","hash":{},"data":data}):helper)))+"\" data-show-header-tabs="+alias4(((helper=(helper=helpers.showHeaderTabs||(depth0!=null?depth0.showHeaderTabs:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"showHeaderTabs","hash":{},"data":data}):helper)))+">\r\n	<div class=\"pstory-block-container\">\r\n		<div class=\"pstory-block-content\">\r\n"+((stack1=helpers["if"].call(alias1,(depth0!=null?depth0.showHeaderTabs:depth0),{"name":"if","hash":{},"fn":container.program(1,data,0,blockParams,depths),"inverse":container.program(7,data,0,blockParams,depths),"data":data}))!=null?stack1:"")+"							<div class=\"carousel-inner-wrapper cards-wrapper\" aria-hidden=\"true\">\r\n"+((stack1=helpers.each.call(alias1,(depth0!=null?depth0.options:depth0),{"name":"each","hash":{},"fn":container.program(9,data,0,blockParams,depths),"inverse":container.noop,"data":data}))!=null?stack1:"")+"							</div>\r\n\r\n							<div class=\"perso-accessibility-wrapper pstory-account-button selected\" role=\"text\">\r\n								<span class=\"perso-accessibility-read\">"+alias4(((helper=(helper=helpers.accountName||(depth0!=null?depth0.accountName:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"accountName","hash":{},"data":data}):helper)))+". "+alias4(((helper=(helper=helpers.numberPrefAccessibility||(depth0!=null?depth0.numberPrefAccessibility:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"numberPrefAccessibility","hash":{},"data":data}):helper)))+" "+alias4(((helper=(helper=helpers.accountNumber||(depth0!=null?depth0.accountNumber:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"accountNumber","hash":{},"data":data}):helper)))+"</span>\r\n							</div>\r\n\r\n"+((stack1=helpers["if"].call(alias1,(depth0!=null?depth0.showIndexDots:depth0),{"name":"if","hash":{},"fn":container.program(16,data,0,blockParams,depths),"inverse":container.noop,"data":data}))!=null?stack1:"")+"							<div class=\"pstory-all-accounts-txt\" role=\"text\">"+((stack1=((helper=(helper=helpers.allAccountsTxt||(depth0!=null?depth0.allAccountsTxt:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"allAccountsTxt","hash":{},"data":data}):helper)))!=null?stack1:"")+"</div>\r\n						</div>\r\n						<input type=\"button\" class=\"pstory-account-button pstory-prev-account-button\" aria-label=\""+alias4(((helper=(helper=helpers.next||(depth0!=null?depth0.next:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"next","hash":{},"data":data}):helper)))+"\" "+((stack1=helpers["if"].call(alias1,(depth0!=null?depth0.isDesktopMode:depth0),{"name":"if","hash":{},"fn":container.program(21,data,0,blockParams,depths),"inverse":container.noop,"data":data}))!=null?stack1:"")+" />\r\n						<input type=\"button\" class=\"pstory-account-button pstory-next-account-button\" aria-label=\""+alias4(((helper=(helper=helpers.next||(depth0!=null?depth0.next:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"next","hash":{},"data":data}):helper)))+"\" "+((stack1=helpers["if"].call(alias1,(depth0!=null?depth0.isDesktopMode:depth0),{"name":"if","hash":{},"fn":container.program(21,data,0,blockParams,depths),"inverse":container.noop,"data":data}))!=null?stack1:"")+"/>\r\n					</div>\r\n					<div class=\"pstory-comment\">"+((stack1=((helper=(helper=helpers.comment||(depth0!=null?depth0.comment:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"comment","hash":{},"data":data}):helper)))!=null?stack1:"")+"</div>\r\n				</div>\r\n			</div>\r\n		</div>\r\n	</div>\r\n</div>\r\n"},"usePartial":!0,"useData":!0,"useDepths":!0});this["Personetics"].UI.Handlebars.templates["pstory-block-pie-chart"]=Handlebars.template({"compiler":[7,">= 4.0.0"],"main":function(container,depth0,helpers,partials,data){var stack1,alias1=container.lambda,alias2=container.escapeExpression;return"<div class=\"pstory-block-frame pstory-block-pie-chart\">\r\n    <div class=\"pstory-block-container\">\r\n        <div class=\"pstory-block-content\">\r\n            <div class=\"pstory-pie-chart\"></div>\r\n            <div class=\"pstory-pie-data\">\r\n                <input type=\"button\" class=\"pstory-arrow pstory-next-arrow\" aria-label=\""+alias2(alias1(((stack1=(depth0!=null?depth0.texts:depth0))!=null?stack1.nextCategory:stack1),depth0))+"\"/>\r\n                <div class=\"pstory-pie-info perso-accessibility-wrapper\" role=\"text\">\r\n                </div>\r\n                <input type=\"button\" class=\"pstory-arrow pstory-previous-arrow\" aria-label=\""+alias2(alias1(((stack1=(depth0!=null?depth0.texts:depth0))!=null?stack1.previousCategory:stack1),depth0))+"\"/>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</div>"},"useData":!0});this["Personetics"].UI.Handlebars.templates["pstory-block-table-perso-txlist1"]=Handlebars.template({"1":function(container,depth0,helpers,partials,data){var stack1;return"                    <table class=\"pstory-table\">\r\n                        <tr class=\"table-header-row\">\r\n                            <th colspan=\"3\">"+((stack1=container.lambda((depth0!=null?depth0.date:depth0),depth0))!=null?stack1:"")+"</th>\r\n                        </tr>\r\n"+((stack1=helpers.each.call(depth0!=null?depth0:(container.nullContext||{}),(depth0!=null?depth0.rows:depth0),{"name":"each","hash":{},"fn":container.program(2,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"                    </table>\r\n"},"2":function(container,depth0,helpers,partials,data){var stack1,alias1=container.lambda;return"                            <tr>\r\n                                <td class=\"perso-td-account-number\">\r\n                                    "+((stack1=alias1((depth0!=null?depth0.accountNumber:depth0),depth0))!=null?stack1:"")+"\r\n                                </td>\r\n                                <td class=\"perso-td-transaction\"> \r\n                                    "+((stack1=alias1((depth0!=null?depth0.transaction:depth0),depth0))!=null?stack1:"")+"\r\n                                </td>\r\n                                <td class=\"perso-td-amount-balance\">\r\n                                    "+((stack1=alias1((depth0!=null?depth0.amount:depth0),depth0))!=null?stack1:"")+"\r\n                                </td>\r\n                            </tr>\r\n"},"compiler":[7,">= 4.0.0"],"main":function(container,depth0,helpers,partials,data){var stack1,helper,alias1=depth0!=null?depth0:(container.nullContext||{});return"<div class=\"pstory-block-frame pstory-block-table "+container.escapeExpression(((helper=(helper=helpers["class"]||(depth0!=null?depth0["class"]:depth0))!=null?helper:helpers.helperMissing),(typeof helper==="function"?helper.call(alias1,{"name":"class","hash":{},"data":data}):helper)))+"\">\r\n    <div class=\"pstory-block-container\">\r\n        <div class=\"pstory-block-content\">\r\n            <div>\r\n"+((stack1=helpers.each.call(alias1,(depth0!=null?depth0.groups:depth0),{"name":"each","hash":{},"fn":container.program(1,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"            </div>\r\n        </div>\r\n    </div>\r\n</div>"},"useData":!0});this["Personetics"].UI.Handlebars.templates["pstory-block-tabs"]=Handlebars.template({"1":function(container,depth0,helpers,partials,data){var stack1,helper,alias1=depth0!=null?depth0:(container.nullContext||{}),alias2=helpers.helperMissing,alias3="function";return"            \r\n                <input type=\"button\" class=\"pstory-tab pstory-button "+((stack1=helpers["if"].call(alias1,(depth0!=null?depth0.selected:depth0),{"name":"if","hash":{},"fn":container.program(2,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\" value=\""+((stack1=((helper=(helper=helpers.text||(depth0!=null?depth0.text:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"text","hash":{},"data":data}):helper)))!=null?stack1:"")+"\" pstory-id=\""+container.escapeExpression(((helper=(helper=helpers.id||(depth0!=null?depth0.id:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"id","hash":{},"data":data}):helper)))+"\" />\r\n            "},"2":function(container,depth0,helpers,partials,data){return"selected"},"4":function(container,depth0,helpers,partials,data){var stack1,helper,alias1=depth0!=null?depth0:(container.nullContext||{}),alias2=helpers.helperMissing,alias3="function",alias4=container.escapeExpression;return"                    <li  class=\"pstory-tab pstory-button "+((stack1=helpers["if"].call(alias1,(depth0!=null?depth0.selected:depth0),{"name":"if","hash":{},"fn":container.program(2,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\" aria-selected=\""+alias4(((helper=(helper=helpers.selected||(depth0!=null?depth0.selected:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"selected","hash":{},"data":data}):helper)))+"\" role=\"tab\" tabindex=\""+alias4(((helper=(helper=helpers.index||(data&&data.index))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"index","hash":{},"data":data}):helper)))+"\" pstory-id=\""+alias4(((helper=(helper=helpers.id||(depth0!=null?depth0.id:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"id","hash":{},"data":data}):helper)))+"\">"+((stack1=((helper=(helper=helpers.text||(depth0!=null?depth0.text:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"text","hash":{},"data":data}):helper)))!=null?stack1:"")+"\r\n                    <span class=\"pstory-header-button-arrow\"></span></li>\r\n"},"compiler":[7,">= 4.0.0"],"main":function(container,depth0,helpers,partials,data){var stack1,helper,alias1=depth0!=null?depth0:(container.nullContext||{}),alias2=helpers.helperMissing,alias3="function",alias4=container.escapeExpression;return"<div id=\"pstory-block-tabs_"+alias4(((helper=(helper=helpers.id||(depth0!=null?depth0.id:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"id","hash":{},"data":data}):helper)))+"\" class=\"pstory-block-frame pstory-block-tabs "+alias4(((helper=(helper=helpers["class"]||(depth0!=null?depth0["class"]:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"class","hash":{},"data":data}):helper)))+"\">\r\n    <div class=\"pstory-block-container\">\r\n        <div class=\"pstory-block-content\">\r\n            <!--"+((stack1=helpers.each.call(alias1,(depth0!=null?depth0.options:depth0),{"name":"each","hash":{},"fn":container.program(1,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"-->\r\n            <div class=\"pstory-tab-animated-border-bottom\"></div>            \r\n            <ul class=\"tablist\" role=\"tablist\">\r\n"+((stack1=helpers.each.call(alias1,(depth0!=null?depth0.options:depth0),{"name":"each","hash":{},"fn":container.program(4,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"            </ul>\r\n        </div>\r\n    </div>\r\n</div>"},"useData":!0});this["Personetics"].UI.Handlebars.templates["tmpl-pstory-title"]=Handlebars.template({"compiler":[7,">= 4.0.0"],"main":function(container,depth0,helpers,partials,data){var stack1,helper,alias1=depth0!=null?depth0:(container.nullContext||{}),alias2=helpers.helperMissing,alias3="function";return"<div class=\"pstory-title-outer-wrapper\">\r\n    <div class=\"pstory-title-wrapper\">\r\n        <input aria-label=\""+container.escapeExpression(((helper=(helper=helpers.backButtonText||(depth0!=null?depth0.backButtonText:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"backButtonText","hash":{},"data":data}):helper)))+"\" type=\"button\" class=\"pstory-title-close\"/>\r\n        <div class=\"pstory-title\">\r\n            <div role=\"text\" class=\"pstory-title-text\">"+((stack1=((helper=(helper=helpers.title||(depth0!=null?depth0.title:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"title","hash":{},"data":data}):helper)))!=null?stack1:"")+"</div>\r\n        </div>\r\n    </div>\r\n</div>\r\n<div id=\"story-frame-container\"></div>"},"useData":!0});this["Personetics"].UI.Handlebars.templates["tmpl-perso-feedback"]=Handlebars.template({"compiler":[7,">= 4.0.0"],"main":function(container,depth0,helpers,partials,data){var stack1,helper,alias1=depth0!=null?depth0:(container.nullContext||{}),alias2=helpers.helperMissing,alias3="function",alias4=container.escapeExpression;return"<div class=\"perso-feedback-wrapper perso-rating-close-state\">\r\n    <div class=\"textarea-wrapper\">\r\n        <div class=\"textarea-container\">\r\n            <div class=\"perso-feedback-label\">"+alias4(((helper=(helper=helpers.lblfeedbackprompt||(depth0!=null?depth0.lblfeedbackprompt:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"lblfeedbackprompt","hash":{},"data":data}):helper)))+"</div>\r\n            <textarea class=\"perso-feedback-text direction-text-center\" ></textarea>\r\n            <div class=\"textarea-size\" ></div>\r\n        </div>\r\n        <input class=\"perso-feedback-submit disabled-button\" disabled=\"disabled\" type=\"button\" value=\""+((stack1=((helper=(helper=helpers.btnsubmit||(depth0!=null?depth0.btnsubmit:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"btnsubmit","hash":{},"data":data}):helper)))!=null?stack1:"")+"\"/>\r\n    </div>\r\n    <div class=\"perso-feedback-reaction\">"+alias4(((helper=(helper=helpers.lblreactionFeedback||(depth0!=null?depth0.lblreactionFeedback:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"lblreactionFeedback","hash":{},"data":data}):helper)))+"</div>\r\n</div>\r\n"},"useData":!0})})(window,window.Personetics=window.Personetics||{},jQuery,window.Personetics.UI.Handlebars);(function(window,Personetics,$,undefined){Personetics.story=Personetics.story||{};Personetics.story.PieChartBlockCiti=Personetics.story.PieChartBlockProduct.extend({setPieSize:function setPieSize(){Personetics.story.PieChartBlock.prototype.setPieSize.call(this);this.height=this.width*0.46;this.innerRadius=this.radius-153;this.outerRadius=this.radius-178;this.innerRadiusOver=this.radius-121.5;this.outerRadiusOver=this.radius-178},updatePieInfoValues:function(obj){var block=this;if(obj){block.el.find(".perso-total-txt").html(obj.category);if(this.options.arcs.filter.grayFilter==!0){block.el.find('.pstory-pie-amount').css('color',"#ffffff")}
block.el.find(".perso-total-amount").html(obj.label);totalAmount=obj.label;var text=block.frameEl.find('.perso-total-amount');text.empty();text=d3.select(text[0]);var tspan=text.append('tspan');var attrs=$(totalAmount)[0]?$(totalAmount)[0].attributes:[];$.each(attrs,function(j,attr){tspan.attr(attr.name,attr.value)});var totalAmountChildren=$(totalAmount).children();$.each(totalAmountChildren,function(i,node){var innerTspan=tspan.append('tspan').text($(node).text());var attrs=node.attributes;$.each(attrs,function(j,attr){innerTspan.attr(attr.name,attr.value)})})}
this.totalText=obj.category;arcPaths=block.frameEl.find('.pstory-pie-chart svg .perso-arc path');var wrapLabelTextBind=Personetics.bind(this,this.wrapLabelText);var labelTextwidth=120;this.svg.selectAll('text.perso-total-txt').attr('dy','1.66em').html(obj.category).call(wrapLabelTextBind,120)},initPieInfoValues:function(){this.setTotal(this.layoutInstructions);var amountDiv='<div class="pstory-pie-amount perso-accessibility-no-read"><span>'+this.totalAmount+'</span></div>';var categoryDiv='<div class="pstory-pie-category perso-accessibility-no-read"><span>'+this.totalText+'</span></div>';var $infoContainer=this.frameEl.find('.pstory-pie-info');$infoContainer.empty();$infoContainer.append(categoryDiv);$infoContainer.append(amountDiv)},renderGrayFilter:function renderGrayFilter(){this.svg.append("filter").attr("id",this.grayscaleId).append("feColorMatrix").attr("type","matrix").attr("values","0 1 0 1 0 0 0.623 0 1 0 0 0.345 0 1 0 0 1 0 1 0 ")},renderPie:function(el,layoutInstructions,block){arcPaths=block.frameEl.find('.pstory-pie-chart svg .perso-arc path');this.renderArcs(layoutInstructions);var slices=layoutInstructions.slices[this.getSelectedPathIndex(arcPaths)];this.totalText=slices?slices.category:"";this.renderPieTitle(this.totalText,block);this.renderPieAmount(slices?slices.label:"")},renderPieTitle:function(totalText,block){var wrapLabelTextBind=Personetics.bind(this,this.wrapLabelText);var labelTextwidth=120;this.svg.append('text').attr('class','perso-total-txt').attr('dy','1.66em').call(wrapLabelTextBind,120)},renderPieAmount:function(totalAmount){var text=this.svg.append('text').attr('class','perso-total-amount').attr('dy','-.3em');var tspan=text.append('tspan');var attrs=$(totalAmount)[0]?$(totalAmount)[0].attributes:[];$.each(attrs,function(j,attr){tspan.attr(attr.name,attr.value)});var totalAmountChildren=$(totalAmount).children();$.each(totalAmountChildren,function(i,node){var innerTspan=tspan.append('tspan').text($(node).text());var attrs=node.attributes;$.each(attrs,function(j,attr){innerTspan.attr(attr.name,attr.value)})})},wrapLabelText:function(text,width){var block=this;var totalAmount=block.frameEl.find('.perso-total-amount');var totalText=block.frameEl.find('.perso-total-txt');text.each(function(){var text=d3.select(this),words=block.totalText.split(/\s+/).reverse(),word,line=[],lineNumber=0,lineHeight=-0.15,y=text.attr("y"),dy=parseFloat(text.attr("dy")),tspan=text.text(null).append("tspan").attr("x",0).attr("y",y).attr("dy",dy+"em");while(word=words.pop()){line.push(word);tspan.text(line.join(" "));if(tspan.node().getComputedTextLength()>width){line.pop();tspan.text(line.join(" "));line=[word];tspan=text.append("tspan").attr("x",0).attr("y",y).attr("dy",++lineNumber*lineHeight+dy+"em").text(word)}
if(lineNumber==1){$(totalAmount).css("transform","translateY(-0.269em)");$(totalText).css("transform","translateY(-0.58em)")}}})}})})(window,window.Personetics=window.Personetics||{},jQuery);(function(window,Personetics,$,undefined){Personetics.story=Personetics.story||{};Personetics.story.BlockChartFactory=new function(){this.chartHelperFactoryMap={};this.registerChartHelper=function(type,config){if(config.hasOwnProperty('helperClass')){if(config.helperClass){var entry=this.chartHelperFactoryMap[type];if(!entry){entry={type:type,class:{},widthModes:{}};this.chartHelperFactoryMap[type]=entry}
if(config.class){entry.class[config.class]=config.helperClass}
else if(config.widthMode){entry.widthModes[config.widthMode]=config.helperClass}
else{entry.helperClass=config.helperClass}}}
else{this.chartHelperFactoryMap[type]=config}};this.generateHelperClazz=function(name,config){var generatedChartHelper=null;if(typeof(name)!=="undefined"&&name!=null&&this.chartHelperFactoryMap.hasOwnProperty(name)){var chartHelperClass=this.chartHelperFactoryMap[name].helperClass;if(config.hasOwnProperty("widthMode")&&typeof config.widthMode!=='undefined'&&config.widthMode!==null&&config.widthMode.length>0&&this.chartHelperFactoryMap[name].widthModes[config.widthMode]!=undefined){var chartHelperClass=this.chartHelperFactoryMap[name].widthModes[config.widthMode]}
generatedChartHelper=new chartHelperClass()}else{Personetics.log('The helper'+name+'is not valid')}
return generatedChartHelper}}})(window,window.Personetics=window.Personetics||{},jQuery);(function(window,Personetics,$,undefined){var d3=Personetics.persoD3||window.d3;Personetics.utils=Personetics.utils?Personetics.utils:{};Personetics.utils.d3Helpers=Personetics.utils.d3Helpers?Personetics.utils.d3Helpers:{};Personetics.utils.d3Helpers.BlockHelperBase=Base.extend({prepareChart:function(data,options){this.options=options;this.width=this.getValueByScreenWidth(this.options.svgWidth)},renderSVGBase:function(el,clazz){var helper=this;if(!clazz){clazz=''}
return(d3.select(el.get(0)).append("svg").attr("class","perso-svg-chart-container "+clazz).attr("width",helper.width).attr("height",helper.getValueByScreenWidth(helper.options.svgHeight)).append("g").attr("transform","translate(0,0)"))},renderLabels:function(){var helper=this;if(this.options.labels.drawLabels){this.svg.append("g").selectAll().data(helper.seriesData).enter().append("text").attr("class","perso-label").attr("class",function(d){var clazz='perso-label';if(d.selected){clazz+=" selected"}
return clazz}).attr("text-anchor","middle").attr("x",function(d,i){return helper.xScale(helper.categoriesData[i])+helper.xScale.rangeBand()/2}).attr("y",function(d){var margin=(this.options.labels.marginBottom>0)?this.options.labels.marginBottom:0;return helper.yScale(d.value)-margin}).html(function(d){return d.label})}},renderXAxis:function(){var helper=this;if(this.xAxis){this.svg.append("g").attr("class","x axis").attr("transform",function(d,i){var x=0;var y=0;if(helper.options.axis.translation.x){x=helper.options.axis.translation.x}
if(helper.options.axis.translation.y=="height"){y+=(helper.height+helper.margin.bottom)}
return("translate("+x+","+y+")")}).call(helper.xAxis)}},wrapLabelText:function(text){text.each(function(){var text=d3.select(this),words=[],word,lineNumber=0,lineHeight=0.8,y=text.attr("y"),dy=parseFloat(text.attr("dy"));if(text.text().match(/\d+/g)!=null)
words[0]=text.text().match(/\d+/g)[0];if(text.text().match(/[a-zA-Z]+/)!=null)
words[1]=text.text().match(/[a-zA-Z]+/)[0];text.text(null);while(word=words.pop()){tspan=text.append("tspan").attr("x",0).attr("y",y).attr("dy",(lineNumber*lineHeight*1.5+dy)+"em");tspan.text(word);lineNumber++}})},renderYAxis:function(isNegative){var helper=this;if(this.options.yAxisLineDisplay){this.svg.append("g").attr("class","y axis perso-grid").attr("transform",function(d,i){var y=typeof helper.options.yAxisTop!='undefined'?helper.options.yAxisTop:0;if(typeof isNegative==='boolean'&&isNegative){y=helper.negativeYAxisTop}
var x=typeof helper.options.horizontalLineLeft!='undefined'?helper.options.horizontalLineLeft:0;return("translate("+helper.getValueByScreenWidth(x)+","+helper.getValueByScreenWidth(y)+")")}).call(helper.yAxis).selectAll(".tick line").attr('x2',function(d,i){var x2=typeof helper.options.horizontalLineWidth!='undefined'?helper.options.horizontalLineWidth:(helper.options.svgWidth||0);return helper.getValueByScreenWidth(x2)})}
if(!this.options.yAxisTextDisplay){this.svg.selectAll(".y.perso-grid .tick text").remove();this.svg.selectAll(".y.perso-grid path").remove()}},renderHorizontalLines:function(y0Scale){var helper=this;var lines=this.svg.append("g").attr("transform","translate("+helper.margin.left*-1+","+0+")").selectAll("g").data(helper.seriesData).enter().append("g").attr("class","perso-chart-line").attr("transform",function(d,i){var y=y1Scale(i)*(i+1);return"translate(0,"+y+")"}).selectAll('.line').data(function(d){return d}).enter().append("line").attr("class","perso-chart-line").attr("x1","0").attr("x2",helper.width).attr("y1",function(d,i){return y0Scale(i)+helper.options.rectangles.paddingBottom}).attr("y2",function(d,i){return y0Scale(i)+helper.options.rectangles.paddingBottom})},renderVerticalLines:function(x0Scale){var helper=this;if(helper.options.drowVerticalLines){var lineMarginLeft=helper.options.lineMarginLeft?helper.options.lineMarginLeft:-30;var lines=this.svg.append("g").attr("transform","translate("+helper.getValueByScreenWidth(lineMarginLeft)+","+helper.getValueByScreenWidth(helper.options.verticalLineTop)+")").selectAll("g").data(helper.seriesData).enter().append("g").attr("class","perso-chart-line").attr("transform",function(d,i){return"translate(0,0)"}).selectAll('.line').data(function(d){return d}).enter().append("line").attr("class","perso-chart-line").attr("y1","0").attr("y2",helper.getValueByScreenWidth(helper.options.lineHeight)).attr("x1",function(d,i){return x0Scale(i)+helper.getValueByScreenWidth(helper.options.rectangles.paddingBottom)}).attr("x2",function(d,i){return x0Scale(i)+helper.getValueByScreenWidth(helper.options.rectangles.paddingBottom)})}},renderGradient:function(){var gradients=this.options.rectangles.gradients;var defWithGradients=this.svg.append("defs");if(gradients){$.each(gradients,function(i,gradient){if(gradient){defWithGradients=defWithGradients.append("linearGradient").attr("id",gradient.id).attr("x1","0").attr("x2","0").attr("y1","0").attr("y2","1");$.each(gradient.stopColors,function(i,stopColor){defWithGradients.append("stop").attr("offset",gradient.offset[i]).attr("stop-color",stopColor)})}})}},renderFilter:function(){var filters=this.options.rectangles.filter;var svgWithFilters=this.svg.selectAll("defs");if(filters){$.each(filters,function(i,filter){if(filter){var filterSvg=svgWithFilters.append("filter").attr("id",filter.id)
filterSvg.append("feGaussianBlur").attr("in",filter.in).attr("stdDeviation",filter.stdDeviation)
filterSvg.append("feOffset").attr("dx",filter.dxOffset).attr("dy",filter.dyOffset)
var feMerge=filterSvg.append("feMerge")
feMerge.append("feMergeNode")
feMerge.append("feMergeNode").attr("in",filter.in)}})}},getValueByScreenWidth:function(value){var screenWidth=$(window).width();if(screenWidth>=this.options.desktopScreenWidth){return value}
else{if(screenWidth<347){return value}else if(screenWidth>=414){return value*this.options.screen.ratio_large}else{return value*this.options.screen.ratio_medium}}}})})(window,window.Personetics=window.Personetics||{},jQuery);(function(window,Personetics,$,undefined){var d3=Personetics.persoD3||window.d3;Personetics.utils=Personetics.utils?Personetics.utils:{};Personetics.utils.d3Helpers=Personetics.utils.d3Helpers?Personetics.utils.d3Helpers:{};Personetics.utils.d3Helpers.MultiVerticalChartHelper=Personetics.utils.d3Helpers.BlockHelperBase.extend({MIN_BAR_HEIGHT:20,prepareChart:function(data,options,handleClick){Personetics.utils.d3Helpers.BlockHelperBase.prototype.prepareChart.call(this,data,options);var helper=this;this.handleClick=handleClick;this.seriesData=data.series;this.categoriesData=data.categories;this.seriesLabelsData=data.seriesLabels;this.series=data.series;this.width=this.getValueByScreenWidth(this.options.svgWidth);this.yScale=d3.scale.linear().range([(this.getValueByScreenWidth(this.options.maxBarHeight)-this.MIN_BAR_HEIGHT),0],.1);this.yAxisScale=d3.scale.linear().range([this.getValueByScreenWidth(this.options.yAxisHeight),0]);this.colorScale=d3.scale.ordinal().rangeRoundBands([0,this.width],.1);this.colors=this.colorScale.range(helper.options.palette);this.colorsLabels=d3.scale.ordinal().rangeRoundBands([0,this.width],.1).range(helper.options.paletteLabels);this.dispatch=d3.dispatch("clickOnMonth");var dataLength=0;this.seriesData.map(function(a){dataLength+=a.length;return a});this.dataLength=dataLength;this.xScale=d3.scale.ordinal().domain(helper.categoriesData).rangeBands([0,this.width]);this.x0Scale=d3.scale.ordinal().domain(d3.range(helper.categoriesData.length)).rangeBands([0,this.width],0);this.xAxis=d3.svg.axis().scale(this.xScale).outerTickSize(0)},renderChart:function(el){var helper=this;this.yScale.domain([0,d3.max(helper.seriesData,function(d){return d3.max(d,function(k){return k.value})})]);this.modifyData();this.svg=this.renderSVGBase(el,"multiVertical");this.renderGradient();this.renderFilter();this.renderMultiVerticalBars();this.renderHiddenRects(this.seriesData);this.renderLabels();this.renderXAxis();this.renderVerticalLines(this.x0Scale)},renderMultiVerticalBars:function(){var helper=this;var mergedData=[].concat.apply([],this.seriesData);this.minValue=d3.min(mergedData,function(d){return d.value||Infinity});this.maxValue=d3.max(mergedData,function(d){return d.value});helper.sortedData=helper.sortData();var blockWithBars=this.svg.append("g").attr("transform",function(data,i){var marginLeft=helper.options.rectangles.marginLeft?helper.options.rectangles.marginLeft:0;return"translate("+marginLeft+","+helper.getValueByScreenWidth(helper.options.barTop)+")"}).selectAll("g").data(helper.sortedData).enter().append("g").style("fill",function(d,i){return helper.colors(i)}).attr("transform",function(d,i){return"translate("+helper.getSeriesTranslateValue(i)+",0)"}).selectAll("rect").data(function(d){return d});blockWithBars.enter().append("rect").attr("class",function(d){var clazz='perso-chart-rect'+' '+d.mode;if(d.selected){clazz+=" selected"}
return clazz}).attr("y",this.getValueByScreenWidth(this.options.maxBarHeight)).attr("height",0).attr("x",function(d,i){return helper.xScale(helper.categoriesData[i])+(helper.width/helper.dataLength)-15}).attr("width",function(d,i){var rectWidth=helper.getValueByScreenWidth(helper.options.rectangles.width);return rectWidth}).attr("rx",function(d){var rx=(helper.options.rectangles.borderRadius.rx)?helper.options.rectangles.borderRadius.rx:"0";return helper.getValueByScreenWidth(rx)}).attr("ry",function(d){var ry=(helper.options.rectangles.borderRadius.ry)?helper.options.rectangles.borderRadius.ry:"0";return helper.getValueByScreenWidth(ry)}).on("click",function(obj,clickedItemIndex){if(typeof helper.handleClick=='function'){helper.handleClick(obj,clickedItemIndex)}});this.MultiVerticalBarsTransition(blockWithBars)},MultiVerticalBarsTransition:function(blockWithBars){var helper=this;blockWithBars.transition().duration(helper.options.rectangles.transition.duration).delay(helper.options.rectangles.transition.delay).attr("y",function(d){return helper.getBarsY(d)}).attr("height",function(d){return helper.getBarsHeight(d)})},getBarsHeight:function(d){var helper=this;var currentValue=Math.abs(d.value);var barHeight=d.value?helper.getValueByScreenWidth(this.options.maxBarHeight)-this.yScale(currentValue):0;d.barHeight=barHeight;return barHeight},getBarsY:function(d){var yValue;if(d.value<0){yValue=this.getValueByScreenWidth(this.options.maxBarHeight)}else{yValue=this.yScale(d.value)}
return yValue},renderLabels:function renderLabels(){var helper=this;helper.sortedData=helper.sortData();if(this.options.labels.drawLabels){var cssClass='perso-label perso-label-fadeIn';if(this.categoriesData.length>=4){cssClass+=" minimize-font"}
var blockWithBars=this.svg.append("g").attr("transform",function(d,i){var transX=helper.width*.14;var transValue=helper.getValueByScreenWidth(helper.options.labelTop);return"translate("+0+","+transValue+")"}).selectAll("g").data(helper.sortedData).enter().append("g").style("fill",function(d,i){return helper.colorsLabels(i)}).attr("transform",function(d,i){var transValue=helper.getValueByScreenWidth(helper.options.nextLabelTop)*(!i);return"translate("+helper.getValueByScreenWidth(helper.options.labels.right)+","+transValue+")"}).selectAll("text").data(function(d){return d});blockWithBars.enter().append("text").attr("text-anchor","middle").attr("class",function(d){var clazz=cssClass+' '+d.mode;if(d.selected){clazz+=" selected"}
return clazz}).attr("x",function(d,i){return helper.xScale(helper.categoriesData[i])+(helper.width/helper.dataLength)}).attr("y",function(d,i,j){var maxBarHeightInMonth=helper.getMaxBarHeightInMonth(helper.categoriesData[i]);var yValue=helper.yScale(0)-maxBarHeightInMonth;return(yValue)}).attr("dy","0.4em");$.each(helper.seriesLabelsData,function(modeIndex,mode){var amounts=helper.svg.selectAll('.perso-label.'+mode);var tspans=amounts.append('tspan');$.each(tspans[0],function(index,tspan){var attrs=$(helper.seriesData[modeIndex][index].label)[0].attributes;$.each(attrs,function(j,attr){tspan.setAttribute(attr.name,attr.value)});$(tspan).attr("perso-index",index);var totalAmountChildren=$($(helper.seriesData[modeIndex][index].label)[0]).children();$.each(totalAmountChildren,function(i,node){var svgTspan=helper.svg.select('[perso-index="'+index+'"]');var innerTspan=svgTspan.append('tspan').text($(node).text());var attrs=node.attributes;$.each(attrs,function(j,attr){innerTspan.attr(attr.name,attr.value)})})})})}},renderXAxis:function(){var helper=this;if(this.xAxis){var axisTick=this.svg.append("g").attr("class","x axis").attr("transform",function(d,i){var x=0;var y=0;if(helper.options.axis.translation.x){x=helper.options.axis.translation.x}
y=helper.getValueByScreenWidth(helper.options.xAxiaTop);return("translate("+x+","+y+")")}).call(helper.xAxis).selectAll(".tick text").attr("y","0").data(this.seriesData[0]).attr("class",function(d,i){var clazz="perso-xAxis-label";if(d.selected){clazz+=" selected"}
if(helper.seriesData[1][i].value===0&&helper.seriesData[0][i].value===0&&helper.seriesData[1][i].category===d.category&&helper.seriesData[0][i].category===d.category){clazz+=" perso-unclickable"}
return clazz}).on("click",function(obj,clickedItemIndex){if((helper.seriesData[1][clickedItemIndex].value!==0||helper.seriesData[0][clickedItemIndex].value!==0)&&helper.seriesData[1][clickedItemIndex].category===obj.category&&helper.seriesData[0][clickedItemIndex].category===obj.category){if(typeof helper.handleClick=='function'){helper.handleClick(obj,clickedItemIndex)}}})}},renderHiddenRects:function(seriesData){var helper=this;var hiddenRectWidth=helper.getValueByScreenWidth(helper.options.rectangles.width*2+helper.options.rectangles.paddingRight);var hiddenRectHeight=helper.getValueByScreenWidth(helper.options.maxBarHeight);helper.seriesData=seriesData;var hiddenRects=this.svg.append('g').attr('class','perso-hidden-rects').attr("transform",function(data,i){var marginLeft=helper.options.rectangles.marginLeft?helper.options.rectangles.marginLeft:0;return"translate("+marginLeft+","+helper.getValueByScreenWidth(helper.options.barTop)+")"}).selectAll("g").data(this.seriesData[0]);hiddenRects.enter().append('rect').attr("class",function(d,i){var clazz='hidden-rect';if(helper.seriesData[1][i].value===0&&helper.seriesData[0][i].value===0&&helper.seriesData[1][i].category===d.category&&helper.seriesData[0][i].category===d.category){clazz+=" perso-unclickable"}
return clazz}).attr("height",function(d,i){return hiddenRectHeight}).attr('width',hiddenRectWidth).attr("x",function(d,i){return helper.xScale(helper.categoriesData[i])+(helper.width/helper.dataLength)-15}).attr('fill-opacity',0).on("click",function(obj,clickedItemIndex){if((helper.seriesData[1][clickedItemIndex].value!==0||helper.seriesData[0][clickedItemIndex].value!==0)&&helper.seriesData[1][clickedItemIndex].category===obj.category&&helper.seriesData[0][clickedItemIndex].category===obj.category){if(typeof helper.handleClick=='function'){helper.handleClick(obj,clickedItemIndex)}}})},getMaxBarHeightInMonth:function(category){var helper=this;var maxValue=0;if(this.series&&this.series.length>0){$.each(helper.seriesData,function(i,series){$.each(series,function(j,item){if(helper.categoriesData[j]==category&&Math.abs(item.barHeight)>maxValue){maxValue=Math.abs(item.barHeight)}})})}
return maxValue},sortData:function(){var helper=this;if(this.seriesData){var reversedLabels=this.seriesLabelsData.slice().reverse();var sortedData=[];reversedLabels.forEach(function(series,i){sortedData[reversedLabels.indexOf(helper.seriesLabelsData[i])]=helper.seriesData[i]})}
return sortedData},modifyData:function(){var helper=this;if(this.seriesData){var series=this.seriesLabelsData;$.each(series,function(i){$.each(helper.seriesData[i],function(k,seriesObj){seriesObj.mode=series[i]})})}},getSeriesTranslateValue:function(index){var paddingRight=this.options.rectangles.paddingRight?this.options.rectangles.paddingRight:0;return this.getValueByScreenWidth(paddingRight)*index}})})(window,window.Personetics=window.Personetics||{},jQuery);(function(window,Personetics,$,undefined){var d3=Personetics.persoD3||window.d3;Personetics.utils=Personetics.utils?Personetics.utils:{};Personetics.utils.d3Helpers=Personetics.utils.d3Helpers?Personetics.utils.d3Helpers:{};Personetics.utils.d3Helpers.VerticalChartHelper=Personetics.utils.d3Helpers.BlockHelperBase.extend({MIN_BAR_HEIGHT:20,prepareChart:function(data,options,handleClick){Personetics.utils.d3Helpers.BlockHelperBase.prototype.prepareChart.call(this,data,options);var helper=this;this.handleClick=handleClick;this.seriesData=data.series;this.categoriesData=data.categories;this.width=this.getValueByScreenWidth(this.options.svgWidth);this.negativeBarTop=this.options.negativeBarTop||this.options.svgHeight;this.negativeYAxisTop=this.options.negativeYAxisTop||this.options.svgHeight;var rect=this.options.rectangles;var maxCategories=(this.width+this.getValueByScreenWidth(rect.space))/this.getValueByScreenWidth(rect.width+rect.space);this.numOfBars=this.categoriesData.length>maxCategories?Math.floor(maxCategories):this.categoriesData.length;this.calcLeft=(this.width-(this.numOfBars+1)*this.getValueByScreenWidth(rect.width+rect.space))/2;var accessCat=this.accessibilityCategories;if(Personetics.processor.PStoryConfig.isRtl()){var slice=this.categoriesData.length-(this.categoriesData.length-this.numOfBars);this.categoriesData=this.categoriesData.slice(0,slice);this.seriesData=this.seriesData.slice(0,slice)}
else{this.categoriesData=this.categoriesData.slice(this.categoriesData.length-this.numOfBars,this.categoriesData.length);this.seriesData=this.seriesData.slice(this.categoriesData.length-this.numOfBars,this.categoriesData.length)}
this.xScale=d3.scale.ordinal().rangeRoundBands([0,(this.numOfBars+1)*this.getValueByScreenWidth(rect.width+rect.space)],1);this.yScale=d3.scale.linear().range([(this.getValueByScreenWidth(this.options.maxBarHeight)-this.MIN_BAR_HEIGHT),0]);this.xAxis=d3.svg.axis().scale(this.xScale).outerTickSize(0)
this.yAxisScale=d3.scale.linear().range([this.getValueByScreenWidth(this.options.yAxisHeight),0]);this.yAxis=d3.svg.axis().scale(this.yAxisScale).orient("left").innerTickSize(-this.width).outerTickSize(0).ticks(5)},renderChart:function(el){var helper=this;var cfg=this.config;this.minVal=0;this.maxVal=d3.max(helper.seriesData,function(d){return Math.abs(parseFloat(d.value))});this.xScale.domain(helper.categoriesData.map(function(d){return d}));this.yScale.domain([this.minVal,this.maxVal]);this.hasMinVals=!1;this.seriesMinVal=d3.min(helper.seriesData,function(d){return parseFloat(d.value)});if(this.seriesMinVal<0){this.hasMinVals=!0;this.maxPositiveVal=d3.max(helper.seriesData,function(d){return parseFloat(d.value)});this.maxNegativeBarHeight=this.options.maxBarHeight-this.yScale(Math.abs(this.seriesMinVal));this.maxPositiveBarHeight=this.options.maxBarHeight-this.yScale(this.maxPositiveVal)}
this.svg=this.renderSVGBase(el);this.renderGradient();this.renderFilter();this.renderYAxis();if(this.hasMinVals)
this.renderYAxis(!0);if(this.options.hasOwnProperty('isDesktop')&&this.options.isDesktop){this.renderAccessibilityHiddenRects()}
this.renderVerticalBars();this.renderLabels();this.renderXAxis()},renderSVGBase:function(el){var helper=this;var height=helper.getValueByScreenWidth(helper.options.svgHeight);var y=0;if(helper.hasMinVals){height=height+helper.getValueByScreenWidth(this.maxNegativeBarHeight+this.options.barTop);y=helper.getValueByScreenWidth(helper.maxPositiveBarHeight-helper.options.maxBarHeight)}
return(d3.select(el.get(0)).append("svg").attr("class","perso-svg-chart-container").attr("width",helper.width).attr("height",height+y).append("g").attr('class','perso-svg-container-group').attr("transform",function(){return"translate(0,"+y+")"}))},renderVerticalBars:function(){var helper=this;helper.minAbsValue=d3.min(helper.seriesData,function(d){return Math.abs(d.value)||Infinity});helper.maxValue=helper.maxVal;helper.minValue=helper.minVal;var rectSpace=helper.getValueByScreenWidth(helper.options.rectangles.space||30);var rectWidth=helper.getValueByScreenWidth(helper.options.rectangles.width);var left=(helper.width-(helper.numOfBars*rectWidth+(helper.numOfBars-1)*rectSpace))/2;var bars=this.svg.append("g").attr("transform",function(){return("translate("+left+","+helper.getValueByScreenWidth(helper.options.barTop)+")")}).selectAll("rect").data(helper.seriesData).enter().append("rect").attr("class",function(d){var clazz="perso-bar";if(d.selected){clazz+=" selected"}
return clazz}).attr("x",function(d,i){return i*(rectSpace+rectWidth)}).attr("width",function(d,i){return rectWidth}).attr("y",function(d,i){if(d.value<0)
return helper.getValueByScreenWidth(helper.negativeBarTop-helper.options.barTop);return helper.getValueByScreenWidth(helper.options.maxBarHeight)}).attr("height",0).attr("rx",function(d){var rx=(helper.options.rectangles.borderRadius.rx)?helper.options.rectangles.borderRadius.rx:"0";return helper.getValueByScreenWidth(rx)}).attr("ry",function(d){var ry=(helper.options.rectangles.borderRadius.ry)?helper.options.rectangles.borderRadius.ry:"0";return helper.getValueByScreenWidth(ry)}).on("click",function(obj,clickedItemIndex){if(typeof helper.handleClick=='function'){helper.handleClick(obj,clickedItemIndex)}})
this.barsTransition(bars)},barsTransition:function(bars){var helper=this;bars.transition().duration(helper.options.rectangles.transition.duration).delay(helper.options.rectangles.transition.delay).attr("y",function(d){return helper.getBarsY(d)}).attr("height",function(d){return helper.getBarsHeight(d)})},getBarsHeight:function(d){var currentValue=Math.abs(d.value);var barHeight=d.value?this.getValueByScreenWidth(this.options.maxBarHeight)-this.yScale(currentValue):0;d.barHeight=barHeight;return barHeight},getBarsY:function(d){var yValue;if(d.value<0){yValue=this.getValueByScreenWidth(this.negativeBarTop-this.options.barTop)}else{yValue=this.yScale(d.value)}
return yValue},renderLabels:function(){var cssClass="perso-label perso-label-fadeIn";var helper=this;if(helper.seriesData.length>=6){cssClass+=" minimize-font"}
if(this.options.labels.drawLabels){this.svg.append("g").attr("transform",function(){var y=helper.options.labelTop?helper.getValueByScreenWidth(helper.options.labelTop):0;return("translate("+helper.calcLeft+","+y+")")}).selectAll().data(helper.seriesData).enter().append("text").attr("class",function(d){var clazz=cssClass;if(d.selected){clazz+=" selected"}
return clazz}).attr("text-anchor","middle").attr("x",function(d,i){return(helper.xScale(helper.categoriesData[i]))}).attr("y",function(d){return helper.getLabelsY(d)}).attr("dy",function(d){if(d.value<0)
return"1em";return 0});var amounts=this.svg.selectAll('.perso-label');var tspans=amounts.append('tspan');$.each(tspans[0],function(index,tspan){var attrs=$(helper.seriesData[index].label)[0].attributes;$.each(attrs,function(j,attr){tspan.setAttribute(attr.name,attr.value)});$(tspan).attr("perso-index",index);var totalAmountChildren=$($(helper.seriesData[index].label)[0]).children();$.each(totalAmountChildren,function(i,node){var svgTspan=helper.svg.select('[perso-index="'+index+'"]');var innerTspan=svgTspan.append('tspan').text($(node).text());var attrs=node.attributes;$.each(attrs,function(j,attr){innerTspan.attr(attr.name,attr.value)})})})}},getLabelsY:function(d){var helper=this;var y;if(d.value<0){y=helper.getValueByScreenWidth(this.options.barTop-this.options.labelTop+this.negativeBarTop-this.options.labelTop)+d.barHeight}
else y=this.yScale(0)-d.barHeight+this.MIN_BAR_HEIGHT;return y},renderXAxis:function(){var helper=this;if(this.xAxis){this.svg.append("g").attr("class","x axis").attr("transform",function(d,i){return("translate("+helper.calcLeft+","+helper.getValueByScreenWidth(helper.options.xAxisTop)+")")}).call(helper.xAxis).selectAll(".tick text").data(helper.seriesData).attr("y","0").attr("class",function(d,i){var clazz="perso-xAxis-label";if(d.selected){clazz+=" selected"}
if(d.value===0){clazz+=" perso-unclickable"}
return clazz})}},renderAccessibilityHiddenRects:function(){var helper=this;var hiddenRectWidth=helper.getValueByScreenWidth((helper.options.rectangles.width*3)+(helper.options.rectangles.paddingRight||0));var hiddenRectHeight=helper.getValueByScreenWidth(helper.options.svgHeight-(helper.options.labelTop||0));var rectSpace=helper.getValueByScreenWidth(helper.options.rectangles.space||30);var rectWidth=helper.getValueByScreenWidth(helper.options.rectangles.width);var left=(helper.width-(helper.numOfBars*rectWidth+(helper.numOfBars-1)*rectSpace))/2;var reversedData=this.seriesData.slice().reverse();var hiddenRects=this.svg.append('g').attr('class','perso-hidden-rects').attr("transform",function(data,i){var marginLeft=helper.options.rectangles.marginLeft?helper.options.rectangles.marginLeft:0;return"translate("+left+","+helper.getValueByScreenWidth(helper.options.barTop-helper.options.yAxisTop)+")"}).selectAll("g").data(reversedData);hiddenRects.enter().append('rect').attr("class",function(d){var clazz='access-hidden-rect';if(d.value===0){clazz+=" perso-unclickable"}
return clazz}).attr("height",function(d,i){return hiddenRectHeight}).attr('width',hiddenRectWidth).attr("x",function(d,i){var lastItemIndex=helper.seriesData.length-1;return((lastItemIndex-i)*(rectSpace+rectWidth)-hiddenRectWidth/3)}).attr('fill-opacity',0)}})})(window,window.Personetics=window.Personetics||{},jQuery);(function(window,Personetics,$,undefined){var d3=Personetics.persoD3||window.d3;Personetics.utils=Personetics.utils?Personetics.utils:{};Personetics.utils.d3Helpers=Personetics.utils.d3Helpers?Personetics.utils.d3Helpers:{};Personetics.utils.d3Helpers.MultiHorizontalChartHelper=Base.extend({localConfigs:{barFillPercent:0.55},prepareMultiHorizontalChart:function(block,el){this.prepareChart(block,el);this.maxDataArraLength=this.getMaxDataArray(block.layoutInstructions.series);this.height=block.options.chartHeight||(this.maxDataArraLength*block.layoutInstructions.series.length*(this.getValueByScreenWidth(block.options.rectangles.height)+this.getValueByScreenWidth(this.options.rectangles.paddingBottom)*2)+block.layoutInstructions.seriesLabels.length*this.options.rectangles.seriesPadding/2);this.localConfigs.barFillPercent=this.options.rectangles.barFillPercent?this.options.rectangles.barFillPercent:this.localConfigs.barFillPercent;this.xScale=d3.scale.linear().range([0,this.width*this.localConfigs.barFillPercent]);this.colorScale=d3.scale.ordinal().rangeRoundBands([0,this.width],.1);var palette=block.defaultConfig.barGraphPalette;var paletteLabels=block.defaultConfig.barGraphLabelsPalette;this.colors=this.colorScale.range(palette);this.colorsLabels=d3.scale.ordinal().rangeRoundBands([0,this.width],.1).range(paletteLabels);this.y0Scale=d3.scale.ordinal().domain(d3.range(block.layoutInstructions.categories.length)).rangeBands([this.height,0],0.05);this.y1Scale=d3.scale.ordinal().domain(d3.range(block.layoutInstructions.series.length)).rangeBands([this.y0Scale.rangeBand(),0],0.05);this.y2Scale=d3.scale.ordinal().domain(block.layoutInstructions.categories).rangeBands([0,this.height]);this.xAxis=d3.svg.axis().scale(this.xScale).orient("bottom");this.yAxis=d3.svg.axis().scale(this.y2Scale).orient("right")},renderMultiHorizontalChart:function(block,el,data){var cfg=block.config;var xScale=this.xScale;var y0Scale=this.y0Scale;var y1Scale=this.y1Scale;var y2Scale=this.y2Scale;xScale.domain([0,d3.max(data.series,function(d){return d3.max(d,function(k){return k.value})})]);this.svg=this.renderSVGBase(el,"multiHorizontal");this.renderGradient();this.renderFilter();this.renderMultiHorizontalBars(block,data,xScale,y1Scale,y0Scale);this.renderHorizontalLines(data,xScale,y0Scale,y1Scale);this.renderLabels(data,xScale,y0Scale,y1Scale);this.renderYAxis()},renderSVGBase:function(el,clazz){var helper=this;if(!clazz){clazz=''}
return(d3.select(el.get(0)).append("svg").attr("focusable",!1).attr("class","perso-svg-chart-container "+clazz).attr("width",helper.width).attr("height",helper.height).append("g").attr("transform","translate("+helper.getValueByScreenWidth(helper.margin.left)+","+helper.getValueByScreenWidth(helper.margin.top)+")"))},renderMultiHorizontalBars:function(block,data,xScale,y1Scale,y0Scale){var inOut=["Out","In"];var helper=this
var mergedData=[].concat.apply([],data.series);helper.minValue=d3.min(mergedData,function(d){return d.value||Infinity});helper.maxValue=d3.max(mergedData,function(d){return d.value});var blockWithBars=this.svg.append("g").attr("transform",function(d,i){var yValue=helper.getValueByScreenWidth(helper.options.rectangles.paddingTop);var xValue=helper.getValueByScreenWidth(helper.options.rectangles.paddingLeft);return"translate("+xValue+","+yValue+")"}).attr("width",helper.width).selectAll("g").data(data.series).enter().append("g").style("fill",function(d,i){return helper.colors(i)}).attr("class",function(d,i){return inOut[i]}).attr("transform",function(d,i){var screenWidth=screen.width;var y=helper.options.rectangles.paddingBottom;y=y1Scale(i)*(i+1)+helper.getValueByScreenWidth(y)*(i+1);return"translate(0,"+y+")"}).selectAll("rect").data(function(d){return d});blockWithBars.enter().append("rect").attr("class",function(d){var clazz='perso-chart-rect';if(d.selected){clazz+=" selected"}
return clazz}).attr("height",function(d,i){var rectHeight=helper.options.rectangles.height;return helper.getValueByScreenWidth(rectHeight)}).attr("y",function(d,i){return y0Scale(i)}).attr("width",1).attr("rx",function(d){var rx=(helper.options.rectangles.borderRadius.rx)?helper.options.rectangles.borderRadius.rx:"0";return helper.getValueByScreenWidth(rx)}).attr("ry",function(d){var ry=(helper.options.rectangles.borderRadius.ry)?helper.options.rectangles.borderRadius.ry:"0";return helper.getValueByScreenWidth(ry)}).on("click",function(obj,clickedItemIndex){if(block)
block.handleClick(obj,clickedItemIndex)});blockWithBars.transition().duration(1000).delay(500).attr("width",function(d){var maxBarWidth=helper.width*0.4;var minBarWidth=maxBarWidth*.166;var minValueInArray=helper.minValue;var maxValueInData=helper.maxValue
var currentValue=d.value;var currentBarWidth=xScale(currentValue);var rectWidth=minBarWidth;if((currentValue/maxValueInData)>0.166||currentValue>minValueInArray){rectWidth+=currentBarWidth}else if(currentValue==0){rectWidth=currentBarWidth}
return rectWidth})},renderLabels:function(data,xScale,y0Scale,y1Scale){var helper=this;if(this.options.drawLabels){var blockWithdata=this.svg.append("g").attr("transform",function(d,i){var yValue=helper.getValueByScreenWidth(helper.options.rectangles.paddingTop);var xValue=helper.getValueByScreenWidth(helper.options.rectangles.paddingLeft);return"translate("+xValue+","+yValue+")"}).attr("width",helper.width).selectAll("g").data(data.series).enter().append("g").attr("transform",function(d,i){var y=helper.options.rectangles.paddingBottom;y=y1Scale(i)*(i+1)+helper.getValueByScreenWidth(y)*(i+1);return"translate(-7,"+y+")"}).selectAll("text").data(function(d){return d});blockWithdata.enter().append("text").attr("class",function(d){var clazz='perso-label perso-label-fadeIn';if(d.selected){clazz+=" selected"}
return clazz}).attr("text-anchor","start").style("fill",function(d,i,j){return helper.colorsLabels(j)}).attr("x",function(d){var paddingLeft=(helper.options.labels.paddingLeft)?helper.options.labels.paddingLeft:"0";var xValue=xScale(d.value)+helper.getValueByScreenWidth(paddingLeft);return xValue}).attr("y",function(d,i){return y0Scale(i)+helper.options.rectangles.height/2}).attr("dy","0.4em").html(function(d){return d.label})}},renderYAxis:function(){var helper=this;if(this.yAxis){var transValue=helper.getValueByScreenWidth(this.options.axis.yAxis.transValue);this.svg.append("g").attr("transform","translate("+helper.options.axis.yAxis.paddingRight*-1+","+transValue+")").attr("class","y axis").call(helper.yAxis).selectAll(".tick text").call(helper.wrapLabelText,screen.width*.23)}
if(this.options.axis.yAxis.hide){this.svg.selectAll(".y .tick text").remove();this.svg.selectAll(".y path").remove()}},getMaxDataArray:function(data){var maxLength=0;if(data.length){$.each(data,function(i,array){if(array.length>maxLength){maxLength=array.length}})}
return maxLength},wrapLabelText:function(text,width){text.each(function(){var text=d3.select(this);var yValue=0;var lines=1;if(this.getComputedTextLength()>width){lines=2;yValue=-5}
var words=text.text().split(/\s+/).reverse(),word,line=[],lineNumber=0,lineHeight=.95,y=text.attr("y"),dy=parseFloat(text.attr("dy")),tspan=text.text(null).append("tspan").attr("x",9).attr("y",yValue*lines).attr("dy",dy+"em");while(word=words.pop()){line.push(word);tspan.text(line.join(" "));if(tspan.node().getComputedTextLength()>width){line.pop();tspan.text(line.join(" "));line=[word];tspan=text.append("tspan").attr("x",9).attr("y",yValue*lines).attr("dy",(++lineNumber*lineHeight*1.5)+dy+"em").text(word)}}})},prepareChart:function(block,el){this.options=block.options;this.totalWidth=el.width();this.margin={top:this.getValueByScreenWidth(this.options.margin.top),right:this.getValueByScreenWidth(this.options.margin.right),bottom:this.getValueByScreenWidth(this.options.margin.bottom),left:this.getValueByScreenWidth(this.options.margin.left)};this.width=el.width()-this.margin.left-this.margin.right},renderHorizontalLines:function(data,xScale,y0Scale,y1Scale){var helper=this;var lines=this.svg.append("g").attr("transform","translate("+helper.margin.left*-1+","+0+")").selectAll("g").data(data.series).enter().append("g").attr("class","perso-chart-line").attr("transform",function(d,i){var y=y1Scale(i)*(i+1);return"translate(0,"+y+")"}).selectAll('.line').data(function(d){return d}).enter().append("line").attr("class","perso-chart-line").attr("x1","0").attr("x2",helper.totalWidth).attr("y1",function(d,i){return y0Scale(i)}).attr("y2",function(d,i){return y0Scale(i)})},renderGradient:function(){var gradients=this.options.rectangles.gradients;var defWithGradients=this.svg.append("defs");if(gradients){$.each(gradients,function(i,gradient){if(gradient){defWithGradients=defWithGradients.append("linearGradient").attr("id",gradient.id).attr("x1","0").attr("x2","0").attr("y1","0").attr("y2","1");defWithGradients.append("stop").attr("offset",gradient.offset1).attr("stop-color",gradient.stopColor1);defWithGradients.append("stop").attr("offset",gradient.offset2).attr("stop-color",gradient.stopColor2)}})}},renderFilter:function(){var filters=this.options.rectangles.filter;var svgWithFilters=this.svg.selectAll("defs");if(filters){$.each(filters,function(i,filter){if(filter){var filterSvg=svgWithFilters.append("filter").attr("id",filter.id)
filterSvg.append("feGaussianBlur").attr("in",filter.in).attr("stdDeviation",filter.stdDeviation)
filterSvg.append("feOffset").attr("dx",filter.dxOffset).attr("dy",filter.dyOffset)
var feMerge=filterSvg.append("feMerge")
feMerge.append("feMergeNode")
feMerge.append("feMergeNode").attr("in",filter.in)}})}},getValueByScreenWidth:function(value){var screenWidth=$(window).width();if(screenWidth>=790){return value}
else{if(screenWidth<347){return value}else if(screenWidth>=414){return value*this.options.screen.ratio_large}else{return value*this.options.screen.ratio_medium}}}})})(window,window.Personetics=window.Personetics||{},jQuery);(function(window,Personetics,$,undefined){var d3=Personetics.persoD3||window.d3;Personetics.utils=Personetics.utils?Personetics.utils:{};Personetics.utils.d3Helpers=Personetics.utils.d3Helpers?Personetics.utils.d3Helpers:{};Personetics.utils.d3Helpers.PinGraphChartHelper=Personetics.utils.d3Helpers.VerticalChartHelper.extend({})})(window,window.Personetics=window.Personetics||{},jQuery);(function(window,Personetics,$,undefined){Personetics.utils=Personetics.utils?Personetics.utils:{};Personetics.utils.d3Helpers=Personetics.utils.d3Helpers?Personetics.utils.d3Helpers:{};Personetics.utils.d3Helpers.VerticalChartHelperProduct=Personetics.utils.d3Helpers.VerticalChartHelper.extend({renderXAxis:function(){var helper=this;if(this.xAxis){this.svg.append("g").attr("class","x axis").attr("transform",function(d,i){var y=helper.getValueByScreenWidth(helper.options.xAxisTop);return("translate("+helper.calcLeft+","+y+")")}).call(helper.xAxis).selectAll(".tick text").data(helper.seriesData).attr("y","0").attr("class",function(d){var clazz="perso-xAxis-label";if(d.selected){clazz+=" selected"}
return clazz}).on("click",function(obj,clickedItemIndex){if(typeof helper.handleClick=='function')
helper.handleClick(obj,clickedItemIndex)})}}})})(window,window.Personetics=window.Personetics||{},jQuery);(function(window,Personetics,$,undefined){Personetics.utils=Personetics.utils?Personetics.utils:{};Personetics.utils.d3Helpers=Personetics.utils.d3Helpers?Personetics.utils.d3Helpers:{};Personetics.utils.d3Helpers.PinGraphChartHelperProduct=Personetics.utils.d3Helpers.VerticalChartHelperProduct.extend({})})(window,window.Personetics=window.Personetics||{},jQuery);(function(window,Personetics,$,undefined){var d3=Personetics.persoD3||window.d3;Personetics.utils=Personetics.utils?Personetics.utils:{};Personetics.utils.d3Helpers=Personetics.utils.d3Helpers?Personetics.utils.d3Helpers:{};Personetics.utils.d3Helpers.MultiVerticalChartHelperDesktop=Personetics.utils.d3Helpers.MultiVerticalChartHelper.extend({prepareChart:function(data,options,handleClick){Personetics.utils.d3Helpers.MultiVerticalChartHelper.prototype.prepareChart.call(this,data,options,handleClick);this.yAxis=d3.svg.axis().scale(this.yAxisScale).orient("left").innerTickSize(-this.width).outerTickSize(0).ticks(5)},renderChart:function(el){var helper=this;this.yScale.domain([0,d3.max(helper.seriesData,function(d){return d3.max(d,function(k){return k.value})})]);this.modifyData();this.svg=this.renderSVGBase(el,"multiVertical");this.renderGradient();this.renderFilter();this.renderYAxis();this.renderAccessibilityHiddenRects();this.renderMultiVerticalBars();this.renderHiddenRects(this.seriesData);this.renderLabels();this.renderXAxis();this.renderVerticalLines(this.x0Scale)},renderAccessibilityHiddenRects:function(){var helper=this;var hiddenRectWidth=helper.getValueByScreenWidth((helper.options.rectangles.width*3)+(helper.options.rectangles.paddingRight||0));var hiddenRectHeight=helper.getValueByScreenWidth(helper.options.svgHeight-(helper.options.labelTop||0));var reversedData=this.seriesData[0].slice().reverse();var hiddenRects=this.svg.append('g').attr('class','perso-hidden-rects').attr("transform",function(data,i){return"translate("+helper.options.accessHiddenRectMarginLeft+","+helper.getValueByScreenWidth(helper.options.accessHiddenRectMarginTop)+")"}).selectAll("g").data(reversedData);hiddenRects.enter().append('rect').attr('class','access-hidden-rect').attr("height",function(d,i){return hiddenRectHeight}).attr('width',hiddenRectWidth).attr("x",function(d,i){var lastItemIndex=helper.series[0].length-1
return(helper.xScale(helper.categoriesData[lastItemIndex-i])+(helper.width/helper.dataLength)-15)-hiddenRectWidth/4}).attr('fill-opacity',0)},renderSVGBase:function(el,clazz){var helper=this;if(!clazz){clazz=''}
this.options.chart=this.options.chart||{};return(d3.select(el.get(0)).append("svg").attr("class","perso-svg-chart-container "+clazz).attr("width",helper.width).attr("height",helper.options.svgHeight).append("g").attr("transform","translate("+this.options.chart.transX+","+helper.getValueByScreenWidth(this.options.chart.transY)+")"))},})})(window,window.Personetics=window.Personetics||{},jQuery);(function(window,Personetics,$,undefined){Personetics.utils.d3Helpers=Personetics.utils.d3Helpers||{};Personetics.utils.d3Helpers.VerticalChartHelperCiti=Personetics.utils.d3Helpers.VerticalChartHelperProduct.extend({barsTransition:function(bars){var helper=this;bars.transition().duration(helper.options.rectangles.transition.duration).delay(helper.options.rectangles.transition.delay).attr("y",function(d){return helper.getBarsY(d)}).attr("height",function(d){return helper.getBarsHeight(d)}).each("end",function(d){if(typeof helper.appendTooltip=="function"){helper.appendTooltip()}})},prepareChart:function(data,options,handleClick,appendTooltip){Personetics.utils.d3Helpers.VerticalChartHelperProduct.prototype.prepareChart.call(this,data,options,handleClick);this.appendTooltip=appendTooltip}})})(window,window.Personetics=window.Personetics||{},jQuery);(function(window,Personetics,$,undefined){Personetics.utils=Personetics.utils||{};Personetics.utils.d3Helpers.PinGraphChartHelperCiti=Personetics.utils.d3Helpers.VerticalChartHelperCiti.extend({renderXAxis:function(data,block){var helper=this;if(this.xAxis){this.svg.append("g").attr("class","x axis").attr("transform",function(d,i){var y=helper.getValueByScreenWidth(helper.options.xAxisTop);return("translate("+helper.calcLeft+","+y+")")}).call(helper.xAxis).selectAll(".tick text").data(helper.seriesData).attr("class",function(d){var clazz="perso-xAxis-label";if(d.selected||d.highlight){clazz+=" selected"}
return clazz}).call(helper.wrapLabelText).on("click",function(obj,clickedItemIndex){if(typeof helper.handleClick=='function')
helper.handleClick(obj,clickedItemIndex)})}}})})(window,window.Personetics=window.Personetics||{},jQuery);(function(window,Personetics,$,undefined){Personetics.utils=Personetics.utils||{};Personetics.utils.d3Helpers.MultiVerticalChartHelperCiti=Personetics.utils.d3Helpers.MultiVerticalChartHelperDesktop.extend({MultiVerticalBarsTransition:function(blockWithBars,block,data,yScale,minValue,maxValue){var helper=this;blockWithBars.transition().duration(helper.options.rectangles.transition.duration).delay(helper.options.rectangles.transition.delay).attr("y",function(d){return helper.getBarsY(d,block,data,yScale,helper.minValue,helper.maxValue)}).attr("height",function(d){return helper.getBarsHeight(d,block,data,yScale,helper.minValue,helper.maxValue)}).each("end",function(d){block.appendTooltip()})}})})(window,window.Personetics=window.Personetics||{},jQuery);(function(window,Personetics,$,undefined){Personetics.story=Personetics.story||{};var keyCode={"Space":32,"Enter":13,"LeftArrow":37,"RightArrow":39,"UpArrow":38,"DownArrow":40};Personetics.story.AccountSelectorBlockProductDesktop=Personetics.story.AccountSelectorBlockProduct.extend({beforeRender:function(el,layoutInstructions){this.animationEnd=!0;Personetics.story.AccountSelectorBlockProduct.prototype.beforeRender.call(this,el,layoutInstructions)},prepareCarouselParam:function prepareCarouselParam(){var me=this;var params=Personetics.story.AccountSelectorBlockProduct.prototype.prepareCarouselParam.call(this);params.updateDotsForAccessibility=this.updateDotsForAccessibility;params.isDesktop=!0;params.onAnimationEnd=function()
{me.animationEnd=!0};return params},updateDotsForAccessibility:function(dotsWrapper,id){dotsWrapper.attr("aria-labelledby","perso-accessibility-read-"+id);if(!!window.MSInputMethodContext&&!!document.documentMode){dotsWrapper.blur();dotsWrapper.focus()}},putFocusAccessibility:function putFocusAccessibility(elementForFocus){},onChooseAccountClick:function onChooseAccountClick(target){Personetics.story.AccountSelectorBlockProduct.prototype.onChooseAccountClick.call(this,target)},optionHeaderKeydownEvent:function optionHeaderClickEvent(e){if([keyCode.Space,keyCode.Enter].indexOf(e.which)!==-1)
{this.optionHeaderClickEvent(e);var elem;var target=$(e.target);if(target.attr("data-all")==="true"||target.parent().attr("data-all")==="true"){elem=$("#allAccountHelper")}else{elem=$("#chooseAccountHelper");elem.attr("aria-labelledby",$(".carousel-index-wrapper").attr("aria-labelledby"))}
elem.addClass("pstory-header-button");elem.attr("tabindex","0");elem.focus();e.preventDefault();e.stopImmediatePropagation()}},optionCarouselDotKeydownEvent:function optionHeaderClickEvent(e){if(this.animationEnd){if([keyCode.RightArrow,keyCode.DownArrow].indexOf(e.which)!==-1){this.animationEnd=!1;this.carouselAnimation.onSwipe("left");return!1}else if([keyCode.LeftArrow,keyCode.UpArrow].indexOf(e.which)!==-1){this.animationEnd=!1;this.carouselAnimation.onSwipe("right");return!1}}else{return!1}
if([keyCode.Space].indexOf(e.which)!==-1)
{e.preventDefault();e.stopImmediatePropagation()}},bindEvents:function bindEvents(){Personetics.story.AccountSelectorBlockProduct.prototype.bindEvents.call(this);Personetics.utils.accessibility.trackFocus(this.frameEl);this.frameEl.find(".pstory-header-button").bind("keypress",Personetics.bind(this,this.optionHeaderKeydownEvent));this.frameEl.find(".carousel-index-wrapper").bind("keydown",Personetics.bind(this,this.optionCarouselDotKeydownEvent))},afterRender:function afterRender(el){Personetics.story.AccountSelectorBlockProduct.prototype.afterRender.call(this,el);var carouselItem=el.find(".carousel-inner-wrapper .carousel-item");if(carouselItem.length>1){this.frameEl.find(".carousel-index-wrapper").attr("tabindex","0")}else{this.frameEl.find(".carousel-index-wrapper").removeAttr("tabindex")}
if(this.showHeaderTabs){this.addAccessibilityTabsHelper()}
carouselItem.each(function()
{var element=$(this);element.find(".perso-bold").attr("id","perso-bold"+element.attr("pstory-id"));element.find(".perso-amount").attr("id","perso-amount"+element.attr("pstory-id"))});el.find(".pstory-all-accounts-txt").find(".perso-bold").attr("id","perso-bold-all");el.find(".pstory-all-accounts-txt").find(".perso-amount").attr("id","perso-amount-all")},addAccessibilityTabsHelper:function addAccessibilityTabsHelper(){var allAccountTab=this.frameEl.find(".pstory-header-button[data-all='true']");var chooseAccountTab=this.frameEl.find(".pstory-header-button[data-all='false']");allAccountTab.append("<div id='allAccountHelper' style='position: absolute;top:0;left:0' aria-labelledby='perso-bold-all perso-amount-all'></div>");chooseAccountTab.append("<div id='chooseAccountHelper' style='position: absolute;top:0;left:0' aria-labelledby='"+$(".carousel-index-wrapper").attr("aria-labelledby")+"'></div>");$("#allAccountHelper,#chooseAccountHelper").focusout(function(){var elem=$(this);elem.removeAttr("tabindex");elem.removeClass("pstory-header-button");if(elem.attr("id")==="chooseAccountHelper"){elem.removeAttr("aria-labelledby")}});if(!!window.MSInputMethodContext&&!!document.documentMode){var ofLabel=Personetics.dictionary.getText("accessibilityOfLbl");allAccountTab.attr("aria-label",allAccountTab.text()+" "+"1 "+ofLabel+" 2");chooseAccountTab.attr("aria-label",chooseAccountTab.text()+" "+"2 "+ofLabel+" 2")}}})})(window,window.Personetics=window.Personetics||{},jQuery);(function(window,Personetics,$,undefined){Personetics.story=Personetics.story||{};var keyCode={'Enter':13};Personetics.story.D3BarChartBlockProductDesktop=Personetics.story.D3BarChartBlockProduct.extend({initOptions:function(){if(this.chartType=="multiVertical"){this.options=this.story.uxCtrl.getColumnChartMultiSeriesOptionsDesktop();this.options.palette=this.story.uxCtrl.getMultiVerticalPaletteDesktop();this.options.paletteLabels=this.story.uxCtrl.getMultiVerticalLabelsPaletteDesktop()}
else if(this.chartType=="multiHorizontal")
this.options=this.story.uxCtrl.getBarChartOptionsDesktop();else this.options=this.story.uxCtrl.getColumnChartOptionsDesktop()},renderAccessibility:function renderAccessibility(el,chartType){Personetics.story.D3BarChartBlockProduct.prototype.renderAccessibility.call(this,el,chartType);this.frameEl.find(".accessibility-chart-wrapper .accessibility-chart-button").attr('tabindex','-1')},afterRender:function(el){var $barChartContainer=this.el.find(".perso-svg-chart-container");Personetics.story.D3BarChartBlockProduct.prototype.afterRender.call(this,el);$barChartContainer.attr("aria-labelledby",$barChartContainer.find("title").attr("id"));Personetics.utils.accessibility.trackFocus($barChartContainer);if(this.chartType!=='pinGraph'){this.addAccessDataToHiddenRects();this.updateSelectedHiddenRect()}
if(this.layoutInstructions.hasOwnProperty('var')&&typeof this.layoutInstructions.var!=='undefined'){this.listenToKeypress()}},putFocusAccessibility:function putFocusAccessibility(elementForFocus){},listenToKeypress:function(){var block=this;if(block.chartHelper.svg){this.el.find(".perso-svg-chart-container").bind("keypress",function(e){if(e.target.className.animVal.indexOf('access-hidden-rect')!==-1){if([keyCode.Enter].indexOf(e.which)!==-1){var data=(block.layoutInstructions.seriesLabels.length>=2)?block.layoutInstructions.series[0]:block.layoutInstructions.series;var lastBarIndex=data.length-1;var targetBarIndex=$(e.target).index();block.handleClick(data[lastBarIndex-targetBarIndex],lastBarIndex-targetBarIndex)}}})}},getSelectedBarIndex:function(svgEl,isSeries){var index;if(svgEl){if(isSeries){index=$(svgEl[0]).find('.perso-chart-rect.In.selected').index()}else{index=$(svgEl[0]).find('.perso-bar.selected').index()}}
return index},renderAccessibilityData:function renderAccessibilityData(el){Personetics.story.D3BarChartBlock.prototype.renderAccessibilityData.call(this,el);if(this.chartType!=='pinGraph'){if(!!window.MSInputMethodContext&&!!document.documentMode){this.el.find(".perso-svg-chart-container").attr('focusable',!1);this.el.find(".perso-svg-container-group").attr({'focusable':!0,"aria-hidden":"false"});this.chartHelper.svg.selectAll(".perso-bar").attr('focusable',!1);this.chartHelper.svg.selectAll(".access-hidden-rect").attr({'focusable':!0,"class":"access-hidden-rect-IE","aria-hidden":"false"})}
this.el.find(".perso-svg-chart-container").attr('tabindex','-1');this.chartHelper.svg.selectAll(".perso-bar").attr('tabindex','-1');this.chartHelper.svg.selectAll(".access-hidden-rect").attr('tabindex','0');this.chartHelper.svg.selectAll(".perso-hidden-rects, .access-hidden-rect").attr('aria-hidden',!1)}},handleClick:function(obj,clickedItemIndex){var block=this;var seriesData=block.layoutInstructions.series;if(obj.hasOwnProperty('mode')&&obj.mode){if((seriesData[1][clickedItemIndex].value!==0||seriesData[0][clickedItemIndex].value!==0)&&seriesData[1][clickedItemIndex].category===obj.category&&seriesData[0][clickedItemIndex].category===obj.category){Personetics.story.D3BarChartBlockProduct.prototype.handleClick.call(this,obj,clickedItemIndex);this.handleMultiChartClick()}}else{if(seriesData[clickedItemIndex].value!==0){Personetics.story.D3BarChartBlockProduct.prototype.handleClick.call(this,obj,clickedItemIndex);this.handleSingleChartClick()}}
this.updateSelectedHiddenRect()},handleSingleChartClick:function(){var persoBarsNum=this.el.find('.perso-bar').length-1;this.el.find('.accessibility-chart-button.selected').removeClass('selected');$(this.el.find('.accessibility-chart-button')[persoBarsNum-(this.el.find('.perso-bar.selected').index())]).addClass('selected')},handleMultiChartClick:function(){var persoBarsNum=this.el.find('.perso-chart-rect.Out').length-1;this.el.find('.accessibility-chart-button.selected').removeClass('selected');$(this.el.find('.accessibility-chart-button')[persoBarsNum-(this.el.find('.perso-chart-rect.Out.selected').index())]).addClass('selected')},addAccessDataToHiddenRects:function(){var accessChartButtons=$(this.el.find('.accessibility-chart-button'));var hiddenRects=$(this.el.find('.access-hidden-rect, .access-hidden-rect-IE'));if(accessChartButtons.length&&hiddenRects.length){for(var i=0;i<hiddenRects.length;i++){var itemData=accessChartButtons.eq(i).attr('aria-label');hiddenRects.eq(i).attr('aria-label',itemData)}}},updateSelectedHiddenRect:function(){var block=this;var classSelected=block.el.find('.perso-xAxis-label.selected').length>0?" "+block.texts.selected:"";var hiddenRects=block.el.find('.access-hidden-rect, .access-hidden-rect-IE');var selectedIndex=block.el.find(".accessibility-chart-button.selected").index();$.each(hiddenRects,function(i,rect){var $rect=$(rect);var ariaLabel=($rect.attr('aria-label').indexOf('not selected')!==-1)?$rect.attr('aria-label').split('not selected'):$rect.attr('aria-label').split('selected');if(selectedIndex!==-1){if(selectedIndex==i){$rect.attr('aria-label',ariaLabel[0]+classSelected)}else{if($rect.attr('aria-label').indexOf('not selected')==-1){$rect.attr('aria-label',ariaLabel[0]+' '+block.texts.notSelected)}}}})}})})(window,window.Personetics=window.Personetics||{},jQuery);(function(window,Personetics,$,undefined){var d3=Personetics.persoD3||window.d3;Personetics.story=Personetics.story||{};Personetics.story.D3PinGraphChartBlockProductDesktop=Personetics.story.D3BarChartBlockProductDesktop.extend({beforeRender:function(el,layoutInstructions){Personetics.story.D3BarChartBlockProduct.prototype.beforeRender.call(this,el,layoutInstructions);this.texts.accessibilityPinGraphTitle=Personetics.dictionary.getText("accessibilityPinGraphTitle")},getHtmlTemplateId:function(clazz){return"pinGraph-chart"},render:function(el,layoutInstructions){Personetics.story.Block.prototype.render.call(this,el,layoutInstructions);this.options.desktopScreenWidth=this.story.uxCtrl.getDesktopScreenWidth();var chartEl=this.frameEl.find(".pstory-pinGraph-chart");if(chartEl.length>0){this.renderBarChart(chartEl,layoutInstructions)}},renderBarChart:function(el,data){this.chartHelper.prepareChart(data,this.options);this.chartHelper.renderChart(el)},beforeRenderChart:function(el,layoutInstructions){this.layoutInstructions.series=this.layoutInstructions.series[0];this.chartType=this.getChartType();this.chartTypeHelper=(this.chartType+"Helper");this.initChartHelper(this.chartTypeHelper);this.options=this.story.uxCtrl.getPinGraphChartOptionsDesktop()},afterRender:function(el){var $barChartContainer=this.el.find(".perso-svg-chart-container");Personetics.story.D3BarChartBlockProductDesktop.prototype.afterRender.call(this,el);$barChartContainer.attr('tabindex','-1')},barsDirection:function barsDirection(){if(Personetics.processor.PStoryConfig.isRtl()){this.barsDirectionRTL()}},getChartType:function(){var type='pinGraph';return type},getAccessibilityTitle:function getAccessibilityTitle(){return this.texts.accessibilityPinGraphTitle},})})(window,window.Personetics=window.Personetics||{},jQuery);(function(window,Personetics,$,undefined){Personetics.story=Personetics.story||{};Personetics.story.D3BarChartBlockCiti=Personetics.story.D3BarChartBlockProductDesktop.extend({renderBarChart:function(el,layoutInstructions){var data=layoutInstructions;this.options.desktopScreenWidth=this.story.uxCtrl.getDesktopScreenWidth();var handleClickBind=Personetics.bind(this,this.handleClick);var appendTooltipBind=Personetics.bind(this,this.appendTooltip);if(this.chartType=="multiHorizontal"){this.chartHelper.prepareMultiHorizontalChart(this,el);this.chartHelper.renderMultiHorizontalChart(this,el,this.layoutInstructions)}
else{this.chartHelper.prepareChart(data,this.options,handleClickBind,appendTooltipBind);this.chartHelper.renderChart(el)}},renderAccessibility:function renderAccessibility(el,chartType){var element=$("<div class='accessibility-chart-wrapper'></div>");var layoutInstructions=this.layoutInstructions;var block=this;var inRect=$(el.find("svg .perso-chart-rect.In"));var buttonHeight;var buttonLeft;var button="";var left=this.getETransform(el);if(chartType!="pinGraph"){el.find("svg .perso-bar, svg .perso-chart-rect.Out").each(function(index,item){button=$("<input type='button' class='accessibility-chart-button'/>");if(chartType=="multiVertical"){buttonHeight=layoutInstructions.series[0][index].barHeight>layoutInstructions.series[1][index].barHeight?layoutInstructions.series[0][index].barHeight:layoutInstructions.series[1][index].barHeight}
else{buttonHeight=layoutInstructions.series[index].barHeight;button.css('width',item.getAttribute("width")+"px")}
buttonLeft=parseInt(item.getAttribute("x"))+left;button.css('left',+buttonLeft+"px");if(buttonHeight>0)
button.css('height',buttonHeight+"px");else button.css('height',"5px");block.ariaLabelAccessibilityButtons(button,layoutInstructions,index,chartType);block.ariaLabelSetSelected(el,item,button);$(button).bind('click',function(e){block.handleClickAccessibilityButtons(layoutInstructions,index,chartType);block.ariaLabelSetSelected(el,item,$(this))});$(button).bind('mouseenter',function(e){block.handleHover(layoutInstructions,index,chartType)});element.prepend(button)});el.find(".pstory-bar-chart").append(element)}},handleHover:function(layoutInstructions,index,chartType){var obj=layoutInstructions;if(chartType=="multiVertical"){obj=layoutInstructions.series[0][index]}
else{obj=layoutInstructions.series[index]}
this.setTooltip(obj,index)},appendTooltip:function appendTooltip(){var chartEl=this.frameEl.find('.pstory-bar-chart');if(chartEl.find('.pstory-tooltip').length>0){return}
chartEl.append("<div class='pstory-tooltip'></div>");var index;if(this.chartType=='vertical'){var selected=this.layoutInstructions.series.filter(function(item,i){index=i;return item.selected==!0})[0]}
else{var selected=this.layoutInstructions.series[0].filter(function(item,i){index=i;return item.selected==!0})[0]}
this.setTooltip(selected,index)},setTooltip:function setTooltip(obj,clickedItemIndex){var selectedRect=this.frameEl.find('svg rect:not(.access-hidden-rect)')[clickedItemIndex];var left=selectedRect.x.baseVal.value+parseFloat(this.frameEl.find(".pstory-bar-chart").css('padding-left'))+this.getETransform(this.frameEl);var tooltip=this.frameEl.find('.pstory-tooltip');if(this.chartType=="multiVertical"){tooltip.empty();tooltip.append("<span>EARNED</span><span class='in-val'></span><span>SPENT</span><span class='out-val'></span>");var $inObj=this.frameEl.find('.in-val');var $outObj=this.frameEl.find('.out-val');$inObj.append(this.layoutInstructions.series[0][clickedItemIndex].label);$outObj.append(this.layoutInstructions.series[1][clickedItemIndex].label);left=left-tooltip.innerWidth()/2+this.options.rectangles.width*1.5;selectedRect=this.frameEl.find('svg rect.selected');var top=selectedRect[0].y.baseVal.value<=selectedRect[1].y.baseVal.value?selectedRect[0].y.baseVal.value+26:selectedRect[1].y.baseVal.value+26}
else{tooltip.html(obj.label);left=left-tooltip.innerWidth()/2+this.options.rectangles.width/2;var top=selectedRect.y.baseVal.value+18}
tooltip.css("left",left+"px")
tooltip.css("top",top+"px")},updateSelectedHiddenRect:function(){var block=this;var classSelected=block.el.find('.perso-xAxis-label.selected').length>0?" "+block.texts.selected:"";var hiddenRects=block.el.find('.access-hidden-rect, .access-hidden-rect-IE');var selectedIndex=block.el.find(".accessibility-chart-button.selected").index();if($(block.el.find('.accessibility-chart-button')).length>0){$.each(hiddenRects,function(i,rect){var $rect=$(rect);var ariaLabel=($rect.attr('aria-label').indexOf('not selected')!==-1)?$rect.attr('aria-label').split('not selected'):$rect.attr('aria-label').split('selected');if(selectedIndex!==-1){if(selectedIndex==i){$rect.attr('aria-label',ariaLabel[0]+classSelected)}else{if($rect.attr('aria-label').indexOf('not selected')==-1){$rect.attr('aria-label',ariaLabel[0]+' '+block.texts.notSelected)}}}})}}})})(window,window.Personetics=window.Personetics||{},jQuery);(function(window,Personetics,$,undefined){Personetics.story=Personetics.story||{};Personetics.story.AccountSelectorBlockCITIDesktop=Personetics.story.AccountSelectorBlockProductDesktop.extend({beforeRender:function(el,layoutInstructions){Personetics.story.AccountSelectorBlockProductDesktop.prototype.beforeRender.call(this,el,layoutInstructions);this.minAccountsForDisplayingArrows=2},headerTabsAnimation:function headerTabsAnimation(selected){if(typeof selected==="undefined"||selected===null||selected.length==0)
return;var tabAnimatedBorder=$(this.frameEl).find(".pstory-tab-animated-border-bottom");var arrow=$(this.frameEl).find('.pstory-header-button-arrow');var left=selected.offset().left-this.frameEl.offset().left-44;var width=selected.width();tabAnimatedBorder.css({"left":left+'px',width:width+'px'})},getAccountSelectorText:function getAccountSelectorText(){var text=Personetics.story.AccountSelectorBlockProductDesktop.prototype.getAccountSelectorText.call(this);text.accountNumberTxt=Personetics.dictionary.getText("accountNumberTxt");return text},onChooseAccountClick:function onChooseAccountClick(selected){this.frameEl.parents('#personetics-story-widget').css({'overflow-y':'hidden'});Personetics.story.AccountSelectorBlockProductDesktop.prototype.onChooseAccountClick.call(this,selected);this.frameEl.parents('#personetics-story-widget').css({'overflow-y':'auto'})},})})(window,window.Personetics=window.Personetics||{},jQuery);(function(window,Personetics,$,undefined){Personetics.story=Personetics.story||{};Personetics.story.D3PinGraphChartBlockDesktopCITI=Personetics.story.D3PinGraphChartBlockProductDesktop.extend({handleClick:function(obj,clickedItemIndex){Personetics.story.D3PinGraphChartBlockProductDesktop.prototype.handleClick.call(this,obj,clickedItemIndex)},handleHover:function(layoutInstructions,index,chartType){var obj=layoutInstructions;obj=layoutInstructions.series[index];this.setTooltip(obj,index)},afterRender:function afterRender(el){Personetics.story.D3PinGraphChartBlockProductDesktop.prototype.afterRender.call(this,el);var layoutInstructions=this.layoutInstructions;var block=this;el.find("svg .perso-bar").each(function(index,item){$(item).bind('mouseenter',function(e){block.handleHover(layoutInstructions,index,block.chartType)})})},appendTooltip:function appendTooltip(){var chartEl=this.frameEl.find('.pstory-pinGraph-chart');if(chartEl.find('.pstory-tooltip').length>0){return}
chartEl.append("<div class='pstory-tooltip'></div>");var index;var selected=this.layoutInstructions.series.filter(function(item,i){index=i;return item.selected==!0})[0];this.setTooltip(selected,index)},setTooltip:function setTooltip(obj,clickedItemIndex){var selectedRect=this.frameEl.find('svg rect')[clickedItemIndex];var left=selectedRect.x.baseVal.value+parseFloat(this.frameEl.find(".pstory-pinGraph-chart svg").css('padding-left'))+this.getETransform(this.frameEl);var top=selectedRect.y.baseVal.value;var tooltip=this.frameEl.find('.pstory-tooltip');tooltip.html(obj.label);left=left-tooltip.innerWidth()/2+this.options.rectangles.width/2+parseFloat(this.frameEl.find(".pstory-pinGraph-chart").css('padding-left'));tooltip.css("left",left+"px")
tooltip.css("top",top+"px")}})})(window,window.Personetics=window.Personetics||{},jQuery);(function(window,Personetics,$,undefined){Personetics.story=Personetics.story||{};Personetics.story.TableBlockCITIDesktop=Personetics.story.TableBlockProduct.extend({beforeRender:function(el,layoutInstructions){Personetics.story.Block.prototype.beforeRender.call(this,el,layoutInstructions);this.addTexts();this.texts={tableTitle:Personetics.dictionary.getText("accessibilityTableTitle"),tableStart:Personetics.dictionary.getText("accessibilityTableStart"),tableEnd:Personetics.dictionary.getText("accessibilityTableEnd")}
this.parseTableToObj();layoutInstructions=this.computeMode(layoutInstructions);this.groupTable();this.formatTable()},computeMode:function computeMode(layoutInstructions){layoutInstructions.rows.forEach(function(obj){if(obj.amount!==null&&typeof(obj.amount)!=="undefined")
if(parseFloat(obj.amount)==obj.amount)
if((parseFloat(obj.amount))>0)
obj.mode="In";else obj.mode="Out"});return layoutInstructions}})})(window,window.Personetics=window.Personetics||{},jQuery);(function(window,Personetics,$,undefined){Personetics.UI=Personetics.UI||{};var factory=Base.extend({widgetsTextsMap:{},defaultLang:"en",getText:function(textId,lang,fallbackText){var fallbackTextValue=fallbackText||"";var text=fallbackTextValue;if(this.widgetsTextsMap.hasOwnProperty(textId)){var textObj=this.widgetsTextsMap[textId];text=textObj[lang]||textObj[this.defaultLang]||fallbackTextValue}
return text},registerText:function(textId,text,lang)
{var lang=lang||this.defaultLang;if(!this.widgetsTextsMap.hasOwnProperty(textId))
this.widgetsTextsMap[textId]={};this.widgetsTextsMap[textId][lang]=text}});Personetics.UI.PWidgetsTextsFactory=new factory()})(window,window.Personetics=window.Personetics||{},jQuery);(function(window,Personetics,$,undefined){Personetics.UI=Personetics.UI||{};Personetics.UI.PAppCtrl=Personetics.UI.PWidgetCtrl.extend({initialize:function(config){this.super=Personetics.UI.PWidgetCtrl.prototype;this.super.initialize.call(this,config);this.config.parentCtrl=this;this.config.widthMode="";this.widgets={};var skinController=config.uxCtrl;if(!skinController)
skinController=new Personetics.story.skinController();this.uxCtrl=skinController;this.desktopScreenWidth=this.uxCtrl.getDesktopScreenWidth();this.screenWidth=$(window).width();if(this.screenWidth>this.desktopScreenWidth){this.config.widthMode="desktop"}
this.setFirstWidgetType(config.widgetType);this.registerTexts()},setFirstWidgetType:function(widgetType){this.firstWidgetType=widgetType||"insights"},addConfigurationClasses:function(){var deviceType=personetics.getDeviceType();this.el.addClass("personetics-device-"+deviceType)},getWidgetEl:function(widgetType){var widgetEl=this.el.find("#personetics-"+widgetType);if(widgetEl.length==0){widgetEl=$("<div id='personetics-"+widgetType+"'></div>");this.el.append(widgetEl)}
return widgetEl},start:function(el){el.empty();var containerEl=$("<div class='personetics-widgets-wrapper'></div>");el.append(containerEl);this.el=containerEl;this.addConfigurationClasses();var widget=Personetics.UI.PWidgetFactory.createWidget(this.firstWidgetType,this.config);this.widgets[this.firstWidgetType]=widget;var firstWidgetEl=this.getWidgetEl(this.firstWidgetType);widget.start(firstWidgetEl)},sendMessage:function(messageObj){var widgetType=messageObj.targetWidget;var message=messageObj.message;var args=messageObj.arguments;var widget=this.widgets[widgetType];if(widget&&widget.hasOwnProperty(message)){return widget[message].apply(widget,args)}},startWidget:function(widgetType,options){options.parentCtrl=options.parentCtrl||this;options.widthMode=this.config.widthMode;var widget=Personetics.UI.PWidgetFactory.createWidget(widgetType,options);widget.start(options.el);if(widget)
this.widgets[widgetType]=widget},closeLoading:function closeLoading(){this.sendMessage({targetWidget:"loading-animation",message:"removeLoading"})},startManagement:function(options){var el=options.el;var managementCtrl=new Personetics.UI.PManagementCtrl(options,this);managementCtrl.start(el);return managementCtrl},startRatings:function(options){var el=$(".pstory-frame");this.currentRatingsEl=el;var ratingCtrl=new Personetics.UI.PRatingCtrl(options,this);ratingCtrl.start(el);return ratingCtrl},startInbox:function(options){var el=options.el;var inboxCtrl=new Personetics.story.PInboxCtrl(options,this);inboxCtrl.start(el);return inboxCtrl},registerTexts:function registerTexts(){Personetics.dictionary.setLanguage(this.config.lang)}})})(window,window.Personetics=window.Personetics||{},jQuery);(function(window,Personetics,$,undefined){Personetics.UI=Personetics.UI||{};Personetics.UI.PRatingCtrl=Personetics.UI.PWidgetCtrl.extend({initialize:function(config){this.super=Personetics.UI.PWidgetCtrl.prototype;this.super.initialize.call(this,config);this.insight=this.config.insight;this.lang=this.config.lang;this.texts={accessibilityRatingLevelTitle:Personetics.dictionary.getText("accessibilityRatingLevelTitle")};this.ratingTemplate="#tmpl-perso-rating";this.feedbackTemplate="#tmpl-perso-feedback"},start:function(el){this.el=el;var ratingTmpl=this.getRatingTemplate();el.append(ratingTmpl);this.fixRatingElToBottom();this.sendGetRatings()},getRatingTemplate:function getRatingTemplate(){var ratingTitle=Personetics.dictionary.getText("lblstoryRating");var ratingTmpl=this.getTemplateHtml(this.ratingTemplate,{ratingTitle:ratingTitle});return ratingTmpl},fixRatingElToBottom:function fixRatingElToBottom(){var ratingEl=this.el.find('.perso-ratings-wrapper');var ratingHeight=ratingEl.height()+1;ratingEl.height(ratingHeight);var ratingOuterHeight=ratingEl.outerHeight(!0);this.el.find('.pstory-container').css('minHeight','calc(100% - '+(ratingOuterHeight-2)+'px)')},sendGetRatings:function(){var testData=window.testData?window.testData.ratings:null;var me=this;if(testData){setTimeout(function(){me.onGetRatigsResponse((testData))},500)}else{var data={id:this.insight.id};personetics.getInsightRating(data,Personetics.bind(this,this.onGetRatigsResponse),Personetics.bind(this,this.onGetRatingsError))}},onGetRatigsResponse:function(json){var rating=json?json.rating:0;var el=this.el.find(".perso-ratings-icons");this.id=json.id;this.starRating(el,rating);this.afterRender()},onGetRatingsError:function onGetRatingsError(){this.onError();var json={id:this.insight.id,rating:0}
this.onGetRatigsResponse(json)},starRating:function(el,prevRating){var me=this;var ratingId=this.insight.id+'_'+this.el.index()+'_rating_';return el.each(function(){var $ratingElement=el;for(var x=0;x<$ratingElement.data("rating-max");x++){var starElement=me.createRatingStarElement(x,prevRating,ratingId+x);$ratingElement.append(starElement)}
var $ratingItems=$ratingElement.children("input");var rating=0;$ratingItems.bind("click",{id:me.id,me:me},Personetics.bind(me,me.rateClick));if(typeof prevRating!=='undefined'&&prevRating!==null){rating=prevRating;$ratingElement.attr("data-val",rating);$($ratingItems[rating-1]).attr("checked",!0)}})},createRatingStarElement:function createRatingStarElement(index,prevRating,ratingElementId){var label=this.texts.accessibilityRatingLevelTitle+' '+(index+1);var element=$("<input type='radio' id='"+ratingElementId+"' name='rating' aria-label='"+label+"'/><label for='"+ratingElementId+"'/>");return element},afterRender:function(){},rateClick:function rateClick(e){this.onRateClick(e);this.feedbackStart()},onRateClick:function onRateClick(e){var target=e.currentTarget;var rating=$(target).index(".perso-ratings-icons input[type='radio']")+1;$("li:lt("+rating+")",$(target).parent("ul")).addClass("perso-hover");$("li:gt("+($(target).index())+")",$(target).parent("ul")).removeClass("perso-hover");$(target).closest("[data-val]").attr("data-val",rating);this.eventObj={id:e.data.id,rating:rating,insightId:this.insight.id};var testData=window.testData?window.testData.ratingsResponse:null;if(testData){var widget=this;setTimeout(function(){e.data.me.onSuccesRate((testData))},500)}else{personetics.updateInsightRating(this.eventObj,e.data.me.onSuccesRate,e.data.me.onError)}},feedbackStart:function feedbackStart(){if(Personetics.projectConfiguration.getConfig("showFeedback")==!0){if(!this.disableFeedBack){this.showFeedback()}
else{if(this.el.find('.perso-feedback-text').length>0&&this.el.find(".perso-feedback-text").val()==""){var lblfeedbackprompt=Personetics.dictionary.getText("lblfeedbackprompt"+this.eventObj.rating);var feedbackText=this.el.find('.perso-feedback-text');feedbackText.attr({placeholder:lblfeedbackprompt,"aria-label":lblfeedbackprompt})}}}},onSuccesRate:function(data){Personetics.log("rating succes")},onError:function(){Personetics.log("rating error")},showFeedback:function showFeedback(){var widget=this;this.el.find('.perso-feedback-wrapper').remove();this.disableFeedBack=!0;var lblfeedbackprompt=Personetics.dictionary.getText("lblfeedbackprompt"+this.eventObj.rating);var lblreactionFeedback=Personetics.dictionary.getText("lblreactionFeedback");var btnsubmit=Personetics.dictionary.getText("btnsubmit");var ratingTmpl=this.getTemplateHtml(this.feedbackTemplate,{lblfeedbackprompt:lblfeedbackprompt,lblreactionFeedback:lblreactionFeedback,btnsubmit:btnsubmit});this.el.append(ratingTmpl);var submit=this.el.find('.perso-feedback-submit');submit.css('margin-left','calc(100% - '+submit.outerWidth()+'px)');submit.bind("click",{id:widget.insight.id,widget:widget},Personetics.bind(widget,widget.sendFeedback));submit.hide();this.el.find('.perso-feedback-reaction').hide();var element=this.el.find('.perso-feedback-wrapper');this.scrollToEnd(this.el,element);this.feedbackText=this.el.find('.perso-feedback-text');this.textareaSize=this.el.find('.textarea-size');var feedbackTextFocusBind=Personetics.bind(this,this.feedbackTextFocus);$(this.feedbackText).bind('focus',feedbackTextFocusBind);var feedbackTextBlurBind=Personetics.bind(this,this.feedbackTextBlur);$(this.feedbackText).bind('blur',feedbackTextBlurBind);widget.textareaSize.text(this.feedbackText.value+'\n');var feedbackTextInputBind=Personetics.bind(this,this.feedbackTextInput);$(this.feedbackText).bind('input',feedbackTextInputBind)},feedbackTextBlur:function feedbackTextBlur(e){var widget=this;var lblfeedbackprompt=Personetics.dictionary.getText("lblfeedbackprompt"+this.eventObj.rating);if(this.value==0){widget.el.find('.perso-feedback-submit').hide();widget.feedbackText.removeClass('direction-text');widget.feedbackText.addClass('direction-text-center');widget.feedbackText.attr("placeholder",lblfeedbackprompt)}
setTimeout(function(){widget.parentCtrl.enableCollapse=!0},800)},feedbackTextInput:function feedbackTextInput(e){var element=this.el.find('.perso-feedback-wrapper');this.textareaSize.text(e.target.value+'\n');this.el.scrollTop(this.el[0].scrollHeight)},feedbackTextFocus:function feedbackTextFocus(e){var element=this.el.find('.perso-feedback-wrapper');this.feedbackText.removeClass('direction-text-center');this.feedbackText.addClass('direction-text');this.feedbackText.attr("placeholder","");this.el.find('.perso-feedback-submit').show();this.el.scrollTop(this.el[0].scrollHeight)
this.parentCtrl.enableCollapse=!1},scrollToEnd:function scrollTo(el,toElement){if(toElement.length>0){$(el).animate({scrollTop:toElement.offset().top-el.offset().top+el.scrollTop()},500)}},sendFeedback:function sendFeedback(e){var widget=this;var feedback=this.el.find('.perso-feedback-text').val();if(typeof feedback!="undefined"&&feedback.length>0){this.eventObj={id:e.data.id,feedback:feedback};personetics.updateInsightFeedback(this.eventObj,e.data.widget.onSuccesFeedback,e.data.widget.onErrorFeedback)}
widget.showFeedbackReaction()},onSuccesFeedback:function(data){Personetics.utils.PLogger.debug("feedback succes")},onErrorFeedback:function(){Personetics.utils.PLogger.debug("feedback error")},showFeedbackReaction:function showFeedbackReaction(){var widget=this;var height=this.el.find('.perso-feedback-wrapper').height();this.el.find('.perso-feedback-wrapper').height(height);var element=this.el.find('.perso-feedback-reaction');element.show();this.el.find(".perso-feedback-wrapper").css('overflow','scroll');var heightreaction=this.el.find('.perso-feedback-reaction').outerHeight();this.el.find('.perso-feedback-wrapper').animate({'scrollTop':150,'height':heightreaction},400,function(){widget.disableFeedBack=!1;widget.el.find(".textarea-wrapper").hide()})}})})(window,window.Personetics=window.Personetics||{},jQuery);(function(window,Personetics,$,undefined){Personetics.UI=Personetics.UI||{};Personetics.UI.PAppCtrlProduct=Personetics.UI.PAppCtrl.extend({setFirstWidgetType:function(widgetType){this.firstWidgetType=widgetType||"teaser-widget"},registerTexts:function registerTexts(){Personetics.UI.PAppCtrl.prototype.registerTexts.call(this)}})})(window,window.Personetics=window.Personetics||{},jQuery);(function(window,Personetics,$,undefined){Personetics.UI=Personetics.UI||{};var keyCode={"UpArrow":38,"DownArrow":40};Personetics.UI.PStoryWidgetCtrl=Personetics.UI.PWidgetCtrl.extend({initialize:function(config){this.super=Personetics.UI.PWidgetCtrl.prototype;this.super.initialize.call(this,config);if(typeof config!==undefined){Personetics.utils.PEventReporting.setValue({"instanceId":config.insightId,"insightId":config.instanceId,"userId":config.userId})}
this.tmplInnerErrorName="#tmpl-perso-widget-story-error";this.texts={imgClass:"errorImage",textSmall:Personetics.dictionary.getText("inboxTechnicalIssues"),textLarge:Personetics.dictionary.getText("OhNo"),errorText:Personetics.dictionary.getText("storyErrorText"),backButtonText:Personetics.dictionary.getText("accessibilityStoryBackButtonText")};this.showTitle=Personetics.projectConfiguration.getConfig("showTitle");this.loadingAnimation=Personetics.projectConfiguration.getConfig("showLoadingAnimation")},start:function(parentEl){this.parentEl=parentEl;this.el=this.parentEl;this.lang=this.config.lang;this.el.empty();if(this.config.widthMode==="desktop"){var me=this;this.el.attr("tabindex","0");Personetics.utils.accessibility.trackFocus(this.el);this.el.keydown(function(e){if(e.currentTarget===e.target){if(e.keyCode===keyCode.DownArrow||e.keyCode===keyCode.UpArrow){var direction=e.keyCode===keyCode.DownArrow?50:-50;me.el.find(".pstory-frame").animate({scrollTop:me.el.find(".pstory-frame").scrollTop()+direction},0,'swing')}}})}
this.renderTitle();this.sendGetStory()},renderTitle:function(){if(!this.showTitle)
return;var html=this.getTemplateHtml("#tmpl-pstory-title",this.texts);var newEl=$(html);this.el.append(newEl);var closeEl=newEl.find(".pstory-title-close");var widget=this;closeEl.bind("click",function(){widget.closeHandler()});var openTeasersEl=newEl.find(".pstory-open-teasers-button");openTeasersEl.bind("click",function(){widget.onShowTeasersButtonClick()})},sendGetStory:function(){var me=this;var testData=window.testData&&window.testData.stories?window.testData.stories[this.config.insightId]:null;if(this.loadingAnimation){this.parentCtrl.startWidget('loading-animation',{el:this.el.find('#story-frame-container')})}
if(testData){setTimeout(function(){me.onGetStoryResponse(testData)},500)}
else{if(typeof storyData!=="undefined"){this.config.payload=storyData}
if(typeof this.config.payload!='undefined'&&this.config.payload!=null){var payload=this.config.payload;if(typeof this.config.isPayloadEncoded!='undefined'&&(this.config.isPayloadEncoded==!0||this.config.isPayloadEncoded=="true")){try{payload=Personetics.utils.encodeDecode.Base64.decode(payload);payload=$.parseJSON(payload)}
catch(payload){this.onError();return}}
me.onGetStoryResponse(payload)}
else{var data={widgetId:this.widgetId,insightId:this.config.insightId};personetics.getInsightDetails(data,Personetics.bind(this,this.onGetStoryResponse),Personetics.bind(this,this.onError))}}},onGetStoryResponse:function(json){if(this.loadingAnimation)
this.parentCtrl.closeLoading();this.context="story";this.openStory(json);this.bindEvents()},openStory:function(storyCfg){var me=this;if(storyCfg){var el=this.parentEl.find("#story-frame-container");if(el.length==0){el=this.parentEl}
this.startStory(storyCfg,el);var titleElement=this.el.find(".pstory-title-text");if(titleElement.length>0){this.setVoiceOverFocus(titleElement[0])}
else{var element=Personetics.utils.accessibility.firstChildFocusable($('.pstory-frame'));if(typeof element!='undefind'){this.setVoiceOverFocus(element)}}}},startStory:function(storyCfg,el){var story=new Personetics.story.PStory({parent:this,lang:this.lang,defaultLang:this.defaultLang,texts:storyCfg.text,flowDef:storyCfg.story,userId:this.config.userId,expressions:storyCfg.expressions,insight:{id:this.config.insightId},data:storyCfg.facts,uxCtrl:this.uxCtrl,showTitle:this.showTitle,widthMode:this.widthMode,iconType:this.iconType,resizeHandler:function(newHeight){},onStartHandleEvent:function(oldHeight,el){$(el).css('height',$(el).height())},onEndHandleEvent:function(el){$(el).css('height','auto')},openTeasersHandler:Personetics.bind(this,function(){this.onShowTeasersButtonClick()})});story.start(el);var ratingsOptions={el:el.find(".pstory-frame"),insight:story.insight,lang:this.lang};this.parentCtrl.startWidget("ratings",ratingsOptions);story.addTouchScroll();return story},onError:function(err){if(this.loadingAnimation)
this.parentCtrl.closeLoading();Personetics.utils.PLogger.error(err);var data={textSmall:this.texts.textSmall,textLarge:this.texts.textLarge,imgClass:this.texts.imgClass,};var el=this.parentEl.find("#story-frame-container");if(el.length==0){el=this.parentEl}
var html=this.getTemplateHtml(this.tmplInnerErrorName,data);el.append(html);this.bindEvents();var closeEl=this.el.find(".pstory-title-close");var me=this;closeEl.bind("click",function(){if(typeof me.closeHandler=='function')
me.closeHandler()})},bindEvents:function(){},closeHandler:function(){var deviceType=personetics.getDeviceType();Personetics.API.personetics.eventBuffer&&Personetics.API.personetics.eventBuffer.sendEvents();if(deviceType==='web'){this.el.parent().empty();var regexResult=new RegExp('[\?&]'+'teasersView'+'=([^&#]*)').exec(window.location.href);var widgetIndicator=0;if(typeof regexResult!=='undefined'&&regexResult!==null)
widgetIndicator=regexResult[1]||0;var widgetType=widgetIndicator==="Carousel"?"teaser-widget-carousel":"teaser-widget"
if(widgetIndicator==="Carousel")this.parentCtrl.config.filter=!1;var config=$.extend(!0,{},this.parentCtrl.config);config.el=this.parentCtrl.getWidgetEl(widgetType);this.parentCtrl.startWidget(widgetType,config)}
else{var bridge=personetics.getJSBridge();if(bridge&&($.isFunction(bridge.sessionEnded))){var params={type:"ExitInsight",value:"1"}
Personetics.utils.PEventReporting.setValue(params);Personetics.utils.PEventReporting.notifyEvent();var config=$.extend(!0,{},this.parentCtrl.config);delete config.eventType;bridge.sessionEnded(config)}
else Personetics.log("Events Delegate not defined")}},onShowTeasersButtonClick:function onShowTeasersButtonClick(){var teasersWidgetEl=this.parentCtrl.getWidgetEl("teaser-widget");var config=$.extend(!0,this.parentCtrl.config,{el:teasersWidgetEl});this.parentCtrl.startWidget("teaser-widget",config)},setVoiceOverFocus:function setVoiceOverFocus(element){var focusInterval=10;var focusTotalRepetitions=10;if(this.config.widthMode!=='desktop'){element.setAttribute('tabindex','0')}
var focusRepetitions=0;var interval=window.setInterval(function(){element.focus();focusRepetitions++;if(focusRepetitions>=focusTotalRepetitions){window.clearInterval(interval)}},focusInterval)}})})(window,window.Personetics=window.Personetics||{},jQuery);(function(window,Personetics,$,undefined){Personetics.story=Personetics.story||{};Personetics.UI.PStoryWidgetCtrlProduct=Personetics.UI.PStoryWidgetCtrl.extend({initialize:function(config){this.super=Personetics.UI.PStoryWidgetCtrl.prototype;this.super.initialize.call(this,config);this.uxCtrl=new Personetics.story.skinController()}})})(window,window.Personetics=window.Personetics||{},jQuery);(function(window,Personetics,$,undefined){Personetics.UI=Personetics.UI||{};Personetics.UI.PStoryWidgetCtrlCITI=Personetics.UI.PStoryWidgetCtrl.extend({initialize:function(config){this.super=Personetics.UI.PStoryWidgetCtrl.prototype;this.super.initialize.call(this,config);this.texts.errorTextTitle=Personetics.dictionary.getText("storyErrorTextTitle");this.texts.errorTextBody=Personetics.dictionary.getText("storyErrorTextBody")},onError:function(err){if(this.loadingAnimation)
this.parentCtrl.closeLoading();Personetics.utils.PLogger.error(err);var data={errorTextTitle:this.texts.errorTextTitle,errorTextBody:this.texts.errorTextBody};var el=this.parentEl.find("#story-frame-container");if(el.length==0){el=this.parentEl}
var html=this.getTemplateHtml(this.tmplInnerErrorName,data);el.append(html);this.bindEvents();var closeEl=this.el.find(".pstory-title-close");var me=this;closeEl.bind("click",function(){if(typeof me.closeHandler=='function')
me.closeHandler()})}})})(window,window.Personetics=window.Personetics||{},jQuery);(function(window,Personetics,$,undefined){var HandlebarsTeaserHelpers=function HandlebarsTeaserHelpers(parent){this.parent=parent};HandlebarsTeaserHelpers.prototype.registerHelpers=function createView(){Handlebars.registerHelper("renderBarChart",function(layoutInstructions){this.renderBarChart(layoutInstructions)}.bind(this))};HandlebarsTeaserHelpers.prototype.renderBlock=function renderBlock(parentEl,layoutInstructions,insightId){var el=parentEl.find("#"+insightId+"_"+layoutInstructions.blockId);if(el.length>0){var block=Personetics.teaser.PBlockFactory.createBlock(this.parent,layoutInstructions);block.beforeRender(el,layoutInstructions,insightId);block.render(el,layoutInstructions);block.afterRender();block.bindEvents()}};window.HandlebarsTeaserHelpers=HandlebarsTeaserHelpers})(window,window.Personetics=window.Personetics||{},jQuery);(function(window,Personetics,$,undefined){var Widget=function Widget(config){this.config=config};Widget.prototype.start=function start(element){this.element=element};Widget.prototype.stop=function stop(){};Personetics.Widget=Widget})(window,window.Personetics=window.Personetics||{},jQuery);var WidgetEventHandler=function WidgetDelegate(){};WidgetEventHandler.prototype.sendToPServer=function sendToPServer(widget,data,onReceive){Personetics.utils.PLogger.debug(widget.getName()+" sending data to PServer: "+JSON.stringify(data))};WidgetEventHandler.prototype.navigateToPage=function navigateToPage(widget,params){Personetics.utils.PLogger.debug(widget.getName()+" navigating to page "+json.stringify(params))};WidgetEventHandler.prototype.widgetError=function widgetError(widget,errorParams){Personetics.utils.PLogger.debug(widget.getName()+" has encoutered an error: "+JSON.stringify(errorParams))};WidgetEventHandler.prototype.widgetStopped=function widgetStopped(widget){Personetics.utils.PLogger.debug(widget.getName()+" has stopped")};WidgetEventHandler.prototype.handleWidgetEvent=function handleWidgetEvent(widget,event){};(function(window,Personetics,undefined){var Handlebars=Personetics.UI.Handlebars;var horizontalBarChartsTemplates=["horizontalBar","horizontalBarAndBox","columnHorizontalBoxTeaser"];var imageFileExtensions=["png","jpg","svg","bmp"];var HandlebarsTeaserWidget=function HandlebarsTeaserWidget(config){Personetics.Widget.call(this,config);this.helpers=new HandlebarsTeaserHelpers(this)};HandlebarsTeaserWidget.prototype=Object.create(Personetics.Widget.prototype);HandlebarsTeaserWidget.prototype.start=function start(parentEl){Personetics.Widget.prototype.start.call(this,parentEl);var me=this;var insightId=this.config.insight.id;this.lang=this.config.lang;Personetics.processor.PStoryConfig.setConfig("lang",this.lang);this.teaserId="perso-teaser-template_"+insightId;var teaserBlocks;var templateId;var isTextTeasers=!1;if(!this.config.insight.hasOwnProperty("teaserTemplate")||this.config.insight.teaserTemplate===null||this.config.insight.teaserTemplate.length==0)
isTextTeasers=!0;if(!this.config.insight.hasOwnProperty("teaserBlocks")||this.config.insight.teaserBlocks===null)
isTextTeasers=!0;if(isTextTeasers){templateId="simpleText";teaserBlocks=[{"blockId":"date","type":"date-box","date":""},{"blockId":"title","type":"text","text":""},{"blockId":"teaser-text","type":"text","text":this.config.insight.text}]}
else{templateId=this.config.insight.teaserTemplate;teaserBlocks=this.config.insight.teaserBlocks}
var template=Handlebars.templates[templateId];if(template){var newTeaserBlocks={insightId:insightId,status:this.config.insight.status,highlighted:this.config.insight.highlighted};teaserBlocks.forEach(function(layoutInstructions,index){if(layoutInstructions.hasOwnProperty("date")){var dateStr=layoutInstructions.date.trim();var month=Personetics.utils.date.monthName(dateStr,me.lang,!0);if(typeof window.skinSetup.getDateFormat=="function"){if(window.skinSetup.getDateFormat()=="dd/mm/yy"){month=Personetics.utils.date.monthNumber(dateStr);var year=Personetics.utils.date.yearNumber(dateStr,!0);layoutInstructions.year=year}}
layoutInstructions.month=month;var day=Personetics.utils.date.dayNumber(dateStr,"DD");layoutInstructions.day=day}
var urlObj={};if(layoutInstructions.type=="image"){urlObj=Personetics.imageMap.getImageClass(layoutInstructions.url,"teaser_images");layoutInstructions.isAbsoluteURL=urlObj.isAbsoluteURL;layoutInstructions.absUrl=urlObj.url}
if(layoutInstructions.blockId=="icon"){urlObj=Personetics.imageMap.getImageClass(layoutInstructions.url,"icons");layoutInstructions.isAbsoluteURL=urlObj.isAbsoluteURL;layoutInstructions.absUrl=urlObj.url}
if(!(isNaN(new Date(layoutInstructions.text))))
{layoutInstructions.isDate=!0}
newTeaserBlocks[layoutInstructions.blockId]=layoutInstructions});var html=template(newTeaserBlocks);parentEl.append(html);this.afterRender(parentEl,newTeaserBlocks)}
else{Personetics.utils.PLogger.error("HandlebarsTeaserWidget.start() - Couldn't find template: '"+templateId+"'")}};HandlebarsTeaserWidget.prototype.afterRender=function(parentEl,teaserBlocks){$(".pstory-hbox-column-frame").each(function(){var parentWidth=$(this).parent().width();var weight=$(this).data("width");var width=Math.floor(weight/12*parentWidth);width=width;$(this).css("width",width);var parentHeight=$(this).parent().height();$(this).css("height",parentHeight)});for(var blockId in teaserBlocks){if(teaserBlocks.hasOwnProperty(blockId)){var layoutInstructions=teaserBlocks[blockId];if(layoutInstructions){if(layoutInstructions.type=="bar-chart"&&horizontalBarChartsTemplates.indexOf(this.config.insight.teaserTemplate)>=0)
layoutInstructions.direction="horizontal";this.helpers.renderBlock(parentEl,layoutInstructions,teaserBlocks.insightId)}}}
var enterKeyCode=13;var spaceKeyCode=32;var me=this;me.teaserClickBind=me.config.widgetType==="inbox-story-widget"?Personetics.bind(this,this.teaserInboxClick):Personetics.bind(this,this.teaserClick);parentEl.find("#"+me.teaserId).bind("click",{userId:me.config.userId,insightId:me.config.insight.id,instanceId:me.config.insight.insightId,lang:me.lang},me.teaserClickBind);parentEl.find("#"+me.teaserId).bind("keydown",{userId:me.config.userId,insightId:me.config.insight.id,instanceId:me.config.insight.insightId,lang:me.lang},function(e){if([enterKeyCode,spaceKeyCode].indexOf(e.which)!==-1){me.teaserClickBind(e)}});parentEl.find('#'+me.teaserId).attr('tabindex',0)};HandlebarsTeaserWidget.prototype.teaserClick=function teaserClick(event){var params={userId:event.data.userId,insightId:event.data.insightId,instanceId:event.data.instanceId,eventType:"teaserClick",lang:event.data.lang,clickedTeaser:$(event.currentTarget),teaserId:this.teaserId};if(typeof personetics!=='undefined'&&personetics!==null&&personetics.hasOwnProperty("sendWidgetEvent"))
personetics.sendWidgetEvent(this,params);else Personetics.utils.PLogger.debug("personetics JS API is not available")},HandlebarsTeaserWidget.prototype.teaserInboxClick=function teaserInboxClick(event){var params={userId:event.data.userId,insightId:event.data.insightId,instanceId:event.data.instanceId,lang:event.data.lang,clickedTeaser:$(event.currentTarget),teaserId:this.teaserId,widget:this.config.widget};if(typeof personetics!=='undefined'&&personetics!==null&&personetics.hasOwnProperty("sendWidgetEvent"))
personetics.sendWidgetEvent(this,params);else Personetics.utils.PLogger.debug("personetics JS API is not available");this.config.widget.startStory(params)},HandlebarsTeaserWidget.prototype.notifyEvent=function(block,eventName,params){Personetics.utils.PLogger.debug("Block: '"+block.layoutInstructions.type+"':'"+block.layoutInstructions.blockId+"' event:'"+event+"' params: "+params)};window.HandlebarsTeaserWidget=HandlebarsTeaserWidget})(window,window.Personetics=window.Personetics||{});(function(window,Personetics,undefined){var Handlebars=Personetics.UI.Handlebars;var filterInbox=function filterInbox(widget){this.parentEl=widget.element;this.widget=widget;this.renderer=Personetics.bind(widget,widget.__proto__.renderTeasers);this.afterRenderer=Personetics.bind(widget,widget.__proto__.afterRender);this.texts={"ttlinboxAll":Personetics.dictionary.getText("ttlinboxAll"),"ttlinboxHighlighted":Personetics.dictionary.getText("ttlinboxHighlighted"),"ttlinboxUnread":Personetics.dictionary.getText("ttlinboxUnread")};var tmpl=Handlebars.templates['filter-inbox-template'];var html=tmpl({"texts":this.texts});this.el=this.parentEl.find(".perso-teaser-filter-wrapper");this.el.append(html);this.afterRender()};filterInbox.prototype.bindEvents=function(){var helper=this;this.el.find(".perso-teaser-filter-tab").bind("click",function(e){helper.onSelectTab($(e.target))})};filterInbox.prototype.onSelectTab=function(selected){var selectedTabId=selected.data("id");this.el.find(".perso-teaser-filter-tab").removeClass('selected');selected.addClass('selected');this.filteredInsights=this.filterInsights(selectedTabId);this.parentEl.find(".perso-multi-teaser-template").empty();if(typeof this.renderer=='function'){this.renderer(this.filteredInsights)}
if(typeof this.afterRenderer=='function'){this.afterRenderer(this.parentEl,this.filteredInsights,selectedTabId)}
if(this.widget.config.hasOwnProperty("callbackOnSuccess")&&typeof this.widget.config.callbackOnSuccess!=="undefined")
{this.widget.config.callbackOnSuccess(this.widget.config)}};filterInbox.prototype.filterInsights=function filterInsights(selectedId){var filteredInsights;var insights=this.widget.insights;if(typeof insights==="undefined"||insights===null)
return[];switch(selectedId){case "all":filteredInsights=insights;break;case "flagged":filteredInsights=insights.filter(function(item){return item.highlighted});break;case "unread":case "new":filteredInsights=insights.filter(function(item){return item.status=="unread"||item.status=="new"});break;default:filteredInsights=insights}
return filteredInsights};filterInbox.prototype.afterRender=function(){this.bindEvents()};filterInbox.prototype.onGetInsights=function(insights){this.insights=insights};window.filterInbox=filterInbox})(window,window.Personetics=window.Personetics||{});(function(window,Personetics,undefined){var HandlebarsMultiTeaserWidget=function HandlebarsMultiTeaserWidget(config){Personetics.Widget.call(this,config)};HandlebarsMultiTeaserWidget.prototype=Object.create(Personetics.Widget.prototype);HandlebarsMultiTeaserWidget.prototype.start=function start(el){Personetics.Widget.prototype.start.call(this,el);el.empty();var me=this;this.renderTitle(el);this.renderWrapper(el);if(this.config.hasOwnProperty('payload')&&typeof(this.config.payload)!=='undefined'&&this.config.payload!==null){this.handlePayload()}else{this.sendGetInsights()}};HandlebarsMultiTeaserWidget.prototype.handlePayload=function handlePayload(){if(this.config.hasOwnProperty('isPayloadEncoded')&&typeof this.config.isPayloadEncoded!=='undefined'&&(this.config.isPayloadEncoded==!0||this.config.isPayloadEncoded=="true")){var decodedPayload=JSON.parse(Personetics.utils.encodeDecode.Base64.decode(this.config.payload));this.insights=decodedPayload.insights}else{this.insights=this.config.payload.insights}
this.onGetInsightsResponse({insights:this.insights})};HandlebarsMultiTeaserWidget.prototype.sendGetInsights=function sendGetInsights(){if(typeof personetics!=='undefined'&&personetics!==null&&personetics.hasOwnProperty("getInboxInsights")){var bankInfo=this.config.bankInfo;this.showLoading();personetics.getInboxInsights(bankInfo,Personetics.bind(this,this.onGetInsightsResponse),Personetics.bind(this,this.onError))}};HandlebarsMultiTeaserWidget.prototype.renderTitle=function renderTitle(el){if(this.config.filter==!0){var inboxTitle=Personetics.dictionary.getText("ttlinbox");var titleHtml='<div class="pstory-title perso-teaser-title">'+'<div aria-live="assertive" role="text" class="pstory-title-text">'+inboxTitle+'</div>'+'<input aria-label="close" type="button" class="pstory-title-close">'+'</div>';el.append(titleHtml);el.append("<div class='perso-teaser-filter-wrapper'></div>");this.filter=new window.filterInbox(this);var newEl=$(titleHtml);var closeEl=$(".pstory-title-close");var widget=this;closeEl.bind("click",function(){widget.closeHandler()});el.attr('aria-label',inboxTitle)}};HandlebarsMultiTeaserWidget.prototype.renderWrapper=function renderWrapper(el){el.append("<div class='perso-multi-teaser-template'></div>");this.parentEl=el;this.el=el.find(".perso-multi-teaser-template").last()};HandlebarsMultiTeaserWidget.prototype.onGetInsightsResponse=function onGetInsightsResponse(json){this.insights=json.insights||json;this.hideLoading();if(this.insights){if(this.insights.length>0){this.renderTeasers(this.insights);this.afterRender(this.parentEl)}
else{this.onEmptyInsights(null,Personetics.dictionary.getText("teasersWidgetNoInsightsText"))}}
else{this.onError(null,Personetics.dictionary.getText("teasersWidgetErrorText"))}};HandlebarsMultiTeaserWidget.prototype.onEmptyInsights=function onEmptyInsights(){this.updateHeight();this.el.empty();var params={textLarge:Personetics.dictionary.getText("noInsigthsTextSecondMsg"),textSmall:Personetics.dictionary.getText("noInsigthsTextFirstMsg"),imgClass:"noInsights"};var html=Personetics.utils.messages.noInsightsMessage(params);this.el.append(html)};HandlebarsMultiTeaserWidget.prototype.onError=function onError(serverError,errorMessage){this.updateHeight();this.el.empty();var params={textLarge:Personetics.dictionary.getText("OhNo"),textSmall:Personetics.dictionary.getText("inboxTechnicalIssues"),imgClass:"errorImage"};var html=Personetics.utils.messages.errorMessage(params);this.el.append(html)};HandlebarsMultiTeaserWidget.prototype.renderTeasers=function renderTeasers(insights){var config=this.config;var el=this.el;var insightIdToDisplay=null;if(config.hasOwnProperty("insightIdToDisplay")){insightIdToDisplay=config.insightIdToDisplay}
if(typeof insights!=="undefined"&&insights!==null){if(insightIdToDisplay!==null){insights.forEach(function(insight,index){if(insight.id==insightIdToDisplay){config.insight=insight;var widget=Personetics.UI.PWidgetFactory.createWidget('teaser-widget-single',config);widget.start(el)}})}
else{insights.forEach(function(insight,index){config.insight=insight;var widget=Personetics.UI.PWidgetFactory.createWidget('teaser-widget-single',config);widget.start(el)})}}};HandlebarsMultiTeaserWidget.prototype.afterRender=function afterRender(el,insights,selectedTabId){this.updateHeight();if(typeof insights!=='undefined'&&insights.length==0){if(selectedTabId==="all"){this.sendGetInsights()}else{var params={text:Personetics.dictionary.getText("nothingToShowHere")};var html=Personetics.utils.messages.noFilteredInsightsMessage(params);this.el.append(html)}}};HandlebarsMultiTeaserWidget.prototype.updateHeight=function updateHeight(){var totalSiblingsHeight=0;var siblings=this.el.siblings();$.each(siblings,function(i,sibling){if($(sibling).is(":visible")){totalSiblingsHeight+=$(sibling).outerHeight(!0)}});this.el.height(this.parentEl.height()-totalSiblingsHeight)}
HandlebarsMultiTeaserWidget.prototype.showLoading=function showLoading(){this.el.append("<div class='perso-loading-wrapper'><div>"+Personetics.dictionary.getText("insightsLoadInsights")+"</div><div class='perso-loading'></div></div>")};HandlebarsMultiTeaserWidget.prototype.hideLoading=function hideLoading(){this.el.find(".perso-loading-wrapper").remove()};HandlebarsMultiTeaserWidget.prototype.closeHandler=function closeHandler(){if(typeof personetics!=='undefined'&&personetics!==null&&personetics.hasOwnProperty("getDeviceType")){var deviceType=personetics.getDeviceType()}
if(deviceType==='web'){}
else{if(typeof personetics!=='undefined'&&personetics!==null){var bridge=personetics.getJSBridge();if(bridge&&($.isFunction(bridge.sessionEnded))){Personetics.utils.PEventReporting.setValue("1");bridge.sessionEnded()}
else Personetics.log("Events Delegate not defined")}}};window.HandlebarsMultiTeaserWidget=HandlebarsMultiTeaserWidget})(window,window.Personetics=window.Personetics||{});(function(window,Personetics,undefined){var HandlebarsMultiTeaserWidgetCarousel=function HandlebarsMultiTeaserWidgetCarousel(config){window.HandlebarsMultiTeaserWidget.call(this,config)};HandlebarsMultiTeaserWidgetCarousel.prototype=Object.create(window.HandlebarsMultiTeaserWidget.prototype);HandlebarsMultiTeaserWidgetCarousel.prototype.start=function start(el){window.HandlebarsMultiTeaserWidget.prototype.start.call(this,el)};HandlebarsMultiTeaserWidgetCarousel.prototype.renderTitle=function renderTitle(el){};HandlebarsMultiTeaserWidgetCarousel.prototype.sendGetInsights=function sendGetInsights(){if(typeof personetics!=='undefined'&&personetics!==null&&personetics.hasOwnProperty("getInsights")){var bankInfo=this.config.bankInfo;this.showLoading();personetics.getInsights(bankInfo,Personetics.bind(this,this.onGetInsightsResponse),Personetics.bind(this,this.onError))}};HandlebarsMultiTeaserWidgetCarousel.prototype.afterRender=function afterRender(el){var $innerWrapperEl=el.find('.perso-multi-teaser-template');window.HandlebarsMultiTeaserWidget.prototype.afterRender.call(this);addCarouselClasses(el);this.bindCarousel(el);addNextAccountForAccessibility(el);this.addSelectedButtonForAccessibility(el);if(this.config.widthMode==='desktop'){$innerWrapperEl.attr("tabindex",0);$innerWrapperEl.find(".carousel-item [tabindex='0']").removeAttr('tabindex');$('#personetics-teaser-widget-carousel').find('#perso-teaser-acc-button, .perso-next-button').attr('tabindex',-1)}};HandlebarsMultiTeaserWidgetCarousel.prototype.renderWrapper=function renderWrapper(el){window.HandlebarsMultiTeaserWidget.prototype.renderWrapper.call(this,el);var $innerWrapperEl=el.find('.perso-multi-teaser-template');$innerWrapperEl.wrap('<div class="carousel-animate carousel-wrapper"></div>');$innerWrapperEl.addClass('carousel-inner-wrapper')};var addNextAccountForAccessibility=function addNextAccountForAccessibility(el){var container=el;var nextAccText="click to select next teaser";var nextAccButton=$('<input type="button" class="perso-next-button" aria-label="'+nextAccText+'" />')
container.append(nextAccButton);var nextTeaser=el.find('.carousel-item.selected:not([clone="true"])').next();if(nextTeaser.length==0)
return;var top=nextTeaser.offset().top-container.offset().top;var left=nextTeaser.offset().left-container.offset().left;var visibleHeight=Math.min(nextTeaser.height(),container.height()-top);var visibleWidth=Math.max(10,container.width()-left);nextAccButton.css({'top':top,'left':left,'height':visibleHeight,'width':visibleWidth,'position':'absolute','background':'transparent','border':'none','outline':'none'});container.css('position','relative');nextAccButton.siblings().css({'position':'relative'});bindEventsForAccButton(el,nextAccButton)};var bindEventsForAccButton=function bindEventsForAccButton(el,nextAccButton){nextAccButton.bind('click',function(){var nextTeaser=el.find('.carousel-item.selected:not([clone="true"])').next();if(nextTeaser.length==0)
nextTeaser=el.find('.carousel-item.selected:not([clone="true"])').prev();nextTeaser.click()})};HandlebarsMultiTeaserWidgetCarousel.prototype.addSelectedButtonForAccessibility=function addSelectedButtonForAccessibility(el){var container=el;var selectedTeaser=el.find('.carousel-item.selected:not([clone="true"])');var teaserAccButton=$('<input id="perso-teaser-acc-button" type="button" class="account-button selected perso-teaser-acc-button"/>');container.append(teaserAccButton);if(selectedTeaser.length==0)
return;this.setSelectedAccButtonLabel();var top=selectedTeaser.offset().top-container.offset().top;var left=selectedTeaser.offset().left-container.offset().left;var visibleHeight=Math.min(selectedTeaser.height(),container.height()-top);var visibleWidth=Math.max(10,container.width()-left);teaserAccButton.css({'top':top,'left':left,'height':visibleHeight,'width':visibleWidth,'position':'absolute','background':'transparent','border':'none','outline':'none'});container.css('position','relative');teaserAccButton.siblings().css({'position':'relative'});bindEventsForTeaserAccButton(el,teaserAccButton)};HandlebarsMultiTeaserWidgetCarousel.prototype.setSelectedAccButtonLabel=function setSelectedAccButtonLabel(){el=this.parentEl
var selectedTeaser=el.find('.carousel-item.selected:not([clone="true"])');var selectedTeaserId=selectedTeaser.attr('pstory-id');el.find('#perso-teaser-acc-button').attr('aria-labelledby',selectedTeaserId)};var bindEventsForTeaserAccButton=function bindEventsForTeaserAccButton(el,teaserAccButton){teaserAccButton.bind('click',function(){selectedTeaserId=teaserAccButton.attr('aria-labelledby');var selectedTeaser=el.find('#'+selectedTeaserId);selectedTeaser.click()})};var addCarouselClasses=function addCarouselClasses(el){var $teaserTemplateElms=el.find('.perso-teaser-template');var carouselItemTemplate='<div class="carousel-item" role="button"></div>';$teaserTemplateElms.each(function(){$(this).wrap(carouselItemTemplate);var pstoryId=$(this).attr('id');$(this).parent().attr('pstory-id',pstoryId)})};HandlebarsMultiTeaserWidgetCarousel.prototype.bindCarousel=function bindCarousel(el){var param=getOptionsWidth(el);param.afterCarouselEnd=Personetics.bind(this,this.setSelectedAccButtonLabel);this.carouselAnimation=new Personetics.utils.carouselAnimation.bindCarouselEventsForAnimation(el,param)};var getOptionsWidth=function getOptionsWidth(el){var container=el.find('.perso-multi-teaser-template');var teaserWidth=container.find('.carousel-item').outerWidth(!0);return{itemWidth:teaserWidth,selectedItemWidth:teaserWidth,numItemsDispaly:container.children().length}};window.HandlebarsMultiTeaserWidgetCarousel=HandlebarsMultiTeaserWidgetCarousel})(window,window.Personetics=window.Personetics||{});(function(window,Personetics,undefined){var Handlebars=Personetics.UI.Handlebars;var filterInboxStory=function filterInboxStory(widget){this.parentEl=widget.element;this.widget=widget;this.renderer=Personetics.bind(widget,widget.__proto__.renderTeasers);this.afterRenderer=Personetics.bind(widget,widget.__proto__.afterRender);this.texts={"ttlinboxAll":Personetics.dictionary.getText("ttlinboxAll"),"ttlinboxHighlighted":Personetics.dictionary.getText("ttlinboxHighlighted"),"ttlinboxUnread":Personetics.dictionary.getText("ttlinboxUnread")};var tmpl=Handlebars.templates['filter-inbox-template'];var html=tmpl({"texts":this.texts});this.el=this.parentEl.find(".perso-teaser-filter-wrapper");this.el.append(html);this.afterRender()};filterInboxStory.prototype.bindEvents=function(){var enterKeyCode=13;var spaceKeyCode=32;var helper=this;this.el.find(".perso-teaser-filter-tab").bind("click",function(e){helper.onSelectTab($(e.target))});this.el.find(".perso-teaser-filter-tab").bind("keydown",function(e){if(([enterKeyCode,spaceKeyCode].indexOf(e.which)!==-1)){helper.onSelectTab($(e.target))}})};filterInboxStory.prototype.onSelectTab=function(selected){if(selected.hasClass("selected"))
{return}
var selectedTabId=selected.data("id");var $previousSelectedTab=this.el.find(".perso-teaser-filter-tab");$previousSelectedTab.removeClass('selected');$previousSelectedTab.attr('aria-selected',!1);selected.addClass('selected');selected.attr('aria-selected',!0);var filteredInsights=this.filterInsights(selectedTabId);this.parentEl.find(".perso-multi-teaser-template").empty();if(typeof this.renderer=='function'){this.renderer(filteredInsights)}
if(typeof this.afterRenderer=='function'){this.afterRenderer(this.parentEl,selectedTabId)}};filterInboxStory.prototype.filterInsights=function filterInsights(selectedId){var filteredInsights;var insights=this.widget.insights;if(typeof insights==="undefined"||insights===null)
return[];switch(selectedId){case "all":filteredInsights=insights;break;case "flagged":filteredInsights=insights.filter(function(item){return item.highlighted});break;case "unread":case "new":filteredInsights=insights.filter(function(item){return item.status=="unread"||item.status=="new"});break;default:filteredInsights=insights}
return filteredInsights};filterInboxStory.prototype.afterRender=function(){this.parentEl.find('.perso-teaser-filter-wrapper ul').children().each(function(i){$(this).attr('tabindex',0)});this.bindEvents()};filterInboxStory.prototype.onGetInsights=function(insights){this.insights=insights};filterInboxStory.prototype.updateInsight=function(insightId){if(typeof this.widget.insights!=="undefined"&&this.widget.insights.length){var insight;if(insightId){insight=this.widget.insights.filter(function(ins){return ins.id===insightId})}
insight=(insight&&insight.length>0)?insight[0]:this.widget.insights[0];insight.status="read";return insight.id}};window.filterInboxStory=filterInboxStory})(window,window.Personetics=window.Personetics||{});(function(window,Personetics,Handlebars,undefined){var HandlebarsTeaserInboxAndStoryWidget=function HandlebarsTeaserInboxAndStoryWidget(config){Personetics.Widget.call(this,config)};HandlebarsTeaserInboxAndStoryWidget.prototype=Object.create(window.Personetics.Widget.prototype);HandlebarsTeaserInboxAndStoryWidget.prototype.start=function start(el){var inboxContent=Handlebars.templates[this.config.templateId?this.config.templateId:'inboxContainer'];el.append(inboxContent);inboxContainerEl=el.find("#personetics-inbox-container");this.config.story.el=el.find("#personetics-story");Personetics.Widget.prototype.start.call(this,inboxContainerEl);inboxContainerEl.empty();if(typeof teaserData!=="undefined"){this.config.payload=teaserData}
this.renderTitle(inboxContainerEl);Personetics.utils.accessibility.trackFocus(inboxContainerEl.find(".perso-teaser-filter-wrapper"));this.renderWrapper(inboxContainerEl);if(this.config.hasOwnProperty('payload')&&typeof(this.config.payload)!=='undefined'&&this.config.payload!==null){this.handlePayload()}else{this.sendGetInsights()}
this.updateHeight()};HandlebarsTeaserInboxAndStoryWidget.prototype.handlePayload=function handlePayload(){if(this.config.hasOwnProperty('isPayloadEncoded')&&typeof this.config.isPayloadEncoded!=='undefined'&&(this.config.isPayloadEncoded==!0||this.config.isPayloadEncoded=="true")){var decodedPayload=JSON.parse(Personetics.utils.encodeDecode.Base64.decode(this.config.payload));this.insights=decodedPayload.insights}else{this.insights=this.config.payload.insights}
this.onGetInsightsResponse({insights:this.insights})};HandlebarsTeaserInboxAndStoryWidget.prototype.sendGetInsights=function sendGetInsights(){if(typeof personetics!=='undefined'&&personetics!==null&&personetics.hasOwnProperty("getInboxInsights")){var bankInfo=this.config.bankInfo;this.showLoading();var me=this;personetics.getInboxInsights(bankInfo,Personetics.bind(this,me.onGetInsightsResponse),Personetics.bind(this,me.onError))}};HandlebarsTeaserInboxAndStoryWidget.prototype.renderTitle=function renderTitle(el){if(this.config.filter==!0){var inboxTitle=Personetics.dictionary.getText("ttlinboxstory");var titleHtml='<div class="pstory-title perso-teaser-title">'+'<div aria-live="assertive" role="text" class="pstory-title-text">'+inboxTitle+'</div>'+'<input aria-label="close" type="button" class="pstory-title-close" tabindex="0">'+'</div>';el.append(titleHtml);el.append("<div class='perso-teaser-filter-wrapper'></div>");this.filter=new window.filterInboxStory(this);var newEl=$(titleHtml);var closeEl=$(".pstory-title-close");var widget=this;closeEl.bind("click",function(){widget.closeHandler()});el.attr('aria-label',inboxTitle)}};HandlebarsTeaserInboxAndStoryWidget.prototype.renderWrapper=function renderWrapper(el){el.closest(".personetics-widgets-wrapper").addClass("personetics-widgets-insights-inbox-wrapper");el.append("<div class='perso-multi-teaser-template'></div>");this.parentEl=el;this.el=el.find(".perso-multi-teaser-template").last()};HandlebarsTeaserInboxAndStoryWidget.prototype.onGetInsightsResponse=function onGetInsightsResponse(json){this.insights=json.insights||json;this.hideLoading();if(this.insights){if(this.insights.length>0){this.renderTeasers(this.insights);this.afterRender(this.parentEl)}
else{this.onEmptyInsights()}}
else{this.onError(null,Personetics.dictionary.getText("inboxTechnicalIssues"))}};HandlebarsTeaserInboxAndStoryWidget.prototype.onEmptyInsights=function(){this.el.empty();var params={textLarge:Personetics.dictionary.getText("noInsigthsTextSecondMsg"),textSmall:Personetics.dictionary.getText("There are no insights for you right now"),imgClass:"errorImage"};var html=Personetics.utils.messages.noInsightsMessage(params);this.el.append(html)}
HandlebarsTeaserInboxAndStoryWidget.prototype.onError=function onError(serverError,errorMessage){this.updateHeight();this.el.empty();var params={textLarge:Personetics.dictionary.getText("OhNo"),textSmall:Personetics.dictionary.getText("inboxTechnicalIssues"),imgClass:"errorImage"};var html=Personetics.utils.messages.errorMessage(params);this.el.append(html)};HandlebarsTeaserInboxAndStoryWidget.prototype.renderTeasers=function renderTeasers(insights){var config=this.config;var el=this.el;var me=this;var insightIdToDisplay=null;if(config.hasOwnProperty("insightIdToDisplay")){insightIdToDisplay=config.insightIdToDisplay}
if(typeof insights!=="undefined"&&insights!==null){if(insightIdToDisplay!==null){insights.forEach(function(insight,index){if(insight.id==insightIdToDisplay){config.insight=insight;config.widget=me;var widget=Personetics.UI.PWidgetFactory.createWidget('teaser-widget-single',config);widget.start(el)}})}
else{insights.forEach(function(insight,index){config.insight=insight;config.widget=me;var widget=Personetics.UI.PWidgetFactory.createWidget('teaser-widget-single',config);widget.start(el)})}}};HandlebarsTeaserInboxAndStoryWidget.prototype.afterRender=function afterRender(el,selectedTabId){Personetics.utils.accessibility.trackFocus(this.el);this.updateHeight();if(this.el.children().length){if(typeof selectedTabId!=="undefined")
{this.startStory()}
else{this.setSelected(this.config.story.teaserId);this.startStory(this.config.story)}}
else{if(selectedTabId==="all"){if(this.config.hasOwnProperty('payload')&&typeof(this.config.payload)!=='undefined'&&this.config.payload!==null){this.handlePayload()}else{this.sendGetInsights()}}
else{var params={text:Personetics.dictionary.getText("nothingToShowHere")};var html=Personetics.utils.messages.noFilteredInsightsMessage(params);this.el.append(html);this.config.story.el.empty()}}};HandlebarsTeaserInboxAndStoryWidget.prototype.updateHeight=function updateHeight(){var totalSiblingsHeight=0;var siblings=this.el.siblings();$.each(siblings,function(i,sibling){if($(sibling).is(":visible")){totalSiblingsHeight+=$(sibling).outerHeight(!0)}});this.el.find(".perso-teaser-template").each(function(){var elem=$(this);elem.prepend("<div class='perso-teaser-overlay'></div>")});this.el.height(this.config.el.height()-totalSiblingsHeight-parseInt(this.el.css('margin-top'),10)-7)}
HandlebarsTeaserInboxAndStoryWidget.prototype.startStory=function startStory(params){if(!params)
{this.loadFirstTeaserStory()}
else{if(this.config.filter){params.insightId=this.filter.updateInsight(params.insightId);if(!params.instanceId){for(var i=0;i<this.insights.length;i++){if(this.insights[i].id===params.insightId){params.instanceId=this.insights[i].insightId}}}
params.teaserId=params.teaserId||"perso-teaser-template_"+params.insightId;this.updateSelectTeasers(params.teaserId);for(key in params){if(typeof params[key]!=="undefined"){this.config.story[key]=params[key]}}}
personetics.startWidget(this.config.story)}};HandlebarsTeaserInboxAndStoryWidget.prototype.updateSelectTeasers=function updateSelectTeasers(insightId)
{className="selected";var teaserObj=this.el.find("#"+insightId);if(teaserObj.length){if(!teaserObj.hasClass(className)){var teasers=this.el.find(".perso-teaser-template.selected");$.each(teasers,function(i,teaser){$(teaser).removeClass(className)});teaserObj.addClass(className)}
this.scrollIntoView(teaserObj.get(0))}
else{this.loadFirstTeaserStory()}};HandlebarsTeaserInboxAndStoryWidget.prototype.setSelected=function setSelected(teaserId)
{if(teaserId===null){var teaserObj=el.find(".perso-teaser-template").eq(0);if(teaserObj.length)
{teaserObj.click()}
else{$("#personetics-story").empty()}}
else{var teaserObj=this.el.find("#"+teaserId);if(teaserObj.length){teaserObj.addClass("selected")
this.scrollIntoView(teaserObj.get(0))}
else{this.config.story.el.empty()}}};HandlebarsTeaserInboxAndStoryWidget.prototype.loadFirstTeaserStory=function loadFirstTeaserStory()
{var teaserObj=this.el.find(".perso-teaser-template").eq(0);if(teaserObj.length)
{teaserObj.click()}
else{$("#personetics-story").empty()}};HandlebarsTeaserInboxAndStoryWidget.prototype.scrollIntoView=function scrollIntoView(e){if(this.isInViewport(e))
{return}
$('.perso-multi-teaser-template').animate({scrollTop:$(e).offset().top},1000)}
HandlebarsTeaserInboxAndStoryWidget.prototype.isInViewport=function isInViewport(element){var rect=element.getBoundingClientRect();var html=document.documentElement;return(rect.top>=40&&rect.left>=0&&rect.bottom<=(window.innerHeight||html.clientHeight)&&rect.right<=(window.innerWidth||html.clientWidth))}
HandlebarsTeaserInboxAndStoryWidget.prototype.showLoading=function showLoading(){this.el.append("<div class='perso-loading-wrapper'><div>"+Personetics.dictionary.getText("insightsLoadInsights")+"</div><div class='perso-loading'></div></div>")};HandlebarsTeaserInboxAndStoryWidget.prototype.hideLoading=function hideLoading(){this.el.find(".perso-loading-wrapper").remove()};HandlebarsTeaserInboxAndStoryWidget.prototype.closeHandler=function closeHandler(){this.config.story&&this.config.story.el.empty()
if(typeof personetics!=='undefined'&&personetics!==null&&personetics.hasOwnProperty("getDeviceType")){var deviceType=personetics.getDeviceType()}
if(deviceType==='web'){}
else{if(typeof personetics!=='undefined'&&personetics!==null){var bridge=personetics.getJSBridge();if(bridge&&($.isFunction(bridge.sessionEnded))){bridge.sessionEnded()}
else Personetics.log("Events Delegate not defined")}}};HandlebarsTeaserInboxAndStoryWidget.prototype.teaserClick=function teaserClick(event){var eventType=this.config!=="undefined"&&this.config.hasOwnProperty("eventType")&&typeof this.config.eventType!=="undefined"?this.config.eventType:"teaserClick";var params={userId:event.data.userId,insightId:event.data.insightId,instanceId:event.data.instanceId,eventType:eventType,lang:event.data.lang,clickedTeaser:$(event.currentTarget),teaserId:this.teaserId};Personetics.utils.PEventReporting.setValue({"instanceId":params.insightId,"insightId":params.instanceId,"userId":event.data.userId});if(typeof personetics!=='undefined'&&personetics!==null&&personetics.hasOwnProperty("sendWidgetEvent"))
personetics.sendWidgetEvent(this,params);else console.log("personetics JS API is not available")};window.HandlebarsTeaserInboxAndStoryWidget=HandlebarsTeaserInboxAndStoryWidget})(window,window.Personetics=window.Personetics||{},Personetics.UI.Handlebars);(function(window,Personetics,$,undefined){Personetics.UI=Personetics.UI||{};Personetics.UI.PLoadingAnimationCtrl=Personetics.UI.PWidgetCtrl.extend({initialize:function(config){this.super=Personetics.UI.PWidgetCtrl.prototype;this.super.initialize.call(this,config);this.loadingText=this.getLoadingTxt(config)},getLoadingTxt:function getLoadingTxt(config){return config.loadingText},start:function(el){this.el=el;this.el.empty();var loadingText=this.loadingText;var loadingTmpl=this.getTemplateHtml("#tmpl-perso-loading-animation",{loadingText:loadingText});el.append(loadingTmpl);this.afterRender()},afterRender:function afterRender(){this.setHeightToParentSpace()},setHeightToParentSpace:function setHeightToParentSpace(){var parentEl=this.el.parent();var parentHeight=parentEl.height();var totalSiblingsHeight=0;var siblings=this.el.siblings();$.each(siblings,function(index,item){if($(item).css("position")=="static")
totalSiblingsHeight+=$(item).height()})
var loadingHeight=parentHeight-totalSiblingsHeight;this.el.find("#perso-loading-widget").height(loadingHeight)},removeLoading:function renderLoading(){var loadingEl=this.el.children("#perso-loading-widget");loadingEl.remove()}})})(window,window.Personetics=window.Personetics||{},jQuery);(function(window,Personetics,$,undefined){Personetics.UI=Personetics.UI||{};Personetics.UI.PRatingCtrlCITI=Personetics.UI.PRatingCtrl.extend({showFeedback:function showFeedback(){Personetics.UI.PRatingCtrl.prototype.showFeedback.call(this);var submit=$(this.el.find('.perso-feedback-submit'));submit.css('margin-left','0');this.el.find('.perso-feedback-submit').show()},feedbackTextInput:function feedbackTextInput(e){var sendButton=$(this.el).find('.perso-feedback-submit');if(e.target.value.length>0){sendButton.removeAttr('disabled');sendButton.removeClass("disabled-button")}
else{if(sendButton.length>0){sendButton.attr('disabled','disabled');sendButton.addClass("disabled-button")}}
Personetics.UI.PRatingCtrl.prototype.feedbackTextInput.call(this,e)},scrollToEnd:function scrollTo(el,toElement){el=$("#personetics-story-widget");if(toElement.length>0){$(el).animate({scrollTop:toElement.offset().top-el.offset().top+el.scrollTop()},500)}},feedbackStart:function feedbackStart(){if(Personetics.projectConfiguration.getConfig("showFeedback")==!0){if(!this.disableFeedBack){this.showFeedback()}
else{if($(this.el.find('.perso-feedback-text')).length>0){var lblfeedbackprompt=Personetics.dictionary.getText("lblfeedbackprompt"+this.eventObj.rating);$(this.el.find('.perso-feedback-label')).text(lblfeedbackprompt)}}}},showFeedbackReaction:function showFeedbackReaction(){var widget=this;var height=$(this.el.find('.perso-feedback-wrapper')).height();$(this.el.find('.perso-feedback-wrapper')).height(height);var element=this.el.find('.perso-feedback-reaction');$(element).show();var heightreaction=$(this.el.find('.perso-feedback-reaction')).outerHeight();$('.perso-feedback-wrapper').animate({'scrollTop':200,'height':heightreaction},400,function(){widget.disableFeedBack=!1;$(".textarea-wrapper").hide()})}})})(window,window.Personetics=window.Personetics||{},jQuery);(function(window,Personetics,$,undefined){Personetics.UI=Personetics.UI||{};Personetics.UI.PLoadingAnimationCtrlCITI=Personetics.UI.PLoadingAnimationCtrl.extend({getLoadingTxt:function getLoadingTxt(){return Personetics.dictionary.getText("loadingMassage")},})})(window,window.Personetics=window.Personetics||{},jQuery);(function(window,Personetics,$,undefined){Personetics.story=Personetics.story||{};Personetics.story.ProductSkinControler=Personetics.story.PSkinControler.extend({registerWidgets:function(){this.registerDefaultWidgets();Personetics.UI.PWidgetFactory.registerWidget("app-ctrl",{widgetClass:Personetics.UI.PAppCtrlProduct,widgetName:"Product app ctrl"});Personetics.UI.PWidgetFactory.registerWidget("master",{widgetClass:Personetics.UI.PAppCtrlProduct,widgetName:"Product master"});Personetics.UI.PWidgetFactory.registerWidget("master-teaser",{widgetClass:Personetics.UI.PAppTeaserCtrl,widgetName:"Product master teaser"});Personetics.UI.PWidgetFactory.registerWidget("story-widget",{widgetClass:Personetics.UI.PStoryWidgetCtrlProduct,widgetName:"Product story widget"});Personetics.UI.PWidgetFactory.registerWidget("inbox-story-widget",{widgetClass:window.HandlebarsTeaserInboxAndStoryWidget,widgetName:"Product inbox and story widget"});Personetics.UI.PWidgetFactory.registerWidget("teaser-widget-single",{widgetClass:window.HandlebarsTeaserWidget,widgetName:"Product single teaser widget"});Personetics.UI.PWidgetFactory.registerWidget("teaser-widget",{widgetClass:window.HandlebarsMultiTeaserWidget,widgetName:"Product teaser widget"});Personetics.UI.PWidgetFactory.registerWidget("teaser-widget-carousel",{widgetClass:window.HandlebarsMultiTeaserWidgetCarousel,widgetName:"Product teaser widget"});Personetics.UI.PWidgetFactory.registerWidget("ratings",{widgetClass:Personetics.UI.PRatingCtrlDesktop,widgetName:"Desktop ratings",widthMode:"desktop"})},registerBlocks:function(){Personetics.story.PSkinControler.prototype.registerBlocks.call(this);this.registerBlock("account-selector",{blockClass:Personetics.story.AccountSelectorBlockProduct});this.registerBlock("account-selector",{widthMode:"desktop",blockClass:Personetics.story.AccountSelectorBlockProductDesktop});this.registerBlock("buttons",{blockClass:Personetics.story.ButtonsBlockProduct});this.registerBlock("pie-chart",{blockClass:Personetics.story.PieChartBlockProduct});this.registerBlock("arc-chart",{blockClass:Personetics.story.PieChartBlockProduct});this.registerBlock("pie-chart",{widthMode:"desktop",blockClass:Personetics.story.PieChartBlockProductDesktop});this.registerBlock("bar-chart",{blockClass:Personetics.story.D3BarChartBlockProduct});this.registerBlock("bar-chart",{widthMode:"desktop",blockClass:Personetics.story.D3BarChartBlockProductDesktop});this.registerBlock("pin-graph",{blockClass:Personetics.story.D3PinGraphChartBlockProduct});this.registerBlock("pin-graph",{widthMode:"desktop",blockClass:Personetics.story.D3PinGraphChartBlockProductDesktop});this.registerBlock("line-chart",{blockClass:Personetics.story.DotsLineChartBlock});this.registerBlock("line-chart",{widthMode:"desktop",blockClass:Personetics.story.DotsLineChartBlockDesktop});this.registerBlock("table",{blockClass:Personetics.story.TableBlockProduct});this.registerBlock("tranList",{blockClass:Personetics.story.TableBlockProduct});this.registerChartHelper("verticalHelper",{helperClass:Personetics.utils.d3Helpers.VerticalChartHelperProduct});this.registerChartHelper("multiVerticalHelper",{helperClass:Personetics.utils.d3Helpers.MultiVerticalChartHelperDesktop,widthMode:"desktop"});this.registerChartHelper("pinGraphHelper",{helperClass:Personetics.utils.d3Helpers.PinGraphChartHelperProduct});this.registerChartHelper("collapseHelper",{helperClass:Personetics.story.CollapseHelper})},getScreenOptions:function(){return{ratio_medium:1.17,ratio_large:1.3}},getValueByScreenWidth:function(value){var screenWidth=$(window).width();var screenOptions=this.getScreenOptions();var returnValue=value;if(screenWidth>=414){returnValue=value*screenOptions.ratio_large}else if(screenWidth>=347){returnValue=value*screenOptions.ratio_medium}
return returnValue},getDesktopScreenWidth:function(){return 790},getCollapseOptions:function(){var screenWidth=$(window).width();var screenOptions=this.getScreenOptions();var displayedHeight;if(screenWidth<347){displayedHeight=70}else if(screenWidth>=414){displayedHeight=70*screenOptions.ratio_large}else{displayedHeight=70*screenOptions.ratio_medium}
return{"displayedHeight":displayedHeight}},getColumnChartOptions:function(){var options={maxBarHeight:99,svgHeight:200,svgWidth:320,labelTop:27,barTop:41,xAxisTop:170,yAxisHeight:128,yAxisTop:20,yAxisLineDisplay:!0,yAxisTextDisplay:!1,negativeYAxisTop:181,negativeBarTop:190,horizontalLineWidth:281,horizontalLineLeft:20,screen:{ratio_medium:1.17,ratio_large:1.3},margin:{top:43,bottom:40},height:180,chart:{transX:0,transY:10},labels:{drawLabels:!0,marginBottom:18,marginTop:-10},rectangles:{width:16,space:33,minHeightPercent:0.15,borderRadius:{rx:9,ry:9},marginFromBottom:15,marginFromLeft:0,gradients:[{id:"selectedGradient",offset:["0%","100%"],stopColors:["#6888d2","#536fb1"]}],filter:{dropShadow:{id:"dropShadow",in:"SourceGraphic",stdDeviation:3,dxOffset:1,dyOffset:2}},transition:{duration:1000,delay:500}},selected:{},axis:{translation:{x:0,y:"height"},xAxis:{hide:!1,collapsedPadding:{top:22,bottom:15}},yAxis:{x:0,y:0,hide:!0}}};return options},getPinGraphChartOptions:function(){var options={svgHeight:200,svgWidth:281,maxBarHeight:112,labelTop:12,barTop:27,xAxisTop:170,yAxisHeight:128,yAxisTop:20,yAxisLineDisplay:!0,yAxisTextDisplay:!1,screen:{ratio_medium:1.17,ratio_large:1.3},margin:{top:43,bottom:40},height:180,chart:{transX:0,transY:10},totalHeight:220,labels:{drawLabels:!0,marginBottom:18,marginTop:4.5},rectangles:{minHeightPercent:0.15,width:9,space:40,borderRadius:{rx:4,ry:4},marginFromBottom:15,gradients:{selectedGradient:{id:"selectedGradient",offset:["0%","100%"],stopColors:["#6888d2","#536fb1"]}},filter:{dropShadow:{id:"dropShadow",in:"SourceGraphic",stdDeviation:3,dxOffset:1,dyOffset:2}},transition:{duration:1000,delay:500}},selected:{},axis:{translation:{x:0,y:"height"},xAxis:{hide:!1,tickPadding:10,collapsedPadding:{top:22,bottom:15}},yAxis:{x:0,y:0,hide:!0}}};return options},getColumnChartMultiSeriesOptions:function(){var options={svgHeight:200,svgWidth:313,maxBarHeight:93,labelTop:45,nextLabelTop:14,barTop:56,xAxiaTop:170,verticalLineTop:20,lineHeight:130,drowVerticalLines:!0,yAxisDisplay:!1,screen:{ratio_medium:1.17,ratio_large:1.3},margin:{top:34,right:24,bottom:72,left:24},totalHeight:220,labels:{drawLabels:!0,marginTop:-16,marginBottom:4,right:2},rectangles:{width:9,space:41,paddingTop:30,paddingLeft:-19,paddingRight:22,paddingBottom:33,seriesPadding:12.5,transX:4,minHeight:0.25,borderRadius:{rx:4,ry:4},marginFromBottom:5,gradients:{selectedInGradient:{id:"selectedInGradient",offset:["0%","100%"],stopColors:["#7193e2","#485f96"]},selectedOutGradient:{id:"selectedOutGradient",offset:["0%","100%"],stopColors:["#ffcc00","#ffb80a"]}},filter:{dropShadow:{id:"dropShadow",in:"SourceGraphic",stdDeviation:3,dxOffset:1,dyOffset:2}},transition:{duration:1000,delay:500}},selected:{},axis:{translation:{x:2.5,y:"height"},xAxis:{hide:!1,tickPadding:10,minimizedPadding:{top:22,bottom:15}}}};return options},getDotsLineChartOptions:function(){var options={screen:{ratio_medium:1.17,ratio_large:1.3},svgHeight:200,svgWidth:320,line_left:59,line_top:20,line_width:227,line_height:130,area_display:!1,lineStyle_interpolate:'cardinal',lineStyle_thickness:3,xAxis_line_y:20,xAxis_line_x:63,xAxis_line_height:130,xAxis_text_y:171,xAxis_text_x:57,xAxis_display:!0,yAxis_x:47,yAxis_y:20,yAxis_display:!0,duration:2000,dots_radius:4.5,dots_radius_selected:5,labels_x:59,labels_y:8.3,labels_display:!0,horizonalLine_x:0,horizonalLine_length:308,horizonalLine_y:100,horizonalLine_display:!1,highlightBy:'last'}
return options},getDotsLineChartOptionsDesktop:function(){var options={screen:{ratio_medium:1.17,ratio_large:1.3},svgHeight:404,svgWidth:790,line_left:89,line_top:105,line_width:611,line_height:162,area_display:!1,lineStyle_interpolate:'cardinal',lineStyle_thickness:4,xAxis_line_y:47,xAxis_line_x:89,xAxis_line_height:257,xAxis_text_y:339,xAxis_text_x:93,xAxis_display:!0,yAxis_x:47,yAxis_y:20,yAxis_display:!1,duration:2000,dots_radius:5,dots_radius_selected:9,labels_x:91,labels_y:24.31,labels_display:!0,horizonalLine_display:!1,highlightBy:'last'}
return options},getBarChartOptions:function(){var options={screen:{ratio_medium:1.17,ratio_large:1.3},margin:{top:22,bottom:0},drawLabels:!0,rectangles:{height:13,width:281,color:"rgba(169, 167, 167, 1)",paddingTop:-28,paddingBottom:10,seriesPadding:3,borderRadius:{rx:6,ry:6},gradients:{selectedGradient:{id:"selectedGradient",offset:["0%","100%"],stopColors:["#6888d2","#536fb1"]}},filter:{dropShadow:{id:"dropShadow",in:"SourceGraphic",stdDeviation:3,dxOffset:1,dyOffset:2}}},labels:{minWidth:100,},selected:{},axis:{xAxis:{hide:!0},yAxis:{hide:!1,transValue:-20}}};return options},getBarGraphPalette:function(){return['rgba(169, 167, 167, 1)','url(#selectedGradient)']},getBarGraphLabelsPalette:function(){return['rgba(40, 36, 37, 1)','rgba(84, 113, 180, 1)']},getMultiVerticalPalette:function(){return['rgba(183, 183, 183, 1)','rgba(215, 215, 215, 1)']},getMultiVerticalLabelsPalette:function(){return['rgba(147, 145, 149, 1)','rgba(40, 36, 37, 1)']},getPieGraphPalette:function(selectedTabId){var outFlowsPalette=['#ffce40','#ffb608','#ff9819','#fe7d3f','#f9652b','#df4c3a','#c72735'];var inFlowsPalette=['#6787d1','#027ac4','#7390c5','#3095bd','#45a5d3','#5acafa','#95dafb'];if(selectedTabId=="Out")
return outFlowsPalette;return inFlowsPalette},getPieOptions:function(){var options={arcs:{selctedPrimaryColor:null,selectedInflowPrimaryColor:null,selectedOutflowPrimaryColor:null,filter:{grayFilter:!0},cornerRadius:{radiusCorner:9},padAngle:0.04}}
return options},getPieOptionsDesktop:function(){var options={arcs:{selctedPrimaryColor:null,selectedInflowPrimaryColor:null,selectedOutflowPrimaryColor:null,filter:{grayFilter:!0},cornerRadius:{radiusCorner:9},padAngle:-0.02},drawCenterLine:!0,centerLineWidth:100}
return options},getPinGraphChartOptionsDesktop:function(){var options={isDesktop:!0,maxBarHeight:177,svgHeight:404,svgWidth:730,labelTop:90,barTop:114,xAxisTop:340,yAxisHeight:255,yAxisTop:47,yAxisLineDisplay:!0,yAxisTextDisplay:!1,screen:{ratio_medium:1.17,ratio_large:1.3},margin:{top:120,bottom:117},chart:{transX:0,transY:10},labels:{drawLabels:!0},rectangles:{width:14,space:89,borderRadius:{rx:6,ry:6},gradients:[{id:"selectedGradient",offset:["0%","100%"],stopColors:["#6888d2","#536fb1"]}],filter:{dropShadow:{id:"dropShadow",in:"SourceGraphic",stdDeviation:3,dxOffset:1,dyOffset:2}},transition:{duration:1000,delay:500}},selected:{},axis:{translation:{x:0,y:"height"},xAxis:{hide:!1,collapsedPadding:{top:22,bottom:15}}}};return options},getColumnChartOptionsDesktop:function(){var options={isDesktop:!0,maxBarHeight:150,svgHeight:404,svgWidth:730,labelTop:118,barTop:137,xAxisTop:340,yAxisHeight:253,yAxisTop:49,yAxisLineDisplay:!0,yAxisTextDisplay:!1,screen:{ratio_medium:1.17,ratio_large:1.3},chart:{transX:0,transY:10},labels:{drawLabels:!0},rectangles:{width:18,space:87,borderRadius:{rx:9,ry:9},gradients:[{id:"selectedGradient",offset:["0%","100%"],stopColors:["#6888d2","#536fb1"]}],filter:{dropShadow:{id:"dropShadow",in:"SourceGraphic",stdDeviation:3,dxOffset:1,dyOffset:2}},transition:{duration:1000,delay:500}},selected:{},axis:{translation:{x:0,y:"height"},xAxis:{hide:!1,collapsedPadding:{top:22,bottom:15}},yAxis:{x:0,y:0,hide:!0}}};return options},getColumnChartMultiSeriesOptionsDesktop:function(){var options={svgHeight:404,svgWidth:730,maxBarHeight:180,labelTop:80,nextLabelTop:21,barTop:107,xAxiaTop:340,yAxisTop:49,yAxisHeight:253,spaceLeft:30,yAxisLineDisplay:!0,yAxisTextDisplay:!1,drowVerticalLines:!1,accessHiddenRectMarginLeft:0,accessHiddenRectMarginTop:43,screen:{ratio_medium:1.17,ratio_large:1.3},chart:{transX:0,transY:0},labels:{drawLabels:!0,right:6},rectangles:{width:18,space:57,seriesPadding:12.5,paddingRight:25,transX:4,borderRadius:{rx:9,ry:9},gradients:{selectedInGradient:{id:"selectedInGradient",offset:["100%"],stopColors:["rgba(84, 113, 180, 1)"]},selectedOutGradient:{id:"selectedOutGradient",offset:["100%"],stopColors:["rgba(255, 185, 10, 1)"]}},filter:{dropShadow:{id:"dropShadow",in:"SourceGraphic",stdDeviation:3,dxOffset:1,dyOffset:2}},transition:{duration:1000,delay:500}},selected:{},axis:{translation:{x:8,y:"height"},xAxis:{hide:!1,tickPadding:10,minimizedPadding:{top:22,bottom:15}},yAxis:{hide:!0,x:0,y:30}}};return options},getBarChartOptionsDesktop:function(){var options={screen:{ratio_medium:1.17,ratio_large:1.3},margin:{top:22,bottom:0},drawLabels:!0,rectangles:{height:13,width:730,color:"rgba(169, 167, 167, 1)",paddingTop:-28,paddingBottom:10,seriesPadding:3,borderRadius:{rx:6,ry:6},gradients:{selectedGradient:{id:"selectedGradient",offset:["0%","100%"],stopColors:["#6888d2","#536fb1"]}},filter:{dropShadow:{id:"dropShadow",in:"SourceGraphic",stdDeviation:3,dxOffset:1,dyOffset:2}}},labels:{minWidth:100,},selected:{},axis:{xAxis:{hide:!0},yAxis:{hide:!1,paddingRight:27,transValue:-20}}};return options},getMultiVerticalPaletteDesktop:function(){return['rgba(215, 215, 215, 1)','rgba(183, 183, 183, 1)']},getMultiVerticalLabelsPaletteDesktop:function(){return['rgba(0, 0, 0, 1)','rgba(115, 114, 114, 1)']},getDotsLineGraphPalette:function(){return['rgba(46, 115, 255, 1)']},getAccountSelectorPalette:function(){return['image1','image2','image3','image4','image5','image6']},getAccountSelectorConfig:function getAccountSelectorConfig(){var config={showArrows:!0,minAccountsForDisplayingArrows:2,enableInfiniteCarousel:!0,showIndexDots:!0,nextArrowDir:"ltr",allAnimation:{type:"fadingSlidingOut",}}
return config},getAccountSelectorConfigDesktop:function getAccountSelectorConfigDesktop(){var config={showArrows:!0,minAccountsForDisplayingArrows:4,enableInfiniteCarousel:!0,showIndexDots:!0,nextArrowDir:"rtl",allAnimation:{type:"heapCards",cardsStackTotalHeight:43,maxSpaceBetweenCards:14,showBoxShadowForLastCardOnly:!1,}}
return config},getCollapseBlockHeight:function getCollapseBlockHeight(blockType){switch(blockType){case "account-selector":return 120;break;case "bar-chart":case "pin-graph":case "pie-chart":return 70;break;default:return 70}}});Personetics.story.skinController=Personetics.story.ProductSkinControler;Personetics.story.getTablesFormat=function(){return{"table-perso-txlist1":{"columns":["accountNumber","transaction","date","amount"],"displayColumns":{"date":{"format":"MM/DD/YY","type":"date"},"amount":{"format":"###,###.00","type":"amount"}}},"table-perso-txlist2":{"columns":["transaction","date","amount"],"displayColumns":{"date":{"format":"MM/DD/YY","type":"date"},"amount":{"format":"###,###.00","type":"amount"}}},"table-perso-txlist3":{"columns":["accountNumber","transaction","date","amount","date","balance"],"displayColumns":{"date":{"format":"MM/DD/YY","type":"date"},"amount":{"format":"###,###.00","type":"amount"},"balance":{"format":"###,###.00","type":"amount"}}},"table-perso-txlist4":{"columns":["date","transaction","amount"],"displayColumns":{"date":{"format":"MM/DD/YY","type":"date"},"amount":{"format":"###,###.00","type":"amount"}}},"table-perso-txlist5":{"columns":["date","transaction","amount","balance"],"displayColumns":{"date":{"format":"MM/DD/YY","type":"date"},"amount":{"format":"###,###.00","type":"amount"},"balance":{"format":"###,###.00","type":"amount"}}},"table-perso-txlist6":{"columns":["date","transaction","amount"],"displayColumns":{"date":{"format":"MM/DD/YY","type":"date"},"amount":{"format":"###,###.00","type":"amount"}}},"table-default":{"displayColumns":{"date":{"format":"MM/DD/YY","type":"date"},"amount":{"format":"###,###.00","type":"amount"}}},}}})(window,window.Personetics=window.Personetics||{},jQuery);(function(window,Personetics,$,undefined){Personetics.story=Personetics.story||{};Personetics.story.CITISkinControler=Personetics.story.ProductSkinControler.extend({registerWidgets:function(){Personetics.story.ProductSkinControler.prototype.registerWidgets.call(this);Personetics.UI.PWidgetFactory.registerWidget("ratings",Personetics.UI.PRatingCtrlCITI,"CITI ratings");Personetics.UI.PWidgetFactory.registerWidget("loading-animation",Personetics.UI.PLoadingAnimationCtrlCITI,"CITI loading");Personetics.UI.PWidgetFactory.registerWidget("story-widget",Personetics.UI.PStoryWidgetCtrlCITI,"CITI story widget")},registerBlocks:function(){Personetics.story.ProductSkinControler.prototype.registerBlocks.call(this);this.registerBlock("account-selector",{widthMode:"desktop",blockClass:Personetics.story.AccountSelectorBlockCITIDesktop});this.registerBlock("pie-chart",{blockClass:Personetics.story.PieChartBlockCiti});this.registerBlock("bar-chart",{widthMode:"desktop",blockClass:Personetics.story.D3BarChartBlockCiti});this.registerBlock("pin-graph",{widthMode:"desktop",blockClass:Personetics.story.D3PinGraphChartBlockDesktopCITI});this.registerChartHelper("verticalHelper",{helperClass:Personetics.utils.d3Helpers.VerticalChartHelperCiti});this.registerChartHelper("pinGraphHelper",{helperClass:Personetics.utils.d3Helpers.PinGraphChartHelperCiti});this.registerChartHelper("multiVerticalHelper",{widthMode:"desktop",helperClass:Personetics.utils.d3Helpers.MultiVerticalChartHelperDesktop});this.registerChartHelper("multiVerticalHelper",{helperClass:Personetics.utils.d3Helpers.MultiVerticalChartHelperCiti})},getColumnChartOptionsDesktop:function(){var options=Personetics.story.ProductSkinControler.prototype.getColumnChartOptionsDesktop.call(this);options.maxBarHeight=165,options.svgHeight=309,options.svgWidth=580,options.labelTop=31,options.barTop=75,options.xAxisTop=251,options.yAxisHeight=199,options.yAxisTop=40,options.rectangles.width=40;options.svgWidth=580;options.rectangles.space=65;options.axis.xAxis.tickPadding=13;options.rectangles.borderRadius.rx=0;options.rectangles.borderRadius.ry=0;options.rectangles.minHeightPercent=0.184;options.rectangles.marginFromBottom=27.5;options.axis.yAxis.y=5;options.axis.xAxis.tickPadding=18;options.labels.drawLabels=!1;return options},getDesktopScreenWidth:function(){return 740},getPinGraphChartOptionsDesktop:function(){var options=Personetics.story.ProductSkinControler.prototype.getPinGraphChartOptionsDesktop.call(this);options.maxBarHeight=165,options.svgHeight=309,options.svgWidth=580,options.labelTop=31,options.barTop=75,options.xAxisTop=251,options.yAxisHeight=199,options.yAxisTop=40,options.rectangles.width=40;options.svgWidth=580;options.rectangles.space=65;options.axis.xAxis.tickPadding=13;options.rectangles.borderRadius.rx=0;options.rectangles.borderRadius.ry=0;options.rectangles.minHeightPercent=0.184;options.rectangles.marginFromBottom=27.5;options.axis.xAxis.tickPadding=18;options.labels.drawLabels=!1;return options},getColumnChartMultiSeriesOptionsDesktop:function(){var options=Personetics.story.ProductSkinControler.prototype.getColumnChartMultiSeriesOptionsDesktop.call(this);options.svgHeight=309,options.svgWidth=580,options.maxBarHeight=122,options.barTop=118,options.xAxiaTop=251,options.yAxisTop=40,options.yAxisHeight=199,options.drowVerticalLines=!1,options.rectangles.width=20;options.svgWidth=580;options.rectangles.space=60;options.chart.transY=3;options.axis.xAxis.tickPadding=13;options.rectangles.minHeight=0;options.rectangles.borderRadius.rx=0;options.rectangles.borderRadius.ry=0;options.rectangles.paddingRight=40;options.axis.translation.x=12.5;options.labels.drawLabels=!1;return options},getBarChartOptionsDesktop:function(){var options=Personetics.story.ProductSkinControler.prototype.getBarChartOptionsDesktop.call(this);options.rectangles.width=40;options.rectangles.borderRadius.rx=0;options.rectangles.borderRadius.ry=0;options.labels.drawLabels=!1;return options},getPieOptions:function(){var options=Personetics.story.ProductSkinControler.prototype.getPieOptions.call(this);options.arcs.cornerRadius.radiusCorner=0;return options},getPieGraphPalette:function(selectedTabId){var outFlowsPalette=['#cb6015'];var inFlowsPalette=['#0060a7'];if(selectedTabId=="Out")
return outFlowsPalette;return inFlowsPalette},getMultiVerticalPaletteDesktop:function(){return[' rgba(255, 255, 255, 1)','rgba(153, 153, 153, 1)']},getBarGraphPalette:function(){return[' rgba(255, 255, 255, 1)','url(#selectedGradient)']},getAccountSelectorConfigDesktop:function getAccountSelectorConfigDesktop(){var config={showArrows:!0,enableInfiniteCarousel:!0,minAccountsForDisplayingArrows:2,showIndexDots:!0,allAnimation:{type:"heapCards",cardsStackTotalHeight:80,maxSpaceBetweenCards:10,showBoxShadowForLastCardOnly:!1,}}
return config},});Personetics.story.skinController=Personetics.story.CITISkinControler})(window,window.Personetics=window.Personetics||{},jQuery);Personetics.story.getTablesFormat=function(){return{"table-perso-txlist1":{"columns":["accountNumber","transaction","date","amount"],"displayColumns":{"date":{"format":"weekday, MMMMM DD, YY","type":"date"},"amount":{"format":"###,###.00","currencySymbol":"$","type":"amount"}},"isGroup":!0,"groupingField":"date"},"table-default":{"displayColumns":{"date":{"format":"weekday, MMMMM DD,YY","type":"date"},"amount":{"format":"###,###.00","currencySymbol":"$","type":"amount"}}}}};(function(window,Personetics,$,undefined){var Handlebars=Personetics.UI.Handlebars;Personetics.teaser=Personetics.teaser||{};Personetics.teaser.Block=Base.extend({initialize:function(parent,layoutInstructions,defaultConfig){this.parent=parent;this.layoutInstructions=layoutInstructions;var tmplId=this.getHtmlTemplateId(layoutInstructions.class);if(tmplId)
this.template=Handlebars.templates["block-"+tmplId];if(typeof defaultConfig!=="undefined"&&defaultConfig!==null){this.defaultConfig=defaultConfig}},getHtmlTemplateId:function(clazz){throw "No template id defined for block"},initBlock:function(){},handleQueryData:function(data){this.renderData(data);this.bindEvents()},setVisible:function(visible){},beforeRender:function(el,layoutInstructions){this.layoutInstructions=layoutInstructions},render:function(el,layoutInstructions){this.layoutInstructions=this.layoutInstructions||layoutInstructions;this.el=el;var html=this.template(layoutInstructions);el.append(html);this.frameEl=el.find(".pstory-block-frame").last()},renderAgain:function(data){var html=this.template(data);$(this.frameEl).replaceWith(html)},renderData:function(data){},afterRender:function(el){},bindEvents:function(){}})})(window,window.Personetics=window.Personetics||{},jQuery);(function(window,Personetics,$,undefined){Personetics.teaser=Personetics.teaser||{};Personetics.teaser.TextBlock=Personetics.teaser.Block.extend({getHtmlTemplateId:function(clazz){switch(clazz){case "note":case "perso-note":return"txt-note";default:return"txt"}}})})(window,window.Personetics=window.Personetics||{},jQuery);(function(window,Personetics,$,undefined){Personetics.teaser=Personetics.teaser||{};Personetics.teaser.DateBoxBlock=Personetics.teaser.Block.extend({getHtmlTemplateId:function(clazz){return"date-box"}})})(window,window.Personetics=window.Personetics||{},jQuery);(function(window,Personetics,$,undefined){Personetics.teaser=Personetics.teaser||{};Personetics.teaser.D3BarChartBlock=Personetics.teaser.Block.extend({CHART_TYPES:{MultiVertical:"multiVertical",MultiHorizontal:"multiHorizontal",SingleVertical:"vertical",SingleHorizontal:"horizontal"},getHtmlTemplateId:function(clazz){return"bar-chart"},beforeRender:function(el,layoutInstructions,templateId){Personetics.teaser.Block.prototype.beforeRender.call(this,el,layoutInstructions);this.setSelected();this.barsDirection();this.beforeRenderChart(el,templateId)},setSelected:function setSelected(){var block=this;this.hasSelected=!1;$.each(this.layoutInstructions.series,function(i,seriesArray){$.each(seriesArray,function(j,item){if(item.selected==!0){block.hasSelected=!0;return!1}})});if(this.hasSelected==!1){$.each(this.layoutInstructions.series,function(i,seriesArray){if(seriesArray.length>0){seriesArray[seriesArray.length-1].selected=!0}})}},render:function(el,layoutInstructions){this.renderSelectedBar(layoutInstructions);this.renderBlock(el,layoutInstructions)},renderBlock:function(el,layoutInstructions){Personetics.teaser.Block.prototype.render.call(this,el,layoutInstructions);var chartEl=this.frameEl.find(".pstory-bar-chart");if(chartEl.length>0){this.renderBarChart(chartEl,layoutInstructions)}},renderSelectedBar:function(layoutInstructions){},afterRender:function(){$(this.chartEl).addClass(this.layoutInstructions.direction);if(this.chartType==this.CHART_TYPES.MultiHorizontal){this.reverseData()}},barsDirection:function barsDirection(){if(this.layoutInstructions.direction=="vertical"&&Personetics.processor.PStoryConfig.isRtl()){this.barsDirectionRTL()}},barsDirectionRTL:function barsDirectionRTL(){if($.isArray(this.layoutInstructions.categories)){this.layoutInstructions.categories.reverse()}
if($.isArray(this.layoutInstructions.series)){$.each(this.layoutInstructions.series,function(i,series){if($.isArray(series)){series.reverse()}})}},beforeRenderChart:function(el,templateId){var direction=this.layoutInstructions.direction||"vertical";if(this.layoutInstructions.series.length==1&&$.isArray(this.layoutInstructions.series[0]))
this.layoutInstructions.series=this.layoutInstructions.series[0];this.chartType=this.getChartType(direction,this.layoutInstructions.seriesLabels.length>1);this.chartTypeHelper=this.chartType+"Helper";this.initChartHelper(this.chartTypeHelper);if(this.chartType==this.CHART_TYPES.MultiVertical)
this.options=this.defaultConfig.columnChartMultiSeriesOptions;else if(this.chartType==this.CHART_TYPES.MultiHorizontal){this.options=this.defaultConfig.barChartOptions;this.reverseData()}
else if(this.chartType==this.CHART_TYPES.SingleHorizontal)
this.options=this.defaultConfig.singleHorizontalChartOptions;else if(templateId=="verticalBarAndBoxTeaser"){this.options=this.defaultConfig.columnChartAndBoxOptions}
else{this.options=this.defaultConfig.columnChartOptions}
if(this.defaultConfig.hasOwnProperty('desktopScreenWidth')&&this.defaultConfig.desktopScreenWidth!=='undefined'&&this.defaultConfig.desktopScreenWidth!==null){this.options.desktopScreenWidth=this.defaultConfig.desktopScreenWidth}},renderBarChart:function(el,layoutInstructions){var data=layoutInstructions;var handleClickBind=Personetics.bind(this,this.handleClick);if(this.chartType=="multiHorizontal"){this.options.palette=this.defaultConfig.barGraphPalette;this.options.paletteLabels=this.defaultConfig.barGraphLabelsPalette;this.chartHelper.prepareMultiHorizontalChart(this,el);this.chartHelper.renderMultiHorizontalChart(this,el,this.layoutInstructions)}
else{this.chartHelper.prepareChart(data,this.options,handleClickBind);this.chartHelper.renderChart(el)}},reverseData:function reverseData(){this.layoutInstructions.series.reverse();$.each(this.layoutInstructions.series,function(index,item){item.reverse()})},handleClick:function(obj,clickedItemIndex){if(this.hasSelected==!1){return}
if(obj.amount==0)
return;var svg=this.frameEl.find('svg .perso-bar, svg .perso-chart-rect')[clickedItemIndex].className.animVal;if(svg.indexOf("selected")!=-1){return}
var highlightedElements=this.frameEl.find('svg .perso-bar.selected, svg .perso-chart-rect.selected');$.each(highlightedElements,function(i,element){element.className.baseVal=Personetics.utils.string.removeClass(element.className,'selected')});var highlightedLabels=this.frameEl.find('svg .perso-label');$.each(highlightedLabels,function(i,label){label.className.baseVal=Personetics.utils.string.removeClass(label.className,'selected')});var highlightedxAxisLabels=this.frameEl.find('svg .perso-xAxis-label');$.each(highlightedxAxisLabels,function(i,xAxisLabel){xAxisLabel.className.baseVal=Personetics.utils.string.removeClass(xAxisLabel.className,'selected')});if(obj.hasOwnProperty("mode")){var highlightSelectedInElements=this.frameEl.find('svg .perso-bar, svg .perso-chart-rect.In')[clickedItemIndex];var highlightSelectedOutElements=this.frameEl.find('svg .perso-bar, svg .perso-chart-rect.Out')[clickedItemIndex];var highlightSelectedInLabels=this.frameEl.find('svg .perso-label.In')[clickedItemIndex];var highlightSelectedOutLabels=this.frameEl.find('svg .perso-label.Out')[clickedItemIndex];highlightSelectedInElements.className.baseVal=Personetics.utils.string.addClass(highlightSelectedInElements.className,'selected');highlightSelectedOutElements.className.baseVal=Personetics.utils.string.addClass(highlightSelectedOutElements.className,'selected');highlightSelectedInLabels.className.baseVal=Personetics.utils.string.addClass(highlightSelectedInLabels.className,'selected');highlightSelectedOutLabels.className.baseVal=Personetics.utils.string.addClass(highlightSelectedOutLabels.className,'selected')}else{var clickedBar=this.frameEl.find('svg .perso-bar, svg .perso-chart-rect')[clickedItemIndex];var clickedBarLabel=this.frameEl.find('svg .perso-label')[clickedItemIndex];var clickedBarxAxis=this.frameEl.find('svg .perso-xAxis-label')[clickedItemIndex];clickedBar.className.baseVal=Personetics.utils.string.addClass(clickedBar.className,'selected');clickedBarLabel.className.baseVal=Personetics.utils.string.addClass(clickedBarLabel.className,'selected');if(clickedBarxAxis){clickedBarxAxis.className.baseVal=Personetics.utils.string.addClass(clickedBarxAxis.className,'selected')}}
this.parent.notifyEvent(this,"setSelectedValue",obj.category);this.notifyReportEvent(obj.category)},getChartType:function(direction,hasMultiSeries){var type=null;if(direction=="vertical"&&hasMultiSeries){type="multiVertical"}else if(direction=="horizontal"&&hasMultiSeries){type="multiHorizontal"}else if(direction=="vertical"){type="vertical"}
else if(direction=="horizontal"){type="horizontal"}
return type},initChartHelper:function(type){this.chartHelper=Personetics.story.BlockChartFactory.generateHelperClazz(type,{})}})})(window,window.Personetics=window.Personetics||{},jQuery);(function(window,Personetics,$,undefined){var d3=Personetics.persoD3||window.d3;Personetics.teaser=Personetics.teaser||{};Personetics.teaser.PieChartBlock=Personetics.teaser.Block.extend({getHtmlTemplateId:function(clazz){return"pie-chart"},beforeRender:function(el,layoutInstructions){Personetics.teaser.Block.prototype.beforeRender.call(this,el,layoutInstructions);this.options=this.defaultConfig.pieOptions;this.cornerRadiusPie=(typeof this.options.arcs.cornerRadius!="undefined")&&(typeof this.options.arcs.cornerRadius.radiusCorner!="undefined")?this.options.arcs.cornerRadius.radiusCorner:9;this.setTotal(layoutInstructions);this.colors=d3.scale.ordinal().range(this.defaultConfig.pieGraphPalette());this.grayscaleId="grayscale_"+ +new Date()},pie:function(){var block=this;var totalAmount=block.totalAmountInt||0;var normalizedValue=totalAmount*0.05;return d3.layout.pie().padAngle(-0.015).value(function(d){var value=d.value+normalizedValue;return value})},setTotal:function setTotal(layoutInstructions){var totalFromSrc=layoutInstructions.centerText;this.totalText=totalFromSrc;if(layoutInstructions.hasOwnProperty('slices')&&layoutInstructions.slices.length>0){var totalAmountObj=layoutInstructions.slices.reduce(function(total,slice){return{value:total.value+slice.value}});this.totalAmountInt=totalAmountObj.value}
else{this.totalAmountInt=0}},getGraphPalette:function(){return this.defaultConfig.pieGraphPalette},render:function(el,layoutInstructions){Personetics.teaser.Block.prototype.render.call(this,el,layoutInstructions);this.frameEl=el.find('.pstory-block-frame').last();var chartEl=this.frameEl.find(".pstory-pie-chart");if(chartEl.length>0){this.renderPieChart(chartEl,layoutInstructions)}},renderPieChart:function(el,layoutInstructions){var block=this;this.setPieSize();d3.selection.prototype.moveToFront=function(){return this.each(function(){var gparent=this.parentNode;gparent.parentNode.appendChild(gparent)})};block.arc=d3.svg.arc().innerRadius(block.innerRadius).outerRadius(block.outerRadius);block.arcOver=d3.svg.arc().innerRadius(block.innerRadiusOver).outerRadius(block.outerRadiusOver);this.renderPieBase(el);this.renderShadowFilter(block);this.renderPie(el,layoutInstructions)},setPieSize:function setPieSize(percents){if(percents)
var percents=percents;else var percents={heightPercent:0.7,innerRadiusPercent:0.17,outerRadiusPercent:0.2,innerRadiusOverPercent:0.165,outerRadiusOverPercent:0.22}
this.margin={top:0,right:19,bottom:0,left:19};this.width=this.frameEl.find('.pstory-pie-chart').width();this.height=this.width*percents.heightPercent;this.radius=this.width/2.3;var calculatedInnerRadiusRatio=percents.innerRadiusPercent*this.width;var calculatedOuterRadiusRatio=percents.outerRadiusPercent*this.width;var calculatedInnerRadiusOverRatio=percents.innerRadiusOverPercent*this.width;var calculatedOuterRadiusOverRatio=percents.outerRadiusOverPercent*this.width;this.innerRadius=this.radius-calculatedInnerRadiusRatio;this.outerRadius=this.radius-calculatedOuterRadiusRatio;this.innerRadiusOver=this.radius-calculatedInnerRadiusOverRatio;this.outerRadiusOver=this.radius-calculatedOuterRadiusOverRatio},renderPieBase:function renderPieBase(el){this.svg=this.renderPieSvgBase(el)},renderPieSvgBase:function(el){var block=this;if(el){return(d3.select(el.get(0)).append("svg").attr("focusable",!1).attr("width",block.width).attr("height",block.height).append("g").attr("transform","translate("+block.width/2+","+block.height/2+")"))}},renderPie:function(el,layoutInstructions){this.renderArcs(layoutInstructions);this.renderPieTitle(this.totalText)},renderArcs:function(layoutInstructions){var block=this;var arcs=block.svg.selectAll(".arc").data(block.pie()(layoutInstructions.slices)).enter().append("g").attr("class","perso-arc");arcs.append("path").attr("d",block.arc).attr("class",function(d){var clazz="";if(d.data.highlight){clazz+="perso-selected"}
return clazz}).style("fill",function(d,i){return block.colors(i)}).on("click",function(obj,clickedItemIndex){if(!obj.data.hasOwnProperty("highlight")){block.onPieItemClick(obj,clickedItemIndex,this)}})},renderTicks:function(block,layoutInstructions){if(block){var ticks=block.svg.append('g').attr('class','perso-ticks').selectAll("line").data(block.pie()(layoutInstructions)).enter().append("line");ticks.attr('class','perso-tick').attr("x1",0).attr("x2",0).attr("y1",-block.radius*.8).attr("y2",-block.radius*.9).attr("stroke","gray").attr("transform",function(d){return"rotate("+(d.startAngle+d.endAngle)/2*(180/Math.PI)+")"})}},renderPieLabels:function(block,layoutInstructions){if(block){var labels=block.svg.append('g').attr('class','perso-pie-labels').attr("transform","translate(8,0)").selectAll("text").data(block.pie()(layoutInstructions)).enter().append("text");labels.attr("class","perso-pie-label").attr("transform",function(d){var dist=block.radius+20;var angle=(d.startAngle+d.endAngle)/2;var x=dist*Math.sin(angle);var y=-dist*Math.cos(angle);return"translate("+x+","+y+")"}).attr("dy","-0.5em").attr("text-anchor","middle").text(function(d){return d.data.category}).call(block.wrapLabelText,screen.width*.28)}},renderPieTitle:function(totalText){this.svg.append('text').attr('class','perso-total-txt').attr('text-anchor','middle').attr('dy','.25em').style('font-size',this.options.centerText.fontSize).style('font-weight',this.options.centerText.fontWeight).text(totalText)},renderPieAmount:function(totalAmount){this.svg.append('text').attr('class','perso-total-amount').attr('dy','.9em').text(totalAmount)},onPieItemClick:function(obj,clickedItemIndex,clickedItem){var block=this;var oldSelectedArc=$('.perso-arc path.perso-selected');if(oldSelectedArc.length){oldSelectedArc[0].className.baseVal=Personetics.utils.string.removeClass(oldSelectedArc[0].className,'perso-selected')}
var oldSelectedArcLabel=this.frameEl.find('.pstory-pie-chart svg .perso-pie-label.selected');if(oldSelectedArcLabel.length){oldSelectedArcLabel[0].className.baseVal=Personetics.utils.string.removeClass(oldSelectedArcLabel[0].className,'selected')}
d3.select(clickedItem).attr("class","perso-selected");var pstoryLabels=this.frameEl.find('.pstory-pie-chart svg .perso-pie-label');if(typeof pstoryLabels!='undefined'&&pstoryLabels.length>clickedItemIndex){var clickedArcLabel=pstoryLabels[clickedItemIndex];clickedArcLabel.className.baseVal=Personetics.utils.string.addClass(clickedArcLabel.className,'selected')}
this.handleClick(obj,clickedItemIndex)},renderShadowFilter:function(block){var filters=block.options.arcs.filter;var svgWithFilters=block.svg;if(filters){$.each(filters,function(i,filter){if(filter){var filterSvg=svgWithFilters.append("filter").attr("id",filter.id);filterSvg.append("feGaussianBlur").attr("in",filter.in).attr("stdDeviation",filter.stdDeviation);filterSvg.append("feOffset").attr("dx",filter.dxOffset).attr("dy",filter.dyOffset);var feMerge=filterSvg.append("feMerge");feMerge.append("feMergeNode");feMerge.append("feMergeNode").attr("in",filter.in)}})}},handleClick:function(obj,clickedItemIndex){var dataObj=obj;if(dataObj.data){dataObj=dataObj.data}
this.parent.notifyEvent(this,"setSelectedValue",dataObj.category)},getSelectedPathIndex:function(paths){var pathIndex=0;if(paths.length){$.each(paths,function(i,path){if(path.className.baseVal=='perso-selected'){pathIndex=i;return!1}})}
return pathIndex},wrapLabelText:function(text,width){text.each(function(){var text=d3.select(this),words=text.text().split(/\s+/).reverse(),word,line=[],lineNumber=0,lineHeight=.95,y=text.attr("y"),dy=parseFloat(text.attr("dy")),tspan=text.text(null).append("tspan").attr("x",0).attr("y",y).attr("dy",dy+"em");while(word=words.pop()){line.push(word);tspan.text(line.join(" "));if(tspan.node().getComputedTextLength()>width){line.pop();tspan.text(line.join(" "));line=[word];tspan=text.append("tspan").attr("x",0).attr("y",y).attr("dy",(++lineNumber*lineHeight*1.5)+dy+"em").text(word)}}
if(lineNumber==1){}})}})})(window,window.Personetics=window.Personetics||{},jQuery);(function(window,Personetics,$,undefined){Personetics.teaser=Personetics.teaser||{};Personetics.teaser.D3PinGraphChartBlock=Personetics.teaser.D3BarChartBlock.extend({getHtmlTemplateId:function(clazz){return"pinGraph-chart"},render:function(el,layoutInstructions){Personetics.teaser.D3BarChartBlock.prototype.renderSelectedBar.call(this,layoutInstructions);this.renderBlock(el,layoutInstructions)},renderBlock:function(el,layoutInstructions){Personetics.teaser.Block.prototype.render.call(this,el,layoutInstructions);var chartEl=this.frameEl.find(".pstory-pinGraph-chart");if(chartEl.length>0){this.renderBarChart(chartEl,layoutInstructions)}},renderBarChart:function(el,data){this.chartHelper.prepareChart(data,this.options);this.chartHelper.renderChart(el)},beforeRenderChart:function(el,layoutInstructions){if(this.layoutInstructions.series.length==1&&$.isArray(this.layoutInstructions.series[0]))
this.layoutInstructions.series=this.layoutInstructions.series[0];this.chartType=this.getChartType();this.chartTypeHelper=(this.chartType+"Helper");this.initChartHelper(this.chartTypeHelper);this.options=this.defaultConfig.pinGraphChartOptions;if(this.defaultConfig.hasOwnProperty('desktopScreenWidth')&&this.defaultConfig.desktopScreenWidth!=='undefined'&&this.defaultConfig.desktopScreenWidth!==null){this.options.desktopScreenWidth=this.defaultConfig.desktopScreenWidth}},getChartType:function(){var type='pinGraph';return type}})})(window,window.Personetics=window.Personetics||{},jQuery);(function(window,Personetics,$,undefined){Personetics.teaser=Personetics.teaser||{};Personetics.teaser.PBlockFactory=new function(){this.types={"TYPE_CONTAINER":"layout"};this.blockFactoryMap={};this.index="0";this.registerBlock=function(type,config){var entry=this.blockFactoryMap[type];if(config.blockClass){if(!entry){entry={type:type,class:{},widthModes:{}};this.blockFactoryMap[type]=entry}
if(config.class){entry.class[config.class]=config.blockClass}
else if(config.widthMode){entry.widthModes[config.widthMode]=config.blockClass}
else{entry.blockClass=config.blockClass}}
if(config.hasOwnProperty("defaultConfig")){entry.defaultConfig=config.defaultConfig}};this.createBlock=function(parent,layoutInstructions,story){var block;var blockClass;var storyCfg=story?story.cfg:null;var type=layoutInstructions.type;if(type==this.types.TYPE_CONTAINER){blockClass=Personetics.teaser.LayoutBlock;layoutInstructions.layoutId="layout-"+this.index;this.index++}
else{var cClass=storyCfg?layoutInstructions.class||storyCfg.chartsLibClass:null;var widthMode=storyCfg?storyCfg.widthMode:null;var entry=this.blockFactoryMap[type];if(entry){if(widthMode){blockClass=entry.widthModes[widthMode]}
if(cClass){blockClass=entry.class[cClass]}
if(!blockClass)
blockClass=entry.blockClass}
if(!blockClass){blockClass=Personetics.teaser.Block;Personetics.log("Invalid block type '"+type+"'")}}
block=new blockClass(parent,layoutInstructions,entry.defaultConfig);return block}}})(window,window.Personetics=window.Personetics||{},jQuery);(function(window,Personetics,$,undefined){var d3=Personetics.persoD3||window.d3;Personetics.teaser=Personetics.teaser||{};Personetics.teaser.PieChartBlockProduct=Personetics.teaser.PieChartBlock.extend({beforeRender:function beforeRender(el,layoutInstructions){Personetics.teaser.PieChartBlock.prototype.beforeRender.call(this,el,layoutInstructions);var previousDialogs=el.parents('.pstory-dialog-frame').prev('.pstory-dialog-frame');var tabsBlock=previousDialogs.find('.pstory-block-tabs');var selectedTab=tabsBlock.find('.pstory-button.selected');var selectedTabId=selectedTab.attr("pstory-id");this.colors=d3.scale.ordinal().range(this.getGraphPalette(selectedTabId))},getGraphPalette:function(selectedTabId){return this.defaultConfig.pieGraphPalette(selectedTabId)},renderPieBase:function renderPieBase(el){Personetics.teaser.PieChartBlock.prototype.renderPieBase.call(this,el);this.renderGrayFilter()},renderGrayFilter:function renderGrayFilter(){this.svg.append("filter").attr("id",this.grayscaleId).append("feColorMatrix").attr("type","matrix").attr("values","0.3333 0.3333 0.3333 0 0 0.3333 0.3333 0.3333 0 0 0.3333 0.3333 0.3333 0 0 0 0 0 1 0")},renderArcs:function(layoutInstructions){Personetics.teaser.PieChartBlock.prototype.renderArcs.call(this,layoutInstructions);var arcs=this.frameEl.find('.pstory-pie-chart svg .perso-arc path');var grayscaleId=this.grayscaleId;$.each(arcs,function(i,arc){d3.select(arc).style("filter","url(#"+grayscaleId+")")})},afterRender:function(el){var block=this;block.arcPaths=block.frameEl.find('.pstory-pie-chart svg .perso-arc path');var defaultPath=this.frameEl.find('.pstory-pie-chart svg .perso-arc path.perso-selected')[0];var defaultPathIndex=this.getSelectedPathIndex(block.arcPaths);d3.select(defaultPath).attr("d",block.arcOver.cornerRadius(block.cornerRadiusPie)).style("filter","").style("fill",function(d,i){return block.colors(defaultPathIndex)});d3.select(defaultPath).moveToFront();var selected=this.layoutInstructions.slices[this.getSelectedPathIndex(block.arcPaths)];block.updatePieInfoValues(selected);if(this.layoutInstructions.slices.length>1){this.frameEl.find('.pstory-pie-data .pstory-arrow').show()}
else{this.frameEl.find('.pstory-pie-data .pstory-arrow').hide()}
block.highlightCenterText(block.colors(defaultPathIndex))},bindEvents:function(){var block=this;var $nextArrow=this.frameEl.find('.pstory-next-arrow');var $previousArrow=this.frameEl.find('.pstory-previous-arrow');var $paths=block.arcPaths;$nextArrow.bind('click',function(e){if(block.frameEl.hasClass('perso-minimized')){return}
var currentItemIndex=block.getSelectedPathIndex($paths);if(currentItemIndex==($paths.length-1)){block.moveArcs(0);block.handleClick(block.layoutInstructions.slices[0],0)}else{block.moveArcs(++currentItemIndex);block.handleClick(block.layoutInstructions.slices[currentItemIndex],currentItemIndex)}});$previousArrow.bind('click',function(e){if(block.frameEl.hasClass('perso-minimized')){return}
var currentItemIndex=block.getSelectedPathIndex($paths);if(currentItemIndex==0){block.moveArcs($paths.length-1);block.handleClick(block.layoutInstructions.slices[$paths.length-1],$paths.length-1)}else{block.moveArcs(--currentItemIndex);block.handleClick(block.layoutInstructions.slices[currentItemIndex],currentItemIndex)}})},onPieItemClick:function onPieItemClick(obj,clickedItemIndex,clickedItem){var block=this;var oldSelectedArc=$('.perso-arc path.perso-selected');var grayscaleId=this.grayscaleId;if(oldSelectedArc.length){oldSelectedArc[0].className.baseVal=Personetics.utils.string.removeClass(oldSelectedArc[0].className,'perso-selected');d3.select(oldSelectedArc[0]).attr("d",block.arc).style("filter","url(#"+grayscaleId+")")}
d3.select(clickedItem).attr("d",block.arcOver.cornerRadius(block.cornerRadiusPie)).attr("class","perso-selected").style("filter","").style("fill",function(d,i){return block.colors(i)});d3.select(clickedItem).moveToFront();this.handleClick(obj,clickedItemIndex);this.updatePieInfoValues(obj.data)},updatePieInfoValues:function(obj){if(this.options.showInfoContainer){var block=this;if(obj){var amountDiv='<div class="pstory-pie-amount"><span>'+obj.label+'</span></div>';var categoryDiv='<div class="pstory-pie-category"><span>'+obj.category+'</span></div>';var $infoContainer=this.frameEl.find('.pstory-pie-info');$infoContainer.empty();$infoContainer.append(amountDiv);$infoContainer.append(categoryDiv);$('.pstory-pie-amount').css('color',block.colors(obj.category))}}},moveArcs:function(index){var block=this
var path=block.arcPaths[index];var oldSelectedArc=$('.perso-arc path.perso-selected');var grayscaleId=this.grayscaleId;if(path){d3.select('.perso-arc path.perso-selected').attr("d",block.arc).style("filter","url(#"+grayscaleId+")")
oldSelectedArc[0].className.baseVal=Personetics.utils.string.removeClass(oldSelectedArc[0].className,'perso-selected');d3.select(path).attr("d",block.arcOver.cornerRadius(block.cornerRadiusPie)).attr("class","perso-selected").style("filter","").style("fill",function(d,i){return block.colors(i)});d3.select(path).moveToFront();block.updatePieInfoValues(block.layoutInstructions.slices[index])}},highlightCenterText:function(color){var block=this;var centerTextElem=block.frameEl.find('.perso-total-txt')[0];d3.select(centerTextElem).style('fill',color)},doScrollEvent:function(){this.minimized=typeof this.minimized!='undefined'?this.minimized:{};var heightPrevFixedElements=0;var prevMinimized=$('.perso-minimized:not(.pstory-block-pie-chart)').last().find('.pstory-block-container');if(prevMinimized.length>0){var prevMinimizedTop=prevMinimized.offset().top;var prevMinimizedHeight=parseFloat(prevMinimized.outerHeight(!0));heightPrevFixedElements=prevMinimizedTop+prevMinimizedHeight}
this.minimized.heightPrevFixedElements=heightPrevFixedElements;this.minimized.prevMinimized=prevMinimized;this.minimized.elementDisplayed=this.frameEl.find('.pstory-pie-data');var offsetElement=this.minimized.elementDisplayed.offset();if(typeof this.minimized.isMinimized!='undefined'&&this.minimized.isMinimized==!0&&this.frameEl.offset().top+15>=this.minimized.topFixedContainer){this.minimized.isMinimized=!1;this.unMinimized()}
else if(offsetElement.top<=this.minimized.heightPrevFixedElements){if(typeof this.minimized.isMinimized=='undefined'||this.minimized.isMinimized==!1){this.minimized.isMinimized=!0;this.doMinimized()}}},doMinimized:function(){var fixedContainer=this.frameEl.find('.pstory-block-container');var marginRight=this.frameEl.css('margin-right');var marginLeft=this.frameEl.css('margin-left');fixedContainer.css({'padding-right':marginRight,'padding-left':marginLeft});this.frameEl.height(this.frameEl.outerHeight());var elementHeight=this.minimized.elementDisplayed.outerHeight();var topFixedContainer=elementHeight-fixedContainer.outerHeight()+this.minimized.heightPrevFixedElements;this.minimized.topFixedContainer=topFixedContainer;fixedContainer.css({'top':topFixedContainer+'px'});var zIndex=999;var prevMinimized=this.minimized.prevMinimized;if(prevMinimized.length>0)
zIndex=prevMinimized.css('z-index')-1;fixedContainer.css({'z-index':zIndex});this.frameEl.removeClass('perso-unMinimized');this.frameEl.addClass('perso-minimized')},unMinimized:function(){this.frameEl.removeClass('perso-minimized');this.frameEl.addClass('perso-unMinimized')}})})(window,window.Personetics=window.Personetics||{},jQuery);(function(window,Personetics,$,undefined){var Handlebars=Personetics.UI.Handlebars;var SkinSetup=function SkinSetup(){};SkinSetup.prototype.init=function registerBlocks(){this.registerDefaultBlocks();this.registerDefaultChartHeplers();this.registerPartialTemplates()};SkinSetup.prototype.registerBlock=function(type,config){Personetics.teaser.PBlockFactory.registerBlock(type,config)};SkinSetup.prototype.registerChartHelper=function(name,clazz){Personetics.story.BlockChartFactory.registerChartHelper(name,clazz)};SkinSetup.prototype.registerPartialTemplates=function registerPartialTemplates(){var me=this;var partialTemplates=this.getPartialTemplates();partialTemplates.forEach(function(partial){var partialTemplate=Handlebars.templates[partial.id];if(typeof partialTemplate!=="undefined"&&partialTemplate!==null)
Handlebars.registerPartial(partial.name,partialTemplate)})};SkinSetup.prototype.getPartialTemplates=function getPartialTemplates(){return[{"name":"teaserWrapperPartial","id":"teaserWrapperPartial"},{"name":"teaserHeader","id":"teaserHeader"}]};SkinSetup.prototype.registerDefaultBlocks=function registerDefaultBlocks(type){this.registerBlock("txt",{blockClass:Personetics.teaser.TextBlock});this.registerBlock("text",{blockClass:Personetics.teaser.TextBlock});this.registerBlock("date-box",{blockClass:Personetics.teaser.DateBoxBlock});this.registerBlock("image",{blockClass:Personetics.teaser.ImageBlock});this.registerBlock("bar-chart",{blockClass:Personetics.teaser.D3BarChartBlock,defaultConfig:{columnChartOptions:{desktopScreenWidth:740,svgHeight:124,svgWidth:300,maxBarHeight:62,barTop:20,xAxisTop:93,yAxisHeight:82,horizontalLineWidth:0,horizontalLineLeft:0,screen:{ratio_medium:1.17,ratio_large:1.3},margin:{top:43,bottom:40},height:180,chart:{transX:0,transY:10},labels:{drawLabels:!1,marginBottom:18,marginTop:4.5},rectangles:{width:5,space:60,minHeightPercent:0.15,borderRadius:{rx:0,ry:0},marginFromBottom:15,marginFromLeft:2,gradients:[{id:"selectedGradient",offset:["0%","100%"],stopColors:["#6888d2","#536fb1"]}],filter:{dropShadow:{id:"dropShadow",in:"SourceGraphic",stdDeviation:3,dxOffset:1,dyOffset:2}},transition:{duration:1000,delay:500}},selected:{},axis:{translation:{x:0,y:"height"},xAxis:{hide:!1,collapsedPadding:{top:22,bottom:0}},yAxis:{x:0,y:0,hide:!0}}},columnChartAndBoxOptions:{maxBarHeight:62,desktopScreenWidth:740,svgHeight:124,svgWidth:235,barTop:20,xAxisTop:94,screen:{ratio_medium:1.17,ratio_large:1.3},margin:{top:43,bottom:40},height:180,chart:{transX:0,transY:10},labels:{drawLabels:!1,marginBottom:18,marginTop:-10},rectangles:{width:5,space:40,borderRadius:{rx:0,ry:0},marginFromBottom:15,marginFromLeft:0,gradients:[{id:"selectedGradient",offset:["0%","100%"],stopColors:["#6888d2","#536fb1"]}],filter:{dropShadow:{id:"dropShadow",in:"SourceGraphic",stdDeviation:3,dxOffset:1,dyOffset:2}},transition:{duration:1000,delay:500}},selected:{},axis:{xAxis:{hide:!1}}},columnChartMultiSeriesOptions:{svgWidth:340,screen:{ratio_medium:1.17,ratio_large:1.3},margin:{top:0,right:24,bottom:0,left:24},totalHeight:101,labels:{drawLabels:!0,marginTop:-16,marginBottom:4,right:3},rectangles:{width:5,paddingTop:30,paddingLeft:-19,paddingRight:22,paddingBottom:33,seriesPadding:12.5,transX:4,minHeight:0.15,borderRadius:{rx:0,ry:0},marginFromBottom:5,gradients:{selectedInGradient:{id:"selectedInGradient",offset:["0%","100%"],stopColors:["rgba(5, 109, 174, 1)","rgba(5, 109, 174, 1)"]},selectedOutGradient:{id:"selectedOutGradient",offset:["0%","100%"],stopColors:["rgba(203, 96, 21, 1)","rgba(203, 96, 21, 1)"]}},filter:{dropShadow:{id:"dropShadow",in:"SourceGraphic",stdDeviation:3,dxOffset:1,dyOffset:2}},transition:{duration:1000,delay:500}},selected:{},axis:{translation:{x:2.5,y:"height"},xAxis:{hide:!1,tickPadding:10,width:1,minimizedPadding:{top:22,bottom:15}},yAxis:{hide:!0}}},barChartOptions:{chartHeight:102,svgWidth:340,screen:{ratio_medium:1.17,ratio_large:1.3},margin:{top:19,right:20,bottom:0,left:20},drawLabels:!1,rectangles:{height:4,color:"rgba(169, 167, 167, 1)",paddingTop:-18,paddingLeft:21,paddingBottom:5,seriesPadding:4,barFillPercent:0.85,borderRadius:{rx:0,ry:0},gradients:{selectedInGradient:{id:"selectedInGradient",offset1:"0%",offset2:"100%",stopColor1:"rgba(5, 109, 174, 1)",stopColor2:"rgba(5, 109, 174, 1)",offset:["0%","100%"],stopColors:["rgba(5, 109, 174, 1)","rgba(5, 109, 174, 1)"]},selectedOutGradient:{id:"selectedOutGradient",offset1:"0%",offset2:"100%",stopColor1:"rgba(203, 96, 21, 1)",stopColor2:"rgba(203, 96, 21, 1)"}},filter:{dropShadow:{id:"dropShadow",in:"SourceGraphic",stdDeviation:3,dxOffset:1,dyOffset:2}}},labels:{paddingLeft:40,minWidth:100},selected:{},axis:{xAxis:{hide:!0},yAxis:{hide:!1,paddingRight:30,transValue:-20}}},singleHorizontalChartOptions:{chartHeight:100,svgWidth:340,screen:{ratio_medium:1.17,ratio_large:1.3},margin:{top:10,right:12,bottom:12,left:5},drawLabels:!1,rectangles:{height:7,color:"rgba(169, 167, 167, 1)",borderRadius:{rx:4,ry:4},groupMargins:{top:-3.5,left:35},gradients:{selectedGradient:{id:"selectedGradient",offset:["0%","100%"],stopColors:["#6888d2","#536fb1"]}},filter:{dropShadow:{id:"dropShadow",in:"SourceGraphic",stdDeviation:3,dxOffset:1,dyOffset:2}}},labels:{paddingLeft:40,minWidth:100},selected:{},axis:{xAxis:{hide:!0},yAxis:{hide:!1}}},barGraphPalette:['url(#selectedOutGradient)','url(#selectedInGradient)'],barGraphLabelsPalette:['rgba(40, 36, 37, 1)','rgba(84, 113, 180, 1)'],multiVerticalPalette:['url(#selectedGradient)','rgba(215, 215, 215, 1)'],multiVerticalLabelsPalette:['rgba(147, 145, 149, 1)','rgba(40, 36, 37, 1)'],columnGraphPalette:['#5D68C2','#3B49B6','#1729AF','#111F88','#08176C'],barChartMultiSeriesLabels:function(labels){return function(){if(labels&&labels.length>0){var label=labels[this.series.index];return("<span class='"+this.series.name+"'>"+label+"</span>")}
else{return""}}}}});this.registerBlock("pie-chart",{blockClass:Personetics.teaser.PieChartBlockCiti,defaultConfig:{pieGraphPalette:function(selectedTabId){return['#056dae']},pieOptions:{arcs:{filter:{dropShadow:{id:"dropShadow",in:"SourceGraphic",stdDeviation:3,dxOffset:1,dyOffset:2}},cornerRadius:{radiusCorner:0},padAngle:-0.02},centerText:{fontSize:12,fontWeight:700,color:'white'},showInfoContainer:!1},renderGrayFilter:function renderGrayFilter(){this.svg.append("filter").attr("id",this.grayscaleId).append("feColorMatrix").attr("type","matrix").attr("values","0 1 0 1 0 0 0.623 0 1 0 0 0.345 0 1 0 0 1 0 1 0 ")},}});this.registerBlock("pin-chart",{blockClass:Personetics.teaser.D3PinGraphChartBlock,defaultConfig:{pinGraphChartOptions:{desktopScreenWidth:740,maxBarHeight:46,svgHeight:124,barTop:20,xAxisTop:68,svgWidth:300,screen:{ratio_medium:1.17,ratio_large:1.3},margin:{top:35,right:20,bottom:40,left:15},height:102,chart:{transX:0,transY:0},totalHeight:102,labels:{drawLabels:!1,marginBottom:18,marginTop:4.5,marginRight:5},rectangles:{minHeightPercent:0.15,width:5,space:60,borderRadius:{rx:0,ry:0},marginFromBottom:10,marginFromLeft:0,gradients:{selectedGradient:{id:"selectedGradient",offset:["0%","100%"],stopColors:["rgba(5, 109, 174, 1)","rgba(5, 109, 174, 1)"]}},filter:{dropShadow:{id:"dropShadow",in:"SourceGraphic",stdDeviation:3,dxOffset:1,dyOffset:2}},transition:{duration:1000,delay:500}},selected:{},axis:{translation:{x:0,y:"height"},xAxis:{hide:!1,tickPadding:15,width:1,minimizedPadding:{top:22,bottom:15,fontSize:12,fontWeight:300,color:'#A94F48'},fontSize:12,fontWeight:700,color:'white'},yAxis:{hide:!0,x:0,y:0,fontSize:0,fontWeight:0,color:'#000'}}}}});this.registerBlock("pin-graph",{blockClass:Personetics.teaser.D3PinGraphChartBlock,defaultConfig:{pinGraphChartOptions:{screen:{ratio_medium:1.17,ratio_large:1.3},margin:{top:35,right:20,bottom:40,left:15},height:102,chart:{transX:0,transY:0},totalHeight:102,labels:{drawLabels:!1,marginBottom:18,marginTop:4.5,marginRight:5},rectangles:{minHeightPercent:0.15,width:8,borderRadius:{rx:3,ry:3},marginFromBottom:10,marginFromLeft:0,gradients:{selectedGradient:{id:"selectedGradient",offset:["0%","100%"],stopColors:["#6888d2","#536fb1"]}},filter:{dropShadow:{id:"dropShadow",in:"SourceGraphic",stdDeviation:3,dxOffset:1,dyOffset:2}},transition:{duration:1000,delay:500}},selected:{},axis:{translation:{x:0,y:"height"},xAxis:{hide:!1,tickPadding:8,width:1,minimizedPadding:{top:22,bottom:15,fontSize:12,fontWeight:300,color:'#A94F48'},fontSize:12,fontWeight:300,color:'#000'},yAxis:{hide:!0,x:0,y:0,fontSize:0,fontWeight:0,color:'#000'}}}}});this.registerBlock("h-box",{blockClass:Personetics.teaser.HBoxBlock})};SkinSetup.prototype.registerDefaultChartHeplers=function registerDefaultChartHeplers(){this.registerChartHelper("verticalHelper",{helperClass:Personetics.utils.d3Helpers.VerticalChartHelperCiti});this.registerChartHelper("horizontalHelper",{helperClass:Personetics.utils.d3Helpers.HorizontalChartHelper});this.registerChartHelper("multiVerticalHelper",{helperClass:Personetics.utils.d3Helpers.MultiVerticalChartHelper});this.registerChartHelper("multiHorizontalHelper",{helperClass:Personetics.utils.d3Helpers.MultiHorizontalChartHelper});this.registerChartHelper("pinGraphHelper",{helperClass:Personetics.utils.d3Helpers.PinGraphChartHelperCiti});Personetics.story.BlockChartFactory.registerChartHelper("lineChartHelper",{helperClass:Personetics.utils.d3Helpers.LineChartHelper})};SkinSetup.prototype.registerTemplates=function registerTemplates(){var loader=new HandlebarTemplateLoader("../skins/vanilla/templates/");loader.load("simpleText","simple-teaser");loader.load("image","image-teaser");loader.load("verticalBar","bar-teaser");loader.load("multiVerticalBar","bar-teaser");loader.load("horizontalBarAndBox","compare-box-teaser");loader.load("pinChart","bar-teaser");loader.load("pie","pies-teaser");loader.load("textAndButton","buttons-teaser");loader.load("imageAndBox","image-box-teaser");loader.load("verticalBarAndBox","bar-box-teaser");loader.load("doubleBox","double-box-teaser");loader.load("horizontalBar","bar-teaser");loader.loadPartial("teaserHeader","teaser-header-partial");loader.loadPartial("teaserWrapperPartial","teaser-wrapper-partial")};window.SkinSetup=SkinSetup})(window,window.Personetics=window.Personetics||{},jQuery);(function(window,Personetics,$,undefined){Personetics.teaser=Personetics.teaser||{};Personetics.teaser.PieChartBlockCiti=Personetics.teaser.PieChartBlockProduct.extend({highlightCenterText:function(){var block=this;var centerTextElem=block.frameEl.find('.perso-total-txt')[0];d3.select(centerTextElem).style('fill',this.options.centerText.color)},renderGrayFilter:function renderGrayFilter(){this.svg.append("filter").attr("id",this.grayscaleId).append("feColorMatrix").attr("type","matrix").attr("values","0 1 0 1 0 0 0.623 0 1 0 0 0.345 0 1 0 0 1 0 1 0 ")},setPieSize:function setPieSize(){var percents={heightPercent:1.2,}
this.margin={top:0,right:19,bottom:0,left:19};this.width=this.frameEl.find('.pstory-pie-chart').width();this.height=this.width*percents.heightPercent;this.radius=this.width/2.3;this.innerRadius=66/2;this.outerRadius=56/2;this.innerRadiusOver=84/2;this.outerRadiusOver=56/2},renderPieSvgBase:function(el){var block=this;block.height=124;if(el){return(d3.select(el.get(0)).append("svg").attr("width",block.width).attr("height",block.height).append("g").attr("transform","translate("+block.width/2+","+block.height/2+")"))}}})})(window,window.Personetics=window.Personetics||{},jQuery);(function(window,Personetics,$,undefined){Personetics.teaser=Personetics.teaser||{};Personetics.teaser.VerticalChartHelperCiti=Personetics.utils.d3Helpers.VerticalChartHelper.extend({})})(window,window.Personetics=window.Personetics||{},jQuery);(function(window,Personetics,$,undefined){Personetics.utils=Personetics.utils||{};Personetics.teaser.PinGraphChartHelperCiti=Personetics.utils.d3Helpers.VerticalChartHelperCiti.extend({renderXAxis:function(data,block){var helper=this;if(this.xAxis){this.svg.append("g").attr("class","x axis").attr("transform",function(d,i){var x=0;var y=helper.yScale(0);if(helper.minValue<0){y=helper.maxPositiveBarHeight+helper.getValueByScreenWidth(10)}
if(helper.options.axis.translation.x){x=helper.options.axis.translation.x}
return("translate("+x+","+y+")")}).call(helper.xAxis).selectAll(".tick text").data(data.series).attr("class",function(d){var clazz="perso-xAxis-label";if(d.selected||d.highlight){clazz+=" selected"}
return clazz}).call(helper.wrapLabelText).on("click",function(obj,clickedItemIndex){if(block)
block.handleClick(obj,clickedItemIndex)}).style('fill',helper.options.axis.xAxis.color).style('font-size',helper.options.axis.xAxis.fontSize).style('font-weight',helper.options.axis.xAxis.fontWeight)}}})})(window,window.Personetics=window.Personetics||{},jQuery);(function(window,Personetics,undefined){Personetics.processor=Personetics.processor||{};var templateDateRegex=/Date\s+([A-Za-z\.\[\]\(\)\'\,\_0-9]*)(?:\s+format='(.*)')?/;var templateEmojiRegex=/Emoji\s+([A-Za-z\.\[\]\(\)\'\,\_0-9]*)?/;var templateAmountRegex=/Amount\s+([A-Za-z\d\.\[\]\(\)\'\,\/\*\+\-]*)(?:\s+format='([#0,\.\+]*)')?(?:\s+currency='(.*)')?/;var templateStringRegex=/String\s+([A-Za-z\d\.\[\]\(\)\'\,\/\*\+\-]*)?(?:\s+maxLength='(.*)')?/;var nodeTypes=["BinaryExpression","UnaryExpression","Identifier","Literal","ArrayExpression","MemberExpression","CallExpression"];Personetics.processor.PExp=function PExp(expStr){this.str=this.compile(expStr);try{this.exp=jsep(this.str)}
catch(e){this.err(e,"PExp('"+this.str+"') Error -Invalid expression: '"+expStr+"'",!0)}};Personetics.processor.PExp.prototype.binops={"+":function(a,b){return a+b},"-":function(a,b){return a-b},"*":function(a,b){return a*b},"/":function(a,b){if(b==0)return 0;return a/b},"%":function(a,b){return a%b},"==":function(a,b){return a==b},"!=":function(a,b){return a!=b},"<":function(a,b){return a<b},"<=":function(a,b){return a<=b},">":function(a,b){return a>b},">=":function(a,b){return a>=b}};Personetics.processor.PExp.prototype.unops={"-":function(a){return-a},"+":function(a){return a}};Personetics.processor.PExp.prototype.compile=function compile(exp){var originalExp=exp;var dateMatch=exp.match(templateDateRegex);var value;var format;if(dateMatch){value=dateMatch[1];format=null;if(dateMatch.length>2&&dateMatch[2])
format="'"+dateMatch[2]+"'";exp="utils.formatDate("+value+","+format+")"}
var amountMatch=exp.match(templateAmountRegex);if(amountMatch){value=amountMatch[1];format=null;var currency=null;var amountMatch2=amountMatch[2];if(typeof amountMatch2!=='undefined'&&amountMatch2!==null&&amountMatch2.length>0)
format="'"+amountMatch[2]+"'";if(typeof amountMatch[3]!=='undefined'&&amountMatch[3]!==null)
currency=amountMatch[3];if(typeof currency=='string')
{currency=currency.replace(/^\s+|\s+$/g,'');if(currency===''){currency='""'}}
exp="utils.formatAmount("+value+", "+currency+", "+format+")";exp=originalExp.replace(templateAmountRegex,exp)}
var emojiMatch=exp.match(templateEmojiRegex);if(emojiMatch){exp="'{{"+exp+"}}'"}
var stringMatch=exp.match(templateStringRegex);var maxLength=null;if(stringMatch){value=stringMatch[1];var stringMatch2=stringMatch[2];if(typeof stringMatch2!=='undefined'&&stringMatch2!==null&&stringMatch2.length>0)
maxLength=stringMatch[2];exp="utils.limitString("+value+","+maxLength+")";exp=originalExp.replace(templateStringRegex,exp)}
return exp};Personetics.processor.PExp.prototype.eval=function(ctx,parentCtx,options){var errorObj=null;var hasError=!1;try{Personetics.log("PExp: attempting to evaluate expression: '"+this.str+"'");var result=this.evalNode(this.exp,ctx,parentCtx,options);if(typeof result==='undefined'||result===null){hasError=!0;errorObj=this.err(null,"PExp.eval('"+this.str+"') Error - Invalid result after evaluating expression: '"+result+"'",!1)}}
catch(e){hasError=!0;errorObj=this.err(e,"PExp.eval('"+this.str+"') Error - Could not evaluate expression",!1)}
if(hasError){this.err(errorObj,null,!0)}
else{var resStr=result;try{resStr=JSON.stringify(result)}
catch(e){resStr=result}
Personetics.log("Result: "+resStr);return result}};Personetics.processor.PExp.prototype.evalNode=function(node,ctx,parentCtx,options){var me=this;var val;if(node.type==="BinaryExpression"){var leftArg=this.evalNode(node.left,ctx,parentCtx,options);var rightArg=this.evalNode(node.right,ctx,parentCtx,options);val=this.binops[node.operator](leftArg,rightArg)}else if(node.type==="UnaryExpression"){val=this.unops[node.operator](this.evalNode(node.argument,ctx,parentCtx,options))}else if(node.type==="Identifier"){val=Personetics.processor.PUtils.getUtilsInstance(node.name,ctx,parentCtx);if(typeof val==="undefined"||val===null)
val=this.getChild(ctx,node.name,ctx,parentCtx,options);if(typeof parentCtx!=='undefined'&&parentCtx!==null){if(typeof val==='undefined'||val===null){val=this.getChild(parentCtx,node.name,ctx,parentCtx,options)}}}else if(node.type==="Literal"){val=node.value}else if(node.type==="ArrayExpression"){var arr=[];for(key in node.elements){var item=node.elements[key];var arrVal=me.evalNode(item,ctx,parentCtx,options);arr.push(arrVal)}
val=arr}else if(node.type==="MemberExpression"){var obj=this.evalNode(node.object,ctx,parentCtx,options);if(node.property.type=="Identifier")
val=this.getChild(obj,node.property.name,ctx,parentCtx,options);else{var prop=this.evalNode(node.property,obj,parentCtx,options);val=this.getChild(obj,prop,options,ctx,parentCtx,options)}
if(typeof(val)=='function'){var bfunc=new PBoundFunction(obj,val);val=bfunc}}else if(node.type==="CallExpression"){var callee=this.evalNode(node.callee,ctx,parentCtx,options);var args=[];for(var key in node.arguments){var arg=node.arguments[key];var argVal=me.evalNode(arg,ctx,parentCtx,options);args.push(argVal)}
if(!callee||!PBoundFunction.prototype.isPrototypeOf(callee))
this.err({"message":"TypeError: Cannot find function '"+node.callee.property.name+"' of '"+node.callee.object.name+"'"},null,!0);val=callee.call(args)}
return val};Personetics.processor.PExp.prototype.getChild=function(obj,prop,ctx,parentCtx,options){if(!obj)
return obj;var child;if(Personetics.processor.PDataSource.prototype.isPrototypeOf(obj))
child=obj.get(prop,options);if(!child)
child=obj[prop];if(this.isNode(child)){child=this.evalNode(child,ctx,parentCtx,options)}
return child};Personetics.processor.PExp.prototype.isNode=function(node){var isNode=!1;if(node&&node.hasOwnProperty("type")){var type=node.type;isNode=nodeTypes.indexOf(type)>=0}
return isNode};Personetics.processor.PExp.prototype.err=function err(e,errorMessage,throwException){throwException=typeof throwException!=='undefined'&&throwException!==null&&throwException!=!1;var msg=null;var stack=null;if(typeof e!=='undefined'&&e!==null){if(typeof e==="object"){if(e.hasOwnProperty("message"))
msg=e.message;if(e.hasOwnProperty("stack"))
stack=e.stack}
else if(typeof e==="string"){msg=e}}
errorMessage=errorMessage?msg?errorMessage+"\n\t Error message: "+msg:errorMessage:msg?msg:"";var errorObj={message:errorMessage,stack:stack};if(throwException)
throw errorObj;else{return errorObj}};var PExpCtx=function PExpCtx(parent){this.parent=parent};PExpCtx.prototype.get=function(name){};PExpCtx.prototype.getParent=function(){};var PObjWrapper=function PObjWrapper(obj){this.obj=obj};PObjWrapper.get=function(name){};var PBoundFunction=function PBoundFunction(obj,func){if(!obj)
throw "No obj provided to bound function";this.obj=obj;this.func=func};PBoundFunction.prototype.call=function(args){return this.func.apply(this.obj,args)}})(window,window.Personetics=window.Personetics||{});(function(window,Personetics,undefined){var pUtils=function(){this._instance={};this.utilsFactory={"utils":utils,"dateUtils":date,"amountUtils":amount}};pUtils.prototype.getUtilsInstance=function(instanceName,context,parentContext){if(this.utilsFactory.hasOwnProperty(instanceName)){if(!this._instance.hasOwnProperty(instanceName)){var clazz=this.utilsFactory[instanceName];this._instance[instanceName]=new clazz(context,parentContext)}
else{var myUtils=this._instance[instanceName];if(typeof myUtils.context=='undefined'||myUtils.context==null)
myUtils.setContext(context,parentContext)}}
return this._instance[instanceName]};var amount=function(context,parentContext){this.context=context;this.parentContext=parentContext};amount.prototype.setContext=function(context,parentContext){this.context=context||this.context;this.parentContext=parentContext||this.parentContext};var date=function(context,parentContext){this.context=context;this.parentContext=parentContext;this.monthNumbers=[1,2,3,4,5,6,7,8,9,10,11,12];this.monthNames={"en-short":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],en:["January","February","March","April","May","June","July","August","September","October","November","December"],he:["ינואר","פברואר","מרץ","אפריל","מאי","יוני","יולי","אוגוסט","ספטמבר","אוקטובר","נובמבר","דצמבר"],"he-short":["ינו","פבר","מרץ","אפר","מאי","יונ","יול","אוג","ספט","אוק","נוב","דצמ"],"es-short":["Ene","Feb","Mar","Abr","May","Jun","Jul","Ago","Sep","Oct","Nov","Dic"],"es":["enero","febrero","marzo","abril","mayo","junio","julio","agosto","septiembre","octubre","noviembre","diciembre"],"fr":["Janvier","Février","Mars","Avril","Mai","Juin","Juillet","Août","Septembre","Octobre","Novembre","Décembre"],"fr-short":["Jan","Fév","Mar","Avr","Mai","Jun","Jul","Aoû","Sep","Oct","Nov","Déc"]}};date.prototype.getMonthName=function(lang){var names=this.monthNames[lang];if(!names){names=this.monthNames.en}
return names}
date.prototype.getMonthNumber=function(lang,monthName){return this.monthNames[lang].indexOf(monthName.replace(/'/gi,''))}
date.prototype.setContext=function(context,parentContext){this.context=context||this.context;this.parentContext=parentContext||this.parentContext};date.prototype.getday=function(dateStr,modifier){return this.getDay(dateStr,modifier)};date.prototype.getDay=function(dateStr,modifier){var result;Personetics.verbose("Calling dateUtils.getDay("+dateStr+", "+modifier+")");var parsedDateStr=dateStr.split('.')[0].replace(/T/g,' ');parsedDateStr=parsedDateStr.split('-').join('/');dateStr=(isNaN(Date.parse(parsedDateStr)))?dateStr:parsedDateStr;var d=new Date(dateStr);var day=d.getDate();var parsedModifier=parseInt(modifier);if(!isNaN(parsedModifier)){d.setDate(day+parsedModifier);result=d.getDate()}
else{result=day}
Personetics.verbose("Result: "+result);return result};date.prototype.getmonth=function(dateStr,modifier){return this.getMonth(dateStr,modifier)};date.prototype.getMonth=function(dateStr,modifier){var result;Personetics.verbose("Calling dateUtils.getMonth("+dateStr+", "+modifier+")");var parsedDateStr=dateStr.split('.')[0].replace(/T/g,' ');parsedDateStr=parsedDateStr.split('-').join('/');dateStr=(isNaN(Date.parse(parsedDateStr)))?dateStr:parsedDateStr;var d=new Date(dateStr);var month=d.getMonth();if(month!=undefined&&month!=null&&!isNaN(month)){month=d.getMonth()+1}
else{try{if(typeof dateStr==='string'){if(!isNaN(dateStr)){month=parseInt(dateStr)}}
else month=dateStr}catch(e){Personetics.verbose("dateUtils.getMonth(): invalid input + '"+dateStr+"'");return dateStr}}
if(modifier){var place=month+modifier;var monthNumbersLength=this.monthNumbers.length;if(place>=monthNumbersLength){place-=monthNumbersLength}
else if(place<=0){place=monthNumbersLength+place}
result=place}
else{result=month}
Personetics.verbose("Result: "+result);return result};date.prototype.getdatemonth=function(dateStr,modifier){return this.getDateMonth(dateStr,modifier)};date.prototype.getDateMonth=function(dateStr,modifier){var result;Personetics.verbose("Calling dateUtils.getDateMonth("+dateStr+", "+modifier+")");var parsedDateStr=dateStr.split('.')[0].replace(/T/g,' ');parsedDateStr=parsedDateStr.split('-').join('/');dateStr=(isNaN(Date.parse(parsedDateStr)))?dateStr:parsedDateStr;var d=new Date(dateStr);var month=d.getMonth()+1;var year=d.getFullYear();var day=d.getDate();if(month==undefined&&month==null&&isNaN(month)){Personetics.verbose("dateUtils.getDateMonth(): invalid input + '"+dateStr+"'");return dateStr}
if(modifier){var newMonth=month+modifier;var monthNumbersLength=this.monthNumbers.length;if(newMonth>=monthNumbersLength){newMonth-=monthNumbersLength;year=year+1}
else if(newMonth<=0){newMonth=monthNumbersLength+newMonth;year=year-1}
if(newMonth<10)
newMonth='0'+newMonth;if(day<10)
day='0'+day;var newDate=year+'-'+newMonth+'-'+day;result=newDate}
else{result=dateStr}
Personetics.verbose("Result: "+result);return result};var utils=function(context,parentContext){this.context=context;this.parentContext=parentContext;this.monthNames={"en-short":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],en:["January","February","March","April","May","June","July","August","September","October","November","December"],he:["ינואר","פברואר","מרץ","אפריל","מאי","יוני","יולי","אוגוסט","ספטמבר","אוקטובר","נובמבר","דצמבר"],"he-short":["ינו'","פבר'","מרץ","אפר'","מאי","יונ'","יול'","אוג'","ספט'","אוק'","נוב'","דצמ'"],"es-short":["Ene","Feb","Mar","Abr","May","Jun","Jul","Ago","Sep","Oct","Nov","Dic"],"es":["enero","febrero","marzo","abril","mayo","junio","julio","agosto","septiembre","octubre","noviembre","diciembre"],"fr":["Janvier","Février","Mars","Avril","Mai","Juin","Juillet","Août","Septembre","Octobre","Novembre","Décembre"],"fr-short":["Jan","Fév","Mar","Avr","Mai","Jun","Jul","Aoû","Sep","Oct","Nov","Déc"]};this.weekDays={en:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],es:["Domingo","Lunes","Martes","Miércoles","Jueves","Viernes","Sábado"]};this.defaultCurrency="";this.tableJoinTypes={INNER:"INNER",LEFT:"LEFT"}};utils.prototype.setContext=function(context,parentContext){this.context=context||this.context;this.parentContext=parentContext||this.parentContext};utils.prototype.monthname=function(dateStr,short,lowerCase){return this.monthName(dateStr,short,lowerCase)};utils.prototype.monthName=function(dateStr,short,lowerCase){var result;Personetics.verbose("Calling utils.monthName("+dateStr+", "+short+","+lowerCase+")");if(!(parseInt(dateStr)==dateStr)){var d=new Date(dateStr);var month=d.getMonth();if(month!=undefined&&month!=null&&!isNaN(month)){month=d.getMonth()}}
else{try{var dn=parseInt(dateStr);if(dn>=1&&dn<=12){month=dn-1}
else{Personetics.log("utils.monthName(): invalid month number + '"+dateStr+"'");return dateStr}}catch(e){Personetics.log("utils.monthName(): invalid input + '"+dateStr+"'");return dateStr}}
var lang=Personetics.processor.PStoryConfig.getConfig("lang");if(short==!0||short=="MMM")
lang=lang+"-short";var names=this.monthNames[lang];if(!names){Personetics.verbose("utils.monthName(): month names not available + '"+names+"'");return dateStr}
result=names[month];if(lowerCase==!0){result=result.toLowerCase()}
Personetics.verbose("Result: "+result);return result};utils.prototype.dayname=function(dateStr,short){return this.dayName(dateStr,short)};utils.prototype.dayName=function(dateStr,short){var result="";if(!(parseInt(dateStr)==dateStr)){var d=new Date(dateStr);var weekday=d.getDay();if(weekday==undefined||weekday==null||isNaN(weekday)){Personetics.verbose("utils.dayName(): invalid weekday");return result}}
else{Personetics.verbose("utils.dayName(): invalid date + '"+dateStr+"'")}
var lang=Personetics.processor.PStoryConfig.getConfig("lang");var names=this.weekDays[lang];if(!names){Personetics.verbose("utils.dayName(): weekdays names are not available for "+lang);return result}
result=names[weekday];return result};utils.prototype.formatdate=function(dateStr,format,isAccessibilityFormat){return this.formatDate(dateStr,format,isAccessibilityFormat)};utils.prototype.formatDate=function formatDate(dateStr,format,isAccessibilityFormat){Personetics.verbose("Calling utils.formatDate("+dateStr+", "+format+")");if(typeof dateStr==='undefined'||dateStr===null||dateStr.length<=0)
throw{message:"utils.formatDate("+dateStr+", "+format+") Error: invalid dateStr parameter"};if(typeof format==="undefined"||format==null)
format=Personetics.processor.PStoryConfig.getConfig("dateFormat");var parsedDateStr=dateStr.split('.')[0].replace(/T/g,' ');parsedDateStr=parsedDateStr.split('-').join('/');dateStr=(isNaN(Date.parse(parsedDateStr)))?dateStr:parsedDateStr;var date=new Date(dateStr);var result=format;var arr=format.split(/[\s\/\\\-\:]/);var arr=format.match(/(dd|DD|d|mmmm|mmm|MMMMM|MMMM|MMM|mm|MM|m|M|YYYY|yy|YY|y|weekday)/g);var me=this;arr.forEach(function(dateFormatItem,index){var dateFormatValue=me.dateFormatToDate(dateFormatItem,date,dateStr);if(dateFormatValue){result=result.replace(dateFormatItem,dateFormatValue)}});if(isAccessibilityFormat){result=this.createAccessibleDateText(result,dateStr,format)}
Personetics.verbose("Result: "+result);return result};utils.prototype.dateFormatToDate=function(formatItem,date,dateStr){var result=null;switch(formatItem){case "d":var day=date.getDate()+'';result=day;break;case "dd":var day=date.getDate()+'';var suffix=day.substring(day.length-1);if(suffix=="1")
result=day+"st";else if(suffix=="2")
result=day+"nd";else if(suffix=="3")
result=day+"rd";else if(day=="11"||day=="12"||day=="13")
result=day+"th";else result=day+"th";break;case "DD":var day=date.getDate();if(day<10)
day="0"+day;result=day;break;case "mmmm":result=this.monthName(dateStr,!0,!0);break;case "m":case "MMMM":case "MMMMM":result=this.monthName(dateStr);break;case "M":case "MMM":result=this.monthName(dateStr,!0);break;case "mm":var monthNum=date.getMonth()+1;result=monthNum;break;case "MM":var monthNum=date.getMonth()+1;result=monthNum;if(monthNum<10)
result="0"+result;break;case "mmm":var monthNum=date.getMonth()+1;monthNum=monthNum+'';result=this.monthName(monthNum);break;case "y":case "YY":case "YYYY":result=date.getFullYear();break;case "yy":var fullYear=date.getFullYear().toString();result=fullYear.substring(2);break;case "weekday":result=this.dayName(dateStr);break;default:break}
return result};utils.prototype.createAccessibleDateText=function createAccessibleDateText(result,dateStr,format){accFormat=format.replace(/(mmm|MMM|mm|MM|m|M)/g,"m");accFormat=accFormat.replace(/DD/g,"dd");accFormat=accFormat.split(/[\/\\]/).join(' ');if(format===accFormat)
return result;var accText=this.formatdate(dateStr,accFormat);var res="<span class='perso-accessibility-wrapper' role='text'><span class='perso-accessibility-no-read' "+"aria-hidden='true'>"+result+"</span><span class='perso-accessibility-read'>"+accText+"</span></span>";return res};utils.prototype.numberWithCommas=function(x){return x.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")};utils.prototype.formatamount=function(amountStr,currency,format){return this.formatAmount(amountStr,currency,format)};utils.prototype.formatAmount=function(amountStr,currency,format){Personetics.verbose("Calling utils.formatAmount("+amountStr+", "+currency+", "+format+")");if(typeof amountStr==='undefined'||amountStr==null)
return null;amountStr=amountStr+'';format=typeof format==='undefined'||format===null?Personetics.processor.PStoryConfig.getConfig("amountFormat"):format;currency=typeof currency==='undefined'||currency===null||Personetics.processor.PStoryConfig.getConfig("useProjectDefaultCurrency")==!0?Personetics.processor.PStoryConfig.getConfig("currencySymbol"):currency;var minus="";var accessibilityMinus="";var formattedStr;var decimals='';var dot='';var isAbs=!1;var value;if(format){var matches=format.match(/0/g);var helper=format;var fixed=matches?matches.length:0;value=parseFloat(amountStr).toFixed(fixed);if(fixed>0){decimals=value.slice(fixed*-1);value=value.slice(0,fixed*-1);dot=value.slice(-1);value=value.slice(0,-1);helper=helper.slice(0,(fixed+1)*-1)}
matches=helper.match(/[,/.]/g);matches.reverse();var helper2=helper;var abs=format[0];if(abs=="+"){format=format.substring(1);isAbs=!0}
if(Array.isArray(matches)){matches.forEach(function(item,i){var valueLength=value.charAt(0)=="-"?value.length-1:value.length;var helperLength=helper.length;var helperIndex=helper.lastIndexOf(item);var index=helperLength-helperIndex-1;index=index+(helper2.length-helperLength);if(index>=valueLength){return!1}
index=index*-1;value=[value.slice(0,index),item,value.slice(index)].join('');helper=helper.slice(0,helperIndex)})}
formattedStr=value}
else{value=amountStr.replace(/\,/g,'');value=this.round(value);formattedStr=this.numberWithCommas(value)}
if(formattedStr.indexOf('-')>-1){formattedStr=formattedStr.substring(1);if(isAbs==!1){minus="-";accessibilityMinus="&minus;"}}
var resultStr;var amountAccessibilityString=accessibilityMinus+currency+formattedStr+dot+decimals;if(Personetics.processor.PStoryConfig.getConfig("supportHtmlTagInProcessor")==!1){resultStr=minus+currency+formattedStr+dot+decimals}
else{decimals="<span class='perso-decimals'>"+decimals+"</span>";currency="<span class='perso-currency'>"+currency+"</span>";formattedStr="<span class='perso-int-num'>"+formattedStr+"</span>";minus="<span class='perso-minus-sign'>"+minus+"</span>";dot="<span class='perso-decimals-dot'>"+dot+"</span>";if(Personetics.processor.PStoryConfig.isRtl())
resultStr="<span class='perso-amount' role='text' aria-label='"+amountAccessibilityString+"'>"+currency+minus+formattedStr+dot+decimals+"</span>";else resultStr="<span class='perso-amount' role='text' aria-label='"+amountAccessibilityString+"'>"+minus+currency+formattedStr+dot+decimals+"</span>"}
Personetics.verbose("Result: "+resultStr);return resultStr};utils.prototype.formatAmountInteger=function(amountStr,currency,format){Personetics.verbose("Calling utils.formatAmountInteger("+amountStr+", "+currency+", "+format+")");amountStr=amountStr+'';currency=typeof currency==='undefined'||currency===null?Personetics.processor.PStoryConfig.getConfig("currencySymbol"):currency;if(typeof currency==='undefined'||currency==null)
currency="";var value=amountStr.replace(/\,/g,'');value=parseInt(value);var resultStr;var unformattedStr=this.numberWithCommas(value);if(value<0)
resultStr="-"+currency+unformattedStr.substring(1);else resultStr=currency+unformattedStr;Personetics.verbose("Result: "+resultStr);return resultStr};utils.prototype.formatpercent=function formatpercent(amountStr){return this.formatPercent(amountStr)};utils.prototype.formatPercent=function formatPercent(amountStr){Personetics.verbose("Calling utils.formatPercent("+amountStr+")");var result=parseFloat(amountStr);result=result*100;result=Math.round(result);result+="%";Personetics.verbose("Result: "+amount);return result};utils.prototype.limitstring=function limitstring(string,maxLength){return this.limitString(string,maxLength)};utils.prototype.limitString=function limitString(string,maxLength){Personetics.verbose("Calling utils.limitString("+string+","+maxLength+")");var _numOfChars=maxLength||parseInt(Personetics.processor.PStoryConfig.getConfig("stringMaxLength"));var _ellipsisString='...';var result=string;if(string.length>_numOfChars)
result=string.substring(0,_numOfChars-(_ellipsisString.length))+_ellipsisString;return result};utils.prototype.round=function round(amount){Personetics.verbose("Calling utils.round("+amount+")");var numb=parseFloat(amount);numb=Math.round(numb);Personetics.verbose("Result: "+numb);return numb};utils.prototype.abs=function abs(x){Personetics.verbose("Calling utils.abs("+x+")");var result=null;if(typeof x!=='undefined'&&x!==null){if(typeof(x)=="string")
result=x.replace("-","");else result=x;result=Math.abs(result)}
Personetics.verbose("Result: "+result);return result};utils.prototype.highlighttext=function(value){return this.highlightText(value)};utils.prototype.highlightText=function(value){return'<span class="perso-highlight">'+value+'</span>'};utils.prototype.join=function join(leftTable,rightTable,conditionExpStr,type){var joinType=type||this.tableJoinTypes.INNER;var regexp=/(\w*)\.(\w*)([\=\!]+)(\w*)\.(\w*)/;var matches=conditionExpStr.match(regexp);if(matches){var leftTableName=matches[1];var leftColName=matches[2];var middlePart=matches[3];var rightTableName=matches[4];var rightColName=matches[5];var newExp="_JoinLeftTable.getValue(leftIndex,'"+leftColName+"')"+middlePart+"_JoinRightTable.getValue(rightIndex,'"+rightColName+"')";var leftSize=leftTable.size();var rightSize=rightTable.size();var cols=leftTable.data.cols;var colMap=leftTable.colMap;var colMapIndex=cols.length;if(Array.isArray(rightTable.data.cols)){var ar=rightTable.data.cols;ar.forEach(function(col,index){if(cols.indexOf(col)<0){cols.push(col);colMap[col]=colMapIndex;colMapIndex++}})}
var result={type:"PTable",cols:cols,rows:[]};var _context,_parentContext;var joinTables={_JoinLeftTable:leftTable,_JoinRightTable:rightTable};if(typeof(this.parentContext)!=='undefined'&&this.parentContext!=null){_parentContext=this.parentContext;_context=this.context;_context._JoinLeftTable=leftTable;_context._JoinRightTable=rightTable}
else{_parentContext=this.context;_context=joinTables}
for(var leftIndex=0;leftIndex<leftSize;leftIndex++){var foundValue=!1;for(var rightIndex=0;rightIndex<rightSize;rightIndex++){var exp=newExp.replace("leftIndex",leftIndex).replace("rightIndex",rightIndex);var conditionExp=new Personetics.processor.PExp(exp);try{var conditionValue=conditionExp.eval(_context,_parentContext)}
catch(e){throw{message:"utils.join() - Error: failed to evaluate join expression. Error message: "+e.message,stack:e.stack}}
if(conditionValue){foundValue=!0;var newRow=new Array(cols.length);for(var colName in colMap){if(colMap.hasOwnProperty(colName)){var colIndex=colMap[colName];var value=leftTable.getValue(leftIndex,colName);if(!value)
value=rightTable.getValue(rightIndex,colName);newRow[colIndex]=value}}
result.rows.push(newRow)}}
if(!foundValue&&joinType==this.tableJoinTypes.LEFT){var newRow=new Array(cols.length);for(var colName in colMap){if(colMap.hasOwnProperty(colName)){var colIndex=colMap[colName];var value=leftTable.getValue(leftIndex,colName);if(!value)
value=null;newRow[colIndex]=value}}
result.rows.push(newRow)}}
var ptable=new Personetics.processor.PTable(result);return ptable}
else return leftTable};Personetics.processor=Personetics.processor||{};Personetics.processor.PUtils=new pUtils()})(window,window.Personetics=window.Personetics||{});(function(window,Personetics,undefined){Personetics.processor=Personetics.processor||{};Personetics.processor.PStoryConfig=new function(){this.configMap={"dateFormat":"MM/DD/YY","amountFormat":"###,###,###","currencySymbol":"$","useProjectDefaultCurrency":!1,"lang":"en","supportHtmlTagInProcessor":"false","stringMaxLength":"15","context":"","serverCallBack":""};this.getConfig=function(configId){if(this.configMap.hasOwnProperty(configId)){return this.configMap[configId]}
return null};this.setConfig=function(configId,configValue){if(this.configMap.hasOwnProperty(configId)&&configValue!='undefined'&&configValue!=null){this.configMap[configId]=configValue}};this.rtlMap={"en":!1,"he":!0};this.isRtl=function(){var lang=this.configMap.lang;if(this.rtlMap.hasOwnProperty(lang)){return this.rtlMap[lang]}
return!1}}})(window,window.Personetics=window.Personetics||{});(function(window,Personetics,undefined){Personetics.processor=Personetics.processor||{};Personetics.processor.PDataSource=function PDataSource(data){this.data=data};Personetics.processor.PDataSource.prototype.getType=function(){return this.type};Personetics.processor.PDataSource.prototype.getData=function(){return this.data};Personetics.processor.PDataSource.prototype.get=function(name){var obj=this.data[name];if(!obj||!obj.type)
return obj;return obj};Personetics.processor.PDataSource.prototype.getChild=function(obj,prop){if(Personetics.processor.PDataSource.prototype.isPrototypeOf(obj))
return obj.get(prop);return obj[prop]}})(window,window.Personetics=window.Personetics||{});(function(window,Personetics,undefined){Personetics.processor=Personetics.processor||{};Personetics.processor.PFuture=function PFuture(){Personetics.processor.PDataSource.call(this,{type:"future",future:!0});this.type="future";this.future=!0};Personetics.processor.PFuture.prototype=Object.create(Personetics.processor.PDataSource.prototype);Personetics.processor.Future=new Personetics.processor.PFuture()})(window,window.Personetics=window.Personetics||{});(function(window,Personetics,undefined){Personetics.processor=Personetics.processor||{};Personetics.processor.POptionModel=function POptionModel(data,parentDataSource){Personetics.processor.PDataSource.call(this,data);this.filteredFields=data.whiteListFields;this.parentDataSource=parentDataSource};Personetics.processor.POptionModel.prototype=Object.create(Personetics.processor.PDataSource.prototype);Personetics.processor.POptionModel.prototype.get=function(name){if(!this.filteredFields||this.filteredFields.hasOwnProperty(name)){var filterName=this.filteredFields?this.filteredFields[name]:name;var value=Personetics.processor.PDataSource.prototype.get.call(this,filterName);if(!value)
value=this.parentDataSource.get(name);return value}
else{return"NOPE"}}})(window,window.Personetics=window.Personetics||{});(function(window,Personetics,undefined){Personetics.processor=Personetics.processor||{};var PTableMappingMethods={sum:{startValue:0,method:function(group,newValue){return group.value+newValue}},avg:{startValue:0,method:function(group,newValue){var oldSize=group.size-1;var oldAvg=group.value;var oldSum=oldSize*oldAvg;return(oldSum+newValue)/group.size}},count:{startValue:0,method:function(group,newValue){return group.size}},standardDeviation:{startValue:0,method:function(group,newValue,index,tableSize){if(group.size==1)
group.mem={items:[]};group.mem.items.push(newValue);if(index==tableSize-1){var variance;var dev;var avg;var sum=0;group.mem.items.forEach(group.mem.items,function(item,i){sum+=item});avg=sum/group.mem.items.length;group.mem.items.forEach(group.mem.items,function(item,i){var x=item-avg;dev+=Math.pow(x,2)});variance=dev/group.mem.items.length;return Math.sqrt(variance)}
else{return null}}},min:{},max:{}};var PTableTypes={PText:"PText"}
Personetics.processor.PTable=function PTable(data){Personetics.processor.PDataSource.call(this,data);this.name=data.name;this.colMap={};this.data={cols:[],rows:[]};this.attributesTypes=data.attributesTypes;this.filter.bind(this);this.loadTable(data)};Personetics.processor.PTable.prototype=Object.create(Personetics.processor.PDataSource.prototype);Personetics.processor.PTable.prototype.toString=function toString(){var result={name:this.name,cols:this.data.cols,rows:this.data.rows,attributesTypes:this.data.attributesTypes,type:this.data.type};return JSON.stringify(result)};Personetics.processor.PTable.prototype.loadTable=function loadTable(data){if(!data||data.future)
return;this.data=data;var colMap={};data.cols.forEach(function(header,i){colMap[header]=i});this.colMap=colMap};Personetics.processor.PTable.prototype.loadObjArray=function loadObjArray(objArray){if(!objArray)
return;var colMap={};var rows=[];var i=0;objArray.forEach(function(obj){for(var key in obj){if(obj.hasOwnProperty(key)){var colIndex=colMap[key];if(!colIndex){colIndex=i++;colMap[key]=colIndex}}}});this.colMap=colMap;var numCols=colMap.length;var cols=new Array(numCols);for(var key in colMap){if(colMap.hasOwnProperty(key)){var index=colMap[key];cols[index]=key}}
objArray.forEach(function(obj){var row=new Array(numCols);for(var key in obj){if(obj.hasOwnProperty(key)){var value=obj[key];var colIndex=colMap[key];row[colIndex]=value}}
rows.push(row)});this.data={cols:cols,rows:rows}};Personetics.processor.PTable.prototype.getObjArray=function getObjArray(){var arr=[];for(var row=0;row<this.getRowCount();row++){var obj={};for(var col=0;col<this.data.cols.length;col++){obj[this.data.cols[col]]=getResultByType(this.data,col,row)}
arr.push(obj)}
return arr};Personetics.processor.PTable.prototype.getColIndex=function getColIndex(name){return this.colMap[name]};Personetics.processor.PTable.prototype.size=function size(){var result;if(!this.data.hasOwnProperty("rows")){result=0}
else{result=this.data.rows.length}
Personetics.verbose("Calling '"+this.name+"'.size()");Personetics.verbose("Result: "+result);return result};Personetics.processor.PTable.prototype.getrowcount=function getrowcount(){return this.getRowCount()};Personetics.processor.PTable.prototype.getRowCount=function getRowCount(){var result=this.data.rows.length;Personetics.verbose("Calling '"+this.name+"'.getRowCount()");Personetics.verbose("Result: "+result);return result};Personetics.processor.PTable.prototype.getrow=function getrow(rowIndex){return this.getRow(rowIndex)};Personetics.processor.PTable.prototype.getRow=function getRow(rowIndex){var result=[];for(var i=0;i<this.data.rows[rowIndex].length;i++){result[i]=getResultByType(this.data,i,rowIndex)}
Personetics.verbose("Calling '"+this.name+"'.getRow("+rowIndex+")");Personetics.verbose("Result: "+JSON.stringify(result));return result};Personetics.processor.PTable.prototype.getfirstrows=function getfirstrows(numOfRows){return this.getFirstRows(numOfRows)};Personetics.processor.PTable.prototype.getFirstRows=function getFirstRows(numOfRows){Personetics.verbose("Calling '"+this.name+"'.getFirstRows("+numOfRows+")");var table=this;if(table.getRowCount()>numOfRows){var rows=table.data.rows.slice(0,numOfRows);var resultTable=new Personetics.processor.PTable({cols:table.data.cols,rows:rows,name:this.name+".getFirstRows("+numOfRows+")",attributesTypes:table.data.attributesTypes,type:table.data.type});Personetics.verbose("Result: "+resultTable.toString());return resultTable}
else{Personetics.verbose("Result: "+table.toString());return table}};Personetics.processor.PTable.prototype.getlastrows=function getlastrows(numOfRows){return this.getLastRows(numOfRows)};Personetics.processor.PTable.prototype.getLastRows=function getLastRows(numOfRows){Personetics.verbose("Calling '"+this.name+"'.getLastRows("+numOfRows+")");var table=this;if(table.getRowCount()>numOfRows){var rows=table.data.rows.slice(0-numOfRows);var resultTable=new Personetics.processor.PTable({cols:table.data.cols,rows:rows,name:this.name+".getLastRows("+numOfRows+")",attributesTypes:this.data.attributesTypes,type:this.data.type});Personetics.verbose("Result: "+resultTable.toString());return resultTable}
else{Personetics.verbose("Result: "+table.toString());return table}};Personetics.processor.PTable.prototype.getrowasobject=function getrowasobject(rowIndex){return this.getRowAsObject(rowIndex)};Personetics.processor.PTable.prototype.getRowAsObject=function getRowAsObject(rowIndex){Personetics.verbose("Calling '"+this.name+"'.getRowAsObject("+rowIndex+")");if(rowIndex<this.data.rows.length){var row=this.data.rows[rowIndex];var result={};for(var colName in this.colMap){if(this.colMap.hasOwnProperty(colName)){var index=this.colMap[colName];result[colName]=row[index]}}
Personetics.verbose("Result: "+JSON.stringify(result));return result}
else{Personetics.verbose("Result: ''");return''}};Personetics.processor.PTable.prototype.getvalue=function getvalue(rowIndex,colName){return this.getValue(rowIndex,colName)};Personetics.processor.PTable.prototype.getValue=function getValue(rowIndex,colName){Personetics.verbose("Calling '"+this.name+"'.getValue("+rowIndex+", "+colName+")");var size=this.size();if(this.colMap.hasOwnProperty(colName)&&size>rowIndex){var colIndex=this.colMap[colName];var result=getResultByType(this.data,this.colMap[colName],rowIndex);Personetics.verbose("Result: "+result);return result}
else{Personetics.verbose("Result: null");return null}};var getResultByType=function getResultByType(data,colIndex,rowIndex)
{var type=data.hasOwnProperty("attributesTypes")&&(typeof data.attributesTypes!=='undefined')&&(data.attributesTypes!==null)?data.attributesTypes[colIndex]:"";switch(type){case PTableTypes.PText:return getTextByLanguage(data.rows[rowIndex][colIndex]);default:return data.rows[rowIndex][colIndex]}};var getTextByLanguage=function getTextByLanguage(row)
{if(row===null||row===undefined)return row;if(row.hasOwnProperty(Personetics.processor.PStoryConfig.getConfig("lang"))){return row[Personetics.processor.PStoryConfig.getConfig("lang")]}
else{if(typeof row!=="object")
{return row}
var firstKey=(function getFirstKey(pTextObj){for(var key in pTextObj)return key})(row);if(firstKey){return row[firstKey]}}};Personetics.processor.PTable.prototype.filter=function filter(colName,validValue){Personetics.verbose("Calling '"+this.name+"'.filter("+colName+", "+validValue+")");if(!validValue||validValue=="all"){Personetics.verbose("No validValue or no filter. Result: "+this.toString());return this}
var rows=[];var i;for(i=0;i<this.getRowCount();i++){var val=this.getValue(i,colName);if(val==validValue)
rows.push(this.getRow(i))}
var table=new Personetics.processor.PTable({cols:this.data.cols,rows:rows,name:this.name+".filter("+colName+", "+validValue+")",attributesTypes:this.data.attributesTypes,type:this.data.type});Personetics.verbose("Result: "+table.toString());return table};Personetics.processor.PTable.prototype.filterbynumber=function filterbynumber(colName,validValue){return this.filterByNumber(colName,validValue)};Personetics.processor.PTable.prototype.filterByNumber=function filterByNumber(colName,validValue){if(arguments.length>2){var operator,amount;var exp=arguments[2];operator=exp;if(arguments.length>3){var exp2=arguments[3];amount=exp2}}
else{return this.filter(colName,validValue)}};var getBackdate=function getBackDate(currentDate,numOfDaysBack){var backdate=new Date(currentDate);var _numOfDaysBack=(numOfDaysBack)?numOfDaysBack:0;backdate=new Date(backdate.setDate(backdate.getDate()+_numOfDaysBack));var backdateObj=new Date(backdate.setHours(0,0,0,0));return backdateObj};Personetics.processor.PTable.prototype.filterByDays=function filterByDays(colName,currentDate,fromDate,toDate){var parsedDateStr=currentDate.split('.')[0].replace(/T/g,' ');parsedDateStr=parsedDateStr.split('-').join('/');currentDate=(isNaN(Date.parse(parsedDateStr)))?currentDate:parsedDateStr;Personetics.verbose("Calling '"+this.name+"'.filterByDays("+colName+", "+currentDate+", "+fromDate+", "+toDate+")");var _toDate=(typeof toDate!=='undefined'&&toDate!==null)?getBackdate(currentDate,toDate):getBackdate(currentDate,0);var _fromDate=getBackdate(currentDate,fromDate);var rows=[];for(var i=0;i<this.getRowCount();i++){var val=this.getValue(i,colName);var dateVal=new Date(val);dateVal.setHours(0,0,0,0);if(typeof dateVal==='object'&&dateVal<=_toDate&&dateVal>=_fromDate){rows.push(this.getRow(i))}}
var table=new Personetics.processor.PTable({cols:this.data.cols,rows:rows,name:this.name+".filterByDays("+colName+", "+currentDate+", "+fromDate+", "+toDate+")",attributesTypes:this.data.attributesTypes,type:this.data.type});Personetics.verbose("Result: "+table.toString());return table};Personetics.processor.PTable.prototype.groupby=function groupby(keyFieldNames,valueFieldName,mappingMethod){return this.groupBy(keyFieldNames,valueFieldName,mappingMethod)};Personetics.processor.PTable.prototype.groupBy=function groupBy(keyFieldNames,valueFieldName,mappingMethod){Personetics.verbose("Calling '"+this.name+"'.groupBy("+keyFieldNames+", "+valueFieldName+", "+mappingMethod+")");var mapping;if(mappingMethod&&PTableMappingMethods.hasOwnProperty(mappingMethod)){mapping=PTableMappingMethods[mappingMethod]}
else{mapping=PTableMappingMethods.sum}
if(!Array.isArray(keyFieldNames))
keyFieldNames=[keyFieldNames];var table=this;var cols=[];cols=cols.concat(keyFieldNames);cols.push(valueFieldName);var groupMap={};var tableSize=table.getRowCount();for(var i=0;i<tableSize;i++){var key="";var keyValues=[];var keyFieldValues=[];for(var keyField in keyFieldNames){if(keyFieldNames.hasOwnProperty(keyField)){keyField=keyFieldNames[keyField];var keyFieldValue=table.getValue(i,keyField);keyFieldValues.push(keyFieldValue);key+=keyFieldValue+","}}
var group=groupMap[key];if(!group){group={key:key,keyValues:keyFieldValues,value:mapping.startValue,size:0};groupMap[key]=group}
group.size++;var value=table.getValue(i,valueFieldName);value=Number(value);group.value=mapping.method(group,value,i,tableSize)}
var rows=[];for(group in groupMap){if(groupMap.hasOwnProperty(group)){var row=[];var groupValue=groupMap[group];for(j=0;j<keyFieldNames.length;j++){row.push(groupValue.keyValues[j])}
row.push(groupValue.value);rows.push(row)}}
var resultTable=new Personetics.processor.PTable({cols:cols,rows:rows,name:this.name+".groupBy("+keyFieldNames+", "+valueFieldName+", "+mappingMethod+")",attributesTypes:this.data.attributesTypes,type:this.data.type});Personetics.verbose("Result: "+resultTable.toString());return resultTable};Personetics.processor.PTable.prototype.groupByExpression=function groupByExpression(expression){Personetics.verbose("Calling '"+this.name+"'.groupByExpression("+expression+")");var exp=new Personetics.processor.PExp(expression);var objArray=this.getObjArray();var rows=this.data.rows;var cols=this.data.cols;var groups={};var me=this;if(Array.isArray(rows)){rows.forEach(function(row,index){var context=objArray[index];try{var key=exp.eval(context);if(!groups.hasOwnProperty(key)){groups[key]=[]}
groups[key].push(row)}
catch(e){Personetics.error(me.name+"'.groupByExpression("+expression+") Error: Failed to evaluate row "+index+", ignoring row")}})}
var tables=[];for(var key in groups){if(groups.hasOwnProperty(key)){var group=groups[key];var table=new Personetics.processor.PTable({cols:cols,rows:group,name:this.name+".groupByExpression("+expression+")",attributesTypes:this.data.attributesTypes,type:this.data.type});var resultTable={table:table,seriesName:key};tables.push(resultTable)}}
var res="[";var sep="";for(var k=0;k<tables;k++){sep=",";res+=sep+tables[k].toString()}
res+="]";Personetics.verbose("Result: "+res);return tables};Personetics.processor.PTable.prototype.sortbydate=function sortbydate(colNames,direction){return this.sortByDate(colNames,direction)};Personetics.processor.PTable.prototype.sortByDate=function sortByDate(colNames,direction){Personetics.verbose("Calling '"+this.name+"'.sortByDate("+colNames+", "+direction+")");var asc=1;if(direction){if(direction.toLowerCase()=="asc"){asc=1}
else if(direction.toLowerCase()=="desc"){asc=-1}}
var table=this;if(!Array.isArray(colNames))
colNames=[colNames];var cols=[];colNames.forEach(function(name){var col=table.colMap[name];cols.push(col)});var newRows=this.data.rows.slice(0);var length=newRows.length;var range;newRows.sort(function(a,b){for(var i=0;i<cols.length;i++){var col=cols[i];var valA=new Date(a[col]).getTime();var valB=new Date(b[col]).getTime();var val=valA-valB;if(val!=0){return asc*val}}
return 0});var resultTable=new Personetics.processor.PTable({cols:table.data.cols,rows:newRows,attributesTypes:table.data.attributesTypes,type:table.data.type});Personetics.verbose("Result: "+resultTable.toString());return resultTable};Personetics.processor.PTable.prototype.sortbymonth=function sortbymonth(colNames,direction){return this.sortByMonth(colNames,direction)};Personetics.processor.PTable.prototype.sortByMonth=function sortByMonth(colNames,direction){Personetics.verbose("Calling '"+this.name+"'.sortByMonth("+colNames+", "+direction+")");var table=this;if(!Array.isArray(colNames))
colNames=[colNames];var cols=[];colNames.forEach(function(name){var col=table.colMap[name];cols.push(col)});var newRows=this.data.rows.slice(0);var range;newRows.sort(function(a,b){for(var i=0;i<cols.length;i++){var col=cols[i];var valA=parseInt(a[col]);var valB=parseInt(b[col]);return valA-valB}
return 0});var range;var index=0;for(var i=1;i<newRows.length;i++){range=Math.abs(newRows[i][0]-newRows[i-1][0]);if(range>1){index=i;break}}
var finalRows;if(index>0){finalRows=newRows.slice(index);finalRows=finalRows.concat(newRows.slice(0,index))}else{finalRows=newRows}
if(direction&&direction.toLowerCase()=="desc"){finalRows.reverse()}
var resultTable=new Personetics.processor.PTable({cols:table.data.cols,rows:finalRows,name:this.name+".sortByMonth("+colNames+", "+direction+")",attributesTypes:table.data.attributesTypes,type:table.data.type});Personetics.verbose("Result: "+resultTable.toString());return resultTable};Personetics.processor.PTable.prototype.sortby=function sortby(colNames,direction,type){return this.sortBy(colNames,direction,type)};Personetics.processor.PTable.prototype.sortBy=function sortBy(colNames,direction,type){Personetics.verbose("Calling '"+this.name+"'.sortBy("+colNames+", "+direction+", "+type+")");var asc=1;if(direction){if(direction.toLowerCase()=="asc"){asc=1}
else if(direction.toLowerCase()=="desc"){asc=-1}}
var table=this;if(!Array.isArray(colNames))
colNames=[colNames];var cols=[];colNames.forEach(function(name){var col=table.colMap[name];cols.push(col)});var newRows=this.data.rows.slice(0);var length=newRows.length;var range;newRows.sort(function(a,b){for(var i=0;i<cols.length;i++){var col=cols[i];var valA=a[col];var valB=b[col];if(valA>valB)return asc;if(valA<valB)return-asc}
return 0});var resultTable=new Personetics.processor.PTable({cols:table.data.cols,rows:newRows,attributesTypes:table.data.attributesTypes,type:table.data.type});Personetics.verbose("Result: "+resultTable.toString());return resultTable};Personetics.processor.PTable.prototype.getasgroupedTable=function getasgroupedTable(valueFunc){return this.getAsGroupedTable(valueFunc)};Personetics.processor.PTable.prototype.getAsGroupedTable=function getAsGroupedTable(valueFunc){Personetics.verbose("Calling '"+this.name+"'.getAsGroupedTable("+valueFunc+")");var groups=[];var curGroup;var valToIndices={};var lastVal;if(Array.isArray(this.data.rows)){this.data.rows.forEach(function(row,i){var val=valueFunc(row).trim();var valIndex=valToIndices[val];if(typeof valIndex==='undefined'||valIndex===null){curGroup={encValue:Personetics.utils.string.stripSpecialChars(val),value:val,rows:[]};groups.push(curGroup);var index=groups.length-1;valToIndices[val]=index}
else{curGroup=groups[valIndex]}
var newRow=jQuery.extend({},row);curGroup.rows.push(newRow)})}
Personetics.verbose("Result: "+groups);return groups};Personetics.processor.PTable.prototype.max=function max(colName){Personetics.verbose("Calling '"+this.name+"'.max("+colName+")");var result=this.extremum(colName,function(extremeVal,val){return extremeVal<val},"max");Personetics.verbose("Result: "+result);return result};Personetics.processor.PTable.prototype.min=function min(colName){Personetics.verbose("Calling '"+this.name+"'.min("+colName+")");var result=this.extremum(colName,function(extremeVal,val){return extremeVal>val},"min");Personetics.verbose("Result: "+result);return result};Personetics.processor.PTable.prototype.extremum=function extremum(colName,isNewExtremeFunc,callingMethodName){if(this.getRowCount()==0)
return this;var colIndex=this.getColIndex(colName);var extremRow=this.data.rows[0];var extremVal=extremRow[colIndex];for(var i=0;i<this.getRowCount();i++){var row=this.data.rows[i];var val=row[colIndex];var floatExtremVal=typeof(extremVal)=='string'?parseFloat(extremVal):extremVal;var floatVal=typeof(val)=='string'?parseFloat(val):val;if(isNewExtremeFunc(floatExtremVal,floatVal)){extremVal=val;extremRow=row}}
var resultTable=new Personetics.processor.PTable({cols:this.data.cols,rows:[extremRow],name:this.name+"."+callingMethodName+"("+colName+", "+isNewExtremeFunc+")",attributesTypes:this.data.attributesTypes,type:this.data.type});return resultTable};Personetics.processor.PTable.prototype.addComputedCol=function addComputedCol(colName,expStr){var exp=new Personetics.processor.PExp(expStr);var newCols=this.data.cols.slice(0);newCols.push(colName);var newRows=[];var me=this;for(var i=0;i<this.getRowCount();i++){var row=this.data.rows[i];try{var val=exp.eval(row);var newRow=row.slice(0);newRow.push(val);newRows.push(newRow)}
catch(e){Personetics.error(me.name+"'.addComputedCol("+colName+", "+expStr+") Error: Failed to "+"valuate row "+i+", ignoring row")}}
var resultTable=new Personetics.processor.PTable({cols:newCols,rows:newRows,name:this.name+".addComputedCol("+colName+", "+expStr+")",attributesTypes:this.data.attributesTypes,type:this.data.type});return resultTable};Personetics.processor.PTable.prototype.map=function map(colName,mappingMethod,optStartVal){if(this.getRowCount()==0)
return optStartVal!=undefined?optStartVal:{};var colIndex=this.getColIndex(colName);var returnValue=optStartVal||0;for(var i=0;i<this.getRowCount();i++){returnValue=mappingMethod(returnValue,this.getValue(i,colName))}
return returnValue};Personetics.processor.PTable.prototype.sum=function(colName){Personetics.verbose("Calling '"+this.name+"'.sum("+colName+")");var result=this.map(colName,function(oldValue,newValue){var oldValueNum=oldValue;if(typeof oldValue==='string')
oldValueNum=parseFloat(oldValue);var newValueNum=newValue;if(typeof newValue==='string')
newValueNum=parseFloat(newValue);return oldValueNum+newValueNum},0);Personetics.verbose("Result: "+result);return result};Personetics.processor.PTable.prototype.avg=function(colName){Personetics.verbose("Calling '"+this.name+"'.avg("+colName+")");var result=0;if(this.getRowCount()>0){var sum=this.sum(colName);result=sum/this.getRowCount()}
Personetics.verbose("Result: "+result);return result};Personetics.processor.PTable.prototype.first=function first(colName){Personetics.verbose("Calling '"+this.name+"'.first("+colName+")");var result;var count=this.getRowCount();if(count>0){if(colName)
result=this.getValue(0,colName);else{var rows=[];rows.push(this.getRow(0));var table=new Personetics.processor.PTable({cols:this.data.cols,rows:rows,name:this.name+".first("+colName+")",attributesTypes:this.data.attributesTypes,type:this.data.type});result=table.getObjArray()[0]}}
else result=this;Personetics.verbose("Result: "+result);return result};Personetics.processor.PTable.prototype.last=function(colName){Personetics.verbose("Calling '"+this.name+"'.last("+colName+")");var result;var count=this.getRowCount();if(count>0){if(colName)
result=this.getValue(count-1,colName);else{var rows=[];rows.push(this.getRow(count-1));var table=new Personetics.processor.PTable({cols:this.data.cols,rows:rows,name:this.name+".last("+colName+")",attributesTypes:this.data.attributesTypes,type:this.data.type});result=table.getObjArray()[0]}}
else{if(colName){if(colName=="month"||colName=="amount")
return 0;else result=null}
else{result=null}}
Personetics.verbose("Result: "+result);return result};Personetics.processor.PTable.prototype.abs=function(colName){Personetics.verbose("Calling '"+this.name+"'.last("+colName+")");var i;var absRows=[];var colIndex=this.colMap[colName];for(i=0;i<this.getRowCount();i++){var currentRow=this.getRow(i);var absRow=[];for(var j=0;j<currentRow.length;j++){var value=currentRow[j];if(j==colIndex)
value=Math.abs(value);absRow.push(value)}
absRows.push(absRow)}
var result=new Personetics.processor.PTable({cols:this.data.cols,rows:absRows,name:this.name+".abs("+colName+")",attributesTypes:this.data.attributesTypes,type:this.data.type});return result}})(window,window.Personetics=window.Personetics||{});(function(window,Personetics,undefined){Personetics.processor=Personetics.processor||{};var PrimitiveFactTypes=["PNumber","PAmount","PDate","PString"];Personetics.processor.PFact=function PFact(data,dataType,formats){Personetics.processor.PTable.call(this,data);this.dataType=dataType;this.formats=formats;this.name=data.name;this.isPrimitive=PrimitiveFactTypes.indexOf(dataType)>=0};Personetics.processor.PFact.prototype=Object.create(Personetics.processor.PTable.prototype);Personetics.processor.PFact.prototype.get=function(key){var colName=key;if(this.isPrimitive)
colName="value";var value=this.getValue(0,colName);return value}})(window,window.Personetics=window.Personetics||{});(function(window,Personetics,undefined){Personetics.processor=Personetics.processor||{};Personetics.processor.PQuery=function PQuery(cfg,model){this.queryName=cfg.queryName;this.model=model;this.preQueryParams=cfg.queryParams;this.queryParams={};this.data=null;this.evalParams()};Personetics.processor.PQuery.prototype.evalParams=function(){var me=this;this.preQueryParams.forEach(function(paramObject,index){var paramName=paramObject.paramName;var varName=paramObject.varName;var exp=new Personetics.processor.PExp(varName);var val=exp.eval(me.model);if(val){me.queryParams[paramName]=val}})};Personetics.processor.PQuery.prototype.getCacheKey=function(){var cacheKey=this.queryName+"?";for(var key in this.queryParams){if(this.queryParams.hasOwnProperty(key)){cacheKey+=key+"="+this.queryParams[val]+"&"}}
return cacheKey};Personetics.processor.PQuery.prototype.getData=function(block){if(this.data)
return this.data;if(!personetics.pserverProxy)
return null;var query=this;personetics.getQueryData({id:block.story.insight.id,queryName:this.queryName,queryParams:this.queryParams},Personetics.bind(this,this.handleQuery));return Personetics.processor.Future};Personetics.processor.PQuery.prototype.handleQuery=function(data){this.model.handleQuery(this,data)}})(window,window.Personetics=window.Personetics||{});(function(window,Personetics,undefined){Personetics.processor=Personetics.processor||{};Personetics.processor.PModel=function PModel(parent,options){Personetics.processor.PDataSource.call(this,options.facts);this.initPModel(options.facts,options.expressions);this.parent=parent};Personetics.processor.PModel.prototype=Object.create(Personetics.processor.PDataSource.prototype);Personetics.processor.PModel.prototype.initPModel=function initPModel(facts,expressions){this.factsConfigs={};this.facts=facts;this.expressionsConfigs={};this.expressions=expressions;this.varCfgs={};this.varValues={};this.varValuesForSave={};this.queryCfgs={};this.queryCache={};this.exps={};this.cache={};this.setupObjFactory();mapObjects(this.facts,this.factsConfigs);mapObjects(this.expressions,this.expressionsConfigs);this.listeners=[]};Personetics.processor.PModel.prototype.setFormats=function(formats){this.formats=formats};Personetics.processor.PModel.prototype.setupObjFactory=function(){var model=this;this.objFactory={};this.objFactory.PTable=function(data){return new Personetics.processor.PTable(data)};this.objFactory.PObjList=function(data){var table=new Personetics.processor.PTable();table.loadObjArray(data);return table};this.objFactory.PFact=function(data,type){return new Personetics.processor.PFact(data,type,model.formats)}};Personetics.processor.PModel.prototype.createObj=function(type,data){var obj=data;var modelType=type;if(type!="PTable"&&type!="PObjList")
modelType="PFact";var creator=this.objFactory[modelType];if(creator)
obj=creator(data,type);if(obj.isPrimitive)
obj=obj.get();return obj};Personetics.processor.PModel.prototype.test=function(id){var val=this.get(id,{test:!0});return{success:val?!0:!1,value:val}};Personetics.processor.PModel.prototype.get=function(id,options){var errorMessage="";var hasError=!1;var val=this.cache[id];if(typeof val!=='undefined'&&val!==null)
return val;var varCfg=this.varCfgs[id];if(!val&&varCfg){val=this.getVarValue(id)}
var dataCfg=this.factsConfigs[id];if(!val&&dataCfg){val=dataCfg;if(typeof val==='undefined'||val===null){Personetics.log("PStoryModel.get('"+id+"') - Error: fact exists but is invalid: '"+val+"'. "+"Trying to evaluate as expression")}
else{if(dataCfg.type){val.name=id;val=this.createObj(dataCfg.type,val)}}}
var expDataCfg=this.expressionsConfigs[id];if(!val&&expDataCfg){try{val=jsep(expDataCfg)}
catch(e){Personetics.log("PStoryModel.get('"+id+"') Error - Invalid expression string: '"+expDataCfg+"'");val=null}
if(typeof val==='undefined'||val===null){Personetics.log("PStoryModel.get('"+id+"') - Error: expression exists but is invalid: '"+val+"'. "+"Trying to evaluate as expression")}}
if(typeof val==='undefined'||val===null){if(this.lastGetValue&&this.lastGetValue==id){this.lastGetValue=null;return null}
this.lastGetValue=id;var exp=new Personetics.processor.PExp(id);try{val=exp.eval(this,null,options);if(typeof val==='undefined'||val===null){hasError=!0;errorMessage="PStoryModel.get('"+id+"') - Error: Evaluating as expression returned an invalid result: '"+val+"'"}}
catch(e){val=null;hasError=!0;errorMessage="PStoryModel.get('"+id+"') Error: Failed to evaluate as expression: \n\t"+e.message}}
if(typeof val!=='undefined'&&val!==null){this.cache[id]=val}
else{Personetics.error(errorMessage,null,options)}
return val};Personetics.processor.PModel.prototype.fetchFromSrc=function(block,src){var errorMessage=null;var result=null;if(src=="query"){var queryObj=new Personetics.processor.PQuery({queryName:block.config.queryName,queryParams:block.config.queryParams},this);this.currentQueryBlock=block;return queryObj.getData(block)}
else{var exp=new Personetics.processor.PExp(src);try{result=exp.eval(this);if(typeof result==='undefined'||result===null){errorMessage=this.err(null,"PStoryModel.fetchFromSrc('"+src+"') - Error: Evaluating as "+"expression returned an invalid result: '"+result+"'",!1)}}
catch(e){errorMessage=this.err(e,"PStoryModel.fetchFromSrc('"+src+"') - Error: Failed to evaluate "+"source as expression \n\t"+e.message,!1)}
if(errorMessage){Personetics.error(errorMessage)}
return result}};Personetics.processor.PModel.prototype.getData=function(){return this.facts};Personetics.processor.PModel.prototype.setVarValue=function(key,value){var me=this;if(!this.varCfgs.hasOwnProperty(key))
this.varCfgs[key]=key;this.cache={};var valueToSet=value?value:null;this.varValues[key]=valueToSet;this.listeners.forEach(function(listenerObj,index){var listener=listenerObj.listener;var callback=listenerObj.callback;callback.call(listener,me.varValues)})};Personetics.processor.PModel.prototype.getVarValue=function(key){return this.varValues[key]};Personetics.processor.PModel.prototype.handleQuery=function(query,queryData){var params;if(typeof queryData!=='undefined'&&queryData!==null&&queryData.hasOwnProperty("story")){if(queryData.story.hasOwnProperty("insightFacts"))
params=queryData.story.insightFacts.query;else params=queryData.story.facts.query;params.name="query";var dataObj=this.createObj(queryData.type,params);query.data=dataObj;var cacheKey=query.getCacheKey();this.queryCfgs[cacheKey]=query;this.factsConfigs.query=dataObj;if(this.currentQueryBlock)
this.parent.handleQueryData(this.currentQueryBlock,dataObj)}
Personetics.error("Personetics.processor.PModel.prototype.handleQuery - Invalid query params: "+JSON.stringify(queryData))};Personetics.processor.PModel.prototype.err=function err(e,errorMessage,throwException){throwException=typeof throwException!=='undefined'&&throwException!==null&&throwException!=!1;var msg=null;var stack=null;if(typeof e!=='undefined'&&e!==null){if(typeof e==="object"){if(e.hasOwnProperty("message"))
msg=e.message;if(e.hasOwnProperty("stack"))
stack=e.stack}
else if(typeof e==="string"){msg=e}}
var result=errorMessage;if(msg&&msg.length>0)
result+=". Cause: "+msg;if(throwException)
throw{message:result,stack:stack};else return result+stack};Personetics.processor.PModel.prototype.addListener=function(listener,callback){this.listeners.push({listener:listener,callback:callback})};var mapObjects=function mapObjects(obj,objConfig){for(var key in obj){if(obj.hasOwnProperty(key)){objConfig[key]=obj[key]}}}})(window,window.Personetics=window.Personetics||{});(function(window,Personetics,undefined){Personetics.processor=Personetics.processor||{};var TemplateStartToken="{{";var TemplateEndToken="}}";var TemlateTokenRegex=/{{([^\n\t\v{}]*)}}/g;Personetics.processor.PTextTemplate=function PTextTemplate(textTemplate,globalContext){this.textTemplate=textTemplate;this.globalContext=globalContext;this.tokens={};this.compile()};Personetics.processor.PTextTemplate.prototype.compile=function(){if(this.textTemplate&&this.textTemplate.length>0){var me=this;var matches=this.textTemplate.match(TemlateTokenRegex);if(matches){matches.forEach(function(match,i){if(!me.tokens.hasOwnProperty(match)){var exp=match.replace(TemplateStartToken,"").replace(TemplateEndToken,"");var token={};token.str=exp;token.exp=new Personetics.processor.PExp(exp);me.tokens[match]=token}})}}};Personetics.processor.PTextTemplate.prototype.process=function(context,parentContext,block){var textTemplate=this.textTemplate;var tokens=this.tokens;var me=this;for(var tokenName in tokens){if(tokens.hasOwnProperty(tokenName)){var token=tokens[tokenName];var value;var data=context?context:me.globalContext;try{value=token.exp.eval(data,parentContext)}
catch(e){Personetics.error("PTextTemplate.process('"+this.textTemplate+"') - Error: Failed to evaluate "+"token '"+token.str+". Error message: "+e.message+e.stack);value="{{"+token.str+"}}"}
var tokenNameEscaped=tokenName.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&");var regexp=new RegExp(tokenNameEscaped,"g");textTemplate=textTemplate.replace(regexp,value)}}
return textTemplate};Personetics.processor.PTextTemplate.prototype.getTextTemplate=function(){return this.textTemplate}})(window,window.Personetics=window.Personetics||{});(function(window,Personetics,undefined){Personetics.processor=Personetics.processor||{};Personetics.processor.BlockProcessor=function BlockProcessor(parent,config,texts,model,dlgId,index){this.parent=parent;this.config=config;this.model=model;this.texts=texts;this.dlgId=dlgId;this.index=index};Personetics.processor.BlockProcessor.prototype.initProcessor=function(){};Personetics.processor.BlockProcessor.prototype.processData=function(){this.layoutInstructions=this.copyConfig(this.config);this.setDefaultSelectedValue();return this.layoutInstructions};Personetics.processor.BlockProcessor.prototype.processText=function(textId,context,parentContext){var pTxt=this.getText(textId);if(!pTxt)
return"-";return pTxt.process(context,parentContext,this)};Personetics.processor.BlockProcessor.prototype.getText=function(textId){var txt;if(this.texts&&this.texts.hasOwnProperty(textId)){txt=new Personetics.processor.PTextTemplate(this.texts[textId],this.model)}
return txt};Personetics.processor.BlockProcessor.prototype.getRealValue=function(simpleValue){return simpleValue};Personetics.processor.BlockProcessor.prototype.setSelectedValue=function(value){this.config.selected=value};Personetics.processor.BlockProcessor.prototype.handleQueryData=function handleQueryData(data){this.doProcessData(data)};Personetics.processor.BlockProcessor.doProcessData=function doProcessData(data){throw "Personetics.processor.BlockProcessor.doProcessData - Not implemented for block class '"+this.config.type+"'"};Personetics.processor.BlockProcessor.prototype.setDefaultSelectedValue=function(){var value=this.getRealValue(this.config.selected);this.parent.setBlockVarValue(this.config,value)};Personetics.processor.BlockProcessor.prototype.copyConfig=function copyConfig(obj){var result={};for(var key in obj){if(obj.hasOwnProperty(key)){var valueObj=obj[key];if(typeof valueObj!=='undefined'&&valueObj!==null){if(valueObj.constructor===[].constructor){var newAr=[];valueObj.forEach(function(item,index){newAr.push(item)});result[key]=newAr}
else if(valueObj.constructor=={}.constructor){var newObj=this.copyConfig(valueObj);result[key]=newObj}
else{result[key]=valueObj}}
else{result[key]=valueObj}}}
return result}})(window,window.Personetics=window.Personetics||{});(function(window,Personetics,undefined){Personetics.processor=Personetics.processor||{};Personetics.processor.TextBlockProcessor=function TextBlockProcessor(parent,config,texts,model,dlgId,index){Personetics.processor.BlockProcessor.call(this,parent,config,texts,model,dlgId,index)};Personetics.processor.TextBlockProcessor.prototype=Object.create(Personetics.processor.BlockProcessor.prototype);Personetics.processor.TextBlockProcessor.prototype.processData=function(){this.layoutInstructions=Personetics.processor.BlockProcessor.prototype.processData.call(this);var textConfig=this.config.txt||this.config.text;if(this.config.hasOwnProperty("txt"))
delete this.layoutInstructions.txt;if(this.config.hasOwnProperty("text"))
delete this.layoutInstructions.text;var txt=this.processText(textConfig,this.model);this.layoutInstructions.text=txt;return this.layoutInstructions}})(window,window.Personetics=window.Personetics||{});(function(window,Personetics,undefined){Personetics.processor=Personetics.processor||{};Personetics.processor.ImageBlock=function ImageBlock(parent,config,texts,model,dlgId,index){Personetics.processor.BlockProcessor.call(this,parent,config,texts,model,dlgId,index)};Personetics.processor.ImageBlock.prototype=Object.create(Personetics.processor.BlockProcessor.prototype);Personetics.processor.ImageBlock.prototype.processData=function(){this.layoutInstructions=Personetics.processor.BlockProcessor.prototype.processData.call(this);var imageSrc=this.processText(this.config.url,this.model);var altText=this.processText(this.config.alt,this.model);this.layoutInstructions.url=imageSrc;this.layoutInstructions.alt=altText;return this.layoutInstructions}})(window,window.Personetics=window.Personetics||{});(function(window,Personetics,undefined){Personetics.processor=Personetics.processor||{};var TYPES={STATIC:"static",NAVIGATE_TO_PAGE:"navigateToPage",DATA:"data"};Personetics.processor.OptionsProcessorBlock=function(parent,config,texts,model,dlgId,index){Personetics.processor.BlockProcessor.call(this,parent,config,texts,model,dlgId,index)};Personetics.processor.OptionsProcessorBlock.prototype=Object.create(Personetics.processor.BlockProcessor.prototype);Personetics.processor.OptionsProcessorBlock.prototype.processData=function(){this.layoutInstructions=Personetics.processor.BlockProcessor.prototype.processData.call(this);var me=this;this.layoutInstructions.options=[];var opts=this.config.options;if(!opts||opts.length==0)
return;this.selectedOptId=null;if(this.config.selected){if(this.config.selected.hasOwnProperty("id"))
this.selectedOptId=this.config.selected.id;else this.selectedOptId=this.config.selected}
this.hasSelected=!1;opts.forEach(function(opt,i){if(!opt.hasOwnProperty("type"))
opt.type="static";me.handleOption(opt)});this.setDefaultSelectedValue();return this.layoutInstructions};Personetics.processor.OptionsProcessorBlock.prototype.addStaticOption=function(opt,selectedOptId){var optObj={};optObj.id=this.getOptId(opt.id);optObj=this.addProperties(opt,optObj,selectedOptId);this.layoutInstructions.options.push(optObj)};Personetics.processor.OptionsProcessorBlock.prototype.addProperties=function(opt,optObj,selectedOptId){optObj.id=(typeof optObj.id==='undefined'||optObj.id==='-')?opt.id:optObj.id;optObj.selected=!1;if(optObj.id==selectedOptId){optObj.selected=!0;this.hasSelected=!0}
if(opt.hasOwnProperty('class')){optObj.class=opt.class}
var optModelObj=new Personetics.processor.POptionModel(opt,this.model);var optText=opt.txt||opt.text;optObj.text=this.processText(optText,optModelObj,this.model);if(typeof opt!=="undefined"&&opt!==null){for(var key in opt)
if(opt.hasOwnProperty(key)&&!optObj.hasOwnProperty(key))
optObj[key]=opt[key]}
return optObj};Personetics.processor.OptionsProcessorBlock.prototype.getOptId=function(optId){return this.processText(optId,this.model)};Personetics.processor.OptionsProcessorBlock.prototype.addDynamicOption=function(opt,selectedOptId){var me=this;if(opt.type==TYPES.DATA&&opt.src&&opt.src.length>0){var table=this.model.fetchFromSrc(this,opt.src);if(typeof table!=='undefined'&&table!==null){table=table.getObjArray();table.forEach(function(dataOpt){dataOpt.text=opt.text||opt.txt;var optObj={};optObj=me.addProperties(dataOpt,optObj,selectedOptId);me.layoutInstructions.options.push(optObj)})}}};Personetics.processor.OptionsProcessorBlock.prototype.getRealValue=function(simpleValue){var realValue=simpleValue;this.layoutInstructions.options.forEach(function(optObj,i){if(optObj.id==simpleValue){realValue=optObj;return!1}});return realValue};Personetics.processor.OptionsProcessorBlock.prototype.setSelectedValue=function(opt){var block=this;this.layoutInstructions.options.forEach(function(optObj,i){if(optObj.id==opt.id){optObj.selected=!0;block.config.selected=optObj}
else{optObj.selected=!1}})};Personetics.processor.OptionsProcessorBlock.prototype.handleOption=function(opt){var me=this;var typeHandled=!1;switch(opt.type){case TYPES.STATIC:me.addStaticOption(opt,me.selectedOptId);typeHandled=!0;break;case TYPES.DATA:me.addDynamicOption(opt,me.selectedOptId);typeHandled=!0;break;default:typeHandled=!1}
return typeHandled}})(window,window.Personetics=window.Personetics||{});(function(window,Personetics,undefined){Personetics.processor=Personetics.processor||{};var TYPES={NAVIGATE_TO_PAGE:"navigateToPage",TOGGLE:"toggle",PAYLOAD:"payload"};Personetics.processor.ButtonsProcessorBlock=function(parent,config,texts,model,dlgId,index){Personetics.processor.OptionsProcessorBlock.call(this,parent,config,texts,model,dlgId,index);this.isAllNavigateTo=!1};Personetics.processor.ButtonsProcessorBlock.prototype=Object.create(Personetics.processor.OptionsProcessorBlock.prototype);Personetics.processor.ButtonsProcessorBlock.prototype.processData=function(){var me=this;if(this.config.hasOwnProperty("buttonType")){var buttonType=this.config.buttonType;if(buttonType=="navigateTo"){this.isAllNavigateTo=!0}}
this.layoutInstructions=Personetics.processor.OptionsProcessorBlock.prototype.processData.call(this);this.layoutInstructions.id=this.config.index;if(this.layoutInstructions.hasOwnProperty("default"))
delete this.layoutInstructions["default"];if(this.layoutInstructions.hasOwnProperty("selected"))
delete this.layoutInstructions.selected;return this.layoutInstructions};Personetics.processor.ButtonsProcessorBlock.prototype.addProperties=function addProperties(opt,optObj,selectedOptId){optObj=Personetics.processor.OptionsProcessorBlock.prototype.addProperties.call(this,opt,optObj,selectedOptId);if(opt.type==TYPES.NAVIGATE_TO_PAGE&&opt.navigateTarget!=null&&opt.navigateTarget.length>0){if(typeof(optObj)!=="undefined"&&optObj!==null){optObj.navigateTarget=this.evalNavigateTarget(opt.navigateTarget);addPayloadToNavigateTo.call(this,opt,optObj)}}
if(this.isAllNavigateTo){if(typeof(optObj)!=="undefined"&&optObj!==null){optObj.navigateTarget=this.evalNavigateTarget(opt.id);addPayloadToNavigateTo.call(this,opt,optObj)}}
return optObj};function addPayloadToNavigateTo(preProccessOpt,newOpt){if(preProccessOpt.hasOwnProperty("payload")&&preProccessOpt.payload){var supportHtmlTagInProcessor=Personetics.processor.PStoryConfig.getConfig("supportHtmlTagInProcessor");Personetics.processor.PStoryConfig.setConfig("supportHtmlTagInProcessor",!1);newOpt.payload={};for(var key in preProccessOpt.payload){if(typeof preProccessOpt.payload[key]==="string"){newOpt.payload[key]=this.processText(preProccessOpt.payload[key],this.model)}else{newOpt.payload[key]={};processObjTexts.call(this,preProccessOpt.payload[key],newOpt.payload[key])}}
Personetics.processor.PStoryConfig.setConfig("supportHtmlTagInProcessor",supportHtmlTagInProcessor)}}
function processObjTexts(currentObj,newObj){for(var key in currentObj){if(typeof currentObj[key]==="string"){newObj[key]=this.processText(currentObj[key],this.model)}
else{newObj[key]={};processObjTexts.call(this,currentObj[key],newObj[key])}}}
Personetics.processor.ButtonsProcessorBlock.prototype.addToggleOption=function(opt,selectedOptId){if(typeof selectedOptId==='undefined'||selectedOptId===null||selectedOptId.length==0)
selectedOptId="off";this.hasSelected=!0;this.prepareToggleButton(opt,selectedOptId)};Personetics.processor.ButtonsProcessorBlock.prototype.addNavigateToOption=function(opt,selectedOptId){var optObj={};optObj.id=this.processText(opt.id,this.model);optObj=this.addProperties(opt,optObj,selectedOptId);this.layoutInstructions.options.push(optObj)};Personetics.processor.ButtonsProcessorBlock.prototype.evalNavigateTarget=function evalNavigateTarget(navIdExpStr){var navIdExp=new Personetics.processor.PExp(navIdExpStr);var navId;try{navId=navIdExp.eval(this.model,null,{shouldDisplayError:!1})}
catch(e){navId=navIdExpStr}
return navId};Personetics.processor.ButtonsProcessorBlock.prototype.prepareToggleButton=function(opt,selectedOptId){var txt;var toggleClass="perso-toggle";var onObj={type:opt.type};var offObj={type:opt.type};onObj.id="on";onObj.class=toggleClass;onObj.on=!0;onObj.off=!1;onObj.selected=selectedOptId=="on";var optionObj=new Personetics.processor.POptionModel(onObj,this.model);var onTxtId=opt.onTxt||opt.onText;txt=this.processText(onTxtId,optionObj);onObj.text=txt;this.layoutInstructions.options.push(onObj);offObj.id="off";offObj.class=toggleClass;offObj.on=!1;offObj.off=!0;offObj.selected=selectedOptId=="off";optionObj=new Personetics.processor.POptionModel(offObj,this.model);var offTxtId=opt.offTxt||opt.offText;txt=this.processText(offTxtId,optionObj);offObj.text=txt;this.layoutInstructions.options.push(offObj);this.model.varValuesForSave[this.config.var]=!0};Personetics.processor.ButtonsProcessorBlock.prototype.handleOption=function(option){var me=this;var isTypeHandled=!1;isTypeHandled=Personetics.processor.OptionsProcessorBlock.prototype.handleOption.call(this,option);if(!isTypeHandled){switch(option.type){case TYPES.TOGGLE:me.addToggleOption(option,me.selectedOptId);isTypeHandled=!0;break;case TYPES.NAVIGATE_TO_PAGE:case TYPES.PAYLOAD:me.addNavigateToOption(option,me.selectedOptId);isTypeHandled=!0;break;default:isTypeHandled=!1}}
return isTypeHandled}})(window,window.Personetics=window.Personetics||{});(function(window,Personetics,undefined){Personetics.processor=Personetics.processor||{};Personetics.processor.AccountSelectorProcessorBlock=function AccountSelectorProcessorBlock(parent,config,texts,model,dlgId,index){Personetics.processor.OptionsProcessorBlock.call(this,parent,config,texts,model,dlgId,index)};Personetics.processor.AccountSelectorProcessorBlock.prototype=Object.create(Personetics.processor.OptionsProcessorBlock.prototype);Personetics.processor.AccountSelectorProcessorBlock.prototype.processData=function(){this.config.options=[{type:'data',src:this.config.src,text:this.config.accountText}];if(this.config.showAll){var all={text:this.config.allAccountsText,id:'all',type:'static'};this.config.options.push(all)}
this.layoutInstructions=Personetics.processor.OptionsProcessorBlock.prototype.processData.call(this);delete this.layoutInstructions.src;delete this.layoutInstructions.allAccountsText;delete this.layoutInstructions.accountText;delete this.layoutInstructions.showAll;if(this.layoutInstructions.hasOwnProperty("default"))
delete this.layoutInstructions.default;if(this.layoutInstructions.hasOwnProperty("selected"))
delete this.layoutInstructions.selected;this.layoutInstructions.id=this.config.index;return this.layoutInstructions};Personetics.processor.AccountSelectorProcessorBlock.prototype.getOptId=function(optId){return optId}})(window,window.Personetics=window.Personetics||{});(function(window,Personetics,undefined){Personetics.processor=Personetics.processor||{};Personetics.processor.TextBoxesProcessorBlock=function(parent,config,texts,model,dlgId,index){Personetics.processor.OptionsProcessorBlock.call(this,parent,config,texts,model,dlgId,index)};Personetics.processor.TextBoxesProcessorBlock.prototype=Object.create(Personetics.processor.OptionsProcessorBlock.prototype);Personetics.processor.TextBoxesProcessorBlock.prototype.processData=function(){this.config.options=this.config.boxes;this.layoutInstructions=Personetics.processor.OptionsProcessorBlock.prototype.processData.call(this);this.layoutInstructions.options.forEach(function(opt){if(opt.selected){delete opt.selected}});delete this.layoutInstructions.boxes;return this.layoutInstructions};Personetics.processor.TextBoxesProcessorBlock.prototype.handleOption=function(opt){this.addStaticOption(opt,this.selectedOptId)};Personetics.processor.TextBoxesProcessorBlock.prototype.addStaticOption=function(opt,selectedOptId){var optObj={};var optModelObj=new Personetics.processor.POptionModel(optObj,this.model);optObj.label=this.processText(opt.label,optModelObj,this.model);if(opt.image){optObj.image=this.processText(opt.image,optModelObj,this.model);if(!this.layoutInstructions.hasOwnProperty("hasImage")){this.layoutInstructions.hasImage=!0}}
var optionObj=new Personetics.processor.POptionModel(opt,this.model);var valueExp=new Personetics.processor.PExp(opt.value);var value;try{value=valueExp.eval(optionObj)}
catch(e){Personetics.error("TextBoxesProcessorBlock.addStaticOption() Error: Failed to evaluate textBox value. "+"Error message: "+e.message+e.stack);value=opt.value}
optObj.value=value;this.layoutInstructions.options.push(optObj)}})(window,window.Personetics=window.Personetics||{});(function(window,Personetics,undefined){Personetics.processor=Personetics.processor||{};Personetics.processor.TabsProcessorBlock=function(parent,config,texts,model,dlgId,index){Personetics.processor.OptionsProcessorBlock.call(this,parent,config,texts,model,dlgId,index)};Personetics.processor.TabsProcessorBlock.prototype=Object.create(Personetics.processor.OptionsProcessorBlock.prototype);Personetics.processor.TabsProcessorBlock.prototype.processData=function(){this.config.options=this.config.tabs;this.layoutInstructions=Personetics.processor.OptionsProcessorBlock.prototype.processData.call(this);this.layoutInstructions.id=this.config.index;this.layoutInstructions.class=this.config.class||"perso-tabs";return this.layoutInstructions}})(window,window.Personetics=window.Personetics||{});(function(window,Personetics,undefined){Personetics.processor=Personetics.processor||{};Personetics.processor.HBoxBlock=function HBoxBlock(parent,config,texts,model,dlgId,index){Personetics.processor.BlockProcessor.call(this,parent,config,texts,model,dlgId,index);this.id="block-layout_"+config.index;this.index=config.index;this.columns=[];this.processorFactory=parent.processorFactory};Personetics.processor.HBoxBlock.prototype=Object.create(Personetics.processor.BlockProcessor.prototype);Personetics.processor.HBoxBlock.prototype.initProcessor=function(){Personetics.processor.BlockProcessor.prototype.initProcessor.call(this);var me=this;this.config.columns.forEach(function(columnConfig,index){var column={width:columnConfig.width,"v-align":columnConfig["v-align"],blocks:[]};if(columnConfig.hasOwnProperty("class"))
column.class=columnConfig.class;columnConfig.blocks.forEach(function(blockCfg,jndex){blockCfg.index=jndex;me.parent.evaluateDefault(blockCfg);var processor=me.parent.createProcessor(blockCfg,me.dlgId);column.blocks.push({processor:processor,config:blockCfg})});me.columns.push(column)})};Personetics.processor.HBoxBlock.prototype.processData=function(){this.layoutInstructions=Personetics.processor.BlockProcessor.prototype.processData.call(this);var me=this;this.layoutInstructions.columns=[];this.columns.forEach(function(column,index){var newColumn={width:column.width,"v-align":column["v-align"],blocks:[]};if(column.hasOwnProperty("class"))
newColumn.class=column.class;column.blocks.forEach(function(block,jndex){var processor=block.processor;var config=block.config;var show=!0;if(config.hasOwnProperty("showIf")&&config.showIf!==null&&config.showIf.length>0){var showIfExp=new Personetics.processor.PExp(config.showIf);try{show=showIfExp.eval(me.model)}
catch(e){show=!1;Personetics.error("HBoxBlock.processData() Error: Failed to evaluate showIf property, not showing block. Error Message: "+e.message+e.stack)}}
if(show){var blockData=processor.processData();newColumn.blocks.push(blockData)}});if(newColumn.blocks.length>0)
me.layoutInstructions.columns.push(newColumn)});return this.layoutInstructions}})(window,window.Personetics=window.Personetics||{});(function(window,Personetics,undefined){Personetics.processor=Personetics.processor||{};Personetics.processor.LayoutBlock=function LayoutBlock(parent,config,texts,model,dlgId,index){Personetics.processor.BlockProcessor.call(this,parent,config,texts,model,dlgId,index);this.id="block-layout_"+config.index;this.index=config.index;this.blocks=[];this.processorFactory=parent.processorFactory};Personetics.processor.LayoutBlock.prototype=Object.create(Personetics.processor.BlockProcessor.prototype);Personetics.processor.LayoutBlock.prototype.initProcessor=function(){Personetics.processor.BlockProcessor.prototype.initProcessor.call(this);var me=this;this.blocks=[];this.config.blocks.forEach(function(blockConfig,index){blockConfig.index=index;var processor=me.parent.createProcessor(blockConfig,me.dlgId);me.blocks.push({processor:processor,config:blockConfig})})};Personetics.processor.LayoutBlock.prototype.processData=function(){this.layoutInstructions=Personetics.processor.BlockProcessor.prototype.processData.call(this);var me=this;this.layoutInstructions.layout=this.config.layout;this.layoutInstructions.blocks=[];this.blocks.forEach(function(block,index){var newBlock={layout:block.layout};var processor=block.processor;var config=block.config;var show=!0;if(config.showIf){var showIfExp=new Personetics.processor.PExp(config.showIf);show=showIfExp.eval(me.model)}
if(show){var blockData=processor.processData();me.layoutInstructions.blocks.push(blockData)}});return this.layoutInstructions}})(window,window.Personetics=window.Personetics||{});(function(window,Personetics,undefined){Personetics.processor=Personetics.processor||{};Personetics.processor.DateBoxBlockProcessor=function DateBoxBlockProcessor(parent,config,texts,model,dlgId,index){Personetics.processor.BlockProcessor.call(this,parent,config,texts,model,dlgId,index)};Personetics.processor.DateBoxBlockProcessor.prototype=Object.create(Personetics.processor.BlockProcessor.prototype);Personetics.processor.DateBoxBlockProcessor.prototype.processData=function(){this.layoutInstructions=Personetics.processor.BlockProcessor.prototype.processData.call(this);var txt=this.processText(this.config.date,this.model);this.layoutInstructions.date=txt;return this.layoutInstructions}})(window,window.Personetics=window.Personetics||{});(function(window,Personetics,undefined){Personetics.processor=Personetics.processor||{};Personetics.processor.TableBlockProcessor=function TableBlockProcessor(parent,config,texts,model,dlgId,index){Personetics.processor.BlockProcessor.call(this,parent,config,texts,model,dlgId,index)};Personetics.processor.TableBlockProcessor.prototype=Object.create(Personetics.processor.BlockProcessor.prototype);Personetics.processor.TableBlockProcessor.prototype.processData=function processData(){var config=this.config;var src=config.src;var table=this.model.fetchFromSrc(this,src);if(table==Personetics.processor.Future){return{type:config.type,future:!0}}
else{return this.doProcessData(table)}};Personetics.processor.TableBlockProcessor.prototype.doProcessData=function doProcessData(table){this.layoutInstructions=Personetics.processor.BlockProcessor.prototype.processData.call(this);delete this.layoutInstructions.src;var rows=[];if(typeof table!=='undefined'&&table!==null&&table.hasOwnProperty("data")){this.layoutInstructions.rows=table.data.rows;this.layoutInstructions.cols=table.data.cols}
return this.layoutInstructions}})(window,window.Personetics=window.Personetics||{});(function(window,Personetics,undefined){Personetics.processor=Personetics.processor||{};Personetics.processor.BarBlockProcessor=function BarBlockProcessor(parent,config,texts,model,dlgId,index){Personetics.processor.BlockProcessor.call(this,parent,config,texts,model,dlgId,index)};Personetics.processor.BarBlockProcessor.prototype=Object.create(Personetics.processor.BlockProcessor.prototype);Personetics.processor.BarBlockProcessor.prototype.processData=function(){this.layoutInstructions=Personetics.processor.BlockProcessor.prototype.processData.call(this);var blockProcessor=this;var config=this.config;var src=config.src;var data=this.model.fetchFromSrc(this,src);this.layoutInstructions.direction=config.direction||"vertical";if(typeof data!=='undefined'&&data!==null){var categories=this.getCategories();var accessibilityCategories=this.getCategories();var series=config.series;if(series){var table=data.groupByExpression(series);var seriesLabels=this.getSeries();this.seriesLabels=seriesLabels;this.layoutInstructions.seriesLabels=seriesLabels;var arr=[];if(typeof seriesLabels!=='undefined'&&seriesLabels!==null&&seriesLabels.length>0){seriesLabels.forEach(function(series,i){var item=table.filter(function(tableRow){return tableRow.seriesName==series})[0];var row=[];if(typeof item!=='undefined'){row=item.table.getObjArray()}
var newItem=blockProcessor.prepareDataByCategories(row,categories);arr.push(newItem)})}
else{table.forEach(function(tableItem,index){var row=tableItem.table.getObjArray();var newItem=blockProcessor.prepareDataByCategories(row,categories);arr.push(newItem)})}
this.layoutInstructions.series=arr}
else{var rows=data.getObjArray();if(categories!=null){var newData=this.prepareDataByCategories(rows,categories)}
else{var newData=this.prepareData(rows)}
this.layoutInstructions.series=[newData];this.seriesLabels=[""]}}
if(this.layoutInstructions.hasOwnProperty("varSource"))
delete this.layoutInstructions.varSource;if(this.layoutInstructions.hasOwnProperty("default"))
delete this.layoutInstructions["default"];if(this.layoutInstructions.hasOwnProperty("selected"))
delete this.layoutInstructions.selected;if(this.layoutInstructions.hasOwnProperty("seriesNames"))
delete this.layoutInstructions.seriesNames;delete this.layoutInstructions.x;delete this.layoutInstructions.y;delete this.layoutInstructions.label;delete this.layoutInstructions.src;this.layoutInstructions.categories=this.categories;if(accessibilityCategories!=null)
accessibilityCategories.categoriesArray.forEach(function(item,index){var i=parseInt(item)-1;accessibilityCategories[index]=Personetics.processor.PUtils.getUtilsInstance("dateUtils").getMonthName(Personetics.processor.PStoryConfig.getConfig("lang"))[i]});else accessibilityCategories=this.layoutInstructions.categories;var accessCat=Object.keys(accessibilityCategories).map(function(key){return accessibilityCategories[key]});accessCat=accessCat.slice(0,accessCat.length-2);this.layoutInstructions.accessibilityCategories=accessCat;this.layoutInstructions.seriesLabels=this.seriesLabels;return this.layoutInstructions};Personetics.processor.BarBlockProcessor.prototype.prepareDataByCategories=function prepareDataByCategories(rows,categories){var blockProcessor=this;var config=this.config;var yFieldExp=new Personetics.processor.PExp(config.y);var xFieldExp=new Personetics.processor.PExp(config.x);var newData=[];this.categories=[];var categoriesKey=categories.key;categories.categoriesArray.forEach(function(category,index){var newItem={};newItem[categoriesKey]=category;newItem.amount=0;newItem.sum=0;rows.forEach(function(row,i){if(row[categoriesKey]==category){newItem=row;return!1}});var newRow=blockProcessor.prepareRow(newItem,xFieldExp,yFieldExp);newData.push(newRow)});return newData};Personetics.processor.BarBlockProcessor.prototype.prepareData=function prepareData(rows){var blockProcessor=this;var config=this.config;var yFieldExp=new Personetics.processor.PExp(config.y);var xFieldExp=new Personetics.processor.PExp(config.x);var newData=[];this.categories=[];rows.forEach(function(row,i){var newRow=blockProcessor.prepareRow(row,xFieldExp,yFieldExp);newData.push(newRow)});return newData};Personetics.processor.BarBlockProcessor.prototype.prepareRow=function prepareRow(row,xFieldExp,yFieldExp){var config=this.config;var newRow={};if(this.config.hasOwnProperty("label")){var label=this.processText(config.label,row,this.model);if(label!="-"){newRow.label=label.replace(/span/g,'tspan')}}
try{var yValue=yFieldExp.eval(row,this.model);newRow.value=yValue}
catch(e){Personetics.error("BarBlockProcessor.prepareRow() Error: failed to evaluate block.y expression. Error message: "+e.message+e.stack);newRow.value=null}
var xValue=null;try{xValue=xFieldExp.eval(row,this.model)}
catch(e){Personetics.error("BarBlockProcessor.prepareRow() Error: failed to evaluate block.x expression. Error message: "+e.message+e.stack)}
this.categories.push(xValue);if(config.hasOwnProperty("var")&&config.hasOwnProperty("default")){newRow.category=row[config.varSource];newRow.selected=!1;if(typeof config.selected!=='undefined'&&row[config.varSource]==config.selected){newRow.selected=!0}}
return newRow};Personetics.processor.BarBlockProcessor.prototype.getCategories=function getCategories(){var result=null;if(this.config.hasOwnProperty("categories")){var configCategories=this.config.categories;var categories=this.model.fetchFromSrc(this,configCategories);if(typeof categories!=='undefined'&&categories!==null){var categoriesArray=categories.getObjArray();var key=categories.data.cols[0];var seriesNamesValues=categoriesArray.map(function(a){return a[key]});result={categoriesArray:seriesNamesValues,key:key}}}
return result};Personetics.processor.BarBlockProcessor.prototype.getSeries=function getSeries(){var result=null;if(!this.config.hasOwnProperty("seriesNames")){Personetics.log("Personetics.processor.BarBlockProcessor - Error: missing 'seriesNames' block property")}
else{var seriesNames=this.model.fetchFromSrc(this,this.config.seriesNames);var seriesNamesArray=seriesNames.getObjArray();var key=seriesNames.data.cols[0];result=seriesNamesArray.map(function(a){return a[key]})}
return result}})(window,window.Personetics=window.Personetics||{});(function(window,Personetics,undefined){Personetics.processor=Personetics.processor||{};Personetics.processor.PieBlockProcessor=function PieBlockProcessor(parent,config,texts,model,dlgId,index){Personetics.processor.BlockProcessor.call(this,parent,config,texts,model,dlgId,index)};Personetics.processor.PieBlockProcessor.prototype=Object.create(Personetics.processor.BlockProcessor.prototype);Personetics.processor.PieBlockProcessor.prototype.processData=function(){this.layoutInstructions=Personetics.processor.BlockProcessor.prototype.processData.call(this);var blockProcessor=this;var config=this.config;var src=config.src;var data=this.model.fetchFromSrc(this,src);if(config.hasOwnProperty("centerText"))
var centerText=this.processText(config.centerText,this.model);if(centerText.length>0){this.layoutInstructions.centerText=centerText.replace(/span/g,'tspan')}
var selected=config.selected;var hasSelected=!1;if(typeof data!=='undefined'&&data!==null){var slices=data.getObjArray();slices.forEach(function(slice,index){slice.highlight=!1;if(typeof selected!=='undefined'&&selected!==null&&config.hasOwnProperty("varSource")&&(slice[config.varSource]==selected||(slice[config.varSource]!=undefined&&slice[config.varSource]==selected[config.varSource]))){slice.highlight=!0;hasSelected=!0}
if(config.hasOwnProperty("label")){var label=blockProcessor.processText(config.label,slice,blockProcessor.model);if(label.length>0&&label!="-")
slice.label=label.replace(/span/g,'tspan')}
if(slice.hasOwnProperty(config.sliceName)){var category=slice[config.sliceName];delete slice[config.sliceName];slice.category=category}
slice.value=slice[config.sliceValue]||slice.amount;slice.index=++index;delete slice[config.sliceValue]});this.layoutInstructions.slices=slices}
if(this.layoutInstructions.hasOwnProperty("varSource"))
delete this.layoutInstructions.varSource;if(this.layoutInstructions.hasOwnProperty("default"))
delete this.layoutInstructions["default"];if(this.layoutInstructions.hasOwnProperty("selected"))
delete this.layoutInstructions.selected;if(this.layoutInstructions.hasOwnProperty("seriesNames"))
delete this.layoutInstructions.seriesNames;delete this.layoutInstructions.sliceName;delete this.layoutInstructions.sliceValue;delete this.layoutInstructions.label;delete this.layoutInstructions.src;return this.layoutInstructions}})(window,window.Personetics=window.Personetics||{});(function(window,Personetics,undefined){Personetics.processor=Personetics.processor||{};Personetics.processor.PinBlockProcessor=function PinBlockProcessor(parent,config,texts,model,dlgId,index){Personetics.processor.BarBlockProcessor.call(this,parent,config,texts,model,dlgId,index)};Personetics.processor.PinBlockProcessor.prototype=Object.create(Personetics.processor.BarBlockProcessor.prototype)})(window,window.Personetics=window.Personetics||{});(function(window,Personetics,undefined){window.PBlockProcessorManager=new function(){var instance=null;this.getInstance=function getInstance(){if(instance==null){instance=new manager()}
return instance}};var manager=function manager(){this.dialogsToBlocksMap={};this.processorFactory={"txt":Personetics.processor.TextBlockProcessor,"text":Personetics.processor.TextBlockProcessor,"image":Personetics.processor.ImageBlock,"buttons":Personetics.processor.ButtonsProcessorBlock,"tabs":Personetics.processor.TabsProcessorBlock,"account-selector":Personetics.processor.AccountSelectorProcessorBlock,"textboxes":Personetics.processor.TextBoxesProcessorBlock,"h-box":Personetics.processor.HBoxBlock,"layout":Personetics.processor.LayoutBlock,"date-box":Personetics.processor.DateBoxBlockProcessor,"tranList":Personetics.processor.TableBlockProcessor,"bar-chart":Personetics.processor.BarBlockProcessor,"pie-chart":Personetics.processor.PieBlockProcessor,"arc-chart":Personetics.processor.PieBlockProcessor,"pin-graph":Personetics.processor.PinBlockProcessor,"pin-chart":Personetics.processor.PinBlockProcessor,"line-chart":Personetics.processor.LineBlockProcessor,"compare-block":Personetics.processor.CompareProcessorBlock}};manager.prototype.start=function start(options){this.storyDefinition=options.story;this.defaultLang="en";if(typeof options.customizationOptions!=='undefined'&&options.customizationOptions!==null){for(var key in options.customizationOptions)
{if(options.customizationOptions.hasOwnProperty(key)){Personetics.processor.PStoryConfig.setConfig(key,options.customizationOptions[key])}}}
this.texts=options.texts;this.model=new Personetics.processor.PModel(this,options);window.model=this.model;this.initProcessors()};manager.prototype.initProcessors=function initProcessors(){var me=this;this.storyDefinition.dialogs.forEach(function(dlgConfig,index){var dlgId=dlgConfig.id;me.dialogsToBlocksMap[dlgId]={};if(dlgConfig.hasOwnProperty("class")){me.dialogsToBlocksMap[dlgId]["class"]=dlgConfig.class}
dlgConfig.blocks.forEach(function(config,jndex){var type=config.type;var processor=me.createProcessor(config,dlgId,jndex);if(processor){me.dialogsToBlocksMap[dlgId][jndex]={processor:processor,previousData:null}}})})};manager.prototype.createProcessor=function createProcessor(config,dlgId,blockIndex){var type=config.type;var processorClass=this.processorFactory[type];if(processorClass){var texts=null;if(this.texts.hasOwnProperty(dlgId)){texts=this.texts[dlgId][this.defaultLang]||{};var lang=Personetics.processor.PStoryConfig.getConfig("lang");if(this.texts[dlgId].hasOwnProperty(lang)){var langTexts=this.texts[dlgId][lang];for(var textId in langTexts){if(langTexts.hasOwnProperty(textId))
texts[textId]=langTexts[textId]}}}
var processor=new processorClass(this,config,texts,this.model,dlgId,blockIndex);processor.initProcessor();return processor}
else{Personetics.log("createProcessor() - invalid processor type '"+type+"'");return null}};manager.prototype.process=function process(){var result=[];for(var dlgId in this.dialogsToBlocksMap){if(this.dialogsToBlocksMap.hasOwnProperty(dlgId)){var dialogBlocks=this.dialogsToBlocksMap[dlgId];var blocks=[];var dialogClass=null;if(dialogBlocks.hasOwnProperty("class")){dialogClass=dialogBlocks.class;delete dialogBlocks.class}
for(var index in dialogBlocks){if(dialogBlocks.hasOwnProperty(index)){var processorObj=dialogBlocks[index].processor;var processor=processorObj;var data=this.processBlock(processorObj,processor);if(data)
blocks.push(data)}}
var hbox={type:"h-box",class:"pstory-dialog-frame",columns:[{width:12,blocks:blocks}]};if(dialogClass!==null)
hbox.class=dialogClass;result.push(hbox)}}
return result};manager.prototype.processBlocks=function processBlocks(dialogConfig){var result=[];var me=this;dialogConfig.blocks.forEach(function(blockCfg,index){var data=me.processBlockConfig(dialogConfig.id,index);if(data)
result.push(data)});return result};manager.prototype.processBlockConfig=function processBlockConfig(dlgId,blockIndex){if(this.dialogsToBlocksMap.hasOwnProperty(dlgId)&&this.dialogsToBlocksMap[dlgId].hasOwnProperty(blockIndex)){var processorObj=this.dialogsToBlocksMap[dlgId][blockIndex];var processor=processorObj.processor;return this.processBlock(processorObj,processor)}};manager.prototype.processBlock=function processBlock(processorObj,processor){var result=null;var config=processor.config;var show=!0;if(config.showIf){var showIfExp=new Personetics.processor.PExp(config.showIf);try{show=showIfExp.eval(this.model)}
catch(e){show=!1;Personetics.error("PBlockProcessorManager.processBlock() Error: Failed to evaluate showIf property, not showing block. Error Message: "+e.message+e.stack)}}
if(show){this.evaluateDefault(config);result=processor.processData();processorObj.previousData=result}
return result};manager.prototype.evaluateDefault=function evaluateDefault(config){var blockDefaultValue=this.getBlockVarValue(config);if(typeof blockDefaultValue!=='undefined'&&blockDefaultValue!==null){config.selected=blockDefaultValue}
else{if(config.hasOwnProperty("default")&&config.default!=null&&config.default.length>0){var defaultStr=config.default;var defaultExp=new Personetics.processor.PExp(defaultStr);try{blockDefaultValue=defaultExp.eval(this.model)}
catch(e){Personetics.error("PBlockProcessorManager.evaluateDefault() Error: Failed to evaluate "+config.type+" block's default expression")}
if(blockDefaultValue){config.selected=blockDefaultValue;this.setBlockVarValue(config,blockDefaultValue)}}}};manager.prototype.resetVariables=function resetVariables(block){if(block.var&&!this.model.varValuesForSave[block.var]){this.model.varValues[block.var]=null}};manager.prototype.getBlockVarValue=function getBlockVarValue(blockConfig){var varKey=blockConfig.var;if(typeof varKey!=='undefined'&&varKey!==null&&varKey.length>0)
return this.model.getVarValue(varKey)};manager.prototype.setBlockVarValue=function setBlockVarValue(blockConfig,value){var varKey=blockConfig.var;if(typeof varKey!=='undefined'&&varKey!==null&&varKey.length>0)
this.model.setVarValue(varKey,value)};manager.prototype.getModel=function getModel(){return this.model};manager.prototype.handleQueryData=function handleQueryData(data,block){var processedData=block.doProcessData(data);this.story.handleQueryData(processedData,block)}})(window,window.Personetics=window.Personetics||{});(function(window,Personetics,$,undefined){var Handlebars=Personetics.UI.Handlebars;Personetics.story=Personetics.story||{};Personetics.story.PCtrlBase=Base.extend({initialize:function(parent){this.parent=parent;this.templates=[];this.partialTemplates=this.getPartialTemplates();this.initHandlebars()},start:function(){},getGraphPalette:function(){return null},handleMessage:function(msg){},initHandlebars:function(){this.handlebars=Handlebars.create();this.registerPartialTemplates()},getTemplateHtml:function(templateId,ctxObj){var tmpl=this.getTemplate(templateId);var html=tmpl(ctxObj);return html},getTemplate:function(templateId){var template=this.templates[templateId];if(!template){template=this.getPrecompiledTemplate(templateId);if(!template){throw "Unknown template '"+templateId+"'"}}
return template},getPrecompiledTemplate:function(templateId){var id=templateId;if(id.substr(0,1)=="#")
id=id.substr(1);var tmpl=Handlebars.templates[id];return tmpl},compileTemplate:function(str){return this.handlebars.compile(str)},getPartialTemplates:function getPartialTemplates(){return[{"name":"innerCard","id":"pstory-block-account-selector-inner-card"},{"name":"innerCardDesktop","id":"pstory-block-account-selector-inner-card-desktop"}]},registerPartialTemplates:function registerPartialTemplates(){var me=this;this.partialTemplates.forEach(function(partial){var partialTemplate=Handlebars.templates[partial.id];if(typeof partialTemplate!=="undefined"&&partialTemplate!==null)
Handlebars.registerPartial(partial.name,partialTemplate)})}})})(window,window.Personetics=window.Personetics||{},jQuery);(function(window,Personetics,$,undefined){Personetics.story=Personetics.story||{};Personetics.story.PBlockFactory=new function(){this.types={"TYPE_CONTAINER":"layout"};this.blockFactoryMap={};this.index="0";this.registerBlock=function(type,config){if(config.blockClass){var entry=this.blockFactoryMap[type];if(!entry){entry={type:type,class:{},widthModes:{}};this.blockFactoryMap[type]=entry}
if(config.class){entry.class[config.class]=config.blockClass}
else if(config.widthMode){entry.widthModes[config.widthMode]=config.blockClass}
else{entry.blockClass=config.blockClass}}};this.createBlock=function(parent,layoutInstructions,story){var block;var blockClass;var storyCfg=story.cfg;var type=layoutInstructions.type;if(type==this.types.TYPE_CONTAINER){blockClass=Personetics.story.LayoutBlock;layoutInstructions.layoutId="layout-"+this.index;this.index++}
else{var chartsLibClass;if(storyCfg!==undefined)
chartsLibClass=storyCfg.chartsLibClass;var cClass=layoutInstructions.class;var cClass=layoutInstructions.class||chartsLibClass;var entry=this.blockFactoryMap[type];if(entry){if(storyCfg.hasOwnProperty("widthMode")&&typeof storyCfg.widthMode!=='undefined'&&storyCfg.widthMode!==null&&storyCfg.widthMode.length>0){blockClass=entry.widthModes[storyCfg.widthMode]}
if(cClass){blockClass=entry.class[cClass]}
if(!blockClass)
blockClass=entry.blockClass}
if(!blockClass){blockClass=Personetics.story.Block;Personetics.log("Invalid block type '"+type+"'")}}
block=new blockClass(parent,layoutInstructions,story);return block}}})(window,window.Personetics=window.Personetics||{},jQuery);(function(window,Personetics,$,undefined){Personetics.story=Personetics.story||{};Personetics.story.PBlockRenderer=Personetics.story.PCtrlBase.extend({initialize:function(){},render:function(element,blockConfig,template){var html=template(blockConfig);element.append(html)},afterRender:function(){}})})(window,window.Personetics=window.Personetics||{},jQuery);(function(window,Personetics,$,undefined){Personetics.story=Personetics.story||{};Personetics.story.Block=Base.extend({initialize:function(parent,layoutInstructions,story){this.parent=parent;this.story=story;this.layoutInstructions=layoutInstructions;this.isFirstBlock=!1;var tmplId=this.getHtmlTemplateId(layoutInstructions.class);if(tmplId)
this.template=this.story.templates[tmplId];if(tmplId&&!this.template){this.template=this.story.getTemplate("#pstory-block-"+tmplId);if(!this.template)
throw "Block template not found for: "+tmplId;this.story.templates[tmplId]=this.template}},getHtmlTemplateId:function(clazz){throw "No template id defined for block"},initBlock:function(){},handleQueryData:function(data){this.renderData(data);this.bindEvents()},setVisible:function(visible){},beforeRender:function(el,layoutInstructions){this.layoutInstructions=layoutInstructions;this.layoutInstructions.isFirstBlock=this.isFirstBlock},render:function(el,layoutInstructions){this.layoutInstructions=this.layoutInstructions||layoutInstructions;this.el=el;var html=this.template(this.layoutInstructions);el.append(html);this.frameEl=el.find(".pstory-block-frame").last()},renderAgain:function(data){var html=this.template(data);$(this.frameEl).replaceWith(html)},renderData:function(data){},afterRender:function(el){if(this.frameEl){this.doScrollEvent(!0)}},bindEvents:function(){},handleEvent:function handleEvent(args){var eventType=args[0];switch(eventType){case "scroll":if(this.frameEl){this.doScrollEvent(args)}}},doScrollEvent:function doScrollEvent(){},notifyReportEvent:function(params){Personetics.utils.PEventReporting.setValue(params);Personetics.utils.PEventReporting.notifyEvent()},setIsFirstBlock:function setIsFirstBlock(valueToSet){this.isFirstBlock=valueToSet}})})(window,window.Personetics=window.Personetics||{},jQuery);(function(window,Personetics,$,undefined){Personetics.story=Personetics.story||{};Personetics.story.LayoutBlock=Personetics.story.Block.extend({getHtmlTemplateId:function(clazz){return"layout"},initialize:function(parent,layoutInstructions,story){Personetics.story.Block.prototype.initialize.call(this,parent,layoutInstructions,story)},render:function(el,layoutInstructions){Personetics.story.Block.prototype.render.call(this,el,layoutInstructions);this.contentEl=this.frameEl.find(".layout-block-content").last();this.renderBlocks(layoutInstructions)},renderBlocks:function(layoutInstructions){var me=this;$.each(layoutInstructions.blocks,function(index,blockLayoutInstructions){var blockRenderer=Personetics.story.PBlockFactory.createBlock(me,blockLayoutInstructions,me.story);blockRenderer.beforeRender(me.contentEl,blockLayoutInstructions);blockRenderer.render(me.contentEl,blockLayoutInstructions);blockRenderer.afterRender(me.contentEl);blockRenderer.bindEvents()})},afterRender:function(){var blockFrames=this.contentEl.children(".pstory-block-frame");var numOfChildren=blockFrames.length;var totalWidth=this.contentEl.width();var childWidth=Math.floor(totalWidth/numOfChildren)-3;var layout=this.layoutInstructions.layout;if(layout=="horizontal"){blockFrames.addClass("perso-horizontal-block");blockFrames.each(function(){$(this).css("width",childWidth)})}}})})(window,window.Personetics=window.Personetics||{},jQuery);(function(window,Personetics,$,undefined){Personetics.story=Personetics.story||{};Personetics.story.HBoxBlock=Personetics.story.Block.extend({getHtmlTemplateId:function(clazz){return"hbox"},initialize:function(parent,layoutInstructions,story){Personetics.story.Block.prototype.initialize.call(this,parent,layoutInstructions,story);this.totalWidth=12;this.colTemplate=this.story.getTemplate("#pstory-block-hbox-columns")},render:function(el,layoutInstructions){Personetics.story.Block.prototype.render.call(this,el,layoutInstructions);this.contentEl=this.frameEl.find(".hbox-block-content").last();this.renderBlocks(layoutInstructions)},renderBlocks:function(layoutInstructions){var me=this;var colHtml=this.colTemplate(layoutInstructions);this.contentEl.append(colHtml);var columnContainers=this.contentEl.find(".pstory-hbox-column-frame");$.each(layoutInstructions.columns,function(index,col){var colEl=columnContainers[index];var blockEl=$(colEl).find(".pstory-hbox-blocks-container");$.each(col.blocks,function(jndex,blockLayoutInstructions){var blockRenderer=Personetics.story.PBlockFactory.createBlock(me,blockLayoutInstructions,me.story);blockRenderer.beforeRender(blockEl,blockLayoutInstructions);blockRenderer.render(blockEl,blockLayoutInstructions);blockRenderer.afterRender(blockEl);blockRenderer.bindEvents()})})},afterRender:function(){var totalWidth=this.totalWidth;var blockWidth=this.contentEl.width();var colEls=this.contentEl.find(".pstory-hbox-column-frame").each(function(){var weight=$(this).data("width");var width=Math.floor(weight/totalWidth*blockWidth);$(this).css("width",width)})}})})(window,window.Personetics=window.Personetics||{},jQuery);(function(window,Personetics,$,undefined){Personetics.story=Personetics.story||{};Personetics.story.TextBlock=Personetics.story.Block.extend({getHtmlTemplateId:function(clazz){switch(clazz){case "note":case "perso-note":return"txt-note";default:return"txt"}},beforeRender:function beforeRender(el,layoutInstructions){var text=layoutInstructions.text.replace(/{{Emoji /g,'<span>&#x');text=text.replace(/}}/g,'</span>');layoutInstructions.text=text;Personetics.story.Block.prototype.beforeRender.call(this,el,layoutInstructions)},render:function(el,layoutInstructions){var param=layoutInstructions;if(layoutInstructions.class=="perso-H4"||layoutInstructions.class=="perso-H5")
param.needAccessibility=!0;var html=this.template(param);el.append(html);this.frameEl=el.find(".pstory-block-frame").last()},})})(window,window.Personetics=window.Personetics||{},jQuery);(function(window,Personetics,$,undefined){Personetics.story=Personetics.story||{};Personetics.story.DateBoxBlock=Personetics.story.Block.extend({getHtmlTemplateId:function(clazz){return"date-box"},render:function(el,layoutInstructions){var monthNames=["January","February","March","April","May","June","July","August","September","October","November","December"];this.layoutInstructions=this.layoutInstructions||layoutInstructions;if(this.layoutInstructions.hasOwnProperty("date")){var dateStr=this.layoutInstructions.date.trim();var date=new Date(dateStr);this.layoutInstructions.day=date.getDate();this.layoutInstructions.month=monthNames[date.getMonth()]}
this.el=el;var html=this.template(this.layoutInstructions);el.append(html);this.frameEl=el.find(".pstory-block-content").last()},})})(window,window.Personetics=window.Personetics||{},jQuery);(function(window,Personetics,$,undefined){Personetics.story=Personetics.story||{};Personetics.story.ImageBlock=Personetics.story.Block.extend({getHtmlTemplateId:function(clazz){return"image"},beforeRender:function(el,layoutInstructions){Personetics.story.Block.prototype.beforeRender.call(this,el,layoutInstructions);var url=this.layoutInstructions.url;if(url.indexOf("http")==0)
this.layoutInstructions.isAbsoluteURL=!0;else this.layoutInstructions.url=url.substr(0,url.lastIndexOf('.'))||url},afterRender:function(el){var element=this.frameEl.find('.pstory-block-content');var backgroundImage=element.css("backgroundImage");var imageSrc=backgroundImage.replace(/url\((['"])?(.*?)\1\)/gi,'$2').split(',')[0];var image=new Image();var height,width;image.src=imageSrc;image.onload=function(){proportionWidth=this.width/element.width();proportionHeight=this.height/proportionWidth;element.css({height:proportionHeight})};this.frameEl.find('.perso-introduce-personetics').attr("aria-label",Personetics.dictionary.getText("accessibilityIntroducePersonetics"));this.frameEl.find('.perso-introduce-personetics').attr("role","img")}})})(window,window.Personetics=window.Personetics||{},jQuery);(function(window,Personetics,$,undefined){Personetics.story=Personetics.story||{};Personetics.story.TableBlock=Personetics.story.Block.extend({getHtmlTemplateId:function(clazz){var template;var classStr;var classes=clazz?clazz.split(" "):[];$.each(classes,function(index,className){if(className.indexOf("perso-txlist")>-1){classStr=className.trim();return!1}});this.classStr=classStr;template=classStr?"table-"+classStr:"table";return template},beforeRender:function(el,layoutInstructions){if(layoutInstructions.rows||layoutInstructions.groups){Personetics.story.Block.prototype.beforeRender.call(this,el,layoutInstructions);this.addTexts();this.parseTableToObj();this.groupTable();this.formatTable();this.texts={tableTitle:Personetics.dictionary.getText("accessibilityTableTitle"),tableStart:Personetics.dictionary.getText("accessibilityTableStart"),tableEnd:Personetics.dictionary.getText("accessibilityTableEnd")};this.layoutInstructions.legendTexts=[{class:Personetics.dictionary.getText("lblScheduled").toLowerCase(),text:Personetics.dictionary.getText("lblScheduled")},{class:Personetics.dictionary.getText("lblEstimated").toLowerCase(),text:Personetics.dictionary.getText("lblEstimated")}]}
else{Personetics.log("TableBlock.beforeRender() Error: invalid rows property - not rendering")}},addTexts:function addTexts(){var balanceLabel=Personetics.dictionary.getText("lblbalance");this.layoutInstructions.balanceLabel=balanceLabel},parseTableToObj:function parseTableToObj(){var block=this;var data=[];$.each(this.layoutInstructions.rows,function(i,row){var newRow={};$.each(block.layoutInstructions.cols,function(j,colName){if(colName==='isScheduled'){if(row[j]==='true'){newRow[colName]=row[j]}else{newRow.isAnticipated=Personetics.dictionary.getText("lblAnticipated")}}else{newRow[colName]=row[j]}});data.push(newRow)});this.layoutInstructions.rows=data},afterRender:function afterRender(el){if(this.frameEl){Personetics.story.Block.prototype.afterRender.call(this,el);this.addRoleAndDataForAccessibility()}},addRoleAndDataForAccessibility:function addRoleAndDataForAccessibility(){this.frameEl.find("table").attr('role','presentation');var valuesElements=this.frameEl.find("td>span");var firstTableValue=valuesElements.first();var lastTableValue=valuesElements.last();firstTableValue.prepend('<span class="perso-accessibility-read">'+this.texts.tableTitle+this.texts.tableStart+'</span>');lastTableValue.append('<span class="perso-accessibility-read">'+this.texts.tableEnd+'</span>');firstTableValue.addClass('perso-accessibility-wrapper').attr('role','text');lastTableValue.addClass('perso-accessibility-wrapper').attr('role','text')},formatTable:function formatTable(){var block=this;var formats=this.story.uxCtrl.getTablesFormat()["table-"+this.classStr];if(!formats)
formats=this.story.uxCtrl.getTablesFormat()["table-default"];if(formats){if(this.isGroup==!0){$.each(this.layoutInstructions.groups,function(i,group){block.formatRow(group,formats);group.rows.forEach(function(row,j){block.formatRow(row,formats)})})}
else{$.each(this.layoutInstructions.rows,function(i,row){block.formatRow(row,formats)})}}},formatRow:function formatRow(row,formats){var block=this;$.each(formats.displayColumns,function(colName,format){if(typeof row[colName]!=='undefined'&&row[colName]!==null){var currencySymbol=row.currencyCD;if(typeof currencySymbol!=='undefined'){format.currencySymbol=currencySymbol}
row[colName]=block.formatTableHelper(colName,format,row[colName])}})},formatTableHelper:function formatTableHelper(type,format,element){var result=element;var utils=Personetics.processor.PUtils.getUtilsInstance("utils",this.model);switch(format.type){case "date":result=utils.formatDate(element,format.format,!0);break;case "amount":result=utils.formatAmount(element,format.currencySymbol,format.format,!0);break}
return result},groupTable:function groupTable(){var block=this;if(typeof this.story.uxCtrl.getTablesFormat=='function'){var formats=this.story.uxCtrl.getTablesFormat();var formatByType=formats["table-"+this.classStr];if(typeof formatByType!='undefined'&&formatByType.isGroup==!0&&typeof formatByType.groupingField!='undefined'){this.isGroup=!0;var groups={};var groupingField=formatByType.groupingField;$.each(this.layoutInstructions.rows,function(i,row){var groupName=row[groupingField];if(typeof groups[groupName]=='undefined'){groups[groupName]={};groups[groupName].rows=[];var groupingValue=groupName.trim();groups[groupName][groupingField]=groupingValue;var groupingValueId=Personetics.utils.string.stripSpecialChars(groupingValue);groups[groupName][groupingField+'Id']=groupingValueId;block.defineOptionalParameter(groups[groupName])}
block.setOptionalParameter(groups[groupName],row);groups[groupName].rows.push(row)});var dataGroup=[];$.each(groups,function(index,group){dataGroup.push(group)});this.layoutInstructions.groups=dataGroup;delete this.layoutInstructions.rows}}},defineOptionalParameter:function defineOptionalParameter(group){},setOptionalParameter:function setOptionalParameter(group,row){},render:function(el,layoutInstructions){if(layoutInstructions.rows||layoutInstructions.groups){Personetics.story.Block.prototype.render.call(this,el,layoutInstructions)}
else{Personetics.log("TableBlock.render() Error: invalid rows property - not rendering")}}})})(window,window.Personetics=window.Personetics||{},jQuery);(function(window,Personetics,$,undefined){Personetics.story=Personetics.story||{};Personetics.story.OptionsBlock=Personetics.story.Block.extend({bindEvents:function(){this.frameEl.find(".pstory-button").bind("click",Personetics.bind(this,this.optionClickEvent));this.bindEvnetsForAnimation()},optionClickEvent:function(e){var target=$(e.currentTarget);var targetId=target.attr('pstory-id');var prevSelected=this.frameEl.find('.pstory-button.selected');if(prevSelected.attr('pstory-id')!=targetId){this.onInputSelect(e);var id=target.attr("pstory-id");this.currentSelectedOption=this.getOptionById(id);this.parent.notifyEvent(this,"setSelectedValue",this.currentSelectedOption);var params={value:this.layoutInstructions.type.toLowerCase()==="quiz"?this.getQuizResult(this.layoutInstructions.options,target):this.getReportValue(target),type:this.layoutInstructions.type};this.notifyReportEvent(params)}},getQuizResult:function(options,target)
{for(var key in options)
{if(options[key].id===target.attr("pstory-id"))
{if(options[key].answer==="true"){return Personetics.dictionary.getText("right")}
else{return Personetics.dictionary.getText("wrong")}}}
return Personetics.dictionary.getText("wrong")},getOptionById:function getOptionById(id){return this.layoutInstructions.options.filter(function(opt){return opt.id==id})[0]},onInputSelect:function(e){var target=$(e.currentTarget);var otherButtons=$(this.frameEl).find('.pstory-button');otherButtons.removeClass('selected');target.addClass('selected')},bindEvnetsForAnimation:function bindEvnetsForAnimation(){}})})(window,window.Personetics=window.Personetics||{},jQuery);(function(window,Personetics,$,undefined){Personetics.story=Personetics.story||{};Personetics.story.TextBoxes=Personetics.story.OptionsBlock.extend({getHtmlTemplateId:function(clazz){return"textboxes"},afterRender:function(){this.boxesHeight()},boxesHeight:function boxesHeight(){var boxesEls=this.frameEl.find(".perso-textbox, .perso-textbox-with-image");var maxHeight=0;boxesEls.each(function(){var height=$(this).height();if(height>=maxHeight)
maxHeight=height});if(maxHeight>0)
boxesEls.css("minHeight",maxHeight)}})})(window,window.Personetics=window.Personetics||{},jQuery);(function(window,Personetics,$,undefined){Personetics.story=Personetics.story||{};Personetics.story.ButtonsBlock=Personetics.story.OptionsBlock.extend({getHtmlTemplateId:function(clazz){return"buttons"},beforeRender:function(el,layoutInstructions){Personetics.story.OptionsBlock.prototype.beforeRender.call(this,el,layoutInstructions);$.each(this.layoutInstructions.options,function(index,option){if(option.type=="toggle"){option.toggleState=option.class+"-"+option.id}});if(this.layoutInstructions.hasOwnProperty('class')&&this.layoutInstructions.class.indexOf('perso-radio-buttons')>-1){this.layoutInstructions.typeRadio=!0;this.layoutInstructions.type="Quiz"}},optionClickEvent:function(e){var target=$(e.target);var navigateToData=typeof target.data("navigateToPayload")=="undefined"?target.children('a').data("navigateToPayload"):target.data("navigateToPayload");if(navigateToData){this.doNavigateToPage(navigateToData)}
else{Personetics.story.OptionsBlock.prototype.optionClickEvent.call(this,e)}},buttonKyedownEvent:function(e){var target=$(e.target);if(target.hasClass('pstory-radio-button')){if([13].indexOf(e.which)!==-1){target.click()}}},afterRender:function(el){Personetics.story.OptionsBlock.prototype.afterRender.call(this,el);if(this.layoutInstructions.buttonType==="navigateTo"&&this.layoutInstructions.options.length){var data={};var buttonId="#pstory-block-buttons_"+this.layoutInstructions.id;var navigateToLink=el.find(buttonId+" .pstory-link-navigateTo");if(this.layoutInstructions.options[0].payload){data.navigateTarget=this.layoutInstructions.options[0].navigateTarget;data.payload=this.layoutInstructions.options[0].payload}else{data.navigateTarget=this.layoutInstructions.options[0].navigateTarget}
navigateToLink.length&&navigateToLink.data("navigateToPayload",data)}
else if(this.layoutInstructions.type==="Quiz"&&this.story.cfg.widthMode==="desktop"){Personetics.utils.accessibility.trackFocus(this.frameEl)}},getReportValue:function(target){var value;if(target.attr("pstory-type-text")!=undefined)
value=target.attr("pstory-type-text");else{value=target.attr("pstory-id")}
return value},doNavigateToPage:function(navigateData){this.parent.notifyEvent(this,"doNavigateToPage",navigateData);var params={value:navigateData.navigateTarget,type:"Navigation"};this.notifyReportEvent(params)},bindEvents:function(){Personetics.story.OptionsBlock.prototype.bindEvents.call(this);var radioButtonsContainer=this.el.find('.pstory-block-buttons.perso-radio-buttons');radioButtonsContainer.bind("keypress",".pstory-radio-button",Personetics.bind(this,this.buttonKyedownEvent))}})})(window,window.Personetics=window.Personetics||{},jQuery);(function(window,Personetics,$,undefined){Personetics.story=Personetics.story||{};Personetics.story.AccountSelectorBlock=Personetics.story.OptionsBlock.extend({getHtmlTemplateId:function(clazz){return"account-selector"}})})(window,window.Personetics=window.Personetics||{},jQuery);(function(window,Personetics,$,undefined){Personetics.story=Personetics.story||{};Personetics.story.TabsBlock=Personetics.story.OptionsBlock.extend({getHtmlTemplateId:function(clazz){return"tabs"},getOptionById:function getOptionById(id){return this.layoutInstructions.options.filter(function(tab){return tab.id==id})[0]},afterRender:function afterRender(el){var selected=this.frameEl.find(".pstory-button.selected");this.changeSelectedTabAnimation(selected)},onInputSelect:function(e){Personetics.story.OptionsBlock.prototype.onInputSelect.call(this,e);var selected=$(e.currentTarget);selected.attr('aria-selected',!0);selected.siblings('[role="tab"]').attr('aria-selected',!1);this.changeSelectedTabAnimation(selected)},changeSelectedTabAnimation:function changeSelectedTabAnimation(selected){if(typeof selected==="undefined"||selected===null||selected.length==0)
return;var tabAnimatedBorder=$(this.frameEl).find(".pstory-tab-animated-border-bottom");var left=selected.offset().left-this.frameEl.offset().left;var width=selected.innerWidth();tabAnimatedBorder.css({"left":left+'px',width:width+'px'})},getReportValue:function(target){var value="Tab "+target.attr("value");return value},})})(window,window.Personetics=window.Personetics||{},jQuery);(function(window,Personetics,$,undefined){Personetics.story=Personetics.story||{};Personetics.story.SelectOneBlock=Personetics.story.OptionsBlock.extend({getHtmlTemplateId:function(clazz){return"selectOne"}})})(window,window.Personetics=window.Personetics||{},jQuery);(function(window,Personetics,$,undefined){var d3=Personetics.persoD3||window.d3;Personetics.story=Personetics.story||{};Personetics.story.D3BarChartBlock=Personetics.story.Block.extend({getHtmlTemplateId:function(clazz){return"bar-chart"},beforeRender:function(el,layoutInstructions){if(layoutInstructions.categories&&layoutInstructions.seriesLabels){Personetics.story.Block.prototype.beforeRender.call(this,el,layoutInstructions);var direction=this.layoutInstructions.direction;this.chartType=this.getChartType(direction,this.layoutInstructions.seriesLabels.length>1);this.setSelected();this.barsDirection();this.beforeRenderChart(el);this.texts={accessibilityBarChartTitle:Personetics.dictionary.getText("accessibilityBarChartTitle"),series:Personetics.dictionary.getText("accessibilitySeries"),selected:Personetics.dictionary.getText("accessibilitySelected"),notSelected:Personetics.dictionary.getText("accessibilityNotSelected")}}
else{Personetics.log("D3BarChartBlock.beforeRender() Error: invalid categories and/or seriesLabels properties - not rendering")}},setSelected:function setSelected(){var block=this;this.hasSelected=!1;$.each(this.layoutInstructions.series,function(i,seriesArray){$.each(seriesArray,function(j,item){if(item.selected==!0){block.hasSelected=!0;return!1}})});if(this.hasSelected==!1){$.each(this.layoutInstructions.series,function(i,seriesArray){if(seriesArray.length>0){seriesArray[seriesArray.length-1].selected=!0}})}},render:function(el,layoutInstructions){if(layoutInstructions.categories&&layoutInstructions.seriesLabels){Personetics.story.Block.prototype.render.call(this,el,layoutInstructions);var chartEl=this.frameEl.find(".pstory-bar-chart");if(chartEl.length>0){this.renderBarChart(chartEl,layoutInstructions)}}
else{Personetics.log("D3BarChartBlock.render() Error: invalid categories and/or seriesLabels properties - not rendering")}},afterRender:function(el){if(this.frameEl){Personetics.story.Block.prototype.afterRender.call(this,el);$(this.chartEl).addClass(this.layoutInstructions.direction);this.renderAccessibilityData()}},renderAccessibilityData:function renderAccessibilityData(el){var id=this.frameEl.parents(".pstory-dialog-frame").attr("id")+this.frameEl.index();var titleContent;var parentNode=this.chartHelper.svg.node().parentNode;if(this.layoutInstructions.type=="pin-graph"){var dataString=this.createDataString();titleContent=this.getAccessibilityTitle()+'. '+dataString}else{titleContent=this.getAccessibilityTitle();d3.select(parentNode).attr("role","application")}
d3.select(parentNode).append("title").attr("id",id+"_title").text(titleContent);this.chartHelper.svg.attr('aria-labelledby',id+'_title');this.chartHelper.svg.selectAll("*").attr('aria-hidden',!0)},getAccessibilityTitle:function getAccessibilityTitle(){return this.texts.accessibilityBarChartTitle},createDataString:function createDataString(){var categories=this.layoutInstructions.categories;var series=this.layoutInstructions.series;var texts=this.texts;var seriesLabels=this.layoutInstructions.seriesLabels;var dataElement=$("<span></span>");var hasMultiSeries=this.layoutInstructions.seriesLabels.length>1;if(hasMultiSeries){$.each(series[0],function(index,item){dataElement.append(' '+texts.series+' '+seriesLabels[0]+', '+categories[index]+', '+item.label+', '+texts.series+' '+seriesLabels[1]+', '+categories[index]+', '+series[1][index].label+',')})}
else{$.each(series,function(index,item){dataElement.prepend(' '+Personetics.utils.date.nthDate(categories[index],Personetics.processor.PStoryConfig.getConfig("lang"))+', '+item.label+',')})}
return dataElement.text()},beforeRenderChart:function(el){if(this.layoutInstructions.series.length==1&&$.isArray(this.layoutInstructions.series[0]))
this.layoutInstructions.series=this.layoutInstructions.series[0];this.chartTypeHelper=this.chartType+"Helper";this.initChartHelper(this.chartTypeHelper);this.initOptions()},initOptions:function(){if(this.chartType=="multiVertical"){this.options=this.story.uxCtrl.getColumnChartMultiSeriesOptions();this.options.palette=this.story.uxCtrl.getMultiVerticalPalette();this.options.paletteLabels=this.story.uxCtrl.getMultiVerticalLabelsPalette()}
else if(this.chartType=="multiHorizontal"){this.options=this.story.uxCtrl.getBarChartOptions()}
else{this.options=this.story.uxCtrl.getColumnChartOptions()}},barsDirection:function barsDirection(){if((this.chartType=="vertical"||this.chartType=="multiVertical")&&Personetics.processor.PStoryConfig.isRtl()){this.barsDirectionRTL()}},barsDirectionRTL:function barsDirectionRTL(){if($.isArray(this.layoutInstructions.categories)){this.layoutInstructions.categories.reverse();this.layoutInstructions.accessibilityCategories.reverse()}
if($.isArray(this.layoutInstructions.series)){$.each(this.layoutInstructions.series,function(i,series){if($.isArray(series)){series.reverse()}})}},renderBarChart:function(el,layoutInstructions){var data=layoutInstructions;this.options.desktopScreenWidth=this.story.uxCtrl.getDesktopScreenWidth();var handleClickBind=Personetics.bind(this,this.handleClick);if(this.chartType=="multiHorizontal"){this.chartHelper.prepareMultiHorizontalChart(this,el);this.chartHelper.renderMultiHorizontalChart(this,el,this.layoutInstructions)}
else{this.chartHelper.prepareChart(data,this.options,handleClickBind);this.chartHelper.renderChart(el)}},handleClick:function(obj,clickedItemIndex){if(this.hasSelected==!1){return}
if(obj.amount==0)
return;var svg;svg=this.frameEl.find('svg .perso-bar, svg .perso-chart-rect')[clickedItemIndex].className.animVal;if(svg.indexOf("selected")!=-1){return}
var highlightedElements=this.frameEl.find('svg .perso-bar.selected, svg .perso-chart-rect.selected');$.each(highlightedElements,function(i,element){element.className.baseVal=Personetics.utils.string.removeClass(element.className,'selected')});var highlightedLabels=this.frameEl.find('svg .perso-label');$.each(highlightedLabels,function(i,label){label.className.baseVal=Personetics.utils.string.removeClass(label.className,'selected')});var highlightedxAxisLabels=this.frameEl.find('svg .perso-xAxis-label');$.each(highlightedxAxisLabels,function(i,xAxisLabel){xAxisLabel.className.baseVal=Personetics.utils.string.removeClass(xAxisLabel.className,'selected')});if(obj.hasOwnProperty("mode")){var highlightSelectedInElements=this.frameEl.find('svg .perso-bar, svg .perso-chart-rect.In')[clickedItemIndex];var highlightSelectedOutElements=this.frameEl.find('svg .perso-bar, svg .perso-chart-rect.Out')[clickedItemIndex];var highlightSelectedInLabels=this.frameEl.find('svg .perso-label.In')[clickedItemIndex];var highlightSelectedOutLabels=this.frameEl.find('svg .perso-label.Out')[clickedItemIndex];var clickedBarxAxis=this.frameEl.find('svg .perso-xAxis-label')[clickedItemIndex];highlightSelectedInElements.className.baseVal=Personetics.utils.string.addClass(highlightSelectedInElements.className,'selected');highlightSelectedOutElements.className.baseVal=Personetics.utils.string.addClass(highlightSelectedOutElements.className,'selected');if(typeof highlightSelectedInLabels!='undefined'){highlightSelectedInLabels.className.baseVal=Personetics.utils.string.addClass(highlightSelectedInLabels.className,'selected')}
if(typeof highlightSelectedOutLabels!='undefined'){highlightSelectedOutLabels.className.baseVal=Personetics.utils.string.addClass(highlightSelectedOutLabels.className,'selected')}
if(clickedBarxAxis){clickedBarxAxis.className.baseVal=Personetics.utils.string.addClass(clickedBarxAxis.className,'selected')}}else{var clickedBar=this.frameEl.find('svg .perso-bar, svg .perso-chart-rect')[clickedItemIndex];var clickedBarLabel=this.frameEl.find('svg .perso-label')[clickedItemIndex];var clickedBarxAxis=this.frameEl.find('svg .perso-xAxis-label')[clickedItemIndex];clickedBar.className.baseVal=Personetics.utils.string.addClass(clickedBar.className,'selected');if(typeof clickedBarLabel!='undefined'){clickedBarLabel.className.baseVal=Personetics.utils.string.addClass(clickedBarLabel.className,'selected')}
if(clickedBarxAxis){clickedBarxAxis.className.baseVal=Personetics.utils.string.addClass(clickedBarxAxis.className,'selected')}}
this.parent.notifyEvent(this,"setSelectedValue",obj.category);var params={value:obj.category,type:this.layoutInstructions.type};this.notifyReportEvent(params)},getChartType:function(direction,hasMultiSeries){var type=null;if(direction=="vertical"&&hasMultiSeries){type="multiVertical"}else if(direction=="horizontal"&&hasMultiSeries){type="multiHorizontal"}else if(direction=="vertical"){type="vertical"}
else if(direction=="horizontal"){type="horizontal"}
return type},initChartHelper:function(type){this.chartHelper=Personetics.story.BlockChartFactory.generateHelperClazz(type,this.story.cfg)}})})(window,window.Personetics=window.Personetics||{},jQuery);(function(window,Personetics,$,undefined){var d3=Personetics.persoD3||window.d3;Personetics.story=Personetics.story||{};Personetics.story.D3PinGraphChartBlock=Personetics.story.D3BarChartBlock.extend({beforeRender:function(el,layoutInstructions){Personetics.story.D3BarChartBlock.prototype.beforeRender.call(this,el,layoutInstructions);this.texts.accessibilityPinGraphTitle=Personetics.dictionary.getText("accessibilityPinGraphTitle")},getHtmlTemplateId:function(clazz){return"pinGraph-chart"},render:function(el,layoutInstructions){Personetics.story.Block.prototype.render.call(this,el,layoutInstructions);var chartEl=this.frameEl.find(".pstory-pinGraph-chart");if(chartEl.length>0){this.renderBarChart(chartEl,layoutInstructions)}},renderBarChart:function(el,data){this.chartHelper.prepareChart(data,this.options);this.chartHelper.renderChart(el)},beforeRenderChart:function(el,layoutInstructions){this.layoutInstructions.series=this.layoutInstructions.series[0];this.chartType=this.getChartType();this.chartTypeHelper=(this.chartType+"Helper");this.initChartHelper(this.chartTypeHelper);this.options=this.story.uxCtrl.getPinGraphChartOptions()},barsDirection:function barsDirection(){if(Personetics.processor.PStoryConfig.isRtl()){this.barsDirectionRTL()}},getChartType:function(){var type='pinGraph';return type},getAccessibilityTitle:function getAccessibilityTitle(){return this.texts.accessibilityPinGraphTitle},})})(window,window.Personetics=window.Personetics||{},jQuery);(function(window,Personetics,$,undefined){var d3=Personetics.persoD3||window.d3;Personetics.story=Personetics.story||{};Personetics.story.PieChartBlock=Personetics.story.Block.extend({getHtmlTemplateId:function(clazz){return"pie-chart"},beforeRender:function(el,layoutInstructions){Personetics.story.Block.prototype.beforeRender.call(this,el,layoutInstructions);this.options=this.story.uxCtrl.getPieOptions();this.setTotal(layoutInstructions);this.colors=d3.scale.ordinal().range(this.getGraphPalette());this.texts={accessibilityPieTitle:Personetics.dictionary.getText("accessibilityPieTitle")};this.grayscaleId="grayscale_"+ +new Date();this.dropShadow='';if(this.options.arcs.filter.dropShadow){this.dropShadowId="drop-shadow_"+ +new Date();this.dropShadow="url(#"+this.dropShadowId+")"}
this.isOldAndroidVersion=Personetics.utils.persoHelper.isOldAndroidVersion();this.layoutInstructions.slices=this.layoutInstructions.slices.sort(function(sliceA,sliceB){return Math.abs(sliceB.value)-Math.abs(sliceA.value)})},setPieDefination:function(){var block=this;var normalizedValue=block.totalAmountInt*0.05;var padAngle=0.04;if(typeof block.options.arcs.padAngle!='undefined'){padAngle=block.options.arcs.padAngle}
return d3.layout.pie().padAngle(padAngle).value(function(d){var value=Math.abs(d.value)+normalizedValue;return value})},sortPie:function(layoutInstructionsSlices){layoutInstructionsSlices.sort(function(a,b){return Math.abs(b.value)-Math.abs(a.value)});return layoutInstructionsSlices},setTotal:function setTotal(layoutInstructions){var totalFromSrc=layoutInstructions.centerText;var totalFromSrcToArr=[];if(totalFromSrc){totalFromSrcToArr=totalFromSrc.split("<br>")}else{Personetics.log("Center text is empty")}
this.totalText=totalFromSrcToArr[0]?totalFromSrcToArr[0]:'';this.totalAmount=totalFromSrcToArr[1]?totalFromSrcToArr[1]:'';if(layoutInstructions.hasOwnProperty('slices')&&layoutInstructions.slices.length>0){var totalAmountObj=layoutInstructions.slices.reduce(function(total,slice){return{value:Math.abs(total.value)+Math.abs(slice.value)}});this.totalAmountInt=totalAmountObj.value}
else{this.totalAmountInt=0}},getGraphPalette:function(){return this.story.uxCtrl.getPieGraphPalette()},render:function(el,layoutInstructions){if(layoutInstructions.slices){layoutInstructions.texts=this.texts;Personetics.story.Block.prototype.render.call(this,el,layoutInstructions);this.frameEl=el.find('.pstory-block-frame').last();var chartEl=this.frameEl.find(".pstory-pie-chart");if(chartEl.length>0){this.renderPieChart(chartEl,layoutInstructions)}}
else{Personetics.log("PieChartBlock.render() Error: invalid slices property - not rendering")}},renderPieChart:function(el,layoutInstructions){var block=this;layoutInstructions.slices=this.sortPie(layoutInstructions.slices);this.setPieSize();d3.selection.prototype.moveToFront=function(){return this.each(function(){var gparent=this.parentNode;gparent.parentNode.appendChild(gparent)})};this.defineArcs();this.renderPieBase(el);this.renderShadowFilter(block);this.renderPie(el,layoutInstructions,block);this.renderAccessibilityData(el,layoutInstructions)},setPieSize:function setPieSize(){this.margin={top:0,right:20,bottom:0,left:20};this.width=this.frameEl.find('.pstory-pie-chart').width();this.height=this.width*0.7;this.radius=this.width/2.5;this.innerRadius=this.radius-26;this.outerRadius=this.radius-36;this.innerRadiusOver=this.radius-23;this.outerRadiusOver=this.radius-43},defineArcs:function defineArcs(){var block=this;this.arc=d3.svg.arc().innerRadius(block.innerRadius).outerRadius(block.outerRadius);this.arcOver=d3.svg.arc().innerRadius(block.innerRadiusOver).outerRadius(block.outerRadiusOver)},renderPieBase:function renderPieBase(el){this.svg=this.renderPieSvgBase(el)},renderPieSvgBase:function(el){var block=this;if(el){return(d3.select(el.get(0)).append("svg").attr("width",block.width).attr("height",block.height).append("g").attr("transform","translate("+block.width/2+","+block.height/2+")"))}},renderPie:function(el,layoutInstructions,block){this.renderArcs(layoutInstructions);this.renderPieTitle(this.totalText);if(this.options.drawCenterLine==!0){this.renderLine()}
this.renderPieAmount(this.totalAmount)},renderArcs:function(layoutInstructions){var block=this;var arcs=block.svg.selectAll(".arc").data(block.setPieDefination()(layoutInstructions.slices)).enter().append("g").attr("class","perso-arc").attr("pstory-id",function(d){return d.data.category});arcs.append("path").attr("d",block.arc).attr("class",function(d){var clazz="";if(d.data.highlight){clazz+="perso-selected"}
return clazz}).style("filter",function(d){if(d.data.highlight){if(block.options.arcs.filter.dropShadow){return"url(#"+block.options.arcs.filter.dropShadow.id+")"}
return""}}).style("fill",function(d,i){return block.colors(d.data.category)}).on("click",function(obj,clickedItemIndex){block.onPieItemClick(obj,clickedItemIndex,this)})},renderTicks:function(block,layoutInstructions){if(block){var ticks=block.svg.append('g').attr('class','perso-ticks').selectAll("line").data(block.setPieDefination()(layoutInstructions)).enter().append("line");ticks.attr('class','perso-tick').attr("x1",0).attr("x2",0).attr("y1",-block.radius*.8).attr("y2",-block.radius*.9).attr("stroke","gray").attr("transform",function(d){return"rotate("+(d.startAngle+d.endAngle)/2*(180/Math.PI)+")"})}},renderPieLabels:function(block,layoutInstructions){if(block){var labels=block.svg.append('g').attr('class','perso-pie-labels').attr("transform","translate(8,0)").selectAll("text").data(block.setPieDefination()(layoutInstructions)).enter().append("text");labels.attr("class","perso-pie-label").attr("transform",function(d){var dist=block.radius+20;var angle=(d.startAngle+d.endAngle)/2;var x=dist*Math.sin(angle);var y=-dist*Math.cos(angle);return"translate("+x+","+y+")"}).attr("dy","-0.5em").attr("text-anchor","middle").html(function(d){return d.data.category}).call(block.wrapLabelText,$(window).width()*.28)}},renderPieTitle:function(totalText){var block=this;var totaltxt_SpaceFromCenter=this.options.totaltxt_SpaceFromCenter||'-.3em';this.svg.append('text').attr('class','perso-total-txt').attr('dy',totaltxt_SpaceFromCenter).html(totalText)},renderPieAmount:function(totalAmount){var block=this;var totalAmount_SpaceFromCenter=this.options.totalAmount_SpaceFromCenter||'.9em';this.svg.append('text').attr('class','perso-total-amount').attr('dy',totalAmount_SpaceFromCenter).html(totalAmount)},renderLine:function(){var lineWidth=this.options.centerLineWidth||0;this.svg.append('line').attr('class','perso-centerLine').attr('x1',lineWidth/2*-1).attr('x2',lineWidth/2)},renderAccessibilityData:function renderAccessibilityData(el){var id=this.frameEl.parents(".pstory-dialog-frame").attr("id")+this.frameEl.index();var titleContent=this.texts.accessibilityPieTitle+'. '+this.createDataString();var parentNode=this.svg.node().parentNode;d3.select(parentNode).append("title").attr("id",id+"_title").text(titleContent);d3.select(parentNode).attr("role","presentation");this.svg.attr('aria-labelledby',id+'_title');this.svg.selectAll("*").attr('aria-hidden',!0)},createDataString:function createDataString(){var dataElement=$("<span></span>");dataElement.append(this.totalText+': '+this.totalAmount+'.');return dataElement.text()},onPieItemClick:function(obj,clickedItemIndex,clickedItem){var block=this;var oldSelectedArc=$('.perso-arc path.perso-selected');if(oldSelectedArc.length){oldSelectedArc[0].className.baseVal=Personetics.utils.string.removeClass(oldSelectedArc[0].className,'perso-selected')}
var oldSelectedArcLabel=this.frameEl.find('.pstory-pie-chart svg .perso-pie-label.selected');if(oldSelectedArcLabel.length){oldSelectedArcLabel[0].className.baseVal=Personetics.utils.string.removeClass(oldSelectedArcLabel[0].className,'selected')}
d3.select(clickedItem).attr("class","perso-selected");var pstoryLabels=this.frameEl.find('.pstory-pie-chart svg .perso-pie-label');if(typeof pstoryLabels!='undefined'&&pstoryLabels.length>clickedItemIndex){var clickedArcLabel=pstoryLabels[clickedItemIndex];clickedArcLabel.className.baseVal=Personetics.utils.string.addClass(clickedArcLabel.className,'selected')}
this.handleClick(obj,clickedItemIndex)},renderShadowFilter:function(block){var filter=block.options.arcs.filter.dropShadow;var svgWithFilters=block.svg;if(filter){var defs=block.svg.append("defs");var filterSvg=defs.append("filter").attr("id",this.dropShadowId).attr("height","130%");filterSvg.append("feGaussianBlur").attr("in",filter.in).attr("stdDeviation",filter.stdDeviation).attr("result","blur");filterSvg.append("feOffset").attr("in","blur").attr("dx",filter.dxOffset).attr("dy",filter.dyOffset).attr("result","offsetBlur");filterSvg.append("feFlood").attr("in","offsetBlur").attr("flood-color",filter.color).attr("flood-opacity","1").attr("result","offsetColor");filterSvg.append("feComposite").attr("in","offsetColor").attr("in2","offsetBlur").attr("operator","in").attr("result","offsetBlur");var feMerge=filterSvg.append("feMerge");feMerge.append("feMergeNode").attr("in","offsetBlur")
feMerge.append("feMergeNode").attr("in",filter.in)}},handleClick:function(obj,clickedItemIndex){var dataObj=obj;if(dataObj.data){dataObj=dataObj.data}
this.parent.notifyEvent(this,"setSelectedValue",dataObj.category);var params={value:dataObj.category,type:this.layoutInstructions.type};this.notifyReportEvent(params)},getSelectedPathIndex:function(paths){var selectedIndex=0;var selectedCategory=this.frameEl.find('path.perso-selected').parent().attr('pstory-id');var selected=this.layoutInstructions.slices.filter(function(slice,i){if(slice.category==selectedCategory){selectedIndex=i;return!0}});return selectedIndex},wrapLabelText:function(text,width){text.each(function(){var text=d3.select(this),words=text.text().split(/\s+/).reverse(),word,line=[],lineNumber=0,lineHeight=.15,y=text.attr("y"),dy=parseFloat(text.attr("dy")),tspan=text.text(null).append("tspan").attr("x",0).attr("y",y).attr("dy",dy+"em");while(word=words.pop()){line.push(word);tspan.text(line.join(" "));if(tspan.node().getComputedTextLength()>width){line.pop();tspan.text(line.join(" "));line=[word];tspan=text.append("tspan").attr("x",0).attr("y",y).attr("dy",++lineNumber*lineHeight+dy+"em").text(word)}}})},})})(window,window.Personetics=window.Personetics||{},jQuery);(function(window,Personetics,$,undefined){var d3=Personetics.persoD3||window.d3;Personetics.story=Personetics.story||{};Personetics.story.WidePieChartBlock=Personetics.story.Block.extend({getHtmlTemplateId:function(clazz){return"pie-chart"},beforeRender:function(el){var block=this;var cfg=block.config;block.margin={top:10,right:10,bottom:10,left:10};block.width=(el.width()-block.margin.left-block.margin.right);block.height=block.width/2;block.radius=block.width/3;block.xFieldExp=new Personetics.processor.PExp(cfg.x);var yExp=block.yFieldExp=new Personetics.processor.PExp(cfg.y);block.xScale=d3.scale.ordinal().rangeRoundBands([0,block.width],.1);block.yScale=d3.scale.linear().range([block.height,0]);block.xAxis=d3.svg.axis().scale(block.xScale).orient("bottom");var deg=(Math.PI/180);block.pie=d3.layout.pie().sort(null).startAngle(-90*deg).endAngle(90*deg).value(function(d){return yExp.eval(d)})},render:function(el){this.el=el;var data=this.story.model.fetchFromSrc(this,this.config.src);if(!data)
return;if(data!==Personetics.processor.Future)
data=data.getObjArray();var html=this.template(data);el.append(html);var chartEl=el.find(".pstory-pie-chart");if(chartEl.length>0){this.renderPieChart(chartEl,data)}},afterRenderPieChart:function(el,data){var block=this;var cfg=block.config;var xScale=block.xScale;var yScale=block.yScale;var xExp=block.xFieldExp;var yExp=block.yFieldExp;xScale.domain(data.map(function(d){return xExp.eval(d)}));yScale.domain([0,d3.max(data,function(d){return yExp.eval(d)})]);block.svg=d3.select(el.get(0)).append("svg").attr("width",block.width+block.margin.left+block.margin.right).attr("height",block.height+block.margin.top+block.margin.bottom).append("g").attr("transform","translate("+(block.width/2+block.margin.left)+","+(block.height+block.margin.top)+")");var colors=this.getGraphPalette();var color=xScale.range(colors);var arc=d3.svg.arc().outerRadius(this.radius).innerRadius(this.radius*0.5);var deg=(Math.PI/180);var pie=d3.layout.pie().sort(null).value(function(d){return yExp.eval(d)}).startAngle(-90*deg).endAngle(90*deg);var svg=block.svg;var g=svg.selectAll(".arc").data(pie(data)).enter().append("g").attr("class","arc");g.append("path").attr("d",arc).style("fill",function(d){return color(xExp.eval(d.data))});var labels=!0;if(labels){var labelRadius=230;g.append("text").attr("x",function(d,i){var centroid=arc.centroid(d);var midAngle=Math.atan2(centroid[1],centroid[0]);var x=Math.cos(midAngle)*labelRadius;var sign=(x>0)?1:-1;var labelX=x+(5*sign);return labelX}).attr("y",function(d,i){var centroid=arc.centroid(d);var midAngle=Math.atan2(centroid[1],centroid[0]);var y=Math.sin(midAngle)*labelRadius;return y}).attr('text-anchor',function(d,i){var centroid=arc.centroid(d);var midAngle=Math.atan2(centroid[1],centroid[0]);var x=Math.cos(midAngle)*labelRadius;return(x>0)?"start":"end"}).text(function(d){var txt=xExp.eval(d.data);return txt});g.append("line").attr({stroke:"black","stroke-width":1,x1:function(d,i){return arc.centroid(d)[0]},y1:function(d,i){return arc.centroid(d)[1]},x2:function(d,i){var centroid=arc.centroid(d);var midAngle=Math.atan2(centroid[1],centroid[0]);var x=Math.cos(midAngle)*labelRadius;return x},y2:function(d,i){var centroid=arc.centroid(d);var midAngle=Math.atan2(centroid[1],centroid[0]);var y=Math.sin(midAngle)*labelRadius;return y},'class':"label-line"})}},getGraphPalette:function(){return this.story.uxCtrl.getPieGraphPalette()},handleClick:function(obj){if(!this.config.var||!this.config.varSource)
return;this.setValue(obj[this.config.varSource]);this.story.fireEvent(this)}})})(window,window.Personetics=window.Personetics||{},jQuery);(function(window,Personetics,$,undefined){Personetics.story=Personetics.story||{};Personetics.story.MapBlock=Personetics.story.Block.extend({getHtmlTemplateId:function(clazz){return"map"},render:function(el,layoutInstructions){Personetics.story.Block.prototype.render.call(this,el,layoutInstructions);this.mapEl=this.frameEl.find(".pstory-map-frame");var mapOptions={scrollwheel:!1,navigationControl:!1,mapTypeControl:!1,scaleControl:!1,draggable:!1,zoom:15,center:new google.maps.LatLng(40.7097798,-73.9624878),mapTypeId:google.maps.MapTypeId.ROADMAP};var mapCanvas=document.createElement("div");mapCanvas.id="map-canvas";mapCanvas.style.width="100%";mapCanvas.style.height="100%";this.mapEl.append(mapCanvas);this.map=new google.maps.Map(mapCanvas,mapOptions)}})})(window,window.Personetics=window.Personetics||{},jQuery);(function(window,Personetics,$,undefined){Personetics.story=Personetics.story||{};Personetics.story.PBlockSessionManager=Base.extend({initialize:function(story){this.story=story;this.blockProcessorManager=PBlockProcessorManager.getInstance();var customizationOptions=story.options;var options={story:story.storyDef,texts:story.texts,facts:story.cfg.data||story.cfg.insightFacts,expressions:story.expressions,customizationOptions:customizationOptions}
this.blockProcessorManager.start(options);this.dialogsToBlocksMap={};this.processedData=[]},reset:function(){this.processedData=[]},resetDialog:function(dlgId){if(this.dialogsToBlocksMap.hasOwnProperty(dlgId))
this.dialogsToBlocksMap[dlgId]=[]},startBlock:function(dlgId,texts,config,index){if(!this.dialogsToBlocksMap.hasOwnProperty(dlgId))
this.dialogsToBlocksMap[dlgId]=[];var layoutInstructions=this.blockProcessorManager.processBlockConfig(dlgId,index);var renderer=Personetics.story.PBlockFactory.createBlock(this,layoutInstructions,this.story);var block={dlgId:dlgId,config:config,layoutInstructions:layoutInstructions,renderer:renderer};this.dialogsToBlocksMap[dlgId].push(block);renderer.initBlock()},renderBlocks:function(dlgId,el,isFirstDialogs){if(this.dialogsToBlocksMap.hasOwnProperty(dlgId)){var me=this;$.each(this.dialogsToBlocksMap[dlgId],function(index,block){var renderer=block.renderer;var layoutInstructions=block.layoutInstructions;if(isFirstDialogs&&index==0)
renderer.setIsFirstBlock(!0);me.processedData.push(layoutInstructions);renderer.beforeRender(el,layoutInstructions);renderer.render(el,layoutInstructions);renderer.afterRender(el);renderer.bindEvents()});if(window.setProcessorData)
window.setProcessorData(this.processedData)}
else{throw "Invalid dialog id '"+dlgId+"'"}},findBlock:function(options){var rendererObj=options.rendererObj;var result=null;$.each(this.dialogsToBlocksMap,function(dlgId,blocks){$.each(blocks,function(index,block){var currObj=block.renderer;if(rendererObj==currObj){result=block;return!1}});if(result)
return!1});return result},notifyEvent:function(renderer,eventName,params){switch(eventName){case "doNavigateToPage":this.doNavigateToPage(params);break;case "setSelectedValue":this.setSelectedValue(renderer,params)}},setSelectedValue:function(renderer,value){var block=this.findBlock({rendererObj:renderer});this.blockProcessorManager.setBlockVarValue(block.config,value);this.story.fireEvent(block)},doNavigateToPage:function(params){var bridge=personetics.getJSBridge();if(bridge&&($.isFunction(bridge.navigateToPage)))
bridge.navigateToPage(params);else Personetics.log("Events Delegate not defined")},setVisible:function(dlgId,visible){if(this.dialogsToBlocksMap.hasOwnProperty(dlgId)){$.each(this.dialogsToBlocksMap[dlgId],function(index,block){block.renderer.setVisible(visible)})}},resetVariables:function(block){this.blockProcessorManager.resetVariables(block)},getModel:function getModel(){return this.blockProcessorManager.getModel()},handleEvent:function handleEvent(eventType){var args=arguments;$.each(this.dialogsToBlocksMap,function(dialogId,dialog){$.each(dialog,function(index,block){block.renderer.handleEvent(args)})})}})})(window,window.Personetics=window.Personetics||{},jQuery);(function(window,Personetics,$,undefined){Personetics.story=Personetics.story||{};Personetics.story.PSkinControler=Base.extend({initialize:function(){},setStory:function(story){this.story=story},registerWidgets:function(){this.registerDefaultWidgets()},registerBlocks:function(){this.registerDefaultBlocks();this.registerDefaultChartHeplers()},getTablesFormat:function(){return Personetics.story.getTablesFormat()},afterRender:function(dlg,callback){if(dlg.shouldShow()){dlg.el.css({opacity:0.0,visibility:"visible"});dlg.el.fadeTo(0,1)}
if(callback)
callback()},beforeRender:function(dlg,callback){callback()},registerBlock:function(type,config){Personetics.story.PBlockFactory.registerBlock(type,config)},registerChartHelper:function(name,clazz){Personetics.story.BlockChartFactory.registerChartHelper(name,clazz)},getAccountSelectorPalette:function(){return['darkBlue','turquoise','grey','red','lightBlue','orange']},getGraphPalette:function(){return['#5D68C2','#3B49B6','#1729AF','#111F88','#08176C']},getColumnGraphPalette:function(){return['#5D68C2','#3B49B6','#1729AF','#111F88','#08176C']},getBarGraphPalette:function(){return['#5D68C2','#3B49B6','#1729AF','#111F88','#08176C']},getPieGraphPalette:function(){return['#5D68C2','#3B49B6','#1729AF','#111F88','#08176C']},getBarChartMultiSeriesLabels:function(labels){return function(){if(labels&&labels.length>0){var label=labels[this.series.index];return("<span class='"+this.series.name+"'>"+label+"</span>")}
else{return""}}},registerDefaultBlocks:function(type){this.registerBlock("txt",{blockClass:Personetics.story.TextBlock});this.registerBlock("text",{blockClass:Personetics.story.TextBlock});this.registerBlock("date-box",{blockClass:Personetics.story.DateBoxBlock});this.registerBlock("image",{blockClass:Personetics.story.ImageBlock});this.registerBlock("textboxes",{blockClass:Personetics.story.TextBoxes});this.registerBlock("compare-block",{blockClass:Personetics.story.CompareBlock});this.registerBlock("buttons",{blockClass:Personetics.story.ButtonsBlock});this.registerBlock("account-selector",{blockClass:Personetics.story.AccountSelectorBlock});this.registerBlock("tabs",{blockClass:Personetics.story.TabsBlock});this.registerBlock("selectOne",{blockClass:Personetics.story.SelectOneBlock});this.registerBlock("external-links",{blockClass:Personetics.story.ButtonsBlock});this.registerBlock("tranList",{blockClass:Personetics.story.TableBlock});this.registerBlock("table",{blockClass:Personetics.story.TableBlock});this.registerBlock("bar-chart",{blockClass:Personetics.story.D3BarChartBlock});this.registerBlock("line-chart",{blockClass:Personetics.story.DotsLineChartBlock});this.registerBlock("bar-chart",{blockClass:Personetics.story.BarChartBlock});this.registerBlock("bar-chart",{blockClass:Personetics.story.BarCharHighchartstBlock,class:"highcharts"});this.registerBlock("pie-chart",{blockClass:Personetics.story.PieChartBlock});this.registerBlock("arc-chart",{blockClass:Personetics.story.PieChartBlock});this.registerBlock("pie-chart",{blockClass:Personetics.story.PieChartBlock,widthMode:"small"});this.registerBlock("pie-chart",{blockClass:Personetics.story.WidePieChartBlock,widthMode:"wide"});this.registerBlock("pie-chart",{blockClass:Personetics.story.PieChartHighchartsBlock,class:"highcharts"});this.registerBlock("spline-chart",{blockClass:Personetics.story.SplineCharHighchartstBlock,class:"highcharts"});this.registerBlock("pinGraph-chart",{blockClass:Personetics.story.PinGraphChartBlock});this.registerBlock("map",{blockClass:Personetics.story.MapBlock});this.registerBlock("pin-graph",{blockClass:Personetics.story.D3PinGraphChartBlock});this.registerBlock("pin-chart",{blockClass:Personetics.story.D3PinGraphChartBlock});this.registerBlock("h-box",{blockClass:Personetics.story.HBoxBlock})},registerDefaultChartHeplers:function(){this.registerChartHelper("verticalHelper",{helperClass:Personetics.utils.d3Helpers.VerticalChartHelper});this.registerChartHelper("horizontalHelper",{helperClass:Personetics.utils.d3Helpers.HorizontalChartHelper});this.registerChartHelper("multiVerticalHelper",{helperClass:Personetics.utils.d3Helpers.MultiVerticalChartHelper});this.registerChartHelper("multiHorizontalHelper",{helperClass:Personetics.utils.d3Helpers.MultiHorizontalChartHelper});this.registerChartHelper("pinGraphHelper",{helperClass:Personetics.utils.d3Helpers.PinGraphChartHelper});this.registerChartHelper("lineChartHelper",{helperClass:Personetics.utils.d3Helpers.LineChartHelper})},registerDefaultWidgets:function(){Personetics.UI.PWidgetFactory.registerWidget("app-ctrl",{widgetClass:Personetics.UI.PAppCtrl,widgetName:"Base app ctrl"});Personetics.UI.PWidgetFactory.registerWidget("master",{widgetClass:Personetics.UI.PAppCtrl,widgetName:"Base master"});Personetics.UI.PWidgetFactory.registerWidget("insights",{widgetClass:Personetics.story.PInsighsCtrl,widgetName:"Base insights"});Personetics.UI.PWidgetFactory.registerWidget("insights-overlay",{widgetClass:Personetics.story.PInsighsOverlayCtrl,widgetName:"Base insights overlay"});Personetics.UI.PWidgetFactory.registerWidget("inbox",{widgetClass:Personetics.story.PInboxCtrl,widgetName:"Base inbox"});Personetics.UI.PWidgetFactory.registerWidget("management",{widgetClass:Personetics.UI.PManagementCtrl,widgetName:"Base management"});Personetics.UI.PWidgetFactory.registerWidget("ratings",{widgetClass:Personetics.UI.PRatingCtrl,widgetName:"Base ratings"});Personetics.UI.PWidgetFactory.registerWidget("story-widget",{widgetClass:Personetics.UI.PStoryWidgetCtrl,widgetName:"Base story widget"});Personetics.UI.PWidgetFactory.registerWidget("loading-animation",{widgetClass:Personetics.UI.PLoadingAnimationCtrl,widgetName:"Base loading"});Personetics.UI.PWidgetFactory.registerWidget("teaser-widget",{widgetClass:Personetics.UI.PTeaserWidgetCtrl,widgetName:"Base teaser widget"});Personetics.UI.PWidgetFactory.registerWidget("teaser-insight-widget",{widgetClass:Personetics.UI.PInsightTeaserWidgetCtrl,widgetName:"Base teaser insight widget"})}});Personetics.story.skinController=Personetics.story.PSkinControler})(window,window.Personetics=window.Personetics||{},jQuery);(function(window,Personetics,$,undefined){Personetics.story=Personetics.story||{};Personetics.story.PDialog=Base.extend({initialize:function(story,config){var dlg=this;this.story=story;this.config=config;this.lang=story.lang;this.id=story.getId()+"_"+this.config.id;this.txts={};this.visible=!1;this.class=this.config.class?this.config.class:"";if(this.config.showIf)
this.showCondExp=new Personetics.processor.PExp(this.config.showIf);this.isShouldShow=null;this.loadTexts(story.texts,story.lang,story.defaultLang);this.initializeBlocks()},loadTexts:function(config,lang,defaultLang){var defaultConfig=this.config.txt||{};var langTexts=config&&config.hasOwnProperty(this.config.id)?config[this.config.id]:null;if(langTexts&&langTexts.hasOwnProperty(defaultLang)){var ar;if(langTexts.hasOwnProperty(lang))
ar=langTexts[lang];else ar=langTexts[defaultLang];$.each(ar,function(textId,textTemplate){defaultConfig[textId]=textTemplate})}
var txts={};var wf=this.story;var dlg=this;if(defaultConfig){$.each(defaultConfig,function(key,txt){var langTxt=txt;if(langTexts){langTxt=langTexts[lang]?langTexts[lang][key]:null;if(!langTxt)
langTxt=langTexts[defaultLang]?langTexts[defaultLang][key]:txt;if(!langTxt)
langTxt=txt}
dlg.txts[key]=langTxt})}
else{Personetics.log("Personetics.story.PDialog.loadTexts: dialog doesn't have any text configuration")}},getId:function(){return this.id},getShortId:function(){return this.config.id},getText:function(txtId){var txt;if(this.txts){var txts=this.txts;if(txts)
txt=txts[txtId]}
return txt},processText:function(txtId,context,parentContext){var pTxt=this.getText(txtId);if(!pTxt)
return"-";if(this.story.mode=="preview")
return pTxt.getTextTemplate();else return pTxt.process(context,parentContext)},shouldShow:function(){if(!this.showCondExp)
return!0;if(this.isShouldShow==null){try{this.isShouldShow=this.showCondExp.eval(this.story.model)}
catch(e){this.isShouldShow=null}}
return this.isShouldShow},generateData:function(){var isFirstDialog=this.isFirstDialog;var data={id:this.getId(),class:this.config.class};if(this.config.isSingleDialogMode){data.btn=[];data.btn.diaogBtn=[];data.btn.showBtn=[];if(this.config.next){data.btn.push({diaogBtn:"Continue",actionBtn:"continue",showBtn:!0})}
else{data.btn.push({diaogBtn:"Close",actionBtn:"close",showBtn:!0})}
if(!isFirstDialog){data.btn.push({diaogBtn:"Previous",actionBtn:"prev",showBtn:!0})}}
return data},render:function(el,isFirstDialog){this.isFirstDialog=isFirstDialog;var shouldShow=this.shouldShow();var isSingleDialogMode=this.config.isSingleDialogMode;if(isSingleDialogMode&&!shouldShow){this.story.renderDialog()}
else{if(shouldShow){var template=this.story.getTemplate("#tmpl-pstory-dialog");if(isSingleDialogMode){template=this.story.getTemplate("#tmpl-pstory-dialog-continue-btn");el.find('.pstory-dialog-frame').hide()}
var data=this.generateData();var html=template(data);var dlgEl=$(html);this.el=dlgEl;el.append(dlgEl)}}},afterRender:function(){var dlg=this;var story=this.story;var dlgEl=this.el;var shouldShow=this.shouldShow();var isSingleDialogMode=this.config.isSingleDialogMode;if(shouldShow){var contentEl=this.el.find('.pstory-dialog-content');if(isSingleDialogMode){if(this.story.parent.scrollTo){this.story.parent.scrollTo(dlgEl.offset().top)}
var dialogButtonsHeight=this.el.find('.pstory-dialog-buttons').height();contentEl.height(contentEl.height()-dialogButtonsHeight)}
if(contentEl.parents('.pstory-dialog-frame').hasClass('horizontal')){this.config.dialogWidth=contentEl.width()}
this.renderBlocks(contentEl);if(contentEl.parents('.pstory-dialog-frame').hasClass('horizontal')){var blocks=contentEl.find('.pstory-block-frame');var width=contentEl.width();var height=0;width/=blocks.length;$.each(blocks,function(i,item){var margin=parseInt($(item).css('margin-left'))+parseInt($(item).css('margin-right'));var itemWidth=width-margin;$(item).width(itemWidth);var itemHeight=$(item).children().first().height();height=itemHeight>height?itemHeight:height});contentEl.height(height)}}},bindEvents:function(){var story=this.story;var shouldShow=this.shouldShow();if(shouldShow){var dlgEl=this.el;var contentEl=this.el.find('.pstory-dialog-content');var dlgClickHandler=story.cfg.dlgClickHandler;if(dlgClickHandler){contentEl.bind("click",function(){dlgClickHandler(this)})}
var continueButtonEl=dlgEl.find(".pstory-dialog-btn");continueButtonEl.bind("click",function(){var opts={};if($(this).data('action')=='prev'){opts.renderPreviousDialog=!0}
else if($(this).data('action')=='close'){story.closeHandler();return}
story.renderDialog(null,opts)})}},initializeBlocks:function(){var dlg=this;var story=this.story;story.blockSessionManager.resetDialog(this.getShortId());this.config.blocks.forEach(function(blockCfg,index){var show=!0;if(blockCfg.showIf){try{var showIfExp=new Personetics.processor.PExp(blockCfg.showIf);show=showIfExp.eval(story.model)}
catch(e){show=!0}}
if(show){blockCfg.index=index;story.blockSessionManager.startBlock(dlg.getShortId(),dlg.txts,blockCfg,index)}})},renderBlocks:function(contentEl){this.story.blockSessionManager.renderBlocks(this.getShortId(),contentEl,this.isFirstDialog)},setIsBlock:function(){if(this.shouldShow()){this.el.addClass("perso-block");$(this.el).find("*").off()}},setVisible:function(visible){if(this.visible==visible)
return;this.visible=visible;var dlg=this;this.story.blockSessionManager.setVisible(this.getShortId,visible)},addBlock:function(block){this.blocks.push(block)}})})(window,window.Personetics=window.Personetics||{},jQuery);(function(window,Personetics,$,undefined){Personetics.story=Personetics.story||{};Personetics.story.PWorkflowCtx=Base.extend({initialize:function(wf,model){this.wf=wf;this.dialogs=[];this.firstDialogId=null},pushDlg:function(dlg){this.dialogs.push(dlg);var isShouldShow=dlg.shouldShow();if(!this.firstDialogId&&isShouldShow)
this.firstDialogId=dlg.getShortId()},getFirstDialogId:function(){return this.firstDialogId},hasDlg:function(dlgId){this.dialogs.forEach(function(dlg,index){if(dlg.getId()==dlgId)
return!0});return!1},getDlg:function(dlgId){var result=null;this.dialogs.forEach(function(dlg,index){if(dlg.getShortId()==dlgId)
result=dlg;return!0});return result},removeDlgsAfter:function(pivotDlgId){if(!pivotDlgId){var after=this.dialogs;this.dialogs=[];return after}
var dlgsBefore=[];var dlgsAfter=[];var before=!0;this.dialogs.forEach(function(dlg,index){if(before)
dlgsBefore.push(dlg);else dlgsAfter.push(dlg);var curDlgId=dlg.getId();if(curDlgId==pivotDlgId)
before=!1});this.dialogs=dlgsBefore;return dlgsAfter}})})(window,window.Personetics=window.Personetics||{},jQuery);(function(window,Personetics,$,undefined){Personetics.story=Personetics.story||{};Personetics.story.PStory=Personetics.story.PCtrlBase.extend({initialize:function(config){this.cfg=config;this.super=Personetics.story.PCtrlBase.prototype;this.super.initialize.call(this,config.parent);this.cfg.chartsLibClass=typeof Highcharts!=='undefined'?"highcharts":null;this.cfg.widthMode="";this.storyDef=config.flowDef||config.storyDefinition;this.id=this.storyDef.storyId;this.insight=config.insight;this.pserver=config.pserver;if(!this.pserver){if(typeof personetics!=='undefined'&&personetics!==null)
this.pserver=personetics.pserverProxy;else this.pserver=null}
var insightFacts=config.data||config.insightFacts;var options={};this.texts=config.texts||config.storyText;this.ctx=new Personetics.story.PWorkflowCtx(this);this.templates={};this.closeHandler=config.closeHandler;this.defaultLang=config.defaultLang||"en";options.lang=config.lang||this.defaultLang;var skinController=config.uxCtrl;if(!skinController)
skinController=new Personetics.story.skinController();this.uxCtrl=skinController;this.desktopScreenWidth=this.uxCtrl.getDesktopScreenWidth();this.screenWidth=$(window).width();if(this.screenWidth>this.desktopScreenWidth){this.cfg.widthMode="desktop"}
this.uxCtrl.registerBlocks();options.useProjectDefaultCurrency=Personetics.projectConfiguration.getConfig("useProjectDefaultCurrency");options.supportHtmlTagInProcessor=Personetics.projectConfiguration.getConfig("supportHtmlTagInProcessor");options.amountFormat=Personetics.projectConfiguration.getConfig("amountFormat");options.dateFormat=Personetics.projectConfiguration.getConfig("dateFormat");options.currencySymbol=Personetics.projectConfiguration.getConfig("currencySymbol");this.options=options;this.expressions=config.expressions;this.blockSessionManager=new Personetics.story.PBlockSessionManager(this);this.model=this.blockSessionManager.getModel();var dlgCfgMap={};this.storyDef.dialogs.forEach(function(cfg){if(dlgCfgMap[cfg.id])
Personetics.log("duplicate dlg found: "+cfg.id);else dlgCfgMap[cfg.id]=cfg});this.dlgCfgMap=dlgCfgMap},getId:function(){return this.id},fireEvent:function(block,e){this.handleEvent(block,e)},start:function(parentEl){this.parentEl=parentEl;var direction=Personetics.processor.PStoryConfig.isRtl()==!0?"rtl":"ltr";var storyData={storyId:this.getId(),langClass:"pstory-lang-"+this.lang,directionClass:"pstory-direction-"+direction,cssClass:this.cfg.cssClass};var html=this.getTemplateHtml("#pstory-frame",storyData);var newEl=$(html);newEl=parentEl.append(newEl);this.frameEl=newEl.find(".pstory-frame");this.el=this.frameEl.find(".pstory-container");var resizedEl=this.el;this.renderTitleText();this.setPlaceHolderForFixedTitle();this.renderDialogs();this.scrollHandler();var contentEl=parentEl},renderDialogs:function(){if(this.cfg.isSingleDialogMode)
this.renderDialog();else this.doNextLoop()},renderTitleText:function(){if(!this.cfg.showTitle)
return;var title=this.getTitle();var subtitle=this.getSubtitle();var iconType=this.cfg.iconType;var pstory_title=this.parentEl.siblings().find('.pstory-title-text');if(pstory_title.length>0){this.parentEl.siblings().find('.pstory-subtitle-text').html(subtitle);this.parentEl.siblings().find('.pstory-title .perso-teaser-image').addClass("perso-"+iconType);this.parentEl.siblings().find('.pstory-title-text').html(title)}
else{var html=this.getTemplateHtml("#tmpl-pstory-title-inside-story",{title:this.getTitle(),backButtonText:'back'});var newEl=$(html);this.el.append(newEl);this.el.find('.pstory-subtitle-text').html(subtitle);this.el.find('.pstory-title .perso-teaser-image').addClass("perso-"+iconType);this.el.find('.pstory-title-text').html(title)}},getTitle:function(){return this.getTitleHelper("title")},getSubtitle:function(){return this.getTitleHelper("subtitle")},getTitleHelper:function(type){var lang=this.options.lang;var defaultLang=this.defaultLang;var titleCfg=this.storyDef[type];if(this.texts.hasOwnProperty(type)&&this.texts[type]){var textTitleCfg=this.texts[type];if(textTitleCfg.hasOwnProperty(lang))
titleCfg=textTitleCfg[lang];else if(textTitleCfg.hasOwnProperty(defaultLang))
titleCfg=textTitleCfg[defaultLang]}
if(!titleCfg)
return null;var titleExp=new Personetics.processor.PTextTemplate(titleCfg.txt,this);var title=titleExp.process(this.model);return title},addTouchScroll:function(){this.frameEl.addClass("pstory-scrolling-touch")},renderDialog:function(startHeight,options){var nextDlg;var flow=this;if(this.current){this.current.setIsBlock();var targetsCfg;if(options&&options.hasOwnProperty("renderPreviousDialog")){var renderPreviousDialog=options.renderPreviousDialog;if(renderPreviousDialog)
targetsCfg=this.findPreviousDialog();else targetsCfg=this.current.config.next}
else{targetsCfg=this.current.config.next}
if(targetsCfg){nextDlg=this.renderNextDlg(targetsCfg,null)}}
else{nextDlg=this.pushDlg(this.storyDef.dialogs[0],null)}
if(!nextDlg){var endHeight=flow.el.height();if(startHeight&&startHeight!=endHeight){if(flow.cfg.resizeHandler)
flow.cfg.resizeHandler(endHeight)}}},findPreviousDialog:function(){var currentDialog=this.current;var dialogsConfig=this.storyDef.dialogs;var res=null;$.each(dialogsConfig,function(index,dialogConfig){var next=dialogConfig.next;if(next){if($.isArray(next)){$.each(next,function(index,nextConfig){if(nextConfig.target==currentDialog.config.id){res={"target":dialogConfig.id};return!1}})}
else{if(next.target==currentDialog.config.id){res={"target":dialogConfig.id};return!1}}}});return res},doNextLoop:function(startHeight){var story=this;var firstNext=this.current;var nextStep=function(){var nextDlg=story.next(nextStep);if(!nextDlg){var endHeight=story.el.height();story.afterLastDialog(endHeight,startHeight)}};nextStep();if(firstNext){var next=firstNext.config.next;if(next){var target;if($.isArray(next)){target=next[0].target}
else{target=next.target}
var id='pdlg-'+story.id+'_'+target;var parent=this.el.parents('.perso-insights-container');this.scrollTo(parent,id);this.setFocus(id)}}},afterLastDialog:function(endHeight,startHeight){var story=this;if(startHeight&&startHeight!=endHeight){if(story.cfg.resizeHandler)
story.cfg.resizeHandler(endHeight,story.el)}
if(story.cfg.onEndHandleEvent){story.cfg.onEndHandleEvent(story.el)}},setPlaceHolderForFixedTitle:function setPlaceForFixedTitle(){var titleEl=$('.pstory-title-wrapper');var height=titleEl.height();if(titleEl.length>0&&titleEl.css('position')=='fixed'){var titleParent=titleEl.parent('.pstory-title-outer-wrapper');titleParent.css('paddingBottom',height+'px')}
var storyFrame=this.el.parents('#story-frame-container');if(storyFrame.length==0){storyFrame=this.el.parents('.pstory-frame')}
var editorFrame=this.el.parents('.pstory-frame');while(editorFrame.height()==0){editorFrame=editorFrame.parent()}
var heightFrame=storyFrame.height()>0?storyFrame.innerHeight():editorFrame.height();storyFrame.height(heightFrame-height)},pushDlg:function(cfg,callback){cfg.isSingleDialogMode=this.cfg.isSingleDialogMode;cfg.widthMode=this.cfg.widthMode;cfg.chartsLibClass=this.cfg.chartsLibClass;var dlg=new Personetics.story.PDialog(this,cfg);this.ctx.pushDlg(dlg);var firstDialogId=this.ctx.getFirstDialogId();var isFirstDialog=firstDialogId==cfg.id;this.current=dlg;var story=this;this.uxCtrl.beforeRender(dlg,function(){dlg.render(story.el,isFirstDialog);dlg.afterRender();dlg.bindEvents();story.uxCtrl.afterRender(dlg,callback)});return dlg},next:function(callback){var nextDlg;if(!this.current)
nextDlg=this.pushDlg(this.storyDef.dialogs[0],callback);var transCfg=this.current.config.next;if(!nextDlg&&transCfg){nextDlg=this.renderNextDlg(transCfg,callback)}
return nextDlg},renderNextDlg:function(transCfg,callback){var trans=transCfg;var isQuiz=!1;for(var i=0;i<this.current.config.blocks.length;i++){if(this.current.config.blocks[i].hasOwnProperty('buttonType')&&this.current.config.blocks[i].hasOwnProperty('class')&&this.current.config.blocks[i].buttonType==="button"&&this.current.config.blocks[i].class==="perso-radio-buttons"){isQuiz=!0;break}}
if(!Array.isArray(transCfg))
trans=[transCfg];if(!isQuiz||(isQuiz&&this.model.getVarValue('selectedAnswer'))){for(var i=0;i<trans.length;i++){var tr=trans[i];var ok=!0;if(tr.cond){var condExp=new Personetics.processor.PExp(tr.cond);try{ok=condExp.eval(this.model)}
catch(e){ok=!1}}
if(ok){if(this.ctx.hasDlg(tr.target))
break;var config=this.dlgCfgMap[tr.target];if(!config){Personetics.utils.PLogger.error("could not find dialog definition for target: "+tr.target)}else{var nextDlg=this.pushDlg(config,callback);break}}}}},handleEvent:function(block){this.el.prevObject.removeClass('pstory-scrolling-touch');var me=this;var startHeight=this.el.height();if(this.cfg.onStartHandleEvent){this.cfg.onStartHandleEvent(startHeight,this.el)}
this.current=null;var dlgId=null;if(block){dlgId=block.dlgId;this.current=this.ctx.getDlg(block.dlgId)}
var after=this.ctx.removeDlgsAfter(this.current.getId());var story=this;after.forEach(function(dlg){if(dlg.el)
dlg.el.remove();$.each(dlg.config.blocks,function(i,block){me.blockSessionManager.resetVariables(block)})});this.blockSessionManager.reset();if(this.cfg.isSingleDialogMode)
this.renderDialog(startHeight);else this.doNextLoop(startHeight);this.el.prevObject.addClass('pstory-scrolling-touch')},handleQueryData:function(data,block){this.blockSessionManager.renderBlock(block.dlgId,block.index,data)},handleScroll:function(scrollTop,scrollBottom){this.ctx.dialogs.forEach(function(dlg,index){var dlgTop=dlg.el.position().top;var dlgBottom=dlgTop+dlg.el.height();var isVisible=!0;if(dlgBottom<=scrollTop||dlgTop>=scrollBottom)
isVisible=!1;dlg.setVisible(isVisible)})},scrollTo:function scrollTo(el,toElementId){},setFocus:function setFocus(elId){},scrollHandler:function(){var story=this;var totalHeight=0;$(this.frameEl).bind("scroll",function(event){var scrollTop=$(this.frameEl).scrollTop();story.blockSessionManager.handleEvent("scroll",scrollTop)})}})})(window,window.Personetics=window.Personetics||{},jQuery);(function(window,Personetics,$,undefined){Personetics.utils=Personetics.utils?Personetics.utils:{};Personetics.utils.accessibility={};Personetics.utils.accessibility.isFocusable=function isFocusable(element){if($(element).is('[aria-hidden="true"], [aria-hidden="true"] *'))
return!1;var hasText=$(element).contents().not($(element).children()).text().trim().length>0;if($(element).is(":input, [role], [aria-label], [aria-labelledby]")||hasText)
return!0;return!1};Personetics.utils.accessibility.firstChildFocusable=function firstChildFocusable(element){if(typeof element=='undefind'||element==null||element.length==0){return!1}
var me=this;var elementChildren=element.find('*');var result=!1;$.each(elementChildren,function(i,elem){result=me.isFocusable(elem);if(result==!0){result=elem;return!1}});return result};Personetics.utils.accessibility.trackFocus=function trackFocus(element){if(typeof element==="undefined"||element.length===0){return}
var usingMouse;var el=element.get(0);var preFocus=function(event){usingMouse=(event.type==='mousedown')};var addFocus=function(event){if(usingMouse){var className=event.target.getAttribute("class");event.target.setAttribute("class",className+' personetics-mouse-focus')}};var removeFocus=function(event){var className=event.target.getAttribute("class");if(className!==null){className=className.replace(/ personetics-mouse-focus/g,'');event.target.setAttribute("class",className)}};var bindEvents=function(){el.removeEventListener('keydown',preFocus);el.removeEventListener('mousedown',preFocus);el.removeEventListener('focusin',addFocus);el.removeEventListener('focusout',removeFocus);el.addEventListener('keydown',preFocus);el.addEventListener('mousedown',preFocus);el.addEventListener('focusin',addFocus);el.addEventListener('focusout',removeFocus)};bindEvents()}})(window,window.Personetics=window.Personetics||{},jQuery);(function(window,Personetics,$,undefined){Personetics.utils=Personetics.utils?Personetics.utils:{};var allAccountsAnimation=function allAccountsAnimation(){var animationMap={};var isValidate=function isValidate(animationObj){var isValid=!1;if(typeof animationObj.type==='undefined'||animationObj.type===null){Personetics.error("Required property 'type' is missing")}
else if(typeof animationObj.doAnimation==='undefined'||animationObj.doAnimation===null){Personetics.error("Required property 'doAnimation' is missing")}
else if(typeof animationObj.cancelAnimation==='undefined'||animationObj.cancelAnimation===null){Personetics.error("Required property 'cancelAnimation' is missing")}
else isValid=!0;return isValid}
function addAnimation(animationObj){if(isValidate(animationObj)){animationMap[animationObj.type]={doAnimation:animationObj.doAnimation,cancelAnimation:animationObj.cancelAnimation}}}
var getAnimation=function getAnimation(type){if(animationMap.hasOwnProperty(type)){return animationMap[type]}
else Personetics.error("All accounts animation doesn't support this type: "+type)}
function init(){addAnimation({type:'heapCards',doAnimation:function allAccountsAnimation_heapCards(selectedCard,cards,params){var cardsLength=cards.length;var totalHeight=params.cardsStackTotalHeight||$(cards).height()/5;var maxSpaceBetweenCards=params.maxSpaceBetweenCards||10;var topSpacing=Math.min(maxSpaceBetweenCards,totalHeight/cardsLength);var realTotalHeight=cardsLength*topSpacing;var topValue=(totalHeight-realTotalHeight)/2;$(selectedCard).css('top',topValue+'px');$(selectedCard).css('zIndex',cardsLength+1);$.each(cards,function(index,card){var selectedCardLeft=$(selectedCard).offset().left;var offsetLeft=$(card).offset().left;var left=parseInt($(card).css('left'));var setLeftValue=selectedCardLeft-offsetLeft+left;$(card).css({'left':setLeftValue+'px','top':((index+1)*topSpacing+topValue)+'px','zIndex':cardsLength-index})});if(params.showBoxShadowForLastCardOnly){cards.last().addClass('pstory-boxshadow-card')}
else cards.add(selectedCard).addClass('pstory-boxshadow-card');if(params.scale){$(selectedCard).css({'transform':'scalex(1)'});$.each(cards,function(index,card){var scaleX=1-(index+1)*params.scale;$(card).css({'transform':'scalex('+scaleX+')'})})}},cancelAnimation:function(cards){cards.css({'left':'','top':''})}});addAnimation({type:'fadingSlidingOut',doAnimation:function allAccountsAnimation_fadingOut(selectedCard,cards,params){var container=params.container||selectedCard.parents('.options-container');$.each(cards.add(selectedCard),function(index,card){var offsetLeft=$(card).offset().left-container.offset().left;var left=parseInt($(card).css('left'));var setLeftValue=$('.options-container').width()-offsetLeft+left;$(card).css('left',setLeftValue+'px')})},cancelAnimation:function(cards){cards.css({'left':''})}})}
init();this.addAnimation=addAnimation;this.getAnimation=getAnimation};Personetics.utils.allAccountsAnimation=new allAccountsAnimation()})(window,window.Personetics=window.Personetics||{},jQuery);(function(window,Personetics,$,undefined){Personetics.utils=Personetics.utils?Personetics.utils:{};Personetics.utils.buttonAnimation={};Personetics.utils.buttonAnimation.bindMaterialButtonEventsForAnimation=function bindMaterialButtonEventsForAnimation(elements){var rplObj,x,y,ink,color,rplDelTimer;$(elements).bind("click",function(e){$('.ink').siblings().one("click",function(e){e.stopPropagation()});$(e.currentTarget).find('.ink').siblings().click()});$(elements).bind("touchend",function(){$('.ink').css({'opacity':'0'});delRipple()});function delRipple(){rplDelTimer=setTimeout(function(){$('.ink').remove()},800)}
$(elements).bind("touchstart",function(e){x=e.originalEvent.touches[0].pageX;y=e.originalEvent.touches[0].pageY;rplObj=$(this);color=$(this).css('color');rippleClosed()})
function rippleClosed(){rplObj.prepend('<span class="ink"></span>');ink=rplObj.find('.ink');ink.css('background',color);if(!ink.height()&&!ink.width()){d=Math.max(rplObj.outerWidth(),rplObj.outerHeight());ink.css({height:d,width:d})}
x=x-rplObj.offset().left-ink.width()/2;y=y-rplObj.offset().top-ink.height()/2;ink.css({top:y+'px',left:x+'px'}).css({'transform':'scale(1.8)'});clearTimeout(rplDelTimer)}
function rippleOpen(){rplObj.prepend('<span class="ink"></span>');ink=rplObj.find('.ink');ink.css('background',color);if(!ink.height()&&!ink.width()){d=Math.max(rplObj.outerWidth(),rplObj.outerHeight());ink.css({height:d,width:d})}
x=rplObj.offset();y=rplObj.offset();ink.css({top:y+'px',left:x+'px'}).css({'transform':'scale(1.8)'});clearTimeout(rplDelTimer)}}})(window,window.Personetics=window.Personetics||{},jQuery);(function(window,Personetics,$,undefined){Personetics.utils=Personetics.utils?Personetics.utils:{};Personetics.utils.carouselAnimation={};Personetics.utils.carouselAnimation.bindCarouselEventsForAnimation=function bindCarouselEventsForAnimation(elementWrapper,param){var innerWrapper;var carouselItems;var carouselItemsBase;var config={};var keyCode={"Space":32,"Enter":13,"LeftArrow":37,"RightArrow":39,"UpArrow":38,"DownArrow":40};init();function init(){innerWrapper=$(elementWrapper).find('.carousel-inner-wrapper');carouselItemsBase=innerWrapper.find('.carousel-item');innerWrapper.attr('num-original-cards',carouselItemsBase.length);if(typeof param=='undefined'){param={}}
if(typeof param.itemWidth!='undefined'){config.itemWidth=param.itemWidth}
if(typeof param.selectedItemWidth!='undefined'){config.selectedItemWidth=param.selectedItemWidth}
if(typeof param.numItemsDispaly=='undefined'){param.numItemsDispaly=3}
if(carouselItemsBase.length>1){var copyData=carouselItemsBase.clone(!0);copyData.attr('clone','true');var copyData2=copyData.clone(!0);innerWrapper.prepend($(copyData));innerWrapper.append($(copyData2).slice(0,2))}
carouselItems=innerWrapper.find('.carousel-item');setConfig(config.itemWidth,config.selectedItemWidth);this.dotAnimation=new Personetics.utils.DotAnimation.bindDotEventsForAnimation(elementWrapper,carouselItemsBase,param);this.dotAnimation.setSelectedDot();setNumItemsToDispaly(param.numItemsDispaly);bindEvents();caruselAccessibility()};function setConfig(itemWidth,selectedItemWidth){if(typeof itemWidth=='undefined'){itemWidth=carouselItemsBase.filter(':not(.selected)').outerWidth(!0)}
if(typeof selectedItemWidth=='undefined'){selectedItemWidth=carouselItemsBase.filter('.selected').outerWidth(!0)}
config.itemWidth=itemWidth;config.selectedItemWidth=selectedItemWidth;var left=0;var left2=0;var selectedIndex=-1;$.each(carouselItemsBase,function(index,item){if($(item).hasClass('selected')){selectedIndex=index}});if(selectedIndex==-1){selectedIndex=0;var pstoryId=carouselItemsBase.first().attr("pstory-id");carouselItems.filter("[pstory-id='"+pstoryId+"']").addClass('selected')}
var carouselItemsBaseLength=carouselItemsBase.length;if(carouselItemsBaseLength>1){left-=itemWidth*(carouselItemsBaseLength-1);left-=selectedItemWidth}
left2=(elementWrapper.width()-selectedItemWidth)/2;left+=left2;var left3=left-(itemWidth*selectedIndex);config.minLeft=left;innerWrapper.css({'transition-duration':'0s','-webkit-transition-duration':'0s'});innerWrapper.css({'left':left3+'px'})};function setNumItemsToDispaly(numItemsDispaly){if(typeof numItemsDispaly=='number'){config.numItemsDispaly=numItemsDispaly;if(numItemsDispaly>carouselItemsBase.length){carouselItems.filter("[clone='true']").addClass('carousel-hide-clone')}
else{carouselItems.removeClass('carousel-hide-clone')}}}
function bindEvents(){if(param.onClick!==!1){carouselItems.bind('click',function(e){if($(elementWrapper).hasClass('carousel-disable')==!1){startCarousel(e)}});$("#personetics-teaser-widget-carousel").bind('keydown',function(e){if(e.target===document.activeElement){if([keyCode.RightArrow].indexOf(e.which)!==-1){onSwipe('right')}
if([keyCode.LeftArrow].indexOf(e.which)!==-1){onSwipe('left')}
if([keyCode.Enter].indexOf(e.which)!==-1){$(this).find(".account-button.selected").click()}}})}
if(param.onSwipe!==!1){$(elementWrapper).swipe(function(e){if($(elementWrapper).hasClass('carousel-disable')==!1){onSwipe(e)}},{preventDefault:!1})}};function startCarousel(e){if(typeof param.beforeCarouselStart=='function'){param.beforeCarouselStart(e)}
doAnimation(e,param.animateDuration);if(param.showIndexDots)
this.dotAnimation.updateIndex(e)};function onSwipe(e){if($(elementWrapper).hasClass('carousel-disable')||this.disableInputSelect){if(param&&param.onAnimationEnd){param.onAnimationEnd()}
return}
if(e=='left'||e=='right'){var carouselItemsLength=carouselItems.length;var indexSelected=carouselItemsBase.filter('.selected').index();var direction=e=='left'?1:-1;indexSelected+=direction;if(indexSelected==carouselItemsLength){indexSelected=0}
if(indexSelected<0){indexSelected=carouselItemsLength-1}
if(carouselItemsBase.length<config.numItemsDispaly&&$(carouselItems[indexSelected]).attr('clone')=='true'){config.swipeDirection=null;if(param&&param.onAnimationEnd){param.onAnimationEnd()}
return}
config.swipeDirection=direction*-1;var event={};event.swipeDirection=e;event.currentTarget=carouselItems[indexSelected];startCarousel(event)}};function caruselAccessibility(){var selectedShow=carouselItems.filter(".selected:not([clone='true'])");selectedShow.siblings().attr("aria-hidden",!0);selectedShow.attr("aria-hidden",!0);selectedShow.prev().addClass("prev");selectedShow.next().addClass("next");selectedShow.prev().addClass("prev");selectedShow.next().addClass("next");carouselItems.removeAttr("aria-label");if(typeof param.text!="undefined"){if(typeof param.text.next!="undefined")
selectedShow.next().attr("aria-label",param.text.next);if(typeof param.text.prev!="undefined")
selectedShow.prev().attr("aria-label",param.text.prev)}};function setAccessibilityFocus(waitTime){var selectedShow=param&&param.isDesktop?null:$(".pstory-account-button.selected");if(selectedShow&&selectedShow.length<1){carouselItems.filter(".selected:not([clone='true'])")}
var focusInterval=10+waitTime;var focusTotalRepetitions=10;if(selectedShow){selectedShow.attr('tabindex','0');selectedShow.blur()}
var focusRepetitions=0;var interval=window.setTimeout(function(){if(selectedShow){selectedShow.focus()}
if(param&&param.onAnimationEnd){param.onAnimationEnd()}},focusInterval)};function doAnimation(e,animateDuration){var target=e.currentTarget;if($(target).hasClass('selected')||config.disableInputSelect==!0){return}
var direction=config.swipeDirection;if(direction==null){direction=$(target).hasClass("prev")?1:-1}
config.disableInputSelect=!0;carouselItems.removeClass('selected');carouselItems.removeClass('prev');carouselItems.removeClass('next');var targetId=$(target).attr('pstory-id');carouselItems.filter('[pstory-id="'+targetId+'"]').addClass('selected');if(typeof animateDuration!='number'){animateDuration=300}
var carouselItemsBaseLength=carouselItemsBase.length;var minLeft=config.minLeft;var maxLeft=minLeft-(config.itemWidth*(carouselItemsBaseLength-1)+config.selectedItemWidth);var oldLeft=0;oldLeft=parseFloat(innerWrapper.css('left'));var newLeft=config.itemWidth*direction+oldLeft;var diff=config.selectedItemWidth-config.itemWidth;var selectedIndex=$(target).index();var prev=innerWrapper.find('.carousel-item:lt('+selectedIndex+')');var numSelect=prev.filter('.selected').length;if(numSelect>1){newLeft=newLeft-diff}
else if(numSelect==0){newLeft=newLeft+diff}
setTimeout(function(){innerWrapper.css({'transition-duration':'0s','-webkit-transition-duration':'0s'});if(Math.abs(newLeft)>=Math.abs(maxLeft)-diff){innerWrapper.css({'left':minLeft+'px'})}
else if(Math.abs(newLeft)<Math.abs(minLeft)-diff){maxLeft=maxLeft+config.itemWidth+diff;innerWrapper.css({'left':maxLeft+'px'})}
config.disableInputSelect=!1;if(typeof param.afterCarouselEnd=='function'){param.afterCarouselEnd()}},animateDuration);innerWrapper.css({'transition-duration':animateDuration+'ms','-webkit-transition-duration':animateDuration+'ms'});innerWrapper.css({'left':newLeft+'px'});config.swipeDirection=null;caruselAccessibility();setAccessibilityFocus(animateDuration)};this.startCarousel=startCarousel;this.setConfig=setConfig;this.setNumItemsToDispaly=setNumItemsToDispaly;this.onSwipe=onSwipe}})(window,window.Personetics=window.Personetics||{},jQuery);(function(window,Personetics,$,undefined){Personetics.utils=Personetics.utils?Personetics.utils:{};Personetics.utils.DotAnimation={};Personetics.utils.DotAnimation.bindDotEventsForAnimation=function bindDotEventsForAnimation(elementWrapper,options,params){this.elementWrapper=elementWrapper;this.params=params;this.setSelectedDot=function setSelectedDot(){var selectedIndex=0;$.each(options,function(index,item){if($(item).hasClass('selected')){selectedIndex=index}});if(params.showIndexDots){var indexDots=this.elementWrapper.find('.carousel-index-wrapper .carousel-index-dot');if(params.firstDot){$(indexDots[0]).addClass('pstory-selected-index');$.each(indexDots,function(index,item){var temp=index;$(item).attr('pstory-id',$(options[temp]).attr('pstory-id'))})}
else{var itemsNum=options.length;var middle=Math.ceil(itemsNum/2)-1;var diff=middle-selectedIndex;if(diff<0)
diff=itemsNum+diff;var index=0;for(var i=0;i<options.length;i++){if($(options[i]).hasClass("selected")){index=i;break}}
$(indexDots[index]).addClass('pstory-selected-index');$.each(indexDots,function(index,item){var temp=index;$(item).attr('pstory-id',$(options[temp]).attr('pstory-id'))})}}};this.updateIndex=function updateIndex(e){var target=e.currentTarget;var id=$(target).attr('pstory-id');var dotsWrapper=this.elementWrapper.find('.carousel-index-wrapper');var indexDots=dotsWrapper.find('.carousel-index-dot');if(this.params&&this.params.updateDotsForAccessibility){this.params.updateDotsForAccessibility(dotsWrapper,id)}
indexDots.removeClass('pstory-selected-index');indexDots.filter('[pstory-id="'+id+'"]').addClass('pstory-selected-index')}}})(window,window.Personetics=window.Personetics||{},jQuery);(function(window,Personetics,undefined){Personetics.utils=Personetics.utils?Personetics.utils:{};Personetics.utils.assert={};Personetics.utils.assert.isUndefined=function isUndefined(obj){return typeof obj==='undefined'};Personetics.utils.assert.isNullOrUndefined=function isNullOrUndefined(obj){return typeof obj==='undefined'||obj==null};Personetics.utils.assert.isTrue=function isTrue(obj){var result=!Personetics.utils.assert.isUndefined(obj);return result&&obj==!0};Personetics.utils.assert.isDefined=function isDefined(obj,nullable){var result=!Personetics.utils.assert.isUndefined(obj);if(result&&!Personetics.utils.assert.isUndefined(nullable)&&nullable!=null){if(!nullable)
result=obj!=null}
return result};Personetics.utils.assert.AssertIsDefined=function AssertIsDefined(obj,errorMessage){if(Personetics.utils.assert.isNullOrUndefined(obj))
{if(errorMessage)
Personetics.utils.PLogger.error(errorMessage,errorMessage);else Personetics.utils.PLogger.error("Object is undefined","Object is undefined")}};Personetics.utils.assert.assignDefaultValue=function assignDefaultValue(variable,defaultValueToSet){var result=null;if(Personetics.utils.assert.isUndefined(variable))
result=defaultValueToSet;else result=variable;return result};Personetics.utils.assert.isObject=function isObject(obj)
{return typeof obj==='object'};Personetics.utils.assert.isString=function isString(obj)
{return typeof obj==='string'};Personetics.utils.assert.isArray=function isArray(obj)
{return Object.prototype.toString.call(obj)==='[object Array]'};Personetics.utils.assert.isFunction=function isFunction(obj)
{return typeof obj==='function'};Personetics.utils.assert.exists=function(first,namespace){var tokens=namespace.split('.');var obj=first;for(var i=1;i<tokens.length;i++){obj=(obj=="undefined")?obj:obj[tokens[i]]}
return obj};Personetics.utils.assert.AssertIsNullOrUndefined=function(obj,message){}})(window,window.Personetics=window.Personetics||{});(function(window,Personetics,$,undefined){Personetics.utils=Personetics.utils||{};Personetics.utils.d3Extensions={};var persoHelper=Personetics.utils.persoHelper;Personetics.utils.d3Extensions.html=function(value){if(typeof value!="string"){return}
else{var rootSpan=$('<span>').html(value).first().children()[0];if(typeof rootSpan=='undefined'){this.text(value)}
else{var tspan=this.append('tspan');var attrs=rootSpan.attributes;$.each(attrs,function(j,attr){tspan.attr(attr.name,attr.value)});var valueChildren=$(rootSpan).children();$.each(valueChildren,function(i,node){var innerTspan=tspan.append('tspan').text($(node).text());var attrs=node.attributes;$.each(attrs,function(j,attr){innerTspan.attr(attr.name,attr.value)})})}}};d3.selection.prototype.html=Personetics.utils.d3Extensions.html;Personetics.utils.d3Extensions.text=function text(value){return arguments.length?this.each(typeof value==="function"?function(){var v=value.apply(this,arguments);v=$(v).length>0?$(v)[0].innerText:v;this.textContent=v==null?"":v}:value==null?function(){this.textContent=""}:function(){this.textContent=$(value).length>0?$(value)[0].innerText:value}):this.textContent};if(typeof persoHelper!=='undefined'&&(persoHelper.isOldAndroidVersion())){d3.selection.prototype.text=Personetics.utils.d3Extensions.text}})(window,window.Personetics=window.Personetics||{},jQuery);(function(window,Personetics,undefined){var monthNumbers=[1,2,3,4,5,6,7,8,9,10,11,12];var monthNames={"en-short":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"en":["January","February","March","April","May","June","July","August","September","October","November","December"],"he":["ינואר","פברואר","מרץ","אפריל","מאי","יוני","יולי","אוגוסט","ספטמבר","אוקטובר","נובמבר","דצמבר"],"he-short":["ינו'","פבר'","מרץ","אפר'","מאי","יונ'","יול'","אוג'","ספט'","אוק'","נוב'","דצמ'"],"fr":["Janvier","Février","Mars","Avril","Mai","Juin","Juillet","Août","Septembre","Octobre","Novembre","Décembre"],"fr-short":["Jan","Fév","Mar","Avr","Mai","Jun","Jul","Aoû","Sep","Oct","Nov","Déc"],"es":["enero","febrero","marzo","abril","mayo","junio","julio","agosto","septiembre","octubre","noviembre","diciembre"],"es-short":["Ene","Feb","Mar","Abr","May","Jun","Jul","Ago","Sep","Oct","Nov","Dic"],};Personetics.utils=Personetics.utils?Personetics.utils:{};Personetics.utils.date={};Personetics.utils.date.monthName=function monthName(dateStr,lang,short){if(!(parseInt(dateStr)==dateStr)){var d=new Date(dateStr);var month=d.getMonth();if(month!=undefined&&month!=null&&!isNaN(month)){month=d.getMonth()}}
else{try{var dn=parseInt(dateStr);if(dn>=1&&dn<=12){month=dn-1}
else{return dateStr}}catch(e){return dateStr}}
if(short==!0)
lang=lang+"-short";var names=monthNames[lang];if(!names){if(short==!0)
names=monthNames["en-short"];else names=monthNames.en}
return names[month]};Personetics.utils.date.dayNumber=function dayNumber(dateStr,dayFormat){var result=dateStr;var date=new Date(dateStr);var day=date.getDate();if(!isNaN(day))
result=date.getDate();if(dayFormat&&dayFormat=="DD"){if(result<10)
result="0"+result}
return result};Personetics.utils.date.monthNumber=function monthNumber(dateStr){if(!(parseInt(dateStr)==dateStr)){var d=new Date(dateStr);var month=d.getMonth();if(month!=undefined&&month!=null&&!isNaN(month)){month=d.getMonth()}}
else{try{var dn=parseInt(dateStr);if(dn>=1&&dn<=12){month=dn-1}
else{return dateStr}}catch(e){return dateStr}}
var monthNum=monthNumbers[month];var result=monthNum;if(monthNum<10)
result="0"+result;return result};Personetics.utils.date.yearNumber=function yearNumber(dateStr,isShort){var result="";var d=new Date(dateStr);var fullYear=d.getFullYear().toString();if(isShort){result=fullYear.substring(2)}
else result=fullYear;return result};Personetics.utils.date.nthDate=function nthDate(dateStr,lang){dateStr=dateStr.toLowerCase();var shortKey=lang+"-short";for(var i=0;i<monthNames[shortKey].length;i++){if(dateStr.indexOf(monthNames[shortKey][i].toLowerCase())!==-1){break}}
var dayNumber=dateStr.replace(monthNames[shortKey][i].toLowerCase(),"");var month=monthNames[lang][i];function nth(d){if(d>3&&d<21)return'th';switch(d%10){case 1:return"st";case 2:return"nd";case 3:return"rd";default:return"th"}}
var isnum=/^\d+$/.test(dayNumber);if(!isnum){return month}
dayNumber=parseInt(dayNumber,10);var result=month+" "+dayNumber+nth(dayNumber);return result}})(window,window.Personetics=window.Personetics||{});(function(window,Personetics,$,undefined){Personetics.utils=Personetics.utils?Personetics.utils:{};Personetics.utils.dictionary={};Personetics.utils.dictionary.overrideObjectProperties=function(original,override,overrideDefinedVals)
{Personetics.utils.assert.assignDefaultValue(overrideDefinedVals,!0);var originalCopy=$.extend({},!0,original);if(Personetics.utils.assert.isNullOrUndefined(override))
return originalCopy;if(Personetics.utils.assert.isNullOrUndefined(originalCopy))
return override;$.each(override,function(key,value){if(!originalCopy.hasOwnProperty(key)||originalCopy[key]==null||overrideDefinedVals)
originalCopy[key]=value});return originalCopy};Personetics.utils.dictionary.hasItem=function hasItem(obj,key,nullable)
{var hasItem=Personetics.utils.assert.isObject(obj)&&Personetics.utils.string.isValidString(key)&&obj.hasOwnProperty(key);return nullable?hasItem:hasItem&&obj[key]!=null};Personetics.utils.dictionary.exists=function exists(obj)
{var args=Array.prototype.slice.call(arguments,1);for(var i=0;i<args.length;i++){if(!obj||!obj.hasOwnProperty(args[i])){return!1}
obj=obj[args[i]]}
return!0};Personetics.utils.dictionary.removeInvalids=function removeInvalids(obj)
{var result={};if(typeof obj!=='undefined'&&obj)
{$.each(obj,function(key,value){if(value!=null)
{if(Personetics.utils.assert.isObject(value)&&!Personetics.utils.assert.isArray(value))
result[key]=Personetics.utils.dictionary.removeInvalids(value);else result[key]=value}})}
return result}})(window,window.Personetics=window.Personetics||{},jQuery);(function(window,Personetics,$,undefined){Personetics.utils=Personetics.utils?Personetics.utils:{};Personetics.utils.encodeDecode={};Personetics.utils.encodeDecode.Base64={codex:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encode:function(input){var output=new Personetics.utils.string.StringBuffer();var enumerator=new Personetics.utils.encodeDecode.Utf8EncodeEnumerator(input);while(enumerator.moveNext()){var chr1=enumerator.current;enumerator.moveNext();var chr2=enumerator.current;enumerator.moveNext();var chr3=enumerator.current;var enc1=chr1>>2;var enc2=((chr1&3)<<4)|(chr2>>4);var enc3=((chr2&15)<<2)|(chr3>>6);var enc4=chr3&63;if(isNaN(chr2)){enc3=enc4=64}else if(isNaN(chr3)){enc4=64}
output.append(this.codex.charAt(enc1)+this.codex.charAt(enc2)+this.codex.charAt(enc3)+this.codex.charAt(enc4))}
return output.toString()},decode:function(input){var output=new Personetics.utils.string.StringBuffer();var enumerator=new Personetics.utils.encodeDecode.Base64DecodeEnumerator(input);while(enumerator.moveNext()){var charCode=enumerator.current;if(charCode<128)
output.append(String.fromCharCode(charCode));else if((charCode>191)&&(charCode<224)){enumerator.moveNext();var charCode2=enumerator.current;output.append(String.fromCharCode(((charCode&31)<<6)|(charCode2&63)))}else{enumerator.moveNext();var charCode2=enumerator.current;enumerator.moveNext();var charCode3=enumerator.current;output.append(String.fromCharCode(((charCode&15)<<12)|((charCode2&63)<<6)|(charCode3&63)))}}
return output.toString()}};Personetics.utils.encodeDecode.Utf8EncodeEnumerator=function Utf8EncodeEnumerator(input){this._input=input;this._index=-1;this._buffer=[];this.current=Number.NaN;this.moveNext=function(){if(this._buffer.length>0){this.current=this._buffer.shift();return!0}else if(this._index>=(this._input.length-1)){this.current=Number.NaN;return!1}else{var charCode=this._input.charCodeAt(++this._index);if((charCode==13)&&(this._input.charCodeAt(this._index+1)==10)){charCode=10;this._index+=2}
if(charCode<128){this.current=charCode}else if((charCode>127)&&(charCode<2048)){this.current=(charCode>>6)|192;this._buffer.push((charCode&63)|128)}else{this.current=(charCode>>12)|224;this._buffer.push(((charCode>>6)&63)|128);this._buffer.push((charCode&63)|128)}
return!0}}};Personetics.utils.encodeDecode.Base64DecodeEnumerator=function Base64DecodeEnumerator(input){this._input=input;this._index=-1;this._buffer=[];this.current=64;this.moveNext=function(){if(this._buffer.length>0){this.current=this._buffer.shift();return!0}else if(this._index>=(this._input.length-1)){this.current=64;return!1}else{var enc1=Personetics.utils.encodeDecode.Base64.codex.indexOf(this._input.charAt(++this._index));var enc2=Personetics.utils.encodeDecode.Base64.codex.indexOf(this._input.charAt(++this._index));var enc3=Personetics.utils.encodeDecode.Base64.codex.indexOf(this._input.charAt(++this._index));var enc4=Personetics.utils.encodeDecode.Base64.codex.indexOf(this._input.charAt(++this._index));var chr1=(enc1<<2)|(enc2>>4);var chr2=((enc2&15)<<4)|(enc3>>2);var chr3=((enc3&3)<<6)|enc4;this.current=chr1;if(enc3!=64)
this._buffer.push(chr2);if(enc4!=64)
this._buffer.push(chr3);return!0}}}})(window,window.Personetics=window.Personetics||{},jQuery);(function(window,Personetics,$,undefined){Personetics.utils=Personetics.utils?Personetics.utils:{};Personetics.utils.PEvent=Base.extend({initialize:function(){this.eventMessage={"type":"sendEvents","eventInfo":{},"checkInPastEvent":!0}},setParam:function(paramName,paramValue){this.eventMessage.eventInfo.params[paramName]=paramValue},getJsonMessageEvent:function(){return JSON.stringify(this.eventMessage)},onSuccessCallback:function(){},onErrorCallback:function(){}})})(window,window.Personetics=window.Personetics||{},jQuery);(function(window,Personetics,$,undefined){Personetics.utils=Personetics.utils?Personetics.utils:{};Personetics.utils.PEventsBuffer=function(){this.sendEventsTypesMapping={"account-selector":"AccountSelector","bar-chart":"BarChart","pie-chart":"PieChart","tabs":"Button","buttons":"Button","Navigation":"NavigateButton"}
this.pastEvents=[];this.eventToSend=[];this.eventDelayInterval=Personetics.projectConfiguration.getConfig("eventDelayInterval");this.start=function(){var me=this;this.intervalId=setInterval(function(){me.sendEvents()},this.eventDelayInterval)};this.stop=function(){if(this.intervalId)
clearInterval(this.intervalId)};this.addEventToSend=function(event,success_callback,error_callback){var shouldAddEvent=this.shouldSendEvent(event);if(shouldAddEvent==!0){this.eventToSend.push({eventData:event,onSuccessCallback:success_callback,onErrorCallback:error_callback});if(event.eventMessage.eventInfo.type==="Navigation")
{this.sendEvents()}}};this.sendEvents=function(){var me=this;var didSendEvents=!1;var requestMsg={};var eventsInfoList=[];if(this.eventToSend.length)
{requestMsg.type=this.eventToSend[0].eventData.eventMessage.type;requestMsg.ctxId="dashboard";requestMsg.lang=Personetics.processor.PStoryConfig.getConfig("lang");requestMsg.protocolVersion=this.eventToSend[0].eventData.eventMessage.protocolVersion}
$.each(this.eventToSend,function(key,pevent){if(typeof me.sendEventsTypesMapping[pevent.eventData.eventMessage.eventInfo.type]!=="undefined")
{pevent.eventData.eventMessage.eventInfo.type=me.sendEventsTypesMapping[pevent.eventData.eventMessage.eventInfo.type]}
eventsInfoList.push(pevent.eventData.eventMessage.eventInfo);me.pastEvents.push(pevent)});if(eventsInfoList.length){didSendEvents=!0;requestMsg.eventsInfoList=eventsInfoList;personetics.pserverProxy.notifyEvent(requestMsg,this.onSuccess,this.onError)}
if(didSendEvents==!0){this.eventToSend=[]}};this.onSuccess=function()
{};this.onError=function()
{};this.shouldSendEvent=function(pevent){var shouldSendEvent=!0;var currentEventInfo=JSON.stringify(pevent.eventMessage.eventInfo);if(pevent.eventMessage.checkInPastEvent==!0){$.each(this.pastEvents,function(key,aPastEvent){var pastEventInfo=aPastEvent.eventData.eventMessage.eventInfo;if(JSON.stringify(pastEventInfo)===currentEventInfo){shouldSendEvent=!1;return!1}})}
if(shouldSendEvent==!1)
return shouldSendEvent;$.each(this.eventToSend,function(key,anEventToSend){var pastEventInfo=anEventToSend.eventData.eventMessage.eventInfo;if(JSON.stringify(pastEventInfo)===JSON.stringify(currentEventInfo)){shouldSendEvent=!1;return!1}});return shouldSendEvent};this.onEventSendSuccess=function(){};this.onEventSendError=function(){Personetics.log("Error on sending events to PServer....")}}})(window,window.Personetics=window.Personetics||{},jQuery);(function(window,Personetics,$,undefined){Personetics.utils=Personetics.utils?Personetics.utils:{};Personetics.utils.PEventOptInOut=Personetics.utils.PEvent.extend({initialize:function(){this.eventMessage={"type":"sendEvents","eventInfo":{"type":"opt-in","params":{}},"checkInPastEvent":!1}},setOptInParam:function(isOptIn){var mode="in";if(isOptIn==!0)
mode="in";else mode="out";this.eventMessage.eventInfo.params.isOptIn=mode},setSentTime:function(){this.eventMessage.eventInfo.params.timestamp=new Date()},getJsonMessageEvent:function(){return JSON.stringify(this.eventMessage)},onSuccessCallback:function(){},onErrorCallback:function(){}})})(window,window.Personetics=window.Personetics||{},jQuery);(function(window,Personetics,$,undefined){Personetics.utils=Personetics.utils?Personetics.utils:{};var pEventReporting=Personetics.utils.PEvent.extend({initialize:function(){this.params={"eventType":"sendEvents","checkInPastEvent":"false","protocolVersion":Personetics.projectConfiguration.getConfig("protocolVersion"),"userId":"","type":"","value":"","insightId":"","instanceId":""}},setValue:function(parameters){var me=this;$.each(parameters,function(key,value){if(me.params.hasOwnProperty(key)&&value!='undefined'&&value!=null){me.params[key]=value}})},createMessage:function(){var params=this.params;var eventMessage={"type":params.eventType,"userId":params.userId,"checkInPastEvent":params.checkInPastEvent,"protocolVersion":params.protocolVersion,"eventInfo":{"type":params.type,"eventDateTime":new Date(),"params":{"value":params.value,"insightId":params.insightId,"instanceId":params.instanceId}},}
return eventMessage},notifyEvent:function(){var pevent={eventMessage:this.createMessage()}
personetics.notifyEvent(pevent)},});Personetics.utils.PEventReporting=new pEventReporting()})(window,window.Personetics=window.Personetics||{},jQuery);(function(window,Personetics,$,undefined){Personetics.utils=Personetics.utils?Personetics.utils:{};Personetics.utils.json={};var JSON=window.JSON||{};window.JSON=JSON;JSON.stringify=JSON.stringify||function(obj){var t=typeof(obj);if(t!="object"||obj===null){if(t=="string")
obj='"'+obj+'"';return String(obj)}else{var n,v,json=[],arr=(obj&&obj.constructor==Array);for(n in obj){if(obj.hasOwnProperty(n)){v=obj[n];t=typeof(v);if(t=="string")
v='"'+v+'"';else if(t=="object"&&v!==null)
v=JSON.stringify(v);json.push((arr?"":'"'+n+'":')+String(v))}}
return(arr?"[":"{")+String(json)+(arr?"]":"}")}};Personetics.utils.json.getJsonStringifyMethod=function getJsonStringifyMethod(){if($.toJSON){return $.toJSON}
else{return JSON.stringify}};Personetics.utils.json.toJSON=function toJSON(value){var _json_stringify=Personetics.utils.json.getJsonStringifyMethod();if(typeof Prototype!=='undefined'&&typeof Array.prototype.toJSON!=='undefined'){var _array_tojson=Array.prototype.toJSON;delete Array.prototype.toJSON;var r=_json_stringify(value);Array.prototype.toJSON=_array_tojson;return r}
else return _json_stringify(value)};Personetics.utils.json.replacer=function replacer(match,pIndent,pKey,pVal,pEnd){var key='<span class=json-key>';var val='<span class=json-value>';var str='<span class=json-string>';var r=pIndent||'';if(pKey)
r=r+key+pKey.replace(/[": ]/g,'')+'</span>: ';if(pVal)
r=r+(pVal[0]=='"'?str:val)+pVal+'</span>';return r+(pEnd||'')};Personetics.utils.json.prettyPrint=function prettyPrint(obj){var jsonLine=/^( *)("[\w.+-]+": )?("[^"]*"|[\w.+-]*)?([,[{])?$/mg;return JSON.stringify(obj,null,3).replace(/&/g,'&amp;').replace(/\\"/g,'&quot;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(jsonLine,Personetics.utils.json.replacer)};Personetics.utils.json.mergeString=function merge(firstjsonString,secondJsonString){var json1=JSON.parse(firstjsonString);var json2=JSON.parse(secondJsonString);var result=Personetics.utils.json.mergeObject(json1,json2);var objectString=Personetics.utils.json.toJSON(result);return objectString}
Personetics.utils.json.mergeObject=function merge(firstjson,secondJson){var mergedJson=$.extend({},firstjson,secondJson);return mergedJson};Personetics.utils.json.mergeDeepObject=function merge(firstjson,secondJson){var mergedJson=$.extend(!0,{},firstjson,secondJson);return mergedJson}})(window,window.Personetics=window.Personetics||{},jQuery);(function(window,Personetics,undefined){Personetics.utils=Personetics.utils||{};Personetics.PLoggerModes={VERBOSE:{name:"VERBOSE",value:1},DEBUG:{name:"DEBUG",value:2},ALERT:{name:"ALERT",value:3},ERROR:{name:"ERROR",value:4},PRODUCTION:{name:"PRODUCTION",value:5}};var logger=function logger(){this.mode=Personetics.PLoggerModes.ERROR.value};logger.prototype.setDebugMode=function setDebugMode(mode){if(typeof mode!=='undefined'&&mode!==null&&mode.hasOwnProperty("name")&&Personetics.PLoggerModes.hasOwnProperty(mode.name))
this.mode=mode.value};logger.prototype.verbose=function verbose(msg){if(this.mode<=Personetics.PLoggerModes.VERBOSE.value)
console.log(msg)};logger.prototype.debug=function debug(msg){if(this.mode<=Personetics.PLoggerModes.DEBUG.value)
console.log(msg)};logger.prototype.error=function(msg,exception,options){if(this.mode<=Personetics.PLoggerModes.ERROR.value){var shouldDisplayError=typeof options!=="undefined"&&options.hasOwnProperty("shouldDisplayError")&&typeof options.shouldDisplayError!=="undefined"?options.shouldDisplayError:!0;if(shouldDisplayError){var context=Personetics.processor.PStoryConfig.getConfig("context");if(context){throwExceptionToServer(msg)}else{console.error("<< ERROR >>: "+msg)}}
if(Personetics.utils.assert.isDefined(exception,!1))
throw exception}};logger.prototype.alert=function(msg){if(this.mode<=Personetics.PLoggerModes.ALERT.value)
alert(msg)};var throwExceptionToServer=function(msg){var context=Personetics.processor.PStoryConfig.getConfig("context").toLowerCase();var func=this[Personetics.processor.PStoryConfig.getConfig("serverCallBack")];if(context==='server'){if(typeof func==='function'){func(msg)}else{throw msg}}else{if(typeof func==='function'){func('Error - invalid value for key "context", it should be "SERVER"'+' \nProcessor error - '+msg)}else{throw('Error - invalid value for key "context", it should be "SERVER"'+' \nProcessor error - '+msg)}}};Personetics.utils.PLogger=new logger();Personetics.verbose=Personetics.utils.PLogger.verbose.bind(Personetics.utils.PLogger);Personetics.log=Personetics.utils.PLogger.debug.bind(Personetics.utils.PLogger);Personetics.debug=Personetics.utils.PLogger.debug.bind(Personetics.utils.PLogger);Personetics.error=Personetics.utils.PLogger.error.bind(Personetics.utils.PLogger);Personetics.alert=Personetics.utils.PLogger.alert.bind(Personetics.utils.PLogger)})(window,window.Personetics=window.Personetics||{});(function(window,Personetics,$,undefined){Personetics.utils=Personetics.utils?Personetics.utils:{};Personetics.utils.messages={};Personetics.utils.messages.errorMessage=function errorMessage(params){var errorMsgTemplate=Personetics.UI.Handlebars.templates[params?params.templateId?params.templateId:'error-msg':'error-msg'];if(typeof personetics!=='undefined'&&personetics!==null&&personetics.hasOwnProperty("getDeviceType")){var deviceType=personetics.getDeviceType()||"web"}
var html;if(deviceType==='web'){html=errorMsgTemplate({textLarge:params.textLarge,textSmall:params.textSmall,imgClass:params.imgClass})}
else{html=errorMsgTemplate({textLarge:params.textLarge,textSmall:params.textSmall,imgClass:params.imgClass,isMobileDevice:!0})}
return html};Personetics.utils.messages.noInsightsMessage=function noInsightsMessage(params){var errorMsgTemplate=Personetics.UI.Handlebars.templates[params?params.templateId?params.templateId:'no-insights-message':'no-insights-message'];if(typeof personetics!=='undefined'&&personetics!==null&&personetics.hasOwnProperty("getDeviceType")){var deviceType=personetics.getDeviceType()||"web"}
var html;if(deviceType==='web'){html=errorMsgTemplate({textLarge:params.textLarge,textSmall:params.textSmall,imgClass:params.imgClass})}
else{html=errorMsgTemplate({textLarge:params.textLarge,textSmall:params.textSmall,imgClass:params.imgClass,isMobileDevice:!0})}
return html};Personetics.utils.messages.noFilteredInsightsMessage=function noFilteredInsightsMessage(params){var noFileredMsgTemplate=Personetics.UI.Handlebars.templates[params?params.templateId?params.templateId:'no-filtered-insights-msg':'no-filtered-insights-msg'];if(typeof personetics!=='undefined'&&personetics!==null&&personetics.hasOwnProperty("getDeviceType")){var deviceType=personetics.getDeviceType()||"web"}
var html;if(deviceType==='web'){html=noFileredMsgTemplate({text:params.text})}
else{html=noFileredMsgTemplate({text:params.text,isMobileDevice:!0})}
return html}})(window,window.Personetics=window.Personetics||{},jQuery);(function(window,Personetics,$,undefined){Personetics.utils=Personetics.utils?Personetics.utils:{};Personetics.utils.network={};Personetics.utils.network.consts={base64EncodeResponse:!1,requestTimeoutInMillis:300000,dataType:"json",async:!0,onComplete:function(){},onSuccess:function(data,textStatus,jqXHR){Personetics.log("request success")},onFailure:function(jqXHR,textStatus,errorThrown){Personetics.log("request failed: "+textStatus+", "+errorThrown)}};Personetics.utils.network.doAjaxGet=function doAjaxGet(url,data,requestOptions){var finalRequestOptions=Personetics.utils.dictionary.overrideObjectProperties(requestOptions,Personetics.utils.network.consts,!1);Personetics.utils.assert.AssertIsDefined(url,"Personetics.utils.network.doAjaxGet: invalid request URL: "+url);var config={type:"GET",url:url,dataType:finalRequestOptions.dataType,async:finalRequestOptions.async,timeout:finalRequestOptions.requestTimeoutInMillis,complete:finalRequestOptions.onComplete,success:onDoAjaxGetSuccess,error:onDoAjaxGetError};if(!Personetics.utils.assert.isNullOrUndefined(data))
config.data=data;$.ajax(config);function onDoAjaxGetSuccess(response){var processedResponse=response;if(finalRequestOptions.base64EncodeResponse==!0){processedResponse=Personetics.utils.network.decodeDataWithBase64(response);processedResponse=$.parseJSON(processedResponse)}
finalRequestOptions.onSuccess(processedResponse)}
function onDoAjaxGetError(XMLHttpRequest,textStatus,errorThrown){finalRequestOptions.onFailure(XMLHttpRequest,textStatus,errorThrown)}};Personetics.utils.network.doAjaxPost=function doAjaxPost(url,postData,requestOptions){var finalRequestOptions=Personetics.utils.dictionary.overrideObjectProperties(requestOptions,Personetics.utils.network.consts,!1);Personetics.utils.assert.AssertIsNullOrUndefined(url,"Personetics.utils.network.doAjaxPost: invalid request URL: "+url);$.ajax({type:"POST",url:url,data:postData,dataType:finalRequestOptions.dataType,async:finalRequestOptions.async,headers:finalRequestOptions.headers,timeout:finalRequestOptions.requestTimeoutInMillis,complete:finalRequestOptions.onComplete,success:onDoAjaxPostSuccess,error:onDoAjaxPostError});function onDoAjaxPostSuccess(response){var processedResponse=response;if(finalRequestOptions.base64EncodeResponse==!0){processedResponse=Personetics.utils.network.decodeDataWithBase64(response);processedResponse=$.parseJSON(processedResponse)}
finalRequestOptions.onSuccess(processedResponse)}
function onDoAjaxPostError(XMLHttpRequest,textStatus,errorThrown){finalRequestOptions.onFailure(XMLHttpRequest,textStatus,errorThrown)}};Personetics.utils.network.queueAjaxPost=function queueAjaxPost(queueId,url,postData,requestOptions){var finalRequestOptions=Personetics.utils.dictionary.overrideObjectProperties(requestOptions,Personetics.utils.network.consts,!1);return $.ajaxq(queueId,{type:"POST",url:url,data:postData,dataType:finalRequestOptions.dataType,timeout:finalRequestOptions.requestTimeoutInMillis,success:onDoAjaxQueuePostSuccess,error:onDoAjaxQueuePostError});function onDoAjaxQueuePostSuccess(response){var processedResponse=response;if(finalRequestOptions.base64EncodeResponse==!0){processedResponse=Personetics.utils.network.decodeDataWithBase64(response);processedResponse=$.parseJSON(processedResponse)}
finalRequestOptions.onSuccess(processedResponse)}
function onDoAjaxQueuePostError(XMLHttpRequest,textStatus,errorThrown){finalRequestOptions.onFailure(XMLHttpRequest,textStatus,errorThrown)}};Personetics.utils.network.removeAjaxPostQueue=function(queueId){$.ajaxq(queueId)};Personetics.utils.network.wasUserAborted=function wasUserAborted(xhr,textStatus){return!xhr.getAllResponseHeaders()&&textStatus!='timeout'};Personetics.utils.network.createPostform=function createPostform(params,absoluteUrl,newDoc,win,pageInfo){newDoc.charset="utf-8";var formId="hintForm";var form=newDoc.createElement("form");form.setAttribute("id",formId);form.setAttribute("method","post");form.setAttribute("action",absoluteUrl);for(var i in params){if(params.hasOwnProperty(i)){var input=newDoc.createElement('input');input.type='hidden';input.name=i;input.value=params[i];form.appendChild(input)}}
newDoc.body.appendChild(form);form.submit();newDoc.body.removeChild(form)}
Personetics.utils.network.decodeDataWithBase64=function(data){data=data.replace(/(\r\n|\n|\r)/gm,"");data=data.replace(/"/g,'');var decodedData=Personetics.utils.encodeDecode.Base64.decode(data);return decodedData}})(window,window.Personetics=window.Personetics||{},jQuery);(function(window,Personetics,undefined){Personetics.utils=Personetics.utils?Personetics.utils:{};Personetics.utils.persoHelper={};Personetics.utils.persoHelper.constants={ANDROID_VERSIONS:{OLD_VERSION_MIN_TARGET:4.4,OLD_VERSION_MAX_TARGET:5.0}}
Personetics.utils.persoHelper.getAndroidVersionNumber=function getAndroidVersionNumber(){var androidVersionNumber;var androidVersionString=getAndroidVersion();if(androidVersionString){androidVersionNumber=parseFloat(getAndroidVersion())}
return androidVersionNumber};Personetics.utils.persoHelper.isOldAndroidVersion=function isOldAndriodVersion(){var androidVersion=this.getAndroidVersionNumber();var isOldAndroidVersion=!1;if(typeof androidVersion!=='undefined'&&androidVersion>0){if(androidVersion<this.constants.ANDROID_VERSIONS.OLD_VERSION_MAX_TARGET&&androidVersion>=this.constants.ANDROID_VERSIONS.OLD_VERSION_MIN_TARGET){isOldAndroidVersion=!0}}
return isOldAndroidVersion};var getAndroidVersion=function getAndroidVersion(){var userAgent=navigator.userAgent.toLowerCase();var match=userAgent.match(/android\s([0-9\.]*)/);return match?match[1]:!1}})(window,window.Personetics=window.Personetics||{});(function(window,Personetics,$,undefined){Personetics.utils=Personetics.utils?Personetics.utils:{};Personetics.utils.print={};Personetics.utils.print.printHtmlToPdf=function printHtmlToPdf(config){var pdf=new jsPDF('p','pt','a4');pdf.addFont('Roboto');pdf.setFont('Roboto');var element=config.parent;if(!config.page||!config.page.el){var children=config.parent.getElementsByTagName("*");config.beforeExportCallback&&config.beforeExportCallback(children);pdf.internal.scaleFactor=config.internalScaleFactor;addHtml(element,pdf,config)}else{var elemFromHtml=config.page.el;var children=config.parent.getElementsByTagName("*");config.beforeExportCallback&&config.beforeExportCallback(children);html2canvas(elemFromHtml,{allowTaint:!1,useCORS:!0,}).then(function(canvas){pdf.internal.scaleFactor=config.page.internalScaleFactor;var newCanvas=copyCanvas(canvas,elemFromHtml.clientWidth,elemFromHtml.clientHeight);config.parent.appendChild(newCanvas);var x=config.x?config.x:0;var y=config.y?config.y:0;pdf.addHTML(newCanvas,x,y,{pagesplit:!0,allowTaint:!1,useCORS:!0},function(){if(newCanvas.parentElement){config.parent.removeChild(newCanvas)}
elemFromHtml.parentNode.removeChild(elemFromHtml);pdf.addPage();pdf.internal.scaleFactor=config.internalScaleFactor;addHtml(element,pdf,config)})})}}
function addHtml(element,pdf,config){var newCanvas=createCanvas({width:element.clientWidth,height:element.clientHeight,totalHeight:config.height});var x=config.x?config.x:0;var y=config.y?config.y:0;pdf.addHTML(element,x,y,{pagesplit:!0,canvas:newCanvas},function(){if(newCanvas.parentElement){config.parent.removeChild(newCanvas)}
pdf.save(config.fileName+config.format);config.callback&&config.callback()})}
Personetics.utils.print.printHtmlToPdfWithLoop=function printHtmlToPdf(config){var pdf=new jsPDF('p','pt','a4');var element=config.parent;if(!config.page||!config.page.html){pdf.internal.scaleFactor=3.75;var frame=config.parent.getElementsByClassName("pstory-dialog-content");var newCanvas=createCanvas({width:element.clientWidth,height:element.clientHeight,totalHeight:config.height});pdf.addHTML(frame[0],{pagesplit:!0,canvas:newCanvas},function(){if(newCanvas.parentElement){config.parent.removeChild(newCanvas)}
loopElements(pdf,frame,1,config)})}else{pdf.internal.scaleFactor=2.5;var elemFromHtml=document.createElement("div");elemFromHtml.innerHTML=config.page.html;var newElement=elemFromHtml.firstChild;newElement.style.width=config.page.width;config.parent.appendChild(newElement);var children=newElement.getElementsByTagName("*");for(var i=0;i<children.length;i++){if(window.getComputedStyle(children[i],null).getPropertyValue("background-image")!=="none"){children[i].style.backgroundImage="none"}}
html2canvas(newElement,{allowTaint:!1,useCORS:!0,}).then(function(canvas){pdf.internal.scaleFactor=1;var newCanvas=copyCanvas(canvas,newElement.clientWidth,newElement.clientHeight);config.parent.appendChild(newCanvas);pdf.addHTML(newCanvas,0,0,{pagesplit:!0,allowTaint:!1,useCORS:!0},function(){if(newCanvas.parentElement){config.parent.removeChild(newCanvas)}
newElement.parentNode.removeChild(newElement);pdf.addPage();pdf.internal.scaleFactor=3.75;var canvas=createCanvas({width:element.clientWidth,height:element.clientHeight,totalHeight:config.height});pdf.addHTML(element,{pagesplit:!0,canvas:canvas},function(){pdf.save(config.fileName+config.format);config.callback&&config.callback()})})})}}
function createCanvas(options){var canvas=document.createElement('canvas');canvas.width=options.width*3;canvas.height=options.totalHeight*3;canvas.style.width=options.width+'px';canvas.style.height=options.height+'px';var context=canvas.getContext('2d');context.scale(3,3);context.fillStyle="rgba(255, 255, 255, 1)";context.fillRect(0,0,canvas.width,canvas.height);return canvas}
function updateCanvas(canvas,options){canvas.width=options.width*3;canvas.height=options.totalHeight*3;canvas.style.width=options.width+'px';canvas.style.height=options.height+'px';var context=canvas.getContext('2d');context.scale(3,3);context.fillStyle="rgba(255, 255, 255, 1)";context.fillRect(0,0,canvas.width,canvas.height)}
function copyCanvas(canvas,width,height){var newCanvas=document.createElement('canvas');newCanvas.width=width*3;newCanvas.height=height*3;newCanvas.style.width=width+'px';newCanvas.style.height=height+'px';var destCtx=newCanvas.getContext('2d');destCtx.scale(3,3);destCtx.fillStyle="rgba(255, 255, 255, 1)";destCtx.fillRect(0,0,newCanvas.width,newCanvas.height);destCtx.drawImage(canvas,0,0);return newCanvas}
function loopElements(pdf,elemnts,index,config){if(index==elemnts.length){pdf.save(config.fileName+config.format);config.callback&&config.callback();return}
pdf.addPage();html2canvas(elemnts[index],{allowTaint:!1,useCORS:!0,}).then(function(canvas){pdf.internal.scaleFactor=1;var newCanvas=copyCanvas(canvas,elemnts[index].clientWidth,elemnts[index].clientHeight);config.parent.appendChild(newCanvas);pdf.addHTML(newCanvas,0,0,{pagesplit:!0,allowTaint:!1,useCORS:!0},function(){if(newCanvas.parentElement){config.parent.removeChild(newCanvas)}
loopElements(pdf,elemnts,index+1,config)})})}})(window,window.Personetics=window.Personetics||{},jQuery);(function(window,Personetics,$,undefined){Personetics.utils=Personetics.utils?Personetics.utils:{};Personetics.utils.scope={};Personetics.utils.scope.bind=function bind(scope,fn){return function(){return fn.apply(scope,arguments)}};Personetics.bind=Personetics.utils.scope.bind;Personetics.utils.scope.Callback=function Callback(f,parameters){this.parameters=parameters;this.f=f;var me=this;this.invoke=function(){me.f.apply(me,me.parameters)}}})(window,window.Personetics=window.Personetics||{},jQuery);(function(window,Personetics,$,undefined){Personetics.utils=Personetics.utils?Personetics.utils:{};Personetics.utils.string={};Personetics.utils.string.isString=function isString(str){return typeof str==='string'};Personetics.utils.string.isEmpty=function isString(str){return Personetics.utils.string.isString(str)&&str.length==0};Personetics.utils.string.isValidString=function isValidString(str){return Personetics.utils.assert.isString(str)&&str!=null&&str.length>0};Personetics.utils.string.truncateLongWords=function truncateLongWords(setnece,maxWordLength){if(typeof setnece!=='undefined'&&setnece&&setnece.length>0&&setnece.replace(/ /g,'').length>0){var words=setnece.split(' ');var processedWords=[];$.each(words,function(i,word){if(word.length>maxWordLength){processedWords.push(word.substring(0,maxWordLength-6)+'...')}
else{processedWords.push(word)}});return processedWords.join(' ')}
else{return""}};Personetics.utils.string.stripTags=function stripTags(input){var tagsToReplace=["script"];var result=input;if(typeof input!=='undefined'&&input!=null&&input.length>0){$.each(tagsToReplace,function(i,tagToReplace){var tagRegex=new RegExp("<"+tagsToReplace+".*>.*</"+tagToReplace+">","ig");result=result.replace(tagRegex,"")})}
return result};Personetics.utils.string.replaceNewLine=function replaceNewLine(element){if(!element)
return element;var typeOf=typeof(element);if(typeOf=='string'){var regex=new RegExp("^<([A-Z][A-Z0-9]*)[^>]*>(.*?)</\\1>$","gim");var res=regex.exec(element.replace(/\n/g,""));if(res){element=element.replace(/\n/g,"")}
else{element=element.replace(/\n/g,"<br />")}}else if(typeOf=='object')
$.each(element,function(key,value){if(!value)
return;if(typeof(key)=='string'&&key.toLowerCase().indexOf('speaking')!=-1)
return;var typeOfValue=typeof(value);element[key]=Personetics.utils.string.replaceNewLine(value)});return element};Personetics.utils.string.StringBuffer=function StringBuffer(){this.buffer=[];this.append=function append(string){this.buffer.push(string);return this};this.toString=function toString(){return this.buffer.join("")}};Personetics.utils.string.decodeHTMLSpecialCharecters=function decodeHTMLSpecialCharecters(input){var decodedString=input.replace("&amp;","&");return decodedString};Personetics.utils.string.stripSpecialChars=function stripSpecialChars(val){return val.replace(/[^a-z0-9\s]/gi,'').replace(/[_\s]/g,'-')};Personetics.utils.string.removeClass=function removeClass(className,clazz){var _classname=className;if(typeof className==='object')
_classname=_classname.animVal;_classname=_classname.replace(new RegExp('(?:^|\\s)'+clazz+'(?:\\s|$)'),' ');return _classname};Personetics.utils.string.addClass=function addClass(className,clazz){className=Personetics.utils.string.removeClass(className,clazz);var _classname=className;if(typeof className==='object')
_classname=_classname.animVal;_classname+=" "+clazz;return _classname}})(window,window.Personetics=window.Personetics||{},jQuery);(function(window,Personetics,$,undefined){Personetics.utils=Personetics.utils?Personetics.utils:{};Personetics.utils.url={};Personetics.utils.url.getParameterByName=function getParameterByName(name){name=name.replace(/[\[]/,"\\\[").replace(/[\]]/,"\\\]");var regex=new RegExp("[\\?&]"+name+"=([^&#]*)"),results=regex.exec(location.search);return results==null?null:decodeURIComponent(results[1].replace(/\+/g," "))};Personetics.utils.url.getAbsoluteUrl=function getAbsoluteUrl(localurl){if(/^(https?|file|ftps?|mailto|javascript|data:image\/[^;]{2,9};):/i.test(localurl))
return localurl;var href=window.location.href;var pathArray=href.split('/');var newPathname="";for(var i=0;i<pathArray.length-1;i++){if(i!=0)
newPathname+="/";newPathname+=pathArray[i]}
return newPathname+'/'+localurl};Personetics.utils.url.openTabWithPost=function openTabWithPost(localUrl,windowoption,params){var absoluteUrl=Personetics.utils.url.getAbsoluteUrl(localUrl);var newWin=window.open("","_blank");newWin.opener=null;newWin.focus();var newDoc=newWin.document;Personetics.utils.network.createPostform(name,params,absoluteUrl,newDoc)};Personetics.utils.url.iframeWithPost=function iframeWithPost(url,name,params){var form=document.createElement("form");form.setAttribute("method","post");form.setAttribute("action",url);form.setAttribute("target",name);for(var i in params){if(params.hasOwnProperty(i)){var input=document.createElement('input');input.type='hidden';input.name=i;input.value=params[i];form.appendChild(input)}}
document.body.appendChild(form);form.submit();document.body.removeChild(form)};Personetics.utils.url.urlCheck=function urlCheck(s){var regexp=/(ftp|http|https):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?/
return regexp.test(s)};Personetics.utils.url.encodePostParams=function encodePostParams(parameterObject){var postParamObject={};$.each(parameterObject,Personetics.bind(this,function(key,value){if(key.indexOf("64")>=0){var paramsJson=Personetics.utils.json.toJSON(parameterObject[key]);var str64=Personetics.utils.encodeDecode.Base64.encode(paramsJson);parameterObject[key]=str64}}));return parameterObject}})(window,window.Personetics=window.Personetics||{},jQuery);(function(window,Personetics,$,undefined){Personetics.story=Personetics.story||{};Personetics.story.PWebAnalytics=Base.extend({reportWidgetActive:function(options){},reportWidgetLoaded:function(options){},reportOverlayLoaded:function(options){},reportRatingsSent:function(options){}})})(window,window.Personetics=window.Personetics||{},jQuery);(function(window,Personetics,$,undefined){Personetics.utils=Personetics.utils||{};Personetics.utils.d3Extensions={};var persoHelper=Personetics.utils.persoHelper;Personetics.utils.d3Extensions.html=function(value){if(typeof value!="string"){return}
else{var rootSpan=$('<span>').html(value).first().children()[0];if(typeof rootSpan=='undefined'){return this.text(value)}
else{var tspan=this.append('tspan');var attrs=rootSpan.attributes;$.each(attrs,function(j,attr){tspan.attr(attr.name,attr.value)});var valueChildren=$(rootSpan).children();$.each(valueChildren,function(i,node){var innerTspan=tspan.append('tspan').text($(node).text());var attrs=node.attributes;$.each(attrs,function(j,attr){innerTspan.attr(attr.name,attr.value)})});return this}}};d3.selection.prototype.html=Personetics.utils.d3Extensions.html;Personetics.utils.d3Extensions.text=function text(value){return arguments.length?this.each(typeof value==="function"?function(){var v=value.apply(this,arguments);v=$(v).length>0?$(v)[0].innerText:v;this.textContent=v==null?"":v}:value==null?function(){this.textContent=""}:function(){this.textContent=$(value).length>0?$(value)[0].innerText:value}):this.textContent};if(typeof persoHelper!=='undefined'&&(persoHelper.isOldAndroidVersion())){d3.selection.prototype.text=Personetics.utils.d3Extensions.text}})(window,window.Personetics=window.Personetics||{},jQuery);(function(window,Personetics,$,undefined){Personetics.story=Personetics.story||{};Personetics.story.PStoryPreview=Personetics.story.PStory.extend({initialize:function(config){this.super=Personetics.story.PStory.prototype;this.super.initialize.call(this,config);this.previewDialogId=config.dialogId;this.previewBlockIndex=config.blockIndex;this.mode=config.mode},renderDialogs:function(){var me=this;var dialogsConfig=this.storyDef.dialogs;var previewDialogConfig=null;$.each(dialogsConfig,function(index,dialogConfig){if(dialogConfig.id==me.previewDialogId){previewDialogConfig=dialogConfig;return!1}});if(previewDialogConfig){this.pushDlg(previewDialogConfig,Personetics.bind(this,this.highlightBlock))}},fireEvent:function(block,e){},highlightBlock:function(){var dlgEl=this.frameEl.find(".pstory-dialog-frame");var blockEl=dlgEl.find('.pstory-block-frame').eq(this.previewBlockIndex);blockEl.addClass("pstory-preview-block")}})})(window,window.Personetics=window.Personetics||{},jQuery);(function(window,Personetics,$,undefined){Personetics.story=Personetics.story||{};Personetics.story.AccountSelectorBlockProduct=Personetics.story.AccountSelectorBlock.extend({beforeRender:function(el,layoutInstructions){Personetics.story.AccountSelectorBlock.prototype.beforeRender.call(this,el,layoutInstructions);var options=$.extend(!0,[],layoutInstructions.options);var optAllIndex;var me=this;this.showHeaderTabs=!1;this.defaultTab='choose-account';$.each(options,function(index,opt){if(opt.id=='all'){optAllIndex=index;me.showHeaderTabs=!0;me.all=$.extend(!0,{},(opt));if(opt.selected)
me.defaultTab='all';return!1}});if(typeof optAllIndex!=='undefined'){options.splice(optAllIndex,1)}
options.cardsLength=options.length;this.options=options;if(this.story.cfg.widthMode==='desktop'){this.config=this.story.uxCtrl.getAccountSelectorConfigDesktop();this.isDesktopMode=!0}
else{this.config=this.story.uxCtrl.getAccountSelectorConfig();this.isDesktopMode=!1}
this.showArrows=this.config.showArrows&&this.options.cardsLength>=this.config.minAccountsForDisplayingArrows},render:function(el,layoutInstructions){this.el=el;var text=this.getAccountSelectorText();this.setImageValueForOptions();var param={options:this.options,class:layoutInstructions.class,showHeaderTabs:this.showHeaderTabs,headersArray:this.getHeadersArray(),showIndexDots:this.config.showIndexDots,isDesktopMode:this.isDesktopMode};param=$.extend(param,text);var html=this.template(param);el.append(html);this.frameEl=el.find(".pstory-block-frame").last()},getHeadersArray:function getHeadersArray(){var result=[{text:Personetics.dictionary.getText("lblaccSelectAll"),isAll:!0},{text:Personetics.dictionary.getText("lblaccSelectChoose"),isAll:!1}];return result},getAccountSelectorText:function getAccountSelectorText(){var text={allAccountsTxt:this.all?this.all.text:"",next:Personetics.dictionary.getText("lblaccSelectNextAcc"),prev:Personetics.dictionary.getText("lblaccSelectPreviousAcc"),allAccountsName:Personetics.dictionary.getText("lblaccSelectAll"),numberPref:Personetics.dictionary.getText("lblaccSelectAccount"),numberPrefAccessibility:Personetics.dictionary.getText("lblaccSelectAccountAccessibility"),accountSelectorText:Personetics.dictionary.getText("lblAccessibiliotyAccountSelectorText"),}
return text},setImageValueForOptions:function setImageValueForOptions(){$.each(this.options,function(i,opt){var urlObj=Personetics.imageMap.getImageClass(opt.image,"account_selector");opt.isAbsoluteURL=urlObj.isAbsoluteURL;opt.image=urlObj.url})},bindEvents:function bindEvents(){Personetics.story.OptionsBlock.prototype.bindEvents.call(this);var block=this;this.frameEl.find(".pstory-header-button").bind("click",Personetics.bind(this,this.optionHeaderClickEvent));this.frameEl.find('.pstory-prev-account-button').bind('click',function(e){var selected=block.frameEl.find(".pstory-button.selected:not([clone='true'])");if(selected.parents('.carousel-disable').length>0){return}
if(block.showArrows&&block.config.nextArrowDir=="ltr")
selected.next().click();else selected.prev().click()});this.frameEl.find('.pstory-next-account-button').bind('click',function(e){var selected=block.frameEl.find(".pstory-button.selected:not([clone='true'])");if(selected.parents('.carousel-disable').length>0){return}
if(block.showArrows&&block.config.nextArrowDir=="ltr")
selected.prev().click();else selected.next().click()})},onInputSelect:function onInputSelect(e){},optionClickEvent:function optionClickEvent(e){},getReportValue:function(target){return"Switch"},optionHeaderClickEvent:function optionHeaderClickEvent(e){var target=$(e.currentTarget);var allAccounts=target.data('all');if(this.frameEl.find(".options-container").hasClass("allAccounts")==allAccounts){this.setFocusOnRelevantElement(allAccounts);return}
this.headerTabsAnimation(target);if(allAccounts){this.onAllAccountsClick(!0)}
else{this.onChooseAccountClick(target)}
this.updateAccessibilityButtons(allAccounts);this.setFocusOnRelevantElement(allAccounts);this.frameEl.find(".pstory-header-button").attr('aria-selected','false');target.attr('aria-selected','true');this.notifyReportHeaderEvent(allAccounts)},setFocusOnRelevantElement:function setFocusOnRelevantElement(isAllAccountsState){var focusedElement;if(isAllAccountsState){focusedElement=this.frameEl.find(".pstory-all-accounts-txt")}
else{focusedElement=this.frameEl.find(".pstory-account-button.selected")}
this.putFocusAccessibility(focusedElement)},notifyReportHeaderEvent:function notifyReportHeaderEvent(allAccounts){var params={};params.type=this.layoutInstructions.type;if(allAccounts){params.value="All"}
else{params.value="Specific"}
this.notifyReportEvent(params)},headerTabsAnimation:function headerTabsAnimation(selected){if(typeof selected==="undefined"||selected===null||selected.length==0)
return;var tabAnimatedBorder=$(this.frameEl).find(".pstory-tab-animated-border-bottom");var left=selected.offset().left-this.frameEl.offset().left;var width=selected.innerWidth();tabAnimatedBorder.css({"left":left+'px',width:width+'px'})},onAllAccountsClick:function onAllAccountsClick(doAnimation){this.frameEl.find('.options-container').addClass('allAccounts');this.frameEl.find('.options-container').addClass('carousel-disable');this.frameEl.find('.options-container').addClass('on-animation');this.carouselAnimation.setConfig();this.allAccountsSelectedAnimation(doAnimation);this.parent.notifyEvent(this,"setSelectedValue",this.all);this.frameEl.find('.pstory-all-accounts-txt').removeAttr("aria-hidden")},onChooseAccountClick:function onChooseAccountClick(target){this.chooseAccountSelectedAnimation();this.frameEl.find('.options-container').removeClass('allAccounts');this.frameEl.find('.options-container').removeClass('carousel-disable');this.carouselAnimation.setConfig();var selected=this.frameEl.find('.pstory-button.selected:not([clone="true"])');selected.prev().addClass("prev");selected.next().addClass("next");var selectedOpt=this.getOptionById(selected.attr('pstory-id'));this.parent.notifyEvent(this,"setSelectedValue",selectedOpt);this.frameEl.find('.pstory-all-accounts-txt').attr("aria-hidden",!0)},setAccessibility:function setAccessibility(isAllAccountsMode){if(this.options.cardsLength==1){var prevNextAccountButtons=this.frameEl.find(".pstory-prev-account-button, .pstory-next-account-button");prevNextAccountButtons.css('display','none');prevNextAccountButtons.attr('aria-hidden',!0);this.setAccSelectedButtonAriaLabel()}
else this.updateAccessibilityButtons(isAllAccountsMode)},updateAccessibilityButtons:function updateAccessibilityButtons(isAllAccountsMode,selectedCard){var accountButtons=this.frameEl.find(".pstory-account-button");if(isAllAccountsMode)
accountButtons.attr('aria-hidden',!0);else{accountButtons.attr('aria-hidden',!1);var accPrevAccount=accountButtons.filter('.pstory-prev-account-button');var accNextAccount=accountButtons.filter('.pstory-next-account-button');if(accNextAccount.hasClass('pstory-disable'))
accNextAccount.attr('aria-hidden',!0);else accPrevAccount.attr('aria-hidden',!0);this.setAccSelectedButtonAriaLabel(selectedCard)}},setAccSelectedButtonAriaLabel:function setAccSelectedButtonAriaLabel(selectedCard){if(typeof selectedCard==='undefined'||selectedCard===null)
selectedCard=this.frameEl.find('.pstory-button.selected:not([clone="true"])');var selectedOpt=this.getOptionById(selectedCard.attr('pstory-id'));var cards=this.frameEl.find('.pstory-button:not([clone="true"])')
var index=cards.index(selectedCard)+1;index=index==0?1:index;var text=$('<span>'+selectedOpt.text+'</span>');if(text.find('br').length>0){text.find('br').replaceWith(' ')}
this.frameEl.find(".pstory-account-button.selected .perso-accessibility-read").attr('aria-label',''+selectedOpt.name+'. '+Personetics.dictionary.getText("lblaccSelectAccountAccessibility")+': '+selectedOpt.number+'. '+text.text()+'. '+index+' '+Personetics.dictionary.getText("accessibilityOutOfTxt")+' '+cards.length+'. '+Personetics.dictionary.getText("accessibilitySelected")).attr("id","perso-accessibility-read-"+selectedOpt.id)},putFocusAccessibility:function putFocusAccessibility(elementForFocus){var focusInterval=10;var focusTotalRepetitions=10;elementForFocus.attr('tabindex','0');elementForFocus.blur();var focusRepetitions=0;var interval=window.setTimeout(function(){elementForFocus.focus()},focusInterval)},allAccountsSelectedAnimation:function allAccountsSelectedAnimation(doAnimation){var allTextEl=this.frameEl.find('.pstory-all-accounts-txt');var cardsForAnimation=this.getAllAccountsAnimationCards();var selectedCard=cardsForAnimation.filter('.selected');var notSelectedCards=cardsForAnimation.filter(':not(.selected)');var cardsLength=notSelectedCards.length;if(selectedCard.length==0)
return;if(doAnimation==!0)
cardsForAnimation.add(allTextEl).addClass("pstory-card-transition");else cardsForAnimation.add(allTextEl).removeClass("pstory-card-transition");cardsForAnimation.addClass('pstory-all-animated');this.frameEl.find('.options-container .pstory-button:not(.pstory-all-animated)').addClass('pstory-button-hidden');cardsForAnimation.removeClass('pstory-all-animated-last');notSelectedCards.last().addClass('pstory-all-animated-last');this.allAccountsAnimation.doAnimation(selectedCard,notSelectedCards,this.config.allAnimation)},chooseAccountSelectedAnimation:function chooseAccountSelectedAnimation(){var allTextEl=this.frameEl.find('.pstory-all-accounts-txt');this.frameEl.find(".pstory-button").add(allTextEl).addClass("pstory-card-transition");var cards=this.frameEl.find('.options-container .pstory-button');cards.removeClass("pstory-all-animated").removeClass('pstory-button-hidden');this.allAccountsAnimation.cancelAnimation(cards)},getAllAccountsAnimationCards:function getAllAccountsAnimationCards(){var cards=this.frameEl.find('.options-container .pstory-button:not(.carousel-hide-clone)');var startIndex,endIndex;var selectedItem=this.frameEl.find('.options-container .pstory-button.selected:not([clone="true"])')
var selectedIndex=cards.index(selectedItem);startIndex=selectedIndex-Math.floor((this.options.cardsLength)/2);endIndex=selectedIndex+Math.ceil((this.options.cardsLength)/2);if(startIndex<0){endIndex+=Math.abs(startIndex);startIndex=0}
else if(endIndex>cards.length){startIndex+=endIndex-cards.length;endIndex=cards.length}
return cards.slice(startIndex,endIndex)},afterRender:function afterRender(el){this.frameEl.parents('.pstory-dialog-frame').addClass('perso-account-selector');this.setDefaultSelect();this.setAccountSelectorColors();this.bindCarousel();this.setDisableArrows();this.accSelectedAccountButtons();if(this.showArrows){this.frameEl.find('.pstory-account-button:not(.selected)').addClass('pstory-arrow')}
else{this.accPrevNextAccountButtons()}
if(this.showHeaderTabs){this.setCssForAllAnimation();this.allAccountsAnimation=Personetics.utils.allAccountsAnimation.getAnimation(this.config.allAnimation.type);var selecteTabAll=this.defaultTab==='all';this.frameEl.find(".pstory-header-button[data-all='true']").attr('aria-selected',selecteTabAll);this.frameEl.find(".pstory-header-button[data-all='false']").attr('aria-selected',!selecteTabAll);this.frameEl.find(".cards-wrapper").attr("aria-hidden",selecteTabAll);var selectedHeader=this.frameEl.find("[aria-selected='true']");this.headerTabsAnimation(selectedHeader);if(this.defaultTab==='all'){this.onAllAccountsClick()}}
Personetics.story.AccountSelectorBlock.prototype.afterRender.call(this,el);this.setAccessibility(this.defaultTab==='all');var frameEl=this.frameEl;this.el.find(".perso-accessibility-account-selector").css({'height':frameEl.outerHeight(),'width':frameEl.width()})},accSelectedAccountButtons:function accSelectedAccountButtons(){var relativeContainer=this.frameEl.find('.options-container');var selectedCardWrapper=this.frameEl.find('.pstory-button.selected:not([clone=true])');var selectedCard=selectedCardWrapper.find('.card');var accAccountButtonSelected=this.frameEl.find('.pstory-account-button.selected');accAccountButtonSelected.css({'top':selectedCard.offset().top-relativeContainer.offset().top,'height':selectedCard.outerHeight(!0),'width':selectedCard.outerWidth(!0),'left':selectedCard.offset().left-relativeContainer.offset().left})},accPrevNextAccountButtons:function accPrevNextAccountButton(){var relativeContainer=this.frameEl.find('.options-container');var selectedCardWrapper=this.frameEl.find('.pstory-button.selected:not([clone=true])');var prevNextCards=this.frameEl.find('.pstory-button.next .card, .pstory-button.prev .card');var accAccountButtons=this.frameEl.find('.pstory-account-button:not(.selected)');$.each(prevNextCards,function(i,card){var $card=$(card);var pstoryButtonPadding=$card.parent().outerWidth()-$card.parent().width();var accAccountButtonWidth=(relativeContainer.width()-selectedCardWrapper.outerWidth())/2-pstoryButtonPadding/2;$(accAccountButtons[i]).css({'top':$card.offset().top-relativeContainer.offset().top,'height':$card.outerHeight(),'width':accAccountButtonWidth,'left':Math.max($card.offset().left-relativeContainer.offset().left,0)})})},setDefaultSelect:function(doAnimation){var target=this.frameEl.find('.pstory-button.selected');if(target.length==0){$(this.frameEl.find('.pstory-button')[0]).addClass('selected')}},bindCarousel:function bindCarousel(){var param=this.prepareCarouselParam();this.carouselAnimation=new Personetics.utils.carouselAnimation.bindCarouselEventsForAnimation(this.frameEl.find(".options-container"),param)},prepareCarouselParam:function prepareCarouselParam(){var param=this.getOptionsWidth();param.showIndexDots=this.config.showIndexDots;param.beforeCarouselStart=Personetics.bind(this,this.beforeCarouselStart);return param},beforeCarouselStart:function beforeCarouselStart(e){Personetics.story.AccountSelectorBlock.prototype.optionClickEvent.call(this,e);this.optionClickEvent(e);this.setDisableArrows(e.currentTarget);this.updateAccessibilityButtons(!1,$(e.currentTarget))},setDisableArrows:function setDisableArrows(selectedItem){if(typeof selectedItem==='undefined'||selectedItem===null)
selectedItem=this.frameEl.find('.pstory-button.selected:not([clone="true"])');if(!this.config.enableInfiniteCarousel||this.options.cardsLength==2){var prevArrow=this.el.find('.pstory-prev-account-button');var nextArrow=this.el.find('.pstory-next-account-button');if($(selectedItem).prev().attr('clone')=="true"){if(this.config.nextArrowDir=="ltr"&&this.showArrows){nextArrow.addClass('pstory-disable');prevArrow.removeClass('pstory-disable')}
else{prevArrow.addClass('pstory-disable');nextArrow.removeClass('pstory-disable')}}
else if($(selectedItem).next().attr('clone')=="true"){if(this.config.nextArrowDir=="ltr"&&this.showArrows){prevArrow.addClass('pstory-disable');nextArrow.removeClass('pstory-disable')}
else{nextArrow.addClass('pstory-disable');prevArrow.removeClass('pstory-disable')}}}},getOptionsWidth:function getOptionsWidth(){var container=this.frameEl.find('.options-container');var allAccounts=container.hasClass("allAccounts");container.removeClass("allAccounts");var buttonWidth=container.find('.pstory-button:not(.selected)').outerWidth(!0);if(typeof buttonWidth=='undefined'){buttonWidth=null}
var selectedWidth=container.find('.pstory-button.selected').outerWidth(!0);if(typeof selectedWidth=='undefined'){selectedWidth=null}
if(allAccounts==!0)
container.addClass("allAccounts");return{itemWidth:buttonWidth,selectedItemWidth:selectedWidth}},setAccountSelectorColors:function(){var listCards=this.frameEl.find(".pstory-button");var colors=this.story.uxCtrl.getAccountSelectorPalette();var sum=Math.ceil(listCards.length/colors.length);var newColors=[];for(var i=0;i<sum;i++){newColors=newColors.concat(colors)}
listCards.each(function(i,opt){$(opt).addClass(newColors[i])})},setCssForAllAnimation:function setCssForAllAnimation(){var container=this.frameEl.find('.options-container');container.addClass('pstory-all-animation-'+this.config.allAnimation.type);container.height(container.height())},doScrollEvent:function(skipAnimation){if(Personetics.projectConfiguration.getConfig("supportCollapse")==!0){var collapseHelper=Personetics.story.BlockChartFactory.generateHelperClazz("collapseHelper",this.story.cfg);this.collapseHelper=typeof this.collapseHelper=="undefined"?collapseHelper:this.collapseHelper;var block=this;var elementDisplayed=this.frameEl.find('.carousel-outer-wrapper');this.collapseHelper.scrollEvent(block,elementDisplayed,skipAnimation)}},onCollapsed:function(elementDisplayed,heightForElementDisplayed,fixedContainer){},onUnCollapsed:function(elementDisplayed){}})})(window,window.Personetics=window.Personetics||{},jQuery);(function(window,Personetics,$,undefined){Personetics.story=Personetics.story||{};Personetics.story.D3BarChartBlockProduct=Personetics.story.D3BarChartBlock.extend({beforeRender:function(el,layoutInstructions){Personetics.story.D3BarChartBlock.prototype.beforeRender.call(this,el,layoutInstructions)},afterRender:function afterRender(el){if(this.chartType=="vertical"||this.chartType=="multiVertical"||this.chartType=="pinGraph"){this.xAxis=this.frameEl.find('.x.axis')[0]}
Personetics.story.D3BarChartBlock.prototype.afterRender.call(this,el);var baseValWidth=el.find(".pstory-bar-chart svg, .pstory-pinGraph-chart svg").attr('width').baseVal;var widthSVG;if(typeof baseValWidth!=='undefined'&&baseValWidth!==null)
widthSVG=baseValWidth.value;else widthSVG=el.find(".pstory-bar-chart svg, .pstory-pinGraph-chart svg").attr('width');var halfWidthSVG=widthSVG/2+'px';el.find(".pstory-bar-chart, .pstory-pinGraph-chart svg").css('padding-left',"calc(50% - "+halfWidthSVG+")");this.renderAccessibility(el,this.chartType)},renderAccessibility:function renderAccessibility(el,chartType){var element=$("<div class='accessibility-chart-wrapper'></div>");var layoutInstructions=this.layoutInstructions;var block=this;var chartSvg=$(el).find("svg.perso-svg-chart-container");var chartSvgOffset=chartSvg.offset();var buttonHeight;var buttonTop;var buttonLeft;var button;if(chartType!="pinGraph"){el.find("svg .x.axis .tick").each(function(index,item){button=$("<input type='button' id='accessibility-chart-button_"+layoutInstructions.categories[index]+"' class='accessibility-chart-button'/>");block.setUnclickableClass(button,chartType,index);buttonHeight=$(item).get(0).getBBox().height;button.css('width',$(item).get(0).getBBox().width+"px");buttonTop=$(item).offset().top-chartSvgOffset.top;buttonLeft=$(item).offset().left-chartSvgOffset.left;button.css({'left':buttonLeft+"px",'top':buttonTop+'px'});button.height(buttonHeight);block.ariaLabelAccessibilityButtons(button,layoutInstructions,index,chartType);block.ariaLabelSetSelected(el,item,button);$(button).bind('click',function(e){block.handleClickAccessibilityButtons(layoutInstructions,index,chartType);block.ariaLabelSetSelected(el,item,$(this))});element.prepend(button)});el.find(".pstory-bar-chart, .pstory-pinGraph-chart").append(element)}},getETransform:function getETransform(el){var innerWrapper=el.find("svg .perso-bar, svg .perso-chart-rect").parent();var innerWrapperTransform=innerWrapper.css('transform');if(innerWrapperTransform!="none"){if(typeof innerWrapperTransform===undefined||innerWrapperTransform===null)
innerWrapperTransform=innerWrapper.css('-webkit-transform');if(typeof WebKitCSSMatrix!=='undefined')
var oldTransition=new WebKitCSSMatrix(innerWrapperTransform)['e'];else var oldTransition=new MSCSSMatrix(innerWrapperTransform)['e']}
else{innerWrapperTransform=innerWrapper.attr('transform');if(typeof innerWrapperTransform.baseVal!=="undefined")
var oldTransition=innerWrapperTransform.baseVal.getItem(0).matrix.e}
return oldTransition},ariaLabelSetSelected:function ariaLabelSetSelected(el,item,button){var classSelected=$(item).find('.perso-xAxis-label.selected').length>0?" selected":"";var selected=el.find(".accessibility-chart-button.selected");if(selected.length>0){var ariaLabel=selected.attr('aria-label').split('selected');selected.attr('aria-label',ariaLabel[0]+'');selected.removeClass("selected")}
if(classSelected==" selected"){button.addClass("selected")}
button.attr('aria-label',button.attr('aria-label')+classSelected)},ariaLabelAccessibilityButtons:function ariaLabelAccessibilityButtons(button,layoutInstructions,index,chartType){var i=layoutInstructions.categories.length-index;var monthNumber=Personetics.processor.PUtils.getUtilsInstance("dateUtils").getMonthNumber(Personetics.processor.PStoryConfig.getConfig("lang")+"-short",layoutInstructions.categories[index])
var fullMonthName=Personetics.processor.PUtils.getUtilsInstance("dateUtils").getMonthName(Personetics.processor.PStoryConfig.getConfig("lang"))[monthNumber]
fullMonthName=fullMonthName||layoutInstructions.categories[index]
var currencySymbol=Personetics.projectConfiguration.getConfig("currencySymbol");if(chartType=="multiVertical"){button.attr("aria-label",''+fullMonthName+', '+Personetics.dictionary.getText("accessibilitySeriesIn")+': '+currencySymbol+Math.round(layoutInstructions.series[0][index].value).toLocaleString("en")+', '+Personetics.dictionary.getText("accessibilitySeriesOut")+': -'+currencySymbol+Math.round(layoutInstructions.series[1][index].value).toLocaleString("en")+', '+i+" "+Personetics.dictionary.getText("accessibilityOutOfTxt")+" "+layoutInstructions.categories.length+'')}else{button.attr("aria-label",fullMonthName+', '+currencySymbol+Math.round(layoutInstructions.series[index].value).toLocaleString("en")+', '+i+" "+Personetics.dictionary.getText("accessibilityOutOfTxt")+" "+layoutInstructions.categories.length+'')}},handleClickAccessibilityButtons:function handleClickAccessibilityButtons(layoutInstructions,index,chartType){var seriesData=layoutInstructions.series;if(chartType=="multiVertical"){var clickedObj=layoutInstructions.series[0][index];if((seriesData[1][index].value!==0||seriesData[0][index].value!==0)&&seriesData[1][index].category===clickedObj.category&&seriesData[0][index].category===clickedObj.category){this.handleClick.call(this,clickedObj,index)}}
else{var clickedObj=layoutInstructions.series[index];this.handleClick.call(this,clickedObj,index)}
var nextElementForFocus;var blockElements=this.el.parents(".pstory-dialog-frame").next().find(".pstory-block-content, .pstory-block-content *");if(!this.frameEl.hasClass('perso-collapsed')){if(typeof Personetics.utils.accessibility!=='undefined'&&Personetics.utils.accessibility!==null){$.each(blockElements,function(index,element){if(Personetics.utils.accessibility.isFocusable(element)){nextElementForFocus=$(element);return!1}});if(typeof nextElementForFocus!=="undefined"&&nextElementForFocus.length>0)
this.putFocusAccessibility(nextElementForFocus)}}},putFocusAccessibility:function putFocusAccessibility(elementForFocus){var focusInterval=10;var focusTotalRepetitions=10;elementForFocus.attr('tabindex','0');elementForFocus.blur();var focusRepetitions=0;var interval=window.setTimeout(function(){elementForFocus.focus()},focusInterval)},doScrollEvent:function(skipAnimation){if(Personetics.projectConfiguration.getConfig("supportCollapse")==!0){if(this.chartType=="vertical"||this.chartType=="multiVertical"){this.collapseHelper=typeof this.collapseHelper=="undefined"?new Personetics.story.CollapseHelper():this.collapseHelper;var block=this;var elementDisplayed=$(this.xAxis);this.collapseHelper.scrollEvent(block,elementDisplayed,skipAnimation)}}},onCollapsed:function(elementDisplayed,heightForElementDisplayed,fixedContainer){},onUnCollapsed:function(elementDisplayed,heightForElementDisplayed,fixedContainer){elementDisplayed[0].setAttribute("transform",elementDisplayed[0].getAttribute("transform"))},handleClick:function(obj,clickedItemIndex){Personetics.story.D3BarChartBlock.prototype.handleClick.call(this,obj,clickedItemIndex)},setUnclickableClass:function(el,chartType,index){var block=this;var seriesData=block.layoutInstructions.series;if(chartType=="multiVertical"){if(seriesData[0][index].value===0&&seriesData[1][index].value===0){el.addClass('perso-unclickable')}}else{if(seriesData[index].value===0){el.addClass('perso-unclickable')}}}})})(window,window.Personetics=window.Personetics||{},jQuery);(function(window,Personetics,$,undefined){Personetics.story=Personetics.story||{};Personetics.story.ButtonsBlockProduct=Personetics.story.ButtonsBlock.extend({bindEvnetsForAnimation:function bindEvnetsForAnimation(){if(Personetics.utils.buttonAnimation&&$.isFunction(Personetics.utils.buttonAnimation.bindMaterialButtonEventsForAnimation))
Personetics.utils.buttonAnimation.bindMaterialButtonEventsForAnimation(this.frameEl.find(".pstory-button"))},})})(window,window.Personetics=window.Personetics||{},jQuery);(function(window,Personetics,$,undefined){var d3=Personetics.persoD3||window.d3;Personetics.story=Personetics.story||{};Personetics.story.PieChartBlockProduct=Personetics.story.PieChartBlock.extend({beforeRender:function beforeRender(el,layoutInstructions){Personetics.story.PieChartBlock.prototype.beforeRender.call(this,el,layoutInstructions);var previousDialogs=el.parents('.pstory-dialog-frame').prev('.pstory-dialog-frame');var tabsBlock=previousDialogs.find('.pstory-block-tabs');var selectedTab=tabsBlock.find('.pstory-button.selected');var selectedTabId=selectedTab.attr("pstory-id");if(typeof this.story.uxCtrl.getPieOptions=="function")
if(typeof this.story.uxCtrl.getPieOptions().arcs!="undefined")
this.cornerRadiusPie=typeof this.story.uxCtrl.getPieOptions().arcs.cornerRadius!="undefined"?this.story.uxCtrl.getPieOptions().arcs.cornerRadius.radiusCorner:9;this.colors=d3.scale.ordinal().range(this.getGraphPalette(selectedTabId));this.selectedTabId=selectedTabId;this.texts=$.extend(!0,this.texts,{nextCategory:Personetics.dictionary.getText("accessibilityNextCategory"),previousCategory:Personetics.dictionary.getText("accessibilityPreviousCategory"),selectedCategoryTitle:Personetics.dictionary.getText("accessibilitySelectedCategoryTitle")})},getGraphPalette:function(selectedTabId){return this.story.uxCtrl.getPieGraphPalette(selectedTabId)},renderPieBase:function renderPieBase(el){Personetics.story.PieChartBlock.prototype.renderPieBase.call(this,el);if(this.options.arcs.filter.grayFilter==!0){this.renderGrayFilter()}},renderGrayFilter:function renderGrayFilter(){this.svg.append("filter").attr("id",this.grayscaleId).append("feColorMatrix").attr("type","matrix").attr("values","0.3333 0.3333 0.3333 0 0 0.3333 0.3333 0.3333 0 0 0.3333 0.3333 0.3333 0 0 0 0 0 1 0")},renderGradient:function(){var gradients=this.options.arcs.gradients;var defWithGradients=this.svg.append("defs");if(gradients){$.each(gradients,function(i,gradient){if(gradient){defWithGradients=defWithGradients.append("linearGradient").attr("id",gradient.id).attr("x1","0").attr("x2","0").attr("y1","0").attr("y2","1");$.each(gradient.stopColors,function(i,stopColor){defWithGradients.append("stop").attr("offset",gradient.offset[i]).attr("stop-color",stopColor)})}})}},renderArcs:function(layoutInstructions){Personetics.story.PieChartBlock.prototype.renderArcs.call(this,layoutInstructions);var grayscaleId=this.grayscaleId;if(this.options.arcs.filter.grayFilter==!0){var arcs=this.frameEl.find('.pstory-pie-chart svg .perso-arc path');$.each(arcs,function(i,arc){d3.select(arc).style("filter","url(#"+grayscaleId+")")})}
this.arcs=arcs},afterRender:function(el){var block=this;if(this.frameEl){this.frameEl.addClass(this.selectedTabId);var defaultPath=this.frameEl.find('.pstory-pie-chart svg .perso-arc path.perso-selected')[0];var radius=this.story.uxCtrl.getPieOptions().arcs.cornerRadius?this.story.uxCtrl.getPieOptions().arcs.cornerRadius.radiusCorner:9;d3.select(defaultPath).attr("d",block.arcOver.cornerRadius(this.cornerRadiusPie)).style("filter",this.dropShadow).style("fill",function(d,i){return block.colorArcs(d.data.category)});this.renderGradient();block.arcPaths=block.frameEl.find('.pstory-pie-chart svg .perso-arc path');d3.select(defaultPath).moveToFront();var selected=this.layoutInstructions.slices[this.getSelectedPathIndex(block.arcPaths)];block.initPieInfoValues(selected);if(this.layoutInstructions.slices.length>1){this.frameEl.find('.pstory-pie-data .pstory-arrow').show()}
else{this.frameEl.find('.pstory-pie-data .pstory-arrow').hide()}
Personetics.story.PieChartBlock.prototype.afterRender.call(this,el)}},bindEvents:function(){if(this.frameEl){var block=this;var $nextArrow=this.frameEl.find('.pstory-next-arrow');var $previousArrow=this.frameEl.find('.pstory-previous-arrow');var $paths=block.arcPaths;$nextArrow.bind('click',function(e){var currentItemIndex=block.getSelectedPathIndex($paths);if(currentItemIndex==($paths.length-1)){block.moveArcs(0);block.handleClick(block.layoutInstructions.slices[0],0)}else{block.moveArcs(++currentItemIndex);block.handleClick(block.layoutInstructions.slices[currentItemIndex],currentItemIndex)}
if(document.activeElement==this){block.putFocusAccessibility($(this).closest(".pstory-block-content"))}});$previousArrow.bind('click',function(e){var currentItemIndex=block.getSelectedPathIndex($paths);if(currentItemIndex==0){block.moveArcs($paths.length-1);block.handleClick(block.layoutInstructions.slices[$paths.length-1],$paths.length-1)}else{block.moveArcs(--currentItemIndex);block.handleClick(block.layoutInstructions.slices[currentItemIndex],currentItemIndex)}
if(document.activeElement==this){block.putFocusAccessibility($(this).closest(".pstory-block-content"))}})}},putFocusAccessibility:function putFocusAccessibility(elementForFocus){var focusInterval=10;var focusTotalRepetitions=10;elementForFocus.attr('tabindex','0');elementForFocus.blur();var focusRepetitions=0;var interval=window.setTimeout(function(){elementForFocus.focus()},focusInterval)},onPieItemClick:function onPieItemClick(obj,clickedItemIndex,clickedItem){var block=this;var oldSelectedArc=this.el.find('.perso-arc path.perso-selected');var filter='';if(this.options.arcs.filter.grayFilter==!0){filter="url(#"+this.grayscaleId+")"}
if(oldSelectedArc[0]!=clickedItem){if(oldSelectedArc.length){oldSelectedArc[0].className.baseVal=Personetics.utils.string.removeClass(oldSelectedArc[0].className,'perso-selected');d3.select(oldSelectedArc[0]).attr("d",block.arc).style("filter",filter)}
d3.select(clickedItem).attr("d",block.arcOver.cornerRadius(this.cornerRadiusPie)).attr("class","perso-selected").style("filter",this.dropShadow).style("fill",function(d,i){return block.colorArcs(d.data.category)});d3.select(clickedItem).moveToFront();this.handleClick(obj,clickedItemIndex);this.updatePieInfoValues(obj.data)}},updatePieInfoValues:function(obj){var block=this;if(obj){var amountDiv='<div class="pstory-pie-amount perso-accessibility-no-read"><span>'+obj.label+'</span></div>';var categoryDiv='<div class="pstory-pie-category perso-accessibility-no-read"><span>'+obj.category+'</span></div>';var $infoContainer=this.frameEl.find('.pstory-pie-info');$infoContainer.empty();$infoContainer.append(amountDiv);$infoContainer.append(categoryDiv);this.addInfoTextForAccessibility($infoContainer,obj);if(this.options.arcs.filter.grayFilter==!0){$('.pstory-pie-amount').css('color',block.colors(obj.category))}}},initPieInfoValues:function(obj){this.updatePieInfoValues(obj)},addInfoTextForAccessibility:function addInfoTextForAccessibility($infoContainer,obj){$infoContainer.prepend('<span class="perso-accessibility-read">'+obj.label+', '+obj.category+'</span>');$infoContainer.find(".perso-accessibility-no-read").attr('aria-hidden',!0)},moveArcs:function(index){var block=this;var path=block.arcPaths[index];var filter='';if(this.options.arcs.filter.grayFilter==!0){filter="url(#"+this.grayscaleId+")"}
var oldSelectedArc=this.el.find('.perso-arc path.perso-selected');if(path){d3.select('.pstory-frame .perso-arc path.perso-selected').attr("d",block.arc).style("filter",filter)
oldSelectedArc[0].className.baseVal=Personetics.utils.string.removeClass(oldSelectedArc[0].className,'perso-selected');d3.select(path).attr("d",block.arcOver.cornerRadius(this.cornerRadiusPie)).attr("class","perso-selected").style("filter",this.dropShadow).style("fill",function(d,i){return block.colorArcs(d.data.category)});d3.select(path).moveToFront();block.updatePieInfoValues(block.layoutInstructions.slices[index])}},colorArcs:function(category){var block=this;var color=block.colors(category);if(block.selectedTabId){if(block.selectedTabId=="Out"&&block.options.arcs.selectedOutflowPrimaryColor!=null){color=block.options.arcs.selectedOutflowPrimaryColor}else if(block.selectedTabId=="In"&&block.options.arcs.selectedInflowPrimaryColor!=null){color=block.options.arcs.selectedInflowPrimaryColor}}else if(block.options.arcs.selctedPrimaryColor!=null){color=block.options.arcs.selctedPrimaryColor}
return color},doScrollEvent:function(skipAnimation){if(Personetics.projectConfiguration.getConfig("supportCollapse")==!0){this.collapseHelper=typeof this.collapseHelper=="undefined"?new Personetics.story.CollapseHelper():this.collapseHelper;var block=this;var elementDisplayed=this.frameEl.find('.pstory-pie-data');this.collapseHelper.scrollEvent(block,elementDisplayed,skipAnimation)}}})})(window,window.Personetics=window.Personetics||{},jQuery);(function(window,Personetics,$,undefined){Personetics.story=Personetics.story||{};Personetics.story.D3PinGraphChartBlockProduct=Personetics.story.D3BarChartBlockProduct.extend({beforeRender:function(el,layoutInstructions){Personetics.story.D3BarChartBlockProduct.prototype.beforeRender.call(this,el,layoutInstructions);this.texts.accessibilityPinGraphTitle=Personetics.dictionary.getText("accessibilityPinGraphTitle")},getHtmlTemplateId:function(clazz){return"pinGraph-chart"},render:function(el,layoutInstructions){Personetics.story.Block.prototype.render.call(this,el,layoutInstructions);var chartEl=this.frameEl.find(".pstory-pinGraph-chart");if(chartEl.length>0){this.renderBarChart(chartEl,layoutInstructions)}},renderBarChart:function(el,data){this.chartHelper.prepareChart(data,this.options);this.chartHelper.renderChart(el)},beforeRenderChart:function(el,layoutInstructions){this.layoutInstructions.series=this.layoutInstructions.series[0];this.chartType=this.getChartType();this.chartTypeHelper=(this.chartType+"Helper");this.initChartHelper(this.chartTypeHelper);this.options=this.story.uxCtrl.getPinGraphChartOptions()},barsDirection:function barsDirection(){if(Personetics.processor.PStoryConfig.isRtl()){this.barsDirectionRTL()}},getChartType:function(){var type='pinGraph';return type},getAccessibilityTitle:function getAccessibilityTitle(){return this.texts.accessibilityPinGraphTitle},})})(window,window.Personetics=window.Personetics||{},jQuery);(function(window,Personetics,$,undefined){Personetics.story=Personetics.story||{};Personetics.story.TableBlockProduct=Personetics.story.TableBlock.extend({getHtmlTemplateId:function(clazz){var template;var classStr;var classes=clazz?clazz.split(" "):[];$.each(classes,function(index,className){if(className.indexOf("perso-txlist")>-1){classStr=className.trim();return!1}});this.classStr=classStr;if(typeof(this.classStr)=="undefined"){var numColumns=this.layoutInstructions.columns.length;switch(numColumns){case 3:this.classStr="perso-txlist4";break;case 4:this.classStr="perso-txlist1";break;case 6:this.classStr="perso-txlist3";break;default:this.classStr="perso-txlist1"}}
template="table-"+this.classStr;return template},afterRender:function(el){Personetics.story.TableBlock.prototype.afterRender.call(this,el);if(Personetics.projectConfiguration.getConfig("supportCollapse")==!0){var collapseHelper=Personetics.story.BlockChartFactory.generateHelperClazz("collapseHelper",this.story.cfg);this.collapseHelper=typeof this.collapseHelper=="undefined"?collapseHelper:this.collapseHelper;var heightPrevFixedElements=this.collapseHelper.getHeightPrevFixedElements();var scrollTopDiff=heightPrevFixedElements-this.frameEl.offset().top;var pstoryFrame=this.frameEl.parents('.pstory-frame');var pstoryContainer=pstoryFrame.find('.pstory-container');var siblingsHeight=pstoryFrame[0].scrollHeight-pstoryContainer.height();if(scrollTopDiff>0)
pstoryFrame.scrollTop(pstoryFrame.scrollTop()-scrollTopDiff);pstoryContainer.css('min-height',pstoryFrame.height()+pstoryFrame.scrollTop()-siblingsHeight)}}})})(window,window.Personetics=window.Personetics||{},jQuery);(function(window,Personetics,$,Handlebars,undefined){this["Personetics"]=this["Personetics"]||{};this["Personetics"].UI=this["Personetics"].UI||{};this["Personetics"].UI.Handlebars=this["Personetics"].UI.Handlebars||{};this["Personetics"].UI.Handlebars.templates=this["Personetics"].UI.Handlebars.templates||{};this["Personetics"].UI.Handlebars.templates["error-msg"]=Handlebars.template({"1":function(container,depth0,helpers,partials,data){return"class=\"mobile-err\""},"compiler":[7,">= 4.0.0"],"main":function(container,depth0,helpers,partials,data){var stack1,helper,alias1=depth0!=null?depth0:(container.nullContext||{}),alias2=helpers.helperMissing,alias3="function",alias4=container.escapeExpression;return"<div id=\"personetics-error-container\" "+((stack1=helpers["if"].call(alias1,(depth0!=null?depth0.isMobileDevice:depth0),{"name":"if","hash":{},"fn":container.program(1,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+">\r\n    <div class=\"personetics-error-img "+alias4(((helper=(helper=helpers.imgClass||(depth0!=null?depth0.imgClass:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"imgClass","hash":{},"data":data}):helper)))+"\"></div>\r\n    <div class=\"personetics-error-larg\">"+alias4(((helper=(helper=helpers.textLarge||(depth0!=null?depth0.textLarge:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"textLarge","hash":{},"data":data}):helper)))+"</div>\r\n    <div class=\"personetics-error-small\">"+alias4(((helper=(helper=helpers.textSmall||(depth0!=null?depth0.textSmall:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"textSmall","hash":{},"data":data}):helper)))+"</div>\r\n\r\n</div>"},"useData":!0});this["Personetics"].UI.Handlebars.templates["flow-selector-tmpl"]=Handlebars.template({"1":function(container,depth0,helpers,partials,data){var helper,alias1=depth0!=null?depth0:(container.nullContext||{}),alias2=helpers.helperMissing,alias3="function",alias4=container.escapeExpression;return"    <option value=\""+alias4(((helper=(helper=helpers.key||(data&&data.key))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"key","hash":{},"data":data}):helper)))+"\">"+alias4(((helper=(helper=helpers.name||(depth0!=null?depth0.name:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"name","hash":{},"data":data}):helper)))+"</option>\r\n"},"compiler":[7,">= 4.0.0"],"main":function(container,depth0,helpers,partials,data){var stack1;return"<select id=\"flow-selector\">\r\n"+((stack1=helpers.each.call(depth0!=null?depth0:(container.nullContext||{}),depth0,{"name":"each","hash":{},"fn":container.program(1,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"</select>\r\n"},"useData":!0});this["Personetics"].UI.Handlebars.templates["no-filtered-insights-msg"]=Handlebars.template({"1":function(container,depth0,helpers,partials,data){return"class=\"mobile-msg\""},"compiler":[7,">= 4.0.0"],"main":function(container,depth0,helpers,partials,data){var stack1,helper,alias1=depth0!=null?depth0:(container.nullContext||{});return"<div id=\"personetics-no-insights-filter-container\" "+((stack1=helpers["if"].call(alias1,(depth0!=null?depth0.isMobileDevice:depth0),{"name":"if","hash":{},"fn":container.program(1,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+">\r\n    <div class=\"personetics-nothing-toshow-msg\">"+container.escapeExpression(((helper=(helper=helpers.text||(depth0!=null?depth0.text:depth0))!=null?helper:helpers.helperMissing),(typeof helper==="function"?helper.call(alias1,{"name":"text","hash":{},"data":data}):helper)))+"</div>\r\n</div>"},"useData":!0});this["Personetics"].UI.Handlebars.templates["no-insights-message"]=Handlebars.template({"1":function(container,depth0,helpers,partials,data){return"class=\"mobile-err\""},"compiler":[7,">= 4.0.0"],"main":function(container,depth0,helpers,partials,data){var stack1,helper,alias1=depth0!=null?depth0:(container.nullContext||{}),alias2=helpers.helperMissing,alias3="function",alias4=container.escapeExpression;return"<div id=\"personetics-no-insights-container\" "+((stack1=helpers["if"].call(alias1,(depth0!=null?depth0.isMobileDevice:depth0),{"name":"if","hash":{},"fn":container.program(1,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+">\r\n    <div class=\"personetics-no-insights-img "+alias4(((helper=(helper=helpers.imgClass||(depth0!=null?depth0.imgClass:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"imgClass","hash":{},"data":data}):helper)))+"\"></div>\r\n    <div class=\"personetics-no-insights-small\">"+alias4(((helper=(helper=helpers.textSmall||(depth0!=null?depth0.textSmall:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"textSmall","hash":{},"data":data}):helper)))+"</div>\r\n    <div class=\"personetics-no-insights-larg\">"+alias4(((helper=(helper=helpers.textLarge||(depth0!=null?depth0.textLarge:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"textLarge","hash":{},"data":data}):helper)))+"</div>\r\n</div>"},"useData":!0});this["Personetics"].UI.Handlebars.templates["pstory-block-account-selector"]=Handlebars.template({"1":function(container,depth0,helpers,partials,data){return"				<div class=\"header-container\">\r\n					<input type=\"button\" value=\"All accounts\" class=\"pstory-header-button selected\" data-all=\"true\" pstory-id=\"all\"/>				\r\n					<input type=\"button\" value=\"Choose account\" class=\"pstory-header-button\" data-all=\"false\"/>\r\n					\r\n					<div class=\"pstory-header-button on-select no-select\" data-all=\"false\" pstory-id=\"all\"></div><!--pstory-id for first time-->\r\n					<div class=\"pstory-header-button on-select select\" data-all=\"true\"></div>\r\n				</div>\r\n				<div class=\"options-container show-all allAccounts\">\r\n"},"3":function(container,depth0,helpers,partials,data){return"        		<div class=\"options-container\">\r\n"},"5":function(container,depth0,helpers,partials,data,blockParams,depths){var stack1,helper,alias1=depth0!=null?depth0:(container.nullContext||{}),alias2=helpers.helperMissing,alias3="function",alias4=container.escapeExpression,alias5=container.lambda;return"					<div class=\"pstory-button "+((stack1=helpers["if"].call(alias1,(depth0!=null?depth0.selected:depth0),{"name":"if","hash":{},"fn":container.program(6,data,0,blockParams,depths),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\" pstory-id=\""+alias4(((helper=(helper=helpers.id||(depth0!=null?depth0.id:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"id","hash":{},"data":data}):helper)))+"\"  pstory-event=\""+alias4(((helper=(helper=helpers.event||(depth0!=null?depth0.event:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"event","hash":{},"data":data}):helper)))+"\" role=\""+alias4(alias5((depths[1]!=null?depths[1].role:depths[1]),depth0))+"\">\r\n						<div class=\"card card_"+alias4(((helper=(helper=helpers.typeImage||(depth0!=null?depth0.typeImage:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"typeImage","hash":{},"data":data}):helper)))+" cards"+alias4(((helper=(helper=helpers.numCards||(depth0!=null?depth0.numCards:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"numCards","hash":{},"data":data}):helper)))+"\" pstory-id=\""+alias4(((helper=(helper=helpers.id||(depth0!=null?depth0.id:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"id","hash":{},"data":data}):helper)))+"\">							\r\n							<div class=\"perso-card-img\" ></div>\r\n							<span class=\"perso-account-name\">"+alias4(((helper=(helper=helpers.name||(depth0!=null?depth0.name:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"name","hash":{},"data":data}):helper)))+"</span>\r\n"+((stack1=helpers["if"].call(alias1,(depth0!=null?depth0.number:depth0),{"name":"if","hash":{},"fn":container.program(8,data,0,blockParams,depths),"inverse":container.noop,"data":data}))!=null?stack1:"")+"						</div>\r\n						 <div id=\"pop-"+alias4(alias5(depth0,depth0))+"\" class=\"pstory-button-txt-wrapper\" pstory-id=\""+alias4(((helper=(helper=helpers.id||(depth0!=null?depth0.id:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"id","hash":{},"data":data}):helper)))+"\"><span class=\"pstory-button-txt\">"+((stack1=((helper=(helper=helpers.text||(depth0!=null?depth0.text:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"text","hash":{},"data":data}):helper)))!=null?stack1:"")+"</span></div>		           \r\n					</div>\r\n"},"6":function(container,depth0,helpers,partials,data){return"selected"},"8":function(container,depth0,helpers,partials,data){var helper;return"							<span class=\"perso-account-number\">Account No. "+container.escapeExpression(((helper=(helper=helpers.number||(depth0!=null?depth0.number:depth0))!=null?helper:helpers.helperMissing),(typeof helper==="function"?helper.call(depth0!=null?depth0:(container.nullContext||{}),{"name":"number","hash":{},"data":data}):helper)))+"</span>\r\n"},"compiler":[7,">= 4.0.0"],"main":function(container,depth0,helpers,partials,data,blockParams,depths){var stack1,helper,alias1=depth0!=null?depth0:(container.nullContext||{}),alias2=helpers.helperMissing,alias3="function",alias4=container.escapeExpression;return"<div id=\"pstory-block-account-selector\" class=\"pstory-block-frame pstory-block-account-selector "+alias4(((helper=(helper=helpers["class"]||(depth0!=null?depth0["class"]:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"class","hash":{},"data":data}):helper)))+"\"  data-show-header-tabs="+alias4(((helper=(helper=helpers.showHeaderTabs||(depth0!=null?depth0.showHeaderTabs:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"showHeaderTabs","hash":{},"data":data}):helper)))+">\r\n    <div class=\"pstory-block-container\">\r\n        <div class=\"pstory-block-content\">\r\n"+((stack1=helpers["if"].call(alias1,(depth0!=null?depth0.showHeaderTabs:depth0),{"name":"if","hash":{},"fn":container.program(1,data,0,blockParams,depths),"inverse":container.program(3,data,0,blockParams,depths),"data":data}))!=null?stack1:"")+"	        	<div class=\"cards-wrapper\">\r\n"+((stack1=helpers.each.call(alias1,(depth0!=null?depth0.options:depth0),{"name":"each","hash":{},"fn":container.program(5,data,0,blockParams,depths),"inverse":container.noop,"data":data}))!=null?stack1:"")+"	        	</div>\r\n				<div class=\"pstory-all-accounts-txt\">"+((stack1=((helper=(helper=helpers.allAccountsTxt||(depth0!=null?depth0.allAccountsTxt:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"allAccountsTxt","hash":{},"data":data}):helper)))!=null?stack1:"")+"</div>\r\n            </div>\r\n            <div class=\"pstory-comment\">"+((stack1=((helper=(helper=helpers.comment||(depth0!=null?depth0.comment:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"comment","hash":{},"data":data}):helper)))!=null?stack1:"")+"</div>\r\n        </div>\r\n    </div>\r\n</div>"},"useData":!0,"useDepths":!0});this["Personetics"].UI.Handlebars.templates["pstory-block-bar-chart-collapse"]=Handlebars.template({"compiler":[7,">= 4.0.0"],"main":function(container,depth0,helpers,partials,data){var helper,alias1=depth0!=null?depth0:(container.nullContext||{}),alias2=helpers.helperMissing,alias3="function",alias4=container.escapeExpression;return"<div class=\"pstory-block-frame pstory-block-bar-chart-collapse pstory-inner-"+alias4(((helper=(helper=helpers["class"]||(depth0!=null?depth0["class"]:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"class","hash":{},"data":data}):helper)))+"\">\r\n    <div class=\"pstory-block-contanier\">\r\n        <div class=\"pstory-block-content\">\r\n            <div class=\"pstory-button-collapse\">\r\n            	<div class=\"pstory-inner-title\">\r\n            		"+alias4(((helper=(helper=helpers.txt||(depth0!=null?depth0.txt:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"txt","hash":{},"data":data}):helper)))+"\r\n        		</div>\r\n        		<div class=\"pstory-button-collapse-icon\"></div>\r\n        	</div>\r\n            <div class=\"pstory-bar-chart-collapse-content\">\r\n           		<div class=\"image\"></div>\r\n       		</div>\r\n        </div>\r\n    </div>\r\n</div>\r\n"},"useData":!0});this["Personetics"].UI.Handlebars.templates["pstory-block-bar-chart"]=Handlebars.template({"compiler":[7,">= 4.0.0"],"main":function(container,depth0,helpers,partials,data){var helper,alias1=depth0!=null?depth0:(container.nullContext||{}),alias2=helpers.helperMissing,alias3="function",alias4=container.escapeExpression;return"<div class=\"pstory-block-frame pstory-block-bar-chart pstory-block-bar-chart "+alias4(((helper=(helper=helpers["class"]||(depth0!=null?depth0["class"]:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"class","hash":{},"data":data}):helper)))+" "+alias4(((helper=(helper=helpers.direction||(depth0!=null?depth0.direction:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"direction","hash":{},"data":data}):helper)))+"\">\r\n    <div class=\"pstory-block-container\">\r\n        <div class=\"pstory-block-content\">\r\n            <div class=\"pstory-bar-chart\"></div>\r\n        </div>\r\n    </div>\r\n</div>"},"useData":!0});this["Personetics"].UI.Handlebars.templates["pstory-block-buttons"]=Handlebars.template({"1":function(container,depth0,helpers,partials,data,blockParams,depths){var stack1;return((stack1=helpers["if"].call(depth0!=null?depth0:(container.nullContext||{}),(depth0!=null?depth0.navigateTarget:depth0),{"name":"if","hash":{},"fn":container.program(2,data,0,blockParams,depths),"inverse":container.program(4,data,0,blockParams,depths),"data":data}))!=null?stack1:"")},"2":function(container,depth0,helpers,partials,data){var stack1,helper,alias1=depth0!=null?depth0:(container.nullContext||{}),alias2=helpers.helperMissing,alias3="function";return"		    <a href=\"#!\" class=\"pstory-link-navigateTo pstory-button ripple-closed\" pnavigate-id=\""+container.escapeExpression(((helper=(helper=helpers.navigateTarget||(depth0!=null?depth0.navigateTarget:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"navigateTarget","hash":{},"data":data}):helper)))+"\" >"+((stack1=((helper=(helper=helpers.text||(depth0!=null?depth0.text:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"text","hash":{},"data":data}):helper)))!=null?stack1:"")+"</a>\r\n"},"4":function(container,depth0,helpers,partials,data,blockParams,depths){var stack1;return((stack1=helpers["if"].call(depth0!=null?depth0:(container.nullContext||{}),(depth0!=null?depth0.toggleState:depth0),{"name":"if","hash":{},"fn":container.program(5,data,0,blockParams,depths),"inverse":container.program(8,data,0,blockParams,depths),"data":data}))!=null?stack1:"")},"5":function(container,depth0,helpers,partials,data){var stack1,helper,alias1=depth0!=null?depth0:(container.nullContext||{}),alias2=helpers.helperMissing,alias3="function",alias4=container.escapeExpression;return"		                <input type=\"button\" class=\"pstory-button pstory-toggle-button "+alias4(((helper=(helper=helpers.toggleState||(depth0!=null?depth0.toggleState:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"toggleState","hash":{},"data":data}):helper)))+" "+((stack1=helpers["if"].call(alias1,(depth0!=null?depth0.selected:depth0),{"name":"if","hash":{},"fn":container.program(6,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\" value=\""+((stack1=((helper=(helper=helpers.text||(depth0!=null?depth0.text:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"text","hash":{},"data":data}):helper)))!=null?stack1:"")+"\" pstory-type-text=\"Toggle "+((stack1=((helper=(helper=helpers.text||(depth0!=null?depth0.text:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"text","hash":{},"data":data}):helper)))!=null?stack1:"")+"\" pstory-id=\""+alias4(((helper=(helper=helpers.toggleState||(depth0!=null?depth0.toggleState:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"toggleState","hash":{},"data":data}):helper)))+"\"/>\r\n"},"6":function(container,depth0,helpers,partials,data){return"selected"},"8":function(container,depth0,helpers,partials,data,blockParams,depths){var stack1;return((stack1=helpers["if"].call(depth0!=null?depth0:(container.nullContext||{}),(depths[1]!=null?depths[1].typeRadio:depths[1]),{"name":"if","hash":{},"fn":container.program(9,data,0,blockParams,depths),"inverse":container.program(12,data,0,blockParams,depths),"data":data}))!=null?stack1:"")},"9":function(container,depth0,helpers,partials,data,blockParams,depths){var stack1,helper,alias1=depth0!=null?depth0:(container.nullContext||{}),alias2=helpers.helperMissing,alias3="function",alias4=container.escapeExpression;return"                                <div class=\"pstory-button pstory-radio-button "+((stack1=helpers["if"].call(alias1,(depth0!=null?depth0.selected:depth0),{"name":"if","hash":{},"fn":container.program(6,data,0,blockParams,depths),"inverse":container.noop,"data":data}))!=null?stack1:"")+"  ripple-closed\" tabindex=\"0\" pstory-id=\""+alias4(((helper=(helper=helpers.id||(depth0!=null?depth0.id:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"id","hash":{},"data":data}):helper)))+"\"  pstory-event=\""+alias4(((helper=(helper=helpers.event||(depth0!=null?depth0.event:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"event","hash":{},"data":data}):helper)))+"\">\r\n                                    <input id=\"pstory-radio-"+alias4(((helper=(helper=helpers.id||(depth0!=null?depth0.id:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"id","hash":{},"data":data}):helper)))+"\" name=\"radio-"+alias4(container.lambda((depths[1]!=null?depths[1].id:depths[1]),depth0))+"\" type=\"radio\" "+((stack1=helpers["if"].call(alias1,(depth0!=null?depth0.selected:depth0),{"name":"if","hash":{},"fn":container.program(10,data,0,blockParams,depths),"inverse":container.noop,"data":data}))!=null?stack1:"")+"/>\r\n                                    <label for=\"pstory-radio-"+alias4(((helper=(helper=helpers.id||(depth0!=null?depth0.id:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"id","hash":{},"data":data}):helper)))+"\" role=\"text\">"+((stack1=((helper=(helper=helpers.text||(depth0!=null?depth0.text:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"text","hash":{},"data":data}):helper)))!=null?stack1:"")+"</label>\r\n                                </div>\r\n"},"10":function(container,depth0,helpers,partials,data){return"checked"},"12":function(container,depth0,helpers,partials,data){var stack1,helper,alias1=container.escapeExpression,alias2=depth0!=null?depth0:(container.nullContext||{}),alias3=helpers.helperMissing,alias4="function";return"                                    <button id=\"pop-"+alias1(container.lambda(depth0,depth0))+"\" class=\"pstory-button pstory-regular-button "+((stack1=helpers["if"].call(alias2,(depth0!=null?depth0.selected:depth0),{"name":"if","hash":{},"fn":container.program(6,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+" ripple-closed\" pstory-type-text=\"Button "+((stack1=((helper=(helper=helpers.text||(depth0!=null?depth0.text:depth0))!=null?helper:alias3),(typeof helper===alias4?helper.call(alias2,{"name":"text","hash":{},"data":data}):helper)))!=null?stack1:"")+"\" pstory-id=\""+alias1(((helper=(helper=helpers.id||(depth0!=null?depth0.id:depth0))!=null?helper:alias3),(typeof helper===alias4?helper.call(alias2,{"name":"id","hash":{},"data":data}):helper)))+"\" pstory-event=\""+alias1(((helper=(helper=helpers.event||(depth0!=null?depth0.event:depth0))!=null?helper:alias3),(typeof helper===alias4?helper.call(alias2,{"name":"event","hash":{},"data":data}):helper)))+"\">\r\n                                        "+((stack1=((helper=(helper=helpers.text||(depth0!=null?depth0.text:depth0))!=null?helper:alias3),(typeof helper===alias4?helper.call(alias2,{"name":"text","hash":{},"data":data}):helper)))!=null?stack1:"")+"\r\n                                    </button>\r\n"},"compiler":[7,">= 4.0.0"],"main":function(container,depth0,helpers,partials,data,blockParams,depths){var stack1,helper,alias1=depth0!=null?depth0:(container.nullContext||{}),alias2=helpers.helperMissing,alias3="function",alias4=container.escapeExpression;return"<div id=\"pstory-block-buttons_"+alias4(((helper=(helper=helpers.id||(depth0!=null?depth0.id:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"id","hash":{},"data":data}):helper)))+"\" class=\"pstory-block-frame pstory-block-buttons "+alias4(((helper=(helper=helpers["class"]||(depth0!=null?depth0["class"]:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"class","hash":{},"data":data}):helper)))+"\">\r\n    <div class=\"pstory-block-container\">\r\n        <div class=\"pstory-block-content\">\r\n"+((stack1=helpers.each.call(alias1,(depth0!=null?depth0.options:depth0),{"name":"each","hash":{},"fn":container.program(1,data,0,blockParams,depths),"inverse":container.noop,"data":data}))!=null?stack1:"")+"        </div>\r\n    </div>\r\n</div>"},"useData":!0,"useDepths":!0});this["Personetics"].UI.Handlebars.templates["pstory-block-compare-block"]=Handlebars.template({"1":function(container,depth0,helpers,partials,data){var stack1,helper,alias1=depth0!=null?depth0:(container.nullContext||{}),alias2=helpers.helperMissing,alias3="function";return"                        <div class=\"perso-compare\" role=\"text\">\r\n                            <div class=\"perso-compare-text label\">"+((stack1=((helper=(helper=helpers.label1||(depth0!=null?depth0.label1:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"label1","hash":{},"data":data}):helper)))!=null?stack1:"")+"</div>\r\n                            <div class=\"perso-compare-text value\">"+((stack1=((helper=(helper=helpers.label2||(depth0!=null?depth0.label2:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"label2","hash":{},"data":data}):helper)))!=null?stack1:"")+"</div>\r\n                        </div>\r\n                <div id=\""+((stack1=((helper=(helper=helpers.id||(depth0!=null?depth0.id:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"id","hash":{},"data":data}):helper)))!=null?stack1:"")+"_wrapper\" class=\"perso-compare-bar-wrapper\">\r\n                    <div id=\""+((stack1=((helper=(helper=helpers.id||(depth0!=null?depth0.id:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"id","hash":{},"data":data}):helper)))!=null?stack1:"")+"\" class=\"perso-compare-bar\"></div>\r\n                </div>\r\n\r\n"},"compiler":[7,">= 4.0.0"],"main":function(container,depth0,helpers,partials,data){var stack1,helper,alias1=depth0!=null?depth0:(container.nullContext||{});return"<div class=\"pstory-block-frame pstory-block-compareBlock "+container.escapeExpression(((helper=(helper=helpers["class"]||(depth0!=null?depth0["class"]:depth0))!=null?helper:helpers.helperMissing),(typeof helper==="function"?helper.call(alias1,{"name":"class","hash":{},"data":data}):helper)))+"\">\r\n    <div class=\"pstory-block-contanier\">\r\n        <div class=\"pstory-block-content\">\r\n            <div class=\"perso-compareBlock-wrapper\" role=\"text\">\r\n"+((stack1=helpers.each.call(alias1,(depth0!=null?depth0.options:depth0),{"name":"each","hash":{},"fn":container.program(1,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"            </div>\r\n        </div>\r\n    </div>\r\n</div>\r\n"},"useData":!0});this["Personetics"].UI.Handlebars.templates["pstory-block-date-box"]=Handlebars.template({"compiler":[7,">= 4.0.0"],"main":function(container,depth0,helpers,partials,data){var helper,alias1=depth0!=null?depth0:(container.nullContext||{}),alias2=helpers.helperMissing,alias3="function",alias4=container.escapeExpression;return"<div class=\"pstory-block-frame pstory-block-date-box "+alias4(((helper=(helper=helpers["class"]||(depth0!=null?depth0["class"]:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"class","hash":{},"data":data}):helper)))+"\">\r\n    <div class=\"pstory-block-contanier\">\r\n        <div class=\"pstory-block-content\" tabindex=\"0\">\r\n            <div class=\"pstory-block-date-month\">"+alias4(((helper=(helper=helpers.month||(depth0!=null?depth0.month:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"month","hash":{},"data":data}):helper)))+"</div>\r\n            <div class=\"pstory-block-date-day\">"+alias4(((helper=(helper=helpers.day||(depth0!=null?depth0.day:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"day","hash":{},"data":data}):helper)))+"</div>\r\n        </div>\r\n    </div>\r\n</div>\r\n\r\n"},"useData":!0});this["Personetics"].UI.Handlebars.templates["pstory-block-hbox-columns"]=Handlebars.template({"1":function(container,depth0,helpers,partials,data){var helper,alias1=depth0!=null?depth0:(container.nullContext||{}),alias2=helpers.helperMissing,alias3="function",alias4=container.escapeExpression;return"        <div class=\"pstory-hbox-column-frame "+alias4(((helper=(helper=helpers["class"]||(depth0!=null?depth0["class"]:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"class","hash":{},"data":data}):helper)))+"\" data-v-align=\""+alias4(((helper=(helper=helpers["v-align"]||(depth0!=null?depth0["v-align"]:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"v-align","hash":{},"data":data}):helper)))+"\" data-width=\""+alias4(((helper=(helper=helpers.width||(depth0!=null?depth0.width:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"width","hash":{},"data":data}):helper)))+"\" >\r\n            <div class=\"pstory-hbox-blocks-container\"></div>\r\n        </div>\r\n"},"compiler":[7,">= 4.0.0"],"main":function(container,depth0,helpers,partials,data){var stack1,helper,alias1=depth0!=null?depth0:(container.nullContext||{});return"<div class=\"pstory-block-hbox-columns-frame "+container.escapeExpression(((helper=(helper=helpers["class"]||(depth0!=null?depth0["class"]:depth0))!=null?helper:helpers.helperMissing),(typeof helper==="function"?helper.call(alias1,{"name":"class","hash":{},"data":data}):helper)))+"\">\r\n"+((stack1=helpers.each.call(alias1,(depth0!=null?depth0.columns:depth0),{"name":"each","hash":{},"fn":container.program(1,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"</div>\r\n"},"useData":!0});this["Personetics"].UI.Handlebars.templates["pstory-block-hbox"]=Handlebars.template({"compiler":[7,">= 4.0.0"],"main":function(container,depth0,helpers,partials,data){return"<div class=\"pstory-block-frame pstory-block-hbox\">\r\n    <div class=\"pstory-block-contanier\">\r\n        <div class=\"pstory-block-content\">\r\n            <div class=\"hbox-block-content\"></div>\r\n        </div>\r\n    </div>\r\n</div>\r\n"},"useData":!0});this["Personetics"].UI.Handlebars.templates["pstory-block-image"]=Handlebars.template({"1":function(container,depth0,helpers,partials,data){var helper,alias1=depth0!=null?depth0:(container.nullContext||{}),alias2=helpers.helperMissing,alias3="function",alias4=container.escapeExpression;return"            <div class=\"pstory-block-content\" id=\""+alias4(((helper=(helper=helpers.id||(depth0!=null?depth0.id:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"id","hash":{},"data":data}):helper)))+"\" style=\"background-image:url('"+alias4(((helper=(helper=helpers.url||(depth0!=null?depth0.url:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"url","hash":{},"data":data}):helper)))+"')\"></div>\r\n"},"3":function(container,depth0,helpers,partials,data){var helper,alias1=depth0!=null?depth0:(container.nullContext||{}),alias2=helpers.helperMissing,alias3="function",alias4=container.escapeExpression;return"            <div class=\"pstory-block-content perso-image perso-"+alias4(((helper=(helper=helpers.url||(depth0!=null?depth0.url:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"url","hash":{},"data":data}):helper)))+"\" id=\""+alias4(((helper=(helper=helpers.id||(depth0!=null?depth0.id:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"id","hash":{},"data":data}):helper)))+"\"></div>\r\n"},"compiler":[7,">= 4.0.0"],"main":function(container,depth0,helpers,partials,data){var stack1,helper,alias1=depth0!=null?depth0:(container.nullContext||{});return"<div class=\"pstory-block-frame pstory-block-image "+container.escapeExpression(((helper=(helper=helpers["class"]||(depth0!=null?depth0["class"]:depth0))!=null?helper:helpers.helperMissing),(typeof helper==="function"?helper.call(alias1,{"name":"class","hash":{},"data":data}):helper)))+"\">\r\n    <div class=\"pstory-block-contanier\">\r\n"+((stack1=helpers["if"].call(alias1,(depth0!=null?depth0.isAbsoluteURL:depth0),{"name":"if","hash":{},"fn":container.program(1,data,0),"inverse":container.program(3,data,0),"data":data}))!=null?stack1:"")+"    </div>\r\n</div>\r\n"},"useData":!0});this["Personetics"].UI.Handlebars.templates["pstory-block-layout"]=Handlebars.template({"compiler":[7,">= 4.0.0"],"main":function(container,depth0,helpers,partials,data){var helper;return"<div class=\"pstory-block-frame pstory-block-layout\">\r\n    <div class=\"pstory-block-contanier\">\r\n        <div class=\"pstory-block-content\">\r\n            <div class=\"layout-block-content\" id=\""+container.escapeExpression(((helper=(helper=helpers.id||(depth0!=null?depth0.id:depth0))!=null?helper:helpers.helperMissing),(typeof helper==="function"?helper.call(depth0!=null?depth0:(container.nullContext||{}),{"name":"id","hash":{},"data":data}):helper)))+"\"></div>\r\n        </div>\r\n    </div>\r\n</div>\r\n"},"useData":!0});this["Personetics"].UI.Handlebars.templates["pstory-block-line-chart"]=Handlebars.template({"compiler":[7,">= 4.0.0"],"main":function(container,depth0,helpers,partials,data){var helper;return"<div class=\"pstory-block-frame pstory-block-line-chart pstory-block-line-chart "+container.escapeExpression(((helper=(helper=helpers["class"]||(depth0!=null?depth0["class"]:depth0))!=null?helper:helpers.helperMissing),(typeof helper==="function"?helper.call(depth0!=null?depth0:(container.nullContext||{}),{"name":"class","hash":{},"data":data}):helper)))+"\">\r\n    <div class=\"pstory-block-container\">\r\n        <div class=\"pstory-block-content\">\r\n            <div class=\"pstory-line-chart\"></div>\r\n        </div>\r\n    </div>\r\n</div>"},"useData":!0});this["Personetics"].UI.Handlebars.templates["pstory-block-map"]=Handlebars.template({"compiler":[7,">= 4.0.0"],"main":function(container,depth0,helpers,partials,data){return"<div class=\"pstory-block-frame pstory-block-map\">\r\n    <div class=\"pstory-block-container\">\r\n        <div class=\"pstory-block-content\">\r\n            <div class=\"pstory-map-frame\"></div>\r\n        </div>\r\n    </div>\r\n</div>\r\n"},"useData":!0});this["Personetics"].UI.Handlebars.templates["pstory-block-pie-chart"]=Handlebars.template({"compiler":[7,">= 4.0.0"],"main":function(container,depth0,helpers,partials,data){return"<div class=\"pstory-block-frame pstory-block-pie-chart\">\r\n    <div class=\"pstory-block-container\">\r\n        <div class=\"pstory-block-content\">\r\n            <div class=\"pstory-pie-chart\"></div>\r\n            <div class=\"pstory-pie-data\">\r\n                <div class=\"pstory-next-arrow\"></div>\r\n                <div class=\"pstory-pie-info\">\r\n                </div>\r\n                <div class=\"pstory-previous-arrow\"></div>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</div>"},"useData":!0});this["Personetics"].UI.Handlebars.templates["pstory-block-pinGraph-chart"]=Handlebars.template({"compiler":[7,">= 4.0.0"],"main":function(container,depth0,helpers,partials,data){var helper;return"<div class=\"pstory-block-frame pstory-block-pinGraph-chart_"+container.escapeExpression(((helper=(helper=helpers.index||(depth0!=null?depth0.index:depth0))!=null?helper:helpers.helperMissing),(typeof helper==="function"?helper.call(depth0!=null?depth0:(container.nullContext||{}),{"name":"index","hash":{},"data":data}):helper)))+" pstory-block-pinGraph-chart\">\r\n    <div class=\"pstory-block-container\">\r\n        <div class=\"pstory-block-content\">\r\n            <div class=\"pstory-pinGraph-chart\"></div>\r\n        </div>\r\n    </div>\r\n</div>"},"useData":!0});this["Personetics"].UI.Handlebars.templates["pstory-block-selectOne"]=Handlebars.template({"1":function(container,depth0,helpers,partials,data){var helper,alias1=depth0!=null?depth0:(container.nullContext||{}),alias2=helpers.helperMissing,alias3="function",alias4=container.escapeExpression;return"	            <div class=\"pstory-selectOne-wrapper\">\r\n		            <span class=\"pstory-selectOne\" pstory-id=\""+alias4(((helper=(helper=helpers.id||(depth0!=null?depth0.id:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"id","hash":{},"data":data}):helper)))+"\"\r\n		                   pstory-event=\""+alias4(((helper=(helper=helpers.event||(depth0!=null?depth0.event:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"event","hash":{},"data":data}):helper)))+"\">"+alias4(((helper=(helper=helpers.txt||(depth0!=null?depth0.txt:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"txt","hash":{},"data":data}):helper)))+"</span>\r\n                    <input type=\"button\" class=\"pstory-button pstory-selectOne-icon\" pstory-id=\""+alias4(((helper=(helper=helpers.id||(depth0!=null?depth0.id:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"id","hash":{},"data":data}):helper)))+"\"\r\n		                   pstory-event=\""+alias4(((helper=(helper=helpers.event||(depth0!=null?depth0.event:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"event","hash":{},"data":data}):helper)))+"\"/>\r\n	            </div>\r\n"},"compiler":[7,">= 4.0.0"],"main":function(container,depth0,helpers,partials,data){var stack1;return"<div class=\"pstory-block-frame pstory-block-selectOne\">\r\n    <div class=\"pstory-block-container\">\r\n        <div class=\"pstory-block-content\">\r\n"+((stack1=helpers.each.call(depth0!=null?depth0:(container.nullContext||{}),depth0,{"name":"each","hash":{},"fn":container.program(1,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"        </div>\r\n    </div>\r\n</div>"},"useData":!0});this["Personetics"].UI.Handlebars.templates["pstory-block-spline-chart"]=Handlebars.template({"compiler":[7,">= 4.0.0"],"main":function(container,depth0,helpers,partials,data){return"<div class=\"pstory-block-frame pstory-block-spline-chart\">\r\n    <div class=\"pstory-block-container\">\r\n        <div class=\"pstory-block-content\">\r\n            <div class=\"pstory-spline-chart\"></div>\r\n        </div>\r\n    </div>\r\n</div>"},"useData":!0});this["Personetics"].UI.Handlebars.templates["pstory-block-table"]=Handlebars.template({"1":function(container,depth0,helpers,partials,data){return"                    <tr>\r\n                        <td class=\"perso-loading-table\">Loading...</td>\r\n                    </tr>\r\n"},"3":function(container,depth0,helpers,partials,data,blockParams,depths){var stack1;return((stack1=helpers["if"].call(depth0!=null?depth0:(container.nullContext||{}),(depth0!=null?depth0.twoCols:depth0),{"name":"if","hash":{},"fn":container.program(4,data,0,blockParams,depths),"inverse":container.program(10,data,0,blockParams,depths),"data":data}))!=null?stack1:"")},"4":function(container,depth0,helpers,partials,data){var stack1,alias1=depth0!=null?depth0:(container.nullContext||{});return((stack1=helpers["if"].call(alias1,(depth0!=null?depth0.showHeaders:depth0),{"name":"if","hash":{},"fn":container.program(5,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+((stack1=helpers.each.call(alias1,(depth0!=null?depth0.rows:depth0),{"name":"each","hash":{},"fn":container.program(8,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")},"5":function(container,depth0,helpers,partials,data){var stack1;return"                            <tr>\r\n"+((stack1=helpers.each.call(depth0!=null?depth0:(container.nullContext||{}),(depth0!=null?depth0.displayedCols:depth0),{"name":"each","hash":{},"fn":container.program(6,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"                            </tr>\r\n"},"6":function(container,depth0,helpers,partials,data){var stack1;return"                                    <th role=\"cell\">"+((stack1=container.lambda(depth0,depth0))!=null?stack1:"")+"</th>\r\n"},"8":function(container,depth0,helpers,partials,data){var stack1,alias1=container.lambda;return"                            <tr>\r\n                                <td class=\"perso-td-first\" role=\"cell\">"+((stack1=alias1((depth0!=null?depth0["0"]:depth0),depth0))!=null?stack1:"")+"</td>\r\n                                <td align=\"right\">\r\n                                    <span class=\"perso-td-second\" role=\"cell\">\r\n                                        "+((stack1=alias1((depth0!=null?depth0["1"]:depth0),depth0))!=null?stack1:"")+"\r\n                                    </span>\r\n                                </td>\r\n                            </tr>\r\n"},"10":function(container,depth0,helpers,partials,data,blockParams,depths){var stack1,alias1=depth0!=null?depth0:(container.nullContext||{});return((stack1=helpers["if"].call(alias1,(depth0!=null?depth0.showHeaders:depth0),{"name":"if","hash":{},"fn":container.program(11,data,0,blockParams,depths),"inverse":container.noop,"data":data}))!=null?stack1:"")+((stack1=helpers.each.call(alias1,(depth0!=null?depth0.rows:depth0),{"name":"each","hash":{},"fn":container.program(16,data,0,blockParams,depths),"inverse":container.noop,"data":data}))!=null?stack1:"")},"11":function(container,depth0,helpers,partials,data){var stack1;return"                            <tr>\r\n                                <th role=\"cell\">"+container.escapeExpression(container.lambda(((stack1=(depth0!=null?depth0.displayedCols:depth0))!=null?stack1["1"]:stack1),depth0))+"</th>                           \r\n"+((stack1=helpers["if"].call(depth0!=null?depth0:(container.nullContext||{}),(depth0!=null?depth0.fourCols:depth0),{"name":"if","hash":{},"fn":container.program(12,data,0),"inverse":container.program(14,data,0),"data":data}))!=null?stack1:"")+"                            </tr>\r\n"},"12":function(container,depth0,helpers,partials,data){var stack1;return"                                <th align=\"right\" role=\"cell\">"+container.escapeExpression(container.lambda(((stack1=(depth0!=null?depth0.displayedCols:depth0))!=null?stack1["3"]:stack1),depth0))+"</th>\r\n"},"14":function(container,depth0,helpers,partials,data){var stack1;return"                                    <th align=\"right\" role=\"cell\">"+container.escapeExpression(container.lambda(((stack1=(depth0!=null?depth0.displayedCols:depth0))!=null?stack1["2"]:stack1),depth0))+"</th>\r\n"},"16":function(container,depth0,helpers,partials,data,blockParams,depths){var stack1,alias1=container.lambda,alias2=depth0!=null?depth0:(container.nullContext||{});return"                            <tr>\r\n                                <td>\r\n                                    <span class=\"perso-td-date\" role=\"cell\">\r\n                                        "+((stack1=alias1((depth0!=null?depth0["0"]:depth0),depth0))!=null?stack1:"")+"\r\n                                        </span>\r\n                                    <span class=\"perso-td-first\" role=\"cell\">\r\n                                        "+((stack1=alias1((depth0!=null?depth0["1"]:depth0),depth0))!=null?stack1:"")+"\r\n                                    </span>\r\n                                </td>\r\n                                <td align=\"right\">\r\n                                    <span class=\"perso-td-second\" role=\"cell\">\r\n                                        "+((stack1=alias1((depth0!=null?depth0["2"]:depth0),depth0))!=null?stack1:"")+"\r\n                                    </span>\r\n"+((stack1=helpers["if"].call(alias2,(depths[1]!=null?depths[1].fourCols:depths[1]),{"name":"if","hash":{},"fn":container.program(17,data,0,blockParams,depths),"inverse":container.noop,"data":data}))!=null?stack1:"")+"                                </td>\r\n"+((stack1=helpers["if"].call(alias2,(depths[1]!=null?depths[1].fourCols:depths[1]),{"name":"if","hash":{},"fn":container.program(19,data,0,blockParams,depths),"inverse":container.noop,"data":data}))!=null?stack1:"")+"                            </tr>\r\n"},"17":function(container,depth0,helpers,partials,data){var stack1;return"                                        <span class=\"perso-td-last\" role=\"cell\">\r\n                                            "+((stack1=container.lambda((depth0!=null?depth0["3"]:depth0),depth0))!=null?stack1:"")+"\r\n                                        </span>\r\n"},"19":function(container,depth0,helpers,partials,data){var stack1;return"                                    <!--<td align=\"right\">\r\n                                        <span class=\"perso-td-last\" role=\"cell\">\r\n                                            "+((stack1=container.lambda((depth0!=null?depth0["3"]:depth0),depth0))!=null?stack1:"")+"\r\n                                        </span>\r\n                                    </td>-->\r\n"},"compiler":[7,">= 4.0.0"],"main":function(container,depth0,helpers,partials,data,blockParams,depths){var stack1;return"<div class=\"pstory-block-frame pstory-block-table\">\r\n    <div class=\"pstory-block-container\">\r\n        <div class=\"pstory-block-content\">\r\n            <table class=\"pstory-table\">\r\n"+((stack1=helpers["if"].call(depth0!=null?depth0:(container.nullContext||{}),(depth0!=null?depth0.future:depth0),{"name":"if","hash":{},"fn":container.program(1,data,0,blockParams,depths),"inverse":container.program(3,data,0,blockParams,depths),"data":data}))!=null?stack1:"")+"            </table>\r\n        </div>\r\n    </div>\r\n</div>"},"useData":!0,"useDepths":!0});this["Personetics"].UI.Handlebars.templates["pstory-block-tabs"]=Handlebars.template({"1":function(container,depth0,helpers,partials,data){var stack1,helper,alias1=depth0!=null?depth0:(container.nullContext||{}),alias2=helpers.helperMissing,alias3="function";return"            \r\n                <input type=\"button\" class=\"pstory-tab pstory-button "+((stack1=helpers["if"].call(alias1,(depth0!=null?depth0.selected:depth0),{"name":"if","hash":{},"fn":container.program(2,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\" value=\""+((stack1=((helper=(helper=helpers.text||(depth0!=null?depth0.text:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"text","hash":{},"data":data}):helper)))!=null?stack1:"")+"\" pstory-id=\""+container.escapeExpression(((helper=(helper=helpers.id||(depth0!=null?depth0.id:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"id","hash":{},"data":data}):helper)))+"\" />\r\n            "},"2":function(container,depth0,helpers,partials,data){return"selected"},"4":function(container,depth0,helpers,partials,data){var stack1,helper,alias1=depth0!=null?depth0:(container.nullContext||{}),alias2=helpers.helperMissing,alias3="function",alias4=container.escapeExpression;return"                    <li  class=\"pstory-tab pstory-button "+((stack1=helpers["if"].call(alias1,(depth0!=null?depth0.selected:depth0),{"name":"if","hash":{},"fn":container.program(2,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\" aria-selected=\""+alias4(((helper=(helper=helpers.selected||(depth0!=null?depth0.selected:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"selected","hash":{},"data":data}):helper)))+"\" role=\"tab\" tabindex=\""+alias4(((helper=(helper=helpers.index||(data&&data.index))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"index","hash":{},"data":data}):helper)))+"\" pstory-id=\""+alias4(((helper=(helper=helpers.id||(depth0!=null?depth0.id:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"id","hash":{},"data":data}):helper)))+"\">"+((stack1=((helper=(helper=helpers.text||(depth0!=null?depth0.text:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"text","hash":{},"data":data}):helper)))!=null?stack1:"")+"</li>\r\n"},"compiler":[7,">= 4.0.0"],"main":function(container,depth0,helpers,partials,data){var stack1,helper,alias1=depth0!=null?depth0:(container.nullContext||{}),alias2=helpers.helperMissing,alias3="function",alias4=container.escapeExpression;return"<div id=\"pstory-block-tabs_"+alias4(((helper=(helper=helpers.id||(depth0!=null?depth0.id:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"id","hash":{},"data":data}):helper)))+"\" class=\"pstory-block-frame pstory-block-tabs "+alias4(((helper=(helper=helpers["class"]||(depth0!=null?depth0["class"]:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"class","hash":{},"data":data}):helper)))+"\">\r\n    <div class=\"pstory-block-container\">\r\n        <div class=\"pstory-block-content\">\r\n            <!--"+((stack1=helpers.each.call(alias1,(depth0!=null?depth0.options:depth0),{"name":"each","hash":{},"fn":container.program(1,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"-->\r\n            <div class=\"pstory-tab-animated-border-bottom\"></div>            \r\n            <ul class=\"tablist\" role=\"tablist\">\r\n"+((stack1=helpers.each.call(alias1,(depth0!=null?depth0.options:depth0),{"name":"each","hash":{},"fn":container.program(4,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"            </ul>\r\n        </div>\r\n    </div>\r\n</div>"},"useData":!0});this["Personetics"].UI.Handlebars.templates["pstory-block-textboxes"]=Handlebars.template({"1":function(container,depth0,helpers,partials,data){return"with-image"},"3":function(container,depth0,helpers,partials,data){var stack1;return((stack1=helpers["if"].call(depth0!=null?depth0:(container.nullContext||{}),(depth0!=null?depth0.image:depth0),{"name":"if","hash":{},"fn":container.program(4,data,0),"inverse":container.program(6,data,0),"data":data}))!=null?stack1:"")},"4":function(container,depth0,helpers,partials,data){var stack1,helper,alias1=depth0!=null?depth0:(container.nullContext||{}),alias2=helpers.helperMissing,alias3="function";return"                       <div class=\"perso-textbox-with-image\" role=\"text\">\r\n                           <div class=\"perso-textbox-image "+((stack1=((helper=(helper=helpers.image||(depth0!=null?depth0.image:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"image","hash":{},"data":data}):helper)))!=null?stack1:"")+"\"></div>\r\n                           <div class=\"perso-value\">"+((stack1=((helper=(helper=helpers.value||(depth0!=null?depth0.value:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"value","hash":{},"data":data}):helper)))!=null?stack1:"")+"</div>\r\n                           <div class=\"perso-label\">"+((stack1=((helper=(helper=helpers.label||(depth0!=null?depth0.label:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"label","hash":{},"data":data}):helper)))!=null?stack1:"")+"</div>\r\n                       </div>\r\n"},"6":function(container,depth0,helpers,partials,data){var stack1,helper,alias1=depth0!=null?depth0:(container.nullContext||{}),alias2=helpers.helperMissing,alias3="function";return"                       <div class=\"perso-textbox\" role=\"text\">\r\n                           <div class=\"perso-value\">"+((stack1=((helper=(helper=helpers.value||(depth0!=null?depth0.value:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"value","hash":{},"data":data}):helper)))!=null?stack1:"")+"</div>\r\n                           <div class=\"perso-label\">"+((stack1=((helper=(helper=helpers.label||(depth0!=null?depth0.label:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"label","hash":{},"data":data}):helper)))!=null?stack1:"")+"</div>\r\n                       </div>\r\n"},"compiler":[7,">= 4.0.0"],"main":function(container,depth0,helpers,partials,data){var stack1,helper,alias1=depth0!=null?depth0:(container.nullContext||{});return"<div class=\"pstory-block-frame pstory-block-textboxes "+container.escapeExpression(((helper=(helper=helpers["class"]||(depth0!=null?depth0["class"]:depth0))!=null?helper:helpers.helperMissing),(typeof helper==="function"?helper.call(alias1,{"name":"class","hash":{},"data":data}):helper)))+"\">\r\n    <div class=\"pstory-block-contanier\">\r\n        <div class=\"pstory-block-content\">\r\n           <div class=\"perso-textboxes-wrapper "+((stack1=helpers["if"].call(alias1,(depth0!=null?depth0.hasImage:depth0),{"name":"if","hash":{},"fn":container.program(1,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\" role=\"text\">\r\n"+((stack1=helpers.each.call(alias1,(depth0!=null?depth0.options:depth0),{"name":"each","hash":{},"fn":container.program(3,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"           </div>\r\n        </div>\r\n    </div>\r\n</div>\r\n"},"useData":!0});this["Personetics"].UI.Handlebars.templates["pstory-block-txt-note"]=Handlebars.template({"compiler":[7,">= 4.0.0"],"main":function(container,depth0,helpers,partials,data){var stack1,helper,alias1=depth0!=null?depth0:(container.nullContext||{}),alias2=helpers.helperMissing,alias3="function";return"<div class=\"pstory-block-frame pstory-block-text "+container.escapeExpression(((helper=(helper=helpers["class"]||(depth0!=null?depth0["class"]:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"class","hash":{},"data":data}):helper)))+"\">\r\n    <div class=\"pstory-block-contanier\">\r\n        <div class=\"pstory-block-content\">\r\n            <div class=\"pstory-block-note-icon\"></div>\r\n            <div class=\"pstory-block-note-txt\" role=\"text\">\r\n                "+((stack1=((helper=(helper=helpers.text||(depth0!=null?depth0.text:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"text","hash":{},"data":data}):helper)))!=null?stack1:"")+"\r\n            </div>\r\n        </div>\r\n    </div>\r\n</div>\r\n"},"useData":!0});this["Personetics"].UI.Handlebars.templates["pstory-block-txt"]=Handlebars.template({"1":function(container,depth0,helpers,partials,data){return"        <div class=\"pstory-block-content\" aria-level=\"2\" role=\"heading\">\r\n"},"3":function(container,depth0,helpers,partials,data){return"        <div class=\"pstory-block-content\" role=\"text\">\r\n"},"compiler":[7,">= 4.0.0"],"main":function(container,depth0,helpers,partials,data){var stack1,helper,alias1=depth0!=null?depth0:(container.nullContext||{}),alias2=helpers.helperMissing,alias3="function";return"<div class=\"pstory-block-frame pstory-block-text "+container.escapeExpression(((helper=(helper=helpers["class"]||(depth0!=null?depth0["class"]:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"class","hash":{},"data":data}):helper)))+"\">\r\n    <div class=\"pstory-block-contanier\">\r\n"+((stack1=helpers["if"].call(alias1,(depth0!=null?depth0.needAccessibility:depth0),{"name":"if","hash":{},"fn":container.program(1,data,0),"inverse":container.program(3,data,0),"data":data}))!=null?stack1:"")+"            "+((stack1=((helper=(helper=helpers.text||(depth0!=null?depth0.text:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"text","hash":{},"data":data}):helper)))!=null?stack1:"")+"\r\n        </div>\r\n    </div>\r\n</div>\r\n"},"useData":!0});this["Personetics"].UI.Handlebars.templates["pstory-frame"]=Handlebars.template({"compiler":[7,">= 4.0.0"],"main":function(container,depth0,helpers,partials,data){var helper,alias1=depth0!=null?depth0:(container.nullContext||{}),alias2=helpers.helperMissing,alias3="function",alias4=container.escapeExpression;return"<div class=\"pstory-frame "+alias4(((helper=(helper=helpers.langClass||(depth0!=null?depth0.langClass:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"langClass","hash":{},"data":data}):helper)))+" "+alias4(((helper=(helper=helpers.directionClass||(depth0!=null?depth0.directionClass:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"directionClass","hash":{},"data":data}):helper)))+" "+alias4(((helper=(helper=helpers.cssClass||(depth0!=null?depth0.cssClass:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"cssClass","hash":{},"data":data}):helper)))+"\" data-id=\"pstory-frame_"+alias4(((helper=(helper=helpers.storyId||(depth0!=null?depth0.storyId:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"storyId","hash":{},"data":data}):helper)))+"\">\r\n    <div class=\"pstory-container\"></div>\r\n</div>\r\n"},"useData":!0});this["Personetics"].UI.Handlebars.templates["tmpl-perso-post"]=Handlebars.template({"compiler":[7,">= 4.0.0"],"main":function(container,depth0,helpers,partials,data){return"<div class=\"post-frame\">\r\n    <div class=\"post-container\">\r\n    </div>\r\n</div>"},"useData":!0});this["Personetics"].UI.Handlebars.templates["tmpl-perso-rating"]=Handlebars.template({"compiler":[7,">= 4.0.0"],"main":function(container,depth0,helpers,partials,data){var helper;return"<div class=\"perso-ratings-wrapper\">\r\n   <div class='perso-ratings-text'>"+container.escapeExpression(((helper=(helper=helpers.ratingTitle||(depth0!=null?depth0.ratingTitle:depth0))!=null?helper:helpers.helperMissing),(typeof helper==="function"?helper.call(depth0!=null?depth0:(container.nullContext||{}),{"name":"ratingTitle","hash":{},"data":data}):helper)))+"</div>\r\n   <div class='perso-ratings-icons' data-rating-max='5'></div>\r\n</div>\r\n\r\n"},"useData":!0});this["Personetics"].UI.Handlebars.templates["tmpl-perso-teasers"]=Handlebars.template({"1":function(container,depth0,helpers,partials,data){var stack1,helper,alias1=container.escapeExpression;return"<div class=\"perso-teaser\" id=\""+alias1(((helper=(helper=helpers.id||(depth0!=null?depth0.id:depth0))!=null?helper:helpers.helperMissing),(typeof helper==="function"?helper.call(depth0!=null?depth0:(container.nullContext||{}),{"name":"id","hash":{},"data":data}):helper)))+"\">"+alias1(container.lambda(((stack1=(depth0!=null?depth0.teaser:depth0))!=null?stack1.title:stack1),depth0))+"</div>\r\n"},"compiler":[7,">= 4.0.0"],"main":function(container,depth0,helpers,partials,data){var stack1;return((stack1=helpers.each.call(depth0!=null?depth0:(container.nullContext||{}),(depth0!=null?depth0.posts:depth0),{"name":"each","hash":{},"fn":container.program(1,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")},"useData":!0});this["Personetics"].UI.Handlebars.templates["tmpl-pfeed"]=Handlebars.template({"compiler":[7,">= 4.0.0"],"main":function(container,depth0,helpers,partials,data){return"<div>\r\n    <div class=\"perso-header\">\r\n        Feed by <!--<img src=\"resources/images/perso-logo.png\" class=\"perso-logo\">-->\r\n        <svg  xmlns:svg=\"http://www.w3.org/2000/svg\" xmlns=\"http://www.w3.org/2000/svg\" width=\"187\" height=\"37\" viewBox=\"0 0 187 37\">\r\n            <image width=\"187\" height=\"37\" preserveAspectRatio=\"none\" id=\"image10\" x=\"0\" y=\"0\"\r\n                    xlink:href=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAALsAAAAlCAYAAAAa/JhZAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyNpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNS1jMDE0IDc5LjE1MTQ4MSwgMjAxMy8wMy8xMy0xMjowOToxNSAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIChNYWNpbnRvc2gpIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjRCQjk1MzY1QkU4NjExRTU4OTQzRThGMDA3MzBBMTYxIiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOjRCQjk1MzY2QkU4NjExRTU4OTQzRThGMDA3MzBBMTYxIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6NEJCOTUzNjNCRTg2MTFFNTg5NDNFOEYwMDczMEExNjEiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6NEJCOTUzNjRCRTg2MTFFNTg5NDNFOEYwMDczMEExNjEiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz5K1DUkAAAMWElEQVR42uxcTXLruBGGX7x/yjqVMl05gOVdMrMwdQLLJ7B8AlknkHUCWScQfQLLJxC9mEl2pg+QMl9+1o/ZT8oBlK+tVhsNgpRdzzNPqGJJokigu/Hh60YD5J7ZlV0JlIM//HFpP1JxOv/y73/2PqrMfzpIXuT95Zf/FlbWyn3f33XndwfexH4k4nRlAVH8BnTr2o+5BXi+v/+7O/vp9Bzb8zdWv2wH9u+vDBwAJFPbo/crB3rHAd2CfGRBPraHA/69PS6cvpbtyx3Yv30HuU55cbW7stUgnuF7akHfs4Af2u9TB3j7fb4D+7d1uS4e7uD3wgL+7AOKOiIZedjzAeV0MmYgDxerjxGuuRCmsvZ93A91gGMcKFba4xETk6JBh7qJwikJALeS2TrKNwZOiknUCWS+t20sfi1AR+k7PazceQOdu6KvCs22LFY/8AEF9fli+KoN2KFjl80PKiZj7P0J6qB7yxB2LJt32c8bsDrh4GiPVd53MY9HMVlKVHStCW3rorgw8fzt7hm5CcMbTbbmnmyBM8qhYsCU6ehkWbz14IsIXR4U2zgiuKi599Iew0A/ucEykYPG3nvlidW18pJtUe5z9V8F5DtX9HvRE3WUnjr6AKl2fwH8ZRx/DAvOE02d/PbcJezkrqs+MYVuI4BuIIRT/gmCGY9R5wFhVxMJDIht2fHBA/SVjCSb6wDXlj2ecP0U8o/x/QGd9G7ZD1H/OGCbfoS+45p+cvZY2uun38hbjWuATvH1g8QAwHlbc38X/faENlcFA4fYfITTjtU/O1Z35LqHRp630HNjlNu6vkYOGjfajgNudwDBO/AmZ+RalTCA1+tkusZ1txHGv4j1NKizj3AgQXv3kmlYqHHLdFiA+ULlWIaKYK2HSLtuxNvODu/N7DX9EcSAref3zFbLBvdq3jvBYKLQJv/7l3Ll5fbxpwm4xA6LuX3F5TFdwxkElgo7Y9/B9fYFw4+RGvKVc1ZXAuD3agy7AHArxoS1RoNrjAH6AF7Lx8jODj0B1KXwiJeegdnxMLOUZx7Q9xEDr++5ZoqJ73uHaaHwl+Z9qUd3nu48DehnMB9LxcT5VYGuV96YPjQa+SoZwoKhEjZMEYf5yg0AkCOUSIRLii1pDdDdHIIb4FZh/QJMTBOeIgLkxBbjmmzArb32uEEa8cwTPh4ok++gN7LXjWAbadMhGN4B4Eph6tYroiCArgLUEQ00Fs+PCejC9l1Fx8rTD0dtEhD7rkHXQXUsiMoXCrvJ2Ty/rxAGuGwJdhMAus+tJorx2mRplp76KgZyzt79wMCXk1FHAIUAc9fj4Xz6ZsLOFQO89Dqjd2T1oRIGnUn5MNgWHlxoxcX1EyQRqhBrx5RPDRomoTPF7acICXyza36NDCG0rIPGnj7QXEVcZ8C8c9/EuobVE4/ch3DDVQQ4vRkp5uZlAsAEbLa635GLPJS0YFITqm6bWfIR1iSAn0LBW6EkQxyxfrVt3SLR0DqZsC/i87SmcSp3PiXdyLPC+GJ6ykLIe24UAy4jWb9UWKtQ4mHKBAwgUwG978FGlTL7fxV+4FrnFTPhrVI2SLQyY2091oA9UcLGJiXRiGXL0lUAnbdJdKBvOoFMVR/zkJkv9RnF7AH2UQd14L/CY5Bbj2FeMXJDoL+K6YTLPAaQ6zqL0l0v7FHXoYKZ7gMA0+x6HfJu78XEH7mgz3oRyYIOCHS+DdjTBq6rr7CsiQBYCZBeKLP6WKDnIQZxXgaTrh5i6JhJ42phzU2keQ43gjWbFM7qGgvW1UkeKfZ4r+X9MhD6tQG8C3GOkaGrm1sNmq7VtNkbo6WZqNNmRs8lv+R9PQaai0FUmnBeehJpQOrwC7aCSmmsTgDAbmHmMMJznTSYX0hW53V2hTfJlfCSBkxmvnFB2OoLF4ehSbEbDKF0KHTL2JzvRAlxziOTAbVhjBSwi438fYVlSzJAAIjncoKBFcYHwxYC2AROCxHKBntIpjSxAXO4FOUZFjPOAqzfUbxdV6QF+8qg96bjlHmB7Pijmrh4qnkeTFaXDTzTq4HZkJl9YLvEaqjx9PUSWZaujBjgUaccIy57hpTy4baDM8TsaeTKamXEwpCLxe29BwLA1HFPmNT9B53aVzzAImD0RSTQB8wzzJH2umfsXNVkbxIlpqZB4Mvl3wTmNRoJ3As7DMCYXUW2DjxPhmQBnTtlNnf/x6ZauyCciukcm3efKazrQDtk9pB9vRSLcLTN4BKDhXQrIVe/4bzyVdljnbdsOWDUpXaEJoOG9W1shlK2H/RimF15pKxJITZ5ahDDHiPnLRfQ1IWbBqu9bcqGrSL7uul2gYHxryzHEOUhBvXyLbG3VRjTpjGA9qLBCBx5Jq7FFqmtYkvdaEtp1uCeSpmoB3PPNbJWsXMUD3HkHtu96YQVGLhoceuI2aupTEXTeUtbsBODZZGGOKzJiKyuUSavsy06Z9LiXpKF6zYy4Tx1BaDnou0cIF5EDNBJDSgck8akU+syXsb4F8Nahwesn5vI1yMbwzaHsEEZ2UeNtzeEwpjS0/DWD0bIbQWR4Qi5OdfuTdNFC/Ggw5EIi5yOX+pSmYG985lR9ma3sE3fbC6+LZB5yT326Ht0ie4fTAIHqCMBwB/BmAthu9QT5uQ1/eWT7x4Dv4jor9Ssd5ZSPz2aLZ4/2IuNy3ZlA/RJw3BqVz5A2T2D2txdl+Z9lt535Z3Lp50JdmUH9l3Zld8o2IudKXblewH77gU9u/LdTFCjmf2HH/7s0kryecHHn3/+2wL/0XOlNIAoBUV5ZLcXe5WCMv9fbqcctkvr3Zn1VgBXzyN+u/QVPRLo6nW591zIQO1QuUG9CdqkJ2cSs16aLs06t8uvc0vWn0X9lO+fQq6M/cf1kIVkp+K2SfD1BJ/NUtzDZSbZpF3mrG2So8L3CyYTl1GzAS/cBl+YvtI29J88fwdc8b4rYceC6T6EHIVZr4uE9DdM7wmra+Mai0c/s2MVK4/EewJhBlAwZSAb4zffx3Bk1nlauocDNGH/8R2VvF7a4z5hHZkIufjzsbT8npj1o3Ik+wPrYNprb8R1tCvyCudSs37wfGBep2n7Rt+W2zWbj5LRK9lMwGYn+D32yMbtMjWbOXCSg3Z3zj3/hWzAC393y5TJor3ThZ/nzwpP0faEDTrSacnkoN91+hNWUkEi8hqV2Q3YNhUgfVUcgztWsSy+6iT7uwfGp33u1xAiE7cSmOv2Ko/N5vZQ6iRa9ctNzQuC2AAZmvVGKQJawa45M/6nfohBniFLzjp0YdZPzTRZXJswVkrYd81mFYjhRqmPtkT3jJ4K7XrkjLUBececDbKJ57x2/bNZvxGsRJsFA6iUw31/YoAN6X/OvMkoNgzn2ZiMCVq2CIn6EHhmNl97RkafQ6hFDSAuzea21iOz+ZhdauK2EOTm9fZYvk+cWG7WUEcKtU4b2meJY8DaDNmMHtDwAfES9dTtqZmY9bt32tigy7xOKVic68NBOAZ705scRqjjKzBw75HDsOuPavRPmJcv69jcC3b2ZI/bo3Dc4iWb5xAw8QjRYTFp6HUUBVhOY5qUGXO45XyFOiZ2Z2Rq1svqjYzMgDfBQBlH2MwwoJwo3ietkeMa8g5b2oD+L4S3vWH65MoAOUbbtLPxjA36JNJmPv3JZl18RpPOp+fnZ8OP8l//KO1RyfPyoOK+2xAmYWAYewycw3OMWJwfAkWXXXPH6l6YuOcUCZzyujvGRBPTbDPROQA5FnOQ2JLjuGH6hGxGHvbavH59xDVscW3q3885Evc3scEI/8udq/yxwFIMgjOWcODh1kJMOO+E/cgedzX6D1i429HmSz7MvtV2gZWb++mnv64M9+OPf0kQf8kwYgEDzY3+5Ak9pTRnhs3ACBkzykwBOLFLF52UiFDtHHXlLLtTRrANvX8lY514yn5PGSBmnnBtzOrJWWjQY53tsxk9dZ8oxDBA2xeBQZYxkIRs0GTgnyjZJRokSxaqOPkOGAHl+ORyDCCbZGuuP4V6h0zeJxYOkudwGHQfFxaTpW+C2rTcmfVrIHLOoq4B2xilufh1Bp3SZ0YpPN8zjNpc3HOEug49nTMT8R61z9/RQk+w07saiYkqcZ3xyDQRE8gZA+BIpN1KwYJXgv0ylm7j92g2O2MDecbqr/BfR7En16Nkcx/NBpru8vxn5XzB8EDeYII4/QR6ZUpfjBhBaPqXIp3KdSs9HnBDp/8JMAAoWRW8rHmVTQAAAABJRU5ErkJggg==\"/>\r\n        </svg>\r\n    </div>\r\n    <div class=\"perso-main\">\r\n        <div class=\"nano perso-container\">\r\n            <div class=\"nano-content perso-scroll\">\r\n            </div>\r\n        </div>\r\n    </div>\r\n    <div class=\"perso-footer\">\r\n        <div class=\"footer-button\">Close</div>\r\n    </div>\r\n</div>\r\n"},"useData":!0});this["Personetics"].UI.Handlebars.templates["tmpl-pslide"]=Handlebars.template({"compiler":[7,">= 4.0.0"],"main":function(container,depth0,helpers,partials,data){var helper;return"<div class=\""+container.escapeExpression(((helper=(helper=helpers["class"]||(depth0!=null?depth0["class"]:depth0))!=null?helper:helpers.helperMissing),(typeof helper==="function"?helper.call(depth0!=null?depth0:(container.nullContext||{}),{"name":"class","hash":{},"data":data}):helper)))+"\">\r\n    <div class=\"perso-header\">\r\n        <sup><sup>Feed by </sup><!--<img src=\"resources/images/perso-logo.png\" class=\"perso-logo\">-->\r\n            <svg  xmlns:svg=\"http://www.w3.org/2000/svg\" xmlns=\"http://www.w3.org/2000/svg\" width=\"187\" height=\"37\" viewBox=\"0 0 187 37\">\r\n                <image width=\"187\" height=\"37\" preserveAspectRatio=\"none\" id=\"image10\" x=\"0\" y=\"0\"\r\n                       xlink:href=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAALsAAAAlCAYAAAAa/JhZAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyNpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNS1jMDE0IDc5LjE1MTQ4MSwgMjAxMy8wMy8xMy0xMjowOToxNSAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIChNYWNpbnRvc2gpIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjRCQjk1MzY1QkU4NjExRTU4OTQzRThGMDA3MzBBMTYxIiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOjRCQjk1MzY2QkU4NjExRTU4OTQzRThGMDA3MzBBMTYxIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6NEJCOTUzNjNCRTg2MTFFNTg5NDNFOEYwMDczMEExNjEiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6NEJCOTUzNjRCRTg2MTFFNTg5NDNFOEYwMDczMEExNjEiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz5K1DUkAAAMWElEQVR42uxcTXLruBGGX7x/yjqVMl05gOVdMrMwdQLLJ7B8AlknkHUCWScQfQLLJxC9mEl2pg+QMl9+1o/ZT8oBlK+tVhsNgpRdzzNPqGJJokigu/Hh60YD5J7ZlV0JlIM//HFpP1JxOv/y73/2PqrMfzpIXuT95Zf/FlbWyn3f33XndwfexH4k4nRlAVH8BnTr2o+5BXi+v/+7O/vp9Bzb8zdWv2wH9u+vDBwAJFPbo/crB3rHAd2CfGRBPraHA/69PS6cvpbtyx3Yv30HuU55cbW7stUgnuF7akHfs4Af2u9TB3j7fb4D+7d1uS4e7uD3wgL+7AOKOiIZedjzAeV0MmYgDxerjxGuuRCmsvZ93A91gGMcKFba4xETk6JBh7qJwikJALeS2TrKNwZOiknUCWS+t20sfi1AR+k7PazceQOdu6KvCs22LFY/8AEF9fli+KoN2KFjl80PKiZj7P0J6qB7yxB2LJt32c8bsDrh4GiPVd53MY9HMVlKVHStCW3rorgw8fzt7hm5CcMbTbbmnmyBM8qhYsCU6ehkWbz14IsIXR4U2zgiuKi599Iew0A/ucEykYPG3nvlidW18pJtUe5z9V8F5DtX9HvRE3WUnjr6AKl2fwH8ZRx/DAvOE02d/PbcJezkrqs+MYVuI4BuIIRT/gmCGY9R5wFhVxMJDIht2fHBA/SVjCSb6wDXlj2ecP0U8o/x/QGd9G7ZD1H/OGCbfoS+45p+cvZY2uun38hbjWuATvH1g8QAwHlbc38X/faENlcFA4fYfITTjtU/O1Z35LqHRp630HNjlNu6vkYOGjfajgNudwDBO/AmZ+RalTCA1+tkusZ1txHGv4j1NKizj3AgQXv3kmlYqHHLdFiA+ULlWIaKYK2HSLtuxNvODu/N7DX9EcSAref3zFbLBvdq3jvBYKLQJv/7l3Ll5fbxpwm4xA6LuX3F5TFdwxkElgo7Y9/B9fYFw4+RGvKVc1ZXAuD3agy7AHArxoS1RoNrjAH6AF7Lx8jODj0B1KXwiJeegdnxMLOUZx7Q9xEDr++5ZoqJ73uHaaHwl+Z9qUd3nu48DehnMB9LxcT5VYGuV96YPjQa+SoZwoKhEjZMEYf5yg0AkCOUSIRLii1pDdDdHIIb4FZh/QJMTBOeIgLkxBbjmmzArb32uEEa8cwTPh4ok++gN7LXjWAbadMhGN4B4Eph6tYroiCArgLUEQ00Fs+PCejC9l1Fx8rTD0dtEhD7rkHXQXUsiMoXCrvJ2Ty/rxAGuGwJdhMAus+tJorx2mRplp76KgZyzt79wMCXk1FHAIUAc9fj4Xz6ZsLOFQO89Dqjd2T1oRIGnUn5MNgWHlxoxcX1EyQRqhBrx5RPDRomoTPF7acICXyza36NDCG0rIPGnj7QXEVcZ8C8c9/EuobVE4/ch3DDVQQ4vRkp5uZlAsAEbLa635GLPJS0YFITqm6bWfIR1iSAn0LBW6EkQxyxfrVt3SLR0DqZsC/i87SmcSp3PiXdyLPC+GJ6ykLIe24UAy4jWb9UWKtQ4mHKBAwgUwG978FGlTL7fxV+4FrnFTPhrVI2SLQyY2091oA9UcLGJiXRiGXL0lUAnbdJdKBvOoFMVR/zkJkv9RnF7AH2UQd14L/CY5Bbj2FeMXJDoL+K6YTLPAaQ6zqL0l0v7FHXoYKZ7gMA0+x6HfJu78XEH7mgz3oRyYIOCHS+DdjTBq6rr7CsiQBYCZBeKLP6WKDnIQZxXgaTrh5i6JhJ42phzU2keQ43gjWbFM7qGgvW1UkeKfZ4r+X9MhD6tQG8C3GOkaGrm1sNmq7VtNkbo6WZqNNmRs8lv+R9PQaai0FUmnBeehJpQOrwC7aCSmmsTgDAbmHmMMJznTSYX0hW53V2hTfJlfCSBkxmvnFB2OoLF4ehSbEbDKF0KHTL2JzvRAlxziOTAbVhjBSwi438fYVlSzJAAIjncoKBFcYHwxYC2AROCxHKBntIpjSxAXO4FOUZFjPOAqzfUbxdV6QF+8qg96bjlHmB7Pijmrh4qnkeTFaXDTzTq4HZkJl9YLvEaqjx9PUSWZaujBjgUaccIy57hpTy4baDM8TsaeTKamXEwpCLxe29BwLA1HFPmNT9B53aVzzAImD0RSTQB8wzzJH2umfsXNVkbxIlpqZB4Mvl3wTmNRoJ3As7DMCYXUW2DjxPhmQBnTtlNnf/x6ZauyCciukcm3efKazrQDtk9pB9vRSLcLTN4BKDhXQrIVe/4bzyVdljnbdsOWDUpXaEJoOG9W1shlK2H/RimF15pKxJITZ5ahDDHiPnLRfQ1IWbBqu9bcqGrSL7uul2gYHxryzHEOUhBvXyLbG3VRjTpjGA9qLBCBx5Jq7FFqmtYkvdaEtp1uCeSpmoB3PPNbJWsXMUD3HkHtu96YQVGLhoceuI2aupTEXTeUtbsBODZZGGOKzJiKyuUSavsy06Z9LiXpKF6zYy4Tx1BaDnou0cIF5EDNBJDSgck8akU+syXsb4F8Nahwesn5vI1yMbwzaHsEEZ2UeNtzeEwpjS0/DWD0bIbQWR4Qi5OdfuTdNFC/Ggw5EIi5yOX+pSmYG985lR9ma3sE3fbC6+LZB5yT326Ht0ie4fTAIHqCMBwB/BmAthu9QT5uQ1/eWT7x4Dv4jor9Ssd5ZSPz2aLZ4/2IuNy3ZlA/RJw3BqVz5A2T2D2txdl+Z9lt535Z3Lp50JdmUH9l3Zld8o2IudKXblewH77gU9u/LdTFCjmf2HH/7s0kryecHHn3/+2wL/0XOlNIAoBUV5ZLcXe5WCMv9fbqcctkvr3Zn1VgBXzyN+u/QVPRLo6nW591zIQO1QuUG9CdqkJ2cSs16aLs06t8uvc0vWn0X9lO+fQq6M/cf1kIVkp+K2SfD1BJ/NUtzDZSbZpF3mrG2So8L3CyYTl1GzAS/cBl+YvtI29J88fwdc8b4rYceC6T6EHIVZr4uE9DdM7wmra+Mai0c/s2MVK4/EewJhBlAwZSAb4zffx3Bk1nlauocDNGH/8R2VvF7a4z5hHZkIufjzsbT8npj1o3Ik+wPrYNprb8R1tCvyCudSs37wfGBep2n7Rt+W2zWbj5LRK9lMwGYn+D32yMbtMjWbOXCSg3Z3zj3/hWzAC393y5TJor3ThZ/nzwpP0faEDTrSacnkoN91+hNWUkEi8hqV2Q3YNhUgfVUcgztWsSy+6iT7uwfGp33u1xAiE7cSmOv2Ko/N5vZQ6iRa9ctNzQuC2AAZmvVGKQJawa45M/6nfohBniFLzjp0YdZPzTRZXJswVkrYd81mFYjhRqmPtkT3jJ4K7XrkjLUBececDbKJ57x2/bNZvxGsRJsFA6iUw31/YoAN6X/OvMkoNgzn2ZiMCVq2CIn6EHhmNl97RkafQ6hFDSAuzea21iOz+ZhdauK2EOTm9fZYvk+cWG7WUEcKtU4b2meJY8DaDNmMHtDwAfES9dTtqZmY9bt32tigy7xOKVic68NBOAZ705scRqjjKzBw75HDsOuPavRPmJcv69jcC3b2ZI/bo3Dc4iWb5xAw8QjRYTFp6HUUBVhOY5qUGXO45XyFOiZ2Z2Rq1svqjYzMgDfBQBlH2MwwoJwo3ietkeMa8g5b2oD+L4S3vWH65MoAOUbbtLPxjA36JNJmPv3JZl18RpPOp+fnZ8OP8l//KO1RyfPyoOK+2xAmYWAYewycw3OMWJwfAkWXXXPH6l6YuOcUCZzyujvGRBPTbDPROQA5FnOQ2JLjuGH6hGxGHvbavH59xDVscW3q3885Evc3scEI/8udq/yxwFIMgjOWcODh1kJMOO+E/cgedzX6D1i429HmSz7MvtV2gZWb++mnv64M9+OPf0kQf8kwYgEDzY3+5Ak9pTRnhs3ACBkzykwBOLFLF52UiFDtHHXlLLtTRrANvX8lY514yn5PGSBmnnBtzOrJWWjQY53tsxk9dZ8oxDBA2xeBQZYxkIRs0GTgnyjZJRokSxaqOPkOGAHl+ORyDCCbZGuuP4V6h0zeJxYOkudwGHQfFxaTpW+C2rTcmfVrIHLOoq4B2xilufh1Bp3SZ0YpPN8zjNpc3HOEug49nTMT8R61z9/RQk+w07saiYkqcZ3xyDQRE8gZA+BIpN1KwYJXgv0ylm7j92g2O2MDecbqr/BfR7En16Nkcx/NBpru8vxn5XzB8EDeYII4/QR6ZUpfjBhBaPqXIp3KdSs9HnBDp/8JMAAoWRW8rHmVTQAAAABJRU5ErkJggg==\"/>\r\n            </svg>\r\n        </sup>\r\n    </div>\r\n    <div class=\"perso-main\">\r\n        <div class=\"nano perso-container\">\r\n            <div  class=\"nano-content perso-scroll\"></div>\r\n        </div>\r\n    </div>\r\n    <div class=\"perso-footer\"><div class=\"footer-button\">Close</div></div>\r\n</div>"},"useData":!0});this["Personetics"].UI.Handlebars.templates["tmpl-pstory-dialog-continue-btn"]=Handlebars.template({"1":function(container,depth0,helpers,partials,data){var stack1;return"        		"+((stack1=helpers["if"].call(depth0!=null?depth0:(container.nullContext||{}),(depth0!=null?depth0.showBtn:depth0),{"name":"if","hash":{},"fn":container.program(2,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\r\n"},"2":function(container,depth0,helpers,partials,data){var helper,alias1=depth0!=null?depth0:(container.nullContext||{}),alias2=helpers.helperMissing,alias3="function",alias4=container.escapeExpression;return"<div class=\"pstory-dialog-btn\" data-action=\""+alias4(((helper=(helper=helpers.actionBtn||(depth0!=null?depth0.actionBtn:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"actionBtn","hash":{},"data":data}):helper)))+"\">"+alias4(((helper=(helper=helpers.diaogBtn||(depth0!=null?depth0.diaogBtn:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"diaogBtn","hash":{},"data":data}):helper)))+"</div>"},"compiler":[7,">= 4.0.0"],"main":function(container,depth0,helpers,partials,data){var stack1,helper,alias1=depth0!=null?depth0:(container.nullContext||{}),alias2=helpers.helperMissing,alias3="function",alias4=container.escapeExpression;return"<div class=\"pstory-dialog-frame perso-dialog-actions-btn "+alias4(((helper=(helper=helpers["class"]||(depth0!=null?depth0["class"]:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"class","hash":{},"data":data}):helper)))+"\" id=\"pdlg-"+alias4(((helper=(helper=helpers.id||(depth0!=null?depth0.id:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"id","hash":{},"data":data}):helper)))+"\">\r\n    <div class=\"pstory-dialog-container\">\r\n        <div class=\"pstory-dialog-content\" ></div>\r\n        <div class=\"pstory-dialog-buttons\" data-numOfDialogBtn=\""+alias4(container.lambda(((stack1=(depth0!=null?depth0.btn:depth0))!=null?stack1.length:stack1),depth0))+"\">\r\n"+((stack1=helpers.each.call(alias1,(depth0!=null?depth0.btn:depth0),{"name":"each","hash":{},"fn":container.program(1,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"		</div>\r\n    </div>\r\n</div>"},"useData":!0});this["Personetics"].UI.Handlebars.templates["tmpl-pstory-dialog"]=Handlebars.template({"compiler":[7,">= 4.0.0"],"main":function(container,depth0,helpers,partials,data){var helper,alias1=depth0!=null?depth0:(container.nullContext||{}),alias2=helpers.helperMissing,alias3="function",alias4=container.escapeExpression;return"<div class=\"pstory-dialog-frame "+alias4(((helper=(helper=helpers["class"]||(depth0!=null?depth0["class"]:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"class","hash":{},"data":data}):helper)))+"\" id=\"pdlg-"+alias4(((helper=(helper=helpers.id||(depth0!=null?depth0.id:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"id","hash":{},"data":data}):helper)))+"\">\r\n    <div class=\"pstory-dialog-container\">\r\n        <div class=\"pstory-dialog-content\" />\r\n    </div>\r\n</div>"},"useData":!0});this["Personetics"].UI.Handlebars.templates["tmpl-pstory-title-inside-story"]=Handlebars.template({"compiler":[7,">= 4.0.0"],"main":function(container,depth0,helpers,partials,data){var stack1,helper;return"<div class=\"pstory-title-outer-wrapper\">\r\n    <div class=\"pstory-fixed pstory-title-wrapper\">\r\n        <div class=\"pstory-title\">\r\n            <div class=\"pstory-title-text pstory-title-inside-story\">"+((stack1=((helper=(helper=helpers.title||(depth0!=null?depth0.title:depth0))!=null?helper:helpers.helperMissing),(typeof helper==="function"?helper.call(depth0!=null?depth0:(container.nullContext||{}),{"name":"title","hash":{},"data":data}):helper)))!=null?stack1:"")+"</div>\r\n        </div>\r\n    </div>\r\n</div>\r\n"},"useData":!0});this["Personetics"].UI.Handlebars.templates["tmpl-pstory-title"]=Handlebars.template({"compiler":[7,">= 4.0.0"],"main":function(container,depth0,helpers,partials,data){var stack1,helper;return"<div class=\"pstory-title-outer-wrapper\">\r\n    <div class=\"pstory-fixed pstory-title-wrapper\">\r\n        <div class=\"pstory-title\">\r\n            <div class=\"pstory-title-text\">"+((stack1=((helper=(helper=helpers.title||(depth0!=null?depth0.title:depth0))!=null?helper:helpers.helperMissing),(typeof helper==="function"?helper.call(depth0!=null?depth0:(container.nullContext||{}),{"name":"title","hash":{},"data":data}):helper)))!=null?stack1:"")+"</div>\r\n        </div>\r\n    </div>\r\n</div>\r\n<div id=\"story-frame-container\"></div>"},"useData":!0});this["Personetics"].UI.Handlebars.templates["block-bar-chart"]=Handlebars.template({"compiler":[7,">= 4.0.0"],"main":function(container,depth0,helpers,partials,data){var helper,alias1=depth0!=null?depth0:(container.nullContext||{}),alias2=helpers.helperMissing,alias3="function",alias4=container.escapeExpression;return"<div class=\"pstory-block-frame pstory-block-bar-chart pstory-block-bar-chart "+alias4(((helper=(helper=helpers["class"]||(depth0!=null?depth0["class"]:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"class","hash":{},"data":data}):helper)))+" "+alias4(((helper=(helper=helpers.direction||(depth0!=null?depth0.direction:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"direction","hash":{},"data":data}):helper)))+"\">\r\n    <div class=\"pstory-block-container\">\r\n        <div class=\"pstory-block-content\">\r\n            <div class=\"pstory-bar-chart\"></div>\r\n        </div>\r\n    </div>\r\n</div>"},"useData":!0});this["Personetics"].UI.Handlebars.templates["block-line-chart"]=Handlebars.template({"compiler":[7,">= 4.0.0"],"main":function(container,depth0,helpers,partials,data){var helper;return"<div class=\"pstory-block-frame pstory-block-line-chart pstory-block-line-chart "+container.escapeExpression(((helper=(helper=helpers["class"]||(depth0!=null?depth0["class"]:depth0))!=null?helper:helpers.helperMissing),(typeof helper==="function"?helper.call(depth0!=null?depth0:(container.nullContext||{}),{"name":"class","hash":{},"data":data}):helper)))+"\">\r\n    <div class=\"pstory-block-container\">\r\n        <div class=\"pstory-block-content\">\r\n            <div class=\"pstory-line-chart\"></div>\r\n        </div>\r\n    </div>\r\n</div>"},"useData":!0});this["Personetics"].UI.Handlebars.templates["block-pie-chart"]=Handlebars.template({"compiler":[7,">= 4.0.0"],"main":function(container,depth0,helpers,partials,data){return"<div class=\"pstory-block-frame pstory-block-pie-chart\">\r\n    <div class=\"pstory-block-container\">\r\n        <div class=\"pstory-block-content\">\r\n            <div class=\"pstory-pie-chart\"></div>\r\n            <div class=\"pstory-pie-data\">\r\n                <div class=\"pstory-next-arrow\"></div>\r\n                <div class=\"pstory-pie-info\">\r\n                </div>\r\n                <div class=\"pstory-previous-arrow\"></div>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</div>"},"useData":!0});this["Personetics"].UI.Handlebars.templates["block-pinGraph-chart"]=Handlebars.template({"compiler":[7,">= 4.0.0"],"main":function(container,depth0,helpers,partials,data){var helper;return"<div class=\"pstory-block-frame pstory-block-pinGraph-chart_"+container.escapeExpression(((helper=(helper=helpers.index||(depth0!=null?depth0.index:depth0))!=null?helper:helpers.helperMissing),(typeof helper==="function"?helper.call(depth0!=null?depth0:(container.nullContext||{}),{"name":"index","hash":{},"data":data}):helper)))+" pstory-block-pinGraph-chart\">\r\n    <div class=\"pstory-block-container\">\r\n        <div class=\"pstory-block-content\">\r\n            <div class=\"pstory-pinGraph-chart\"></div>\r\n        </div>\r\n    </div>\r\n</div>"},"useData":!0});this["Personetics"].UI.Handlebars.templates["block-spline-chart"]=Handlebars.template({"compiler":[7,">= 4.0.0"],"main":function(container,depth0,helpers,partials,data){return"<div class=\"pstory-block-frame pstory-block-spline-chart\">\r\n    <div class=\"pstory-block-container\">\r\n        <div class=\"pstory-block-content\">\r\n            <div class=\"pstory-spline-chart\"></div>\r\n        </div>\r\n    </div>\r\n</div>"},"useData":!0});this["Personetics"].UI.Handlebars.templates["tmpl-perso-widget-story-error"]=Handlebars.template({"1":function(container,depth0,helpers,partials,data){return"class=\"mobile-err\""},"compiler":[7,">= 4.0.0"],"main":function(container,depth0,helpers,partials,data){var stack1,helper,alias1=depth0!=null?depth0:(container.nullContext||{}),alias2=helpers.helperMissing,alias3="function";return"<div id=\"personetics-error-container\" "+((stack1=helpers["if"].call(alias1,(depth0!=null?depth0.isMobileDevice:depth0),{"name":"if","hash":{},"fn":container.program(1,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+">\r\n    <div class=\"personetics-error-img "+container.escapeExpression(((helper=(helper=helpers.imgClass||(depth0!=null?depth0.imgClass:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"imgClass","hash":{},"data":data}):helper)))+"\"></div> \r\n    <div class=\"personetics-error-large\">"+((stack1=((helper=(helper=helpers.textLarge||(depth0!=null?depth0.textLarge:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"textLarge","hash":{},"data":data}):helper)))!=null?stack1:"")+"</div>\r\n    <div class=\"personetics-error-small\">"+((stack1=((helper=(helper=helpers.textSmall||(depth0!=null?depth0.textSmall:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"textSmall","hash":{},"data":data}):helper)))!=null?stack1:"")+"</div>\r\n   \r\n\r\n</div>"},"useData":!0});this["Personetics"].UI.Handlebars.templates["p-story-widget-ctrl.js"]=Handlebars.template({"compiler":[7,">= 4.0.0"],"main":function(container,depth0,helpers,partials,data){return"(function(window, Personetics, $, undefined){\r\n    Personetics.story = Personetics.story || {};\r\n    Personetics.UI.PStoryWidgetCtrlProduct = Personetics.UI.PStoryWidgetCtrl.extend({\r\n\r\n        initialize: function(config) {\r\n            this.super = Personetics.UI.PStoryWidgetCtrl.prototype;\r\n            this.super.initialize.call(this, config);\r\n\r\n            this.uxCtrl = new Personetics.story.skinController();\r\n        }\r\n    });\r\n})(window, window.Personetics = window.Personetics || {}, jQuery);"},"useData":!0});this["Personetics"].UI.Handlebars.templates["tmpl-perso-widget-story-error"]=Handlebars.template({"compiler":[7,">= 4.0.0"],"main":function(container,depth0,helpers,partials,data){var helper,alias1=depth0!=null?depth0:(container.nullContext||{}),alias2=helpers.helperMissing,alias3="function",alias4=container.escapeExpression;return"<div class='story-widget-error'>\r\n    <div class='story-widget-error-title'>\r\n        "+alias4(((helper=(helper=helpers.errorTextTitle||(depth0!=null?depth0.errorTextTitle:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"errorTextTitle","hash":{},"data":data}):helper)))+"\r\n    </div>\r\n    <div class='story-widget-error-body'>\r\n        "+alias4(((helper=(helper=helpers.errorTextBody||(depth0!=null?depth0.errorTextBody:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"errorTextBody","hash":{},"data":data}):helper)))+"\r\n    </div>\r\n</div>"},"useData":!0});this["Personetics"].UI.Handlebars.templates["tmpl-perso-feedback"]=Handlebars.template({"compiler":[7,">= 4.0.0"],"main":function(container,depth0,helpers,partials,data){var stack1,helper,alias1=depth0!=null?depth0:(container.nullContext||{}),alias2=helpers.helperMissing,alias3="function";return"<div class=\"perso-feedback-wrapper\">\r\n    <div class=\"textarea-wrapper\">\r\n        <div class=\"textarea-container\">\r\n            <textarea class=\"perso-feedback-text direction-text-left\" maxlength=\"500\" placeholder=\""+((stack1=((helper=(helper=helpers.lblfeedbackprompt||(depth0!=null?depth0.lblfeedbackprompt:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"lblfeedbackprompt","hash":{},"data":data}):helper)))!=null?stack1:"")+"\"></textarea>\r\n            <div class=\"textarea-size\" ></div>\r\n        </div>\r\n        <input class=\"perso-feedback-submit\" type=\"button\" value=\""+((stack1=((helper=(helper=helpers.btnsubmit||(depth0!=null?depth0.btnsubmit:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"btnsubmit","hash":{},"data":data}):helper)))!=null?stack1:"")+"\"/>\r\n    </div>\r\n    <div class=\"perso-feedback-reaction\">"+((stack1=((helper=(helper=helpers.lblreactionFeedback||(depth0!=null?depth0.lblreactionFeedback:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"lblreactionFeedback","hash":{},"data":data}):helper)))!=null?stack1:"")+"</div>\r\n</div>\r\n"},"useData":!0});this["Personetics"].UI.Handlebars.templates["filter-inbox-template"]=Handlebars.template({"compiler":[7,">= 4.0.0"],"main":function(container,depth0,helpers,partials,data){var stack1,alias1=container.lambda,alias2=container.escapeExpression;return"<ul role=\"tablist\">\r\n	<li role=\"tab\" class =\"perso-teaser-filter-tab selected\" data-id=\"all\" aria-selected=\"true\" aria-label=\""+alias2(alias1(((stack1=(depth0!=null?depth0.texts:depth0))!=null?stack1.ttlinboxAll:stack1),depth0))+"\">"+alias2(alias1(((stack1=(depth0!=null?depth0.texts:depth0))!=null?stack1.ttlinboxAll:stack1),depth0))+"</li>\r\n	<li role=\"tab\" class =\"perso-teaser-filter-tab\" data-id=\"unread\" aria-selected=\"false\" aria-label=\""+alias2(alias1(((stack1=(depth0!=null?depth0.texts:depth0))!=null?stack1.ttlinboxUnread:stack1),depth0))+"\">"+alias2(alias1(((stack1=(depth0!=null?depth0.texts:depth0))!=null?stack1.ttlinboxUnread:stack1),depth0))+"</li>\r\n	<li role=\"tab\" class =\"perso-teaser-filter-tab\" data-id=\"flagged\" aria-selected=\"false\" aria-label=\""+alias2(alias1(((stack1=(depth0!=null?depth0.texts:depth0))!=null?stack1.ttlinboxHighlighted:stack1),depth0))+"\">"+alias2(alias1(((stack1=(depth0!=null?depth0.texts:depth0))!=null?stack1.ttlinboxHighlighted:stack1),depth0))+"</li>\r\n</ul>\r\n"},"useData":!0});this["Personetics"].UI.Handlebars.templates.inboxContainer=Handlebars.template({"compiler":[7,">= 4.0.0"],"main":function(container,depth0,helpers,partials,data){return"<div id=\"personetics-inbox-container\">\r\n</div>\r\n<div id=\"personetics-story-inner-container\">\r\n    <div class=\"perso-story-inner-top\">\r\n        <div class=\"story-top-title\"></div>\r\n        <div class=\"story-top-buttons-wrapper\">\r\n            <div class=\"story-top-button story-top-button-inbox\">\r\n                <input id=\"story-button-inbox\" type=\"button\" class=\"story-top-button-circle\">\r\n                <div class=\"story-top-button-circle-img\"></div>\r\n                </input>\r\n                <div class=\"story-top-button-text\">INSIGHTS INBOX</div>\r\n            </div>\r\n        </div>\r\n    </div>\r\n    <div class=\"perso-story-inner\">\r\n        <div id=\"personetics-story\"></div>\r\n    </div>\r\n</div>"},"useData":!0});this["Personetics"].UI.Handlebars.templates["pstory-block-account-selector-accessibility"]=Handlebars.template({"1":function(container,depth0,helpers,partials,data){var stack1,helper,alias1=depth0!=null?depth0:(container.nullContext||{}),alias2=helpers.helperMissing,alias3="function",alias4=container.escapeExpression,alias5=container.lambda;return"				<div class=\"header-container\">\r\n					<div class=\"pstory-tab-animated-border-bottom\"></div>\r\n					<ul class=\"tablist\" role=\"tablist\">\r\n						<li  class=\"pstory-header-button\" role=\"tab\" tabindex=\""+alias4(((helper=(helper=helpers.index||(data&&data.index))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"index","hash":{},"data":data}):helper)))+"\" data-all=\"true\" pstory-id=\"all\">"+((stack1=alias5(((stack1=(depth0!=null?depth0.headerTexts:depth0))!=null?stack1["0"]:stack1),depth0))!=null?stack1:"")+"</li>\r\n						<li  class=\"pstory-header-button\" role=\"tab\" tabindex=\""+alias4(((helper=(helper=helpers.index||(data&&data.index))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"index","hash":{},"data":data}):helper)))+"\"  data-all=\"false\">"+((stack1=alias5(((stack1=(depth0!=null?depth0.headerTexts:depth0))!=null?stack1["1"]:stack1),depth0))!=null?stack1:"")+"</li>\r\n					</ul>\r\n				</div>\r\n				<div class=\"carousel-animate carousel-wrapper options-container show-all\">\r\n"},"3":function(container,depth0,helpers,partials,data){return"        		<div class=\"carousel-animate carousel-wrapper options-container\">\r\n"},"5":function(container,depth0,helpers,partials,data,blockParams,depths){var stack1,helper,alias1=depth0!=null?depth0:(container.nullContext||{}),alias2=helpers.helperMissing,alias3="function",alias4=container.escapeExpression,alias5=container.lambda;return"					<div class=\"carousel-item pstory-button "+((stack1=helpers["if"].call(alias1,(depth0!=null?depth0.selected:depth0),{"name":"if","hash":{},"fn":container.program(6,data,0,blockParams,depths),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\" pstory-id=\""+alias4(((helper=(helper=helpers.id||(depth0!=null?depth0.id:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"id","hash":{},"data":data}):helper)))+"\" aria-hidden=\"true\" pstory-event=\""+alias4(((helper=(helper=helpers.event||(depth0!=null?depth0.event:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"event","hash":{},"data":data}):helper)))+"\" role=\""+alias4(alias5((depths[1]!=null?depths[1].role:depths[1]),depth0))+"\">\r\n						<div class=\"card card_"+alias4(((helper=(helper=helpers.typeImage||(depth0!=null?depth0.typeImage:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"typeImage","hash":{},"data":data}):helper)))+" cards"+alias4(((helper=(helper=helpers.numCards||(depth0!=null?depth0.numCards:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"numCards","hash":{},"data":data}):helper)))+"\" pstory-id=\""+alias4(((helper=(helper=helpers.id||(depth0!=null?depth0.id:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"id","hash":{},"data":data}):helper)))+"\">							\r\n"+((stack1=container.invokePartial(partials.innerCard,depth0,{"name":"innerCard","hash":{"numberPrefAccessibility":(depths[1]!=null?depths[1].numberPrefAccessibility:depths[1]),"numberPref":(depths[1]!=null?depths[1].numberPref:depths[1])},"data":data,"indent":"\t\t\t\t\t\t\t","helpers":helpers,"partials":partials,"decorators":container.decorators}))!=null?stack1:"")+"						</div>\r\n						 <div id=\"pop-"+alias4(alias5(depth0,depth0))+"\" class=\"pstory-button-txt-wrapper\" pstory-id=\""+alias4(((helper=(helper=helpers.id||(depth0!=null?depth0.id:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"id","hash":{},"data":data}):helper)))+"\"><span class=\"pstory-button-txt\">\r\n                             "+((stack1=((helper=(helper=helpers.text||(depth0!=null?depth0.text:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"text","hash":{},"data":data}):helper)))!=null?stack1:"")+"</span></div>		           \r\n					</div>\r\n"},"6":function(container,depth0,helpers,partials,data){return"selected"},"compiler":[7,">= 4.0.0"],"main":function(container,depth0,helpers,partials,data,blockParams,depths){var stack1,helper,alias1=depth0!=null?depth0:(container.nullContext||{}),alias2=helpers.helperMissing,alias3="function",alias4=container.escapeExpression;return"<div class=\"perso-accessibility-wrapper perso-accessibility-account-selector\" role=\"text\">\r\n	<span class=\"perso-accessibility-read\">"+alias4(((helper=(helper=helpers.accountSelectorText||(depth0!=null?depth0.accountSelectorText:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"accountSelectorText","hash":{},"data":data}):helper)))+"</span> \r\n</div>\r\n<div id=\"pstory-block-account-selector_"+alias4(((helper=(helper=helpers.index||(depth0!=null?depth0.index:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"index","hash":{},"data":data}):helper)))+"\" class=\"pstory-block-frame pstory-block-account-selector "+alias4(((helper=(helper=helpers["class"]||(depth0!=null?depth0["class"]:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"class","hash":{},"data":data}):helper)))+"\" data-showAll="+alias4(((helper=(helper=helpers.showAll||(depth0!=null?depth0.showAll:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"showAll","hash":{},"data":data}):helper)))+">\r\n    <div class=\"pstory-block-container\">\r\n        <div class=\"pstory-block-content\">\r\n"+((stack1=helpers["if"].call(alias1,(depth0!=null?depth0.showAll:depth0),{"name":"if","hash":{},"fn":container.program(1,data,0,blockParams,depths),"inverse":container.program(3,data,0,blockParams,depths),"data":data}))!=null?stack1:"")+"	        	<div class=\"carousel-inner-wrapper cards-wrapper\">\r\n"+((stack1=helpers.each.call(alias1,(depth0!=null?depth0.options:depth0),{"name":"each","hash":{},"fn":container.program(5,data,0,blockParams,depths),"inverse":container.noop,"data":data}))!=null?stack1:"")+"	        	</div>\r\n				<div class=\"perso-accessibility-wrapper account-button selected\" role=\"text\">\r\n					<span class=\"perso-accessibility-read\">"+alias4(((helper=(helper=helpers.accountName||(depth0!=null?depth0.accountName:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"accountName","hash":{},"data":data}):helper)))+". "+alias4(((helper=(helper=helpers.numberPrefAccessibility||(depth0!=null?depth0.numberPrefAccessibility:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"numberPrefAccessibility","hash":{},"data":data}):helper)))+" "+alias4(((helper=(helper=helpers.accountNumber||(depth0!=null?depth0.accountNumber:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"accountNumber","hash":{},"data":data}):helper)))+"</span>\r\n				</div>\r\n                <input class=\"account-button prev\" id=\"prev\" type=\"button\" value=\"\" aria-label=\""+alias4(((helper=(helper=helpers.next||(depth0!=null?depth0.next:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"next","hash":{},"data":data}):helper)))+"\"/>\r\n				<input class=\"account-button next\" id=\"next\" type=\"button\" value=\"\" aria-label=\""+alias4(((helper=(helper=helpers.next||(depth0!=null?depth0.next:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"next","hash":{},"data":data}):helper)))+"\"/>\r\n				<div class=\"pstory-all-accounts-txt\" role=\"text\">"+((stack1=((helper=(helper=helpers.allAccountsTxt||(depth0!=null?depth0.allAccountsTxt:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"allAccountsTxt","hash":{},"data":data}):helper)))!=null?stack1:"")+"</div>\r\n            </div>\r\n            <div class=\"pstory-comment\">"+((stack1=((helper=(helper=helpers.comment||(depth0!=null?depth0.comment:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"comment","hash":{},"data":data}):helper)))!=null?stack1:"")+"</div>\r\n        </div>\r\n    </div>\r\n</div>"},"usePartial":!0,"useData":!0,"useDepths":!0});this["Personetics"].UI.Handlebars.templates["pstory-block-account-selector-inner-card"]=Handlebars.template({"1":function(container,depth0,helpers,partials,data){var helper,alias1=depth0!=null?depth0:(container.nullContext||{}),alias2=helpers.helperMissing,alias3="function",alias4=container.escapeExpression;return"			<span class=\"perso-account-number\" aria-label=\""+alias4(((helper=(helper=helpers.numberPrefAccessibility||(depth0!=null?depth0.numberPrefAccessibility:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"numberPrefAccessibility","hash":{},"data":data}):helper)))+" "+alias4(((helper=(helper=helpers.number||(depth0!=null?depth0.number:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"number","hash":{},"data":data}):helper)))+".\">"+alias4(((helper=(helper=helpers.number||(depth0!=null?depth0.number:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"number","hash":{},"data":data}):helper)))+"</span>\r\n"},"compiler":[7,">= 4.0.0"],"main":function(container,depth0,helpers,partials,data){var stack1,helper,alias1=depth0!=null?depth0:(container.nullContext||{}),alias2=helpers.helperMissing,alias3="function",alias4=container.escapeExpression;return"<div class=\"card card_"+alias4(((helper=(helper=helpers.typeImage||(depth0!=null?depth0.typeImage:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"typeImage","hash":{},"data":data}):helper)))+" cards"+alias4(((helper=(helper=helpers.numCards||(depth0!=null?depth0.numCards:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"numCards","hash":{},"data":data}):helper)))+"\" pstory-id=\""+alias4(((helper=(helper=helpers.id||(depth0!=null?depth0.id:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"id","hash":{},"data":data}):helper)))+"\">							\r\n		<span class=\"perso-account-name\" aria-label=\""+alias4(((helper=(helper=helpers.name||(depth0!=null?depth0.name:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"name","hash":{},"data":data}):helper)))+".\">"+alias4(((helper=(helper=helpers.name||(depth0!=null?depth0.name:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"name","hash":{},"data":data}):helper)))+"</span>\r\n"+((stack1=helpers["if"].call(alias1,(depth0!=null?depth0.number:depth0),{"name":"if","hash":{},"fn":container.program(1,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"		<div id=\"pop-"+alias4(container.lambda(depth0,depth0))+"\" class=\"pstory-button-txt-wrapper\" pstory-id=\""+alias4(((helper=(helper=helpers.id||(depth0!=null?depth0.id:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"id","hash":{},"data":data}):helper)))+"\"><span class=\"pstory-button-txt\">"+((stack1=((helper=(helper=helpers.text||(depth0!=null?depth0.text:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"text","hash":{},"data":data}):helper)))!=null?stack1:"")+"</span></div>	\r\n	</div>\r\n\r\n"},"useData":!0});this["Personetics"].UI.Handlebars.templates["pstory-block-account-selector"]=Handlebars.template({"1":function(container,depth0,helpers,partials,data,blockParams,depths){var stack1;return"			<div class=\"header-container\">\r\n				<div class=\"pstory-tab-animated-border-bottom\"></div>\r\n				<ul class=\"tablist\" role=\"tablist\">\r\n"+((stack1=helpers.each.call(depth0!=null?depth0:(container.nullContext||{}),(depth0!=null?depth0.headersArray:depth0),{"name":"each","hash":{},"fn":container.program(2,data,0,blockParams,depths),"inverse":container.noop,"data":data}))!=null?stack1:"")+"				</ul>\r\n			</div>\r\n			<div class=\"carousel-outer-wrapper\">\r\n				<div class=\"carousel-animate options-container carousel-wrapper pstory-show-header-tabs\">\r\n"},"2":function(container,depth0,helpers,partials,data,blockParams,depths){var stack1,helper,alias1=depth0!=null?depth0:(container.nullContext||{}),alias2=helpers.helperMissing,alias3="function";return"						<li class=\"pstory-header-button\" "+((stack1=helpers["if"].call(alias1,(depths[1]!=null?depths[1].isDesktopMode:depths[1]),{"name":"if","hash":{},"fn":container.program(3,data,0,blockParams,depths),"inverse":container.noop,"data":data}))!=null?stack1:"")+" role=\"tab\" data-all=\""+container.escapeExpression(((helper=(helper=helpers.isAll||(depth0!=null?depth0.isAll:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"isAll","hash":{},"data":data}):helper)))+"\" "+((stack1=helpers["if"].call(alias1,(depth0!=null?depth0.isAll:depth0),{"name":"if","hash":{},"fn":container.program(5,data,0,blockParams,depths),"inverse":container.noop,"data":data}))!=null?stack1:"")+">"+((stack1=((helper=(helper=helpers.text||(depth0!=null?depth0.text:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"text","hash":{},"data":data}):helper)))!=null?stack1:"")+"</li>\r\n"},"3":function(container,depth0,helpers,partials,data){var stack1,helper;return" tabindex=\"0\"  aria-label=\""+((stack1=((helper=(helper=helpers.text||(depth0!=null?depth0.text:depth0))!=null?helper:helpers.helperMissing),(typeof helper==="function"?helper.call(depth0!=null?depth0:(container.nullContext||{}),{"name":"text","hash":{},"data":data}):helper)))!=null?stack1:"")+"\" "},"5":function(container,depth0,helpers,partials,data){return"pstory-id=\"all\""},"7":function(container,depth0,helpers,partials,data){return"					<div class=\"carousel-outer-wrapper\">\r\n						<div class=\"carousel-animate options-container carousel-wrapper\">\r\n"},"9":function(container,depth0,helpers,partials,data,blockParams,depths){var stack1,helper,alias1=depth0!=null?depth0:(container.nullContext||{}),alias2=helpers.helperMissing,alias3="function",alias4=container.escapeExpression;return"								<div class=\"carousel-item pstory-button "+((stack1=helpers["if"].call(alias1,(depth0!=null?depth0.selected:depth0),{"name":"if","hash":{},"fn":container.program(10,data,0,blockParams,depths),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\" aria-hidden=\"true\" pstory-id=\""+alias4(((helper=(helper=helpers.id||(depth0!=null?depth0.id:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"id","hash":{},"data":data}):helper)))+"\" pstory-event=\""+alias4(((helper=(helper=helpers.event||(depth0!=null?depth0.event:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"event","hash":{},"data":data}):helper)))+"\"\r\n								 role=\""+alias4(container.lambda((depths[1]!=null?depths[1].role:depths[1]),depth0))+"\">\r\n									"+((stack1=helpers["if"].call(alias1,(depths[1]!=null?depths[1].isDesktopMode:depths[1]),{"name":"if","hash":{},"fn":container.program(12,data,0,blockParams,depths),"inverse":container.program(14,data,0,blockParams,depths),"data":data}))!=null?stack1:"")+"\r\n								</div>\r\n"},"10":function(container,depth0,helpers,partials,data){return"selected"},"12":function(container,depth0,helpers,partials,data,blockParams,depths){var stack1;return" "+((stack1=container.invokePartial(partials.innerCardDesktop,depth0,{"name":"innerCardDesktop","hash":{"numberPrefAccessibility":(depths[1]!=null?depths[1].numberPrefAccessibility:depths[1]),"numberPref":(depths[1]!=null?depths[1].numberPref:depths[1])},"data":data,"helpers":helpers,"partials":partials,"decorators":container.decorators}))!=null?stack1:"")+"\r\n									"},"14":function(container,depth0,helpers,partials,data,blockParams,depths){var stack1;return" "+((stack1=container.invokePartial(partials.innerCard,depth0,{"name":"innerCard","hash":{"numberPrefAccessibility":(depths[1]!=null?depths[1].numberPrefAccessibility:depths[1]),"numberPref":(depths[1]!=null?depths[1].numberPref:depths[1])},"data":data,"helpers":helpers,"partials":partials,"decorators":container.decorators}))!=null?stack1:"")+" "},"16":function(container,depth0,helpers,partials,data){var stack1,alias1=depth0!=null?depth0:(container.nullContext||{});return"							<div class=\"carousel-index-wrapper\" "+((stack1=helpers["if"].call(alias1,(depth0!=null?depth0.isDesktopMode:depth0),{"name":"if","hash":{},"fn":container.program(17,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+">\r\n								<div class=\"carousel-index-container\">\r\n"+((stack1=helpers.each.call(alias1,(depth0!=null?depth0.options:depth0),{"name":"each","hash":{},"fn":container.program(19,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"								</div>\r\n							</div>\r\n"},"17":function(container,depth0,helpers,partials,data){var stack1;return" role=\"application\" aria-labelledby=\"perso-accessibility-read-"+container.escapeExpression(container.lambda(((stack1=((stack1=(depth0!=null?depth0.options:depth0))!=null?stack1["0"]:stack1))!=null?stack1.id:stack1),depth0))+"\""},"19":function(container,depth0,helpers,partials,data){return"									<div class=\"carousel-index-dot\">\r\n										<div class=\"carousel-index-dot-circle\"></div>\r\n									</div> \r\n"},"21":function(container,depth0,helpers,partials,data){return" tabindex=\"-1\" "},"compiler":[7,">= 4.0.0"],"main":function(container,depth0,helpers,partials,data,blockParams,depths){var stack1,helper,alias1=depth0!=null?depth0:(container.nullContext||{}),alias2=helpers.helperMissing,alias3="function",alias4=container.escapeExpression;return"<div class=\"perso-accessibility-wrapper perso-accessibility-account-selector\" role=\"text\">\r\n	<span class=\"perso-accessibility-read\">"+alias4(((helper=(helper=helpers.accountSelectorText||(depth0!=null?depth0.accountSelectorText:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"accountSelectorText","hash":{},"data":data}):helper)))+"</span>\r\n</div>\r\n<div id=\"pstory-block-account-selector_"+alias4(((helper=(helper=helpers.index||(depth0!=null?depth0.index:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"index","hash":{},"data":data}):helper)))+"\" class=\"pstory-block-frame pstory-block-account-selector "+alias4(((helper=(helper=helpers["class"]||(depth0!=null?depth0["class"]:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"class","hash":{},"data":data}):helper)))+"\" data-show-header-tabs="+alias4(((helper=(helper=helpers.showHeaderTabs||(depth0!=null?depth0.showHeaderTabs:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"showHeaderTabs","hash":{},"data":data}):helper)))+">\r\n	<div class=\"pstory-block-container\">\r\n		<div class=\"pstory-block-content\">\r\n"+((stack1=helpers["if"].call(alias1,(depth0!=null?depth0.showHeaderTabs:depth0),{"name":"if","hash":{},"fn":container.program(1,data,0,blockParams,depths),"inverse":container.program(7,data,0,blockParams,depths),"data":data}))!=null?stack1:"")+"							<div class=\"carousel-inner-wrapper cards-wrapper\" aria-hidden=\"true\">\r\n"+((stack1=helpers.each.call(alias1,(depth0!=null?depth0.options:depth0),{"name":"each","hash":{},"fn":container.program(9,data,0,blockParams,depths),"inverse":container.noop,"data":data}))!=null?stack1:"")+"							</div>\r\n\r\n							<div class=\"perso-accessibility-wrapper pstory-account-button selected\" role=\"text\">\r\n								<span class=\"perso-accessibility-read\">"+alias4(((helper=(helper=helpers.accountName||(depth0!=null?depth0.accountName:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"accountName","hash":{},"data":data}):helper)))+". "+alias4(((helper=(helper=helpers.numberPrefAccessibility||(depth0!=null?depth0.numberPrefAccessibility:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"numberPrefAccessibility","hash":{},"data":data}):helper)))+" "+alias4(((helper=(helper=helpers.accountNumber||(depth0!=null?depth0.accountNumber:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"accountNumber","hash":{},"data":data}):helper)))+"</span>\r\n							</div>\r\n\r\n"+((stack1=helpers["if"].call(alias1,(depth0!=null?depth0.showIndexDots:depth0),{"name":"if","hash":{},"fn":container.program(16,data,0,blockParams,depths),"inverse":container.noop,"data":data}))!=null?stack1:"")+"							<div class=\"pstory-all-accounts-txt\" role=\"text\">"+((stack1=((helper=(helper=helpers.allAccountsTxt||(depth0!=null?depth0.allAccountsTxt:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"allAccountsTxt","hash":{},"data":data}):helper)))!=null?stack1:"")+"</div>\r\n						</div>\r\n						<input type=\"button\" class=\"pstory-account-button pstory-prev-account-button\" aria-label=\""+alias4(((helper=(helper=helpers.next||(depth0!=null?depth0.next:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"next","hash":{},"data":data}):helper)))+"\" "+((stack1=helpers["if"].call(alias1,(depth0!=null?depth0.isDesktopMode:depth0),{"name":"if","hash":{},"fn":container.program(21,data,0,blockParams,depths),"inverse":container.noop,"data":data}))!=null?stack1:"")+" />\r\n						<input type=\"button\" class=\"pstory-account-button pstory-next-account-button\" aria-label=\""+alias4(((helper=(helper=helpers.next||(depth0!=null?depth0.next:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"next","hash":{},"data":data}):helper)))+"\" "+((stack1=helpers["if"].call(alias1,(depth0!=null?depth0.isDesktopMode:depth0),{"name":"if","hash":{},"fn":container.program(21,data,0,blockParams,depths),"inverse":container.noop,"data":data}))!=null?stack1:"")+"/>\r\n					</div>\r\n					<div class=\"pstory-comment\">"+((stack1=((helper=(helper=helpers.comment||(depth0!=null?depth0.comment:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"comment","hash":{},"data":data}):helper)))!=null?stack1:"")+"</div>\r\n				</div>\r\n			</div>\r\n		</div>"},"usePartial":!0,"useData":!0,"useDepths":!0});this["Personetics"].UI.Handlebars.templates["pstory-block-pie-chart"]=Handlebars.template({"compiler":[7,">= 4.0.0"],"main":function(container,depth0,helpers,partials,data){var stack1;return"<div class=\"pstory-block-frame pstory-block-pie-chart\">\r\n    <div class=\"pstory-block-container\">\r\n        <div class=\"pstory-block-content\">\r\n            <div class=\"pstory-pie-chart\"></div>\r\n            <div class=\"pstory-pie-data\">\r\n                <input type=\"button\" class=\"pstory-arrow pstory-next-arrow\" aria-hidden=\"true\"/>\r\n                <div class=\"pstory-pie-info perso-accessibility-wrapper\" role=\"text\">\r\n                </div>\r\n                <input type=\"button\" class=\"pstory-arrow pstory-previous-arrow\" aria-label=\""+container.escapeExpression(container.lambda(((stack1=(depth0!=null?depth0.texts:depth0))!=null?stack1.nextCategory:stack1),depth0))+"\"/>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</div>"},"useData":!0});this["Personetics"].UI.Handlebars.templates["pstory-block-table-minimal"]=Handlebars.template({"1":function(container,depth0,helpers,partials,data){return"                    <tr>\r\n                        <td class=\"perso-loading-table\">Loading...</td>\r\n                    </tr>\r\n"},"3":function(container,depth0,helpers,partials,data,blockParams,depths){var stack1;return((stack1=helpers.each.call(depth0!=null?depth0:(container.nullContext||{}),(depth0!=null?depth0.rows:depth0),{"name":"each","hash":{},"fn":container.program(4,data,0,blockParams,depths),"inverse":container.noop,"data":data}))!=null?stack1:"")},"4":function(container,depth0,helpers,partials,data,blockParams,depths){var stack1,alias1=container.lambda;return"                            <tr class=\""+container.escapeExpression(alias1((depths[1]!=null?depths[1]["class"]:depths[1]),depth0))+"\">\r\n                                <td role=\"cell\" class=\"perso-td-date\">"+((stack1=alias1((depth0!=null?depth0.date:depth0),depth0))!=null?stack1:"")+"</td>\r\n                                <td  align=\"right\" role=\"cell\" class=\"perso-td-amount-balance\">"+((stack1=alias1((depth0!=null?depth0.amount:depth0),depth0))!=null?stack1:"")+" </td>                                \r\n                                <td  align=\"right\" class=\"perso-td-amount-balance  \" role=\"cell\"> "+((stack1=alias1((depth0!=null?depth0.account:depth0),depth0))!=null?stack1:"")+"</td>\r\n\r\n                            </tr>\r\n"},"compiler":[7,">= 4.0.0"],"main":function(container,depth0,helpers,partials,data,blockParams,depths){var stack1;return"<div class=\"pstory-block-frame pstory-block-table\">\r\n    <div class=\"pstory-block-container\">\r\n        <div class=\"pstory-block-content\">\r\n            <table class=\"pstory-table\">\r\n"+((stack1=helpers["if"].call(depth0!=null?depth0:(container.nullContext||{}),(depth0!=null?depth0.future:depth0),{"name":"if","hash":{},"fn":container.program(1,data,0,blockParams,depths),"inverse":container.program(3,data,0,blockParams,depths),"data":data}))!=null?stack1:"")+"            </table>\r\n        </div>\r\n    </div>\r\n</div>"},"useData":!0,"useDepths":!0});this["Personetics"].UI.Handlebars.templates["pstory-block-table-perso-txlist1"]=Handlebars.template({"1":function(container,depth0,helpers,partials,data){return"                    <tr>\r\n                        <td class=\"perso-loading-table\">Loading...</td>\r\n                    </tr>\r\n"},"3":function(container,depth0,helpers,partials,data){var stack1;return((stack1=helpers.each.call(depth0!=null?depth0:(container.nullContext||{}),(depth0!=null?depth0.rows:depth0),{"name":"each","hash":{},"fn":container.program(4,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")},"4":function(container,depth0,helpers,partials,data){var stack1,alias1=container.lambda;return"                            <tr>\r\n                                <td>\r\n                                   <span class=\"perso-td-first-row perso-td-account-number\">\r\n                                       "+((stack1=alias1((depth0!=null?depth0.accountNumber:depth0),depth0))!=null?stack1:"")+"\r\n                                   </span>\r\n                                    <span class=\"perso-td-transaction\">\r\n                                        "+((stack1=alias1((depth0!=null?depth0.transaction:depth0),depth0))!=null?stack1:"")+"\r\n                                    </span>\r\n                                </td>\r\n                                <td  class=\"rightAlign\" >\r\n                                     <span class=\"perso-td-first-row perso-td-date\">\r\n                                         "+((stack1=alias1((depth0!=null?depth0.date:depth0),depth0))!=null?stack1:"")+"\r\n                                     </span>\r\n                                    <span class=\"perso-td-amount-balance perso-td-amount\">\r\n                                        "+((stack1=alias1((depth0!=null?depth0.amount:depth0),depth0))!=null?stack1:"")+"\r\n                                    </span>\r\n                                </td>\r\n                            </tr>\r\n\r\n"},"compiler":[7,">= 4.0.0"],"main":function(container,depth0,helpers,partials,data){var stack1;return"<div class=\"pstory-block-frame pstory-block-table\">\r\n    <div class=\"pstory-block-container\">\r\n        <div class=\"pstory-block-content\">\r\n            <table class=\"pstory-table pstory-table-txlist1\">\r\n"+((stack1=helpers["if"].call(depth0!=null?depth0:(container.nullContext||{}),(depth0!=null?depth0.future:depth0),{"name":"if","hash":{},"fn":container.program(1,data,0),"inverse":container.program(3,data,0),"data":data}))!=null?stack1:"")+"            </table>\r\n        </div>\r\n    </div>\r\n</div>"},"useData":!0});this["Personetics"].UI.Handlebars.templates["pstory-block-table-perso-txlist2"]=Handlebars.template({"1":function(container,depth0,helpers,partials,data){return"                    <tr>\r\n                        <td class=\"perso-loading-table\">Loading...</td>\r\n                    </tr>\r\n"},"3":function(container,depth0,helpers,partials,data){var stack1;return((stack1=helpers.each.call(depth0!=null?depth0:(container.nullContext||{}),(depth0!=null?depth0.rows:depth0),{"name":"each","hash":{},"fn":container.program(4,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")},"4":function(container,depth0,helpers,partials,data){var stack1,alias1=container.lambda;return"                            <tr>\r\n                                <td>\r\n                                    <span class=\"perso-td-first-row perso-td-transaction\">\r\n                                        "+((stack1=alias1((depth0!=null?depth0.transaction:depth0),depth0))!=null?stack1:"")+"\r\n                                    </span>\r\n                                </td>\r\n                                <td  class=\"rightAlign\" >\r\n                                    <span class=\"perso-td-first-row perso-td-date\">\r\n                                        "+((stack1=alias1((depth0!=null?depth0.date:depth0),depth0))!=null?stack1:"")+"\r\n                                    </span>\r\n                                    <span class=\"perso-td-amount-balance perso-td-amount\">\r\n                                        "+((stack1=alias1((depth0!=null?depth0.amount:depth0),depth0))!=null?stack1:"")+"\r\n                                    </span>\r\n                                </td>\r\n                            </tr>\r\n\r\n"},"compiler":[7,">= 4.0.0"],"main":function(container,depth0,helpers,partials,data){var stack1;return"<div class=\"pstory-block-frame pstory-block-table\">\r\n    <div class=\"pstory-block-container\">\r\n        <div class=\"pstory-block-content\">\r\n            <table class=\"pstory-table pstory-table-txlist2\">\r\n"+((stack1=helpers["if"].call(depth0!=null?depth0:(container.nullContext||{}),(depth0!=null?depth0.future:depth0),{"name":"if","hash":{},"fn":container.program(1,data,0),"inverse":container.program(3,data,0),"data":data}))!=null?stack1:"")+"            </table>\r\n        </div>\r\n    </div>\r\n</div>"},"useData":!0});this["Personetics"].UI.Handlebars.templates["pstory-block-table-perso-txlist3"]=Handlebars.template({"1":function(container,depth0,helpers,partials,data){return"                    <tr>\r\n                        <td class=\"perso-loading-table\">Loading...</td>\r\n                    </tr>\r\n"},"3":function(container,depth0,helpers,partials,data,blockParams,depths){var stack1;return((stack1=helpers.each.call(depth0!=null?depth0:(container.nullContext||{}),(depth0!=null?depth0.rows:depth0),{"name":"each","hash":{},"fn":container.program(4,data,0,blockParams,depths),"inverse":container.noop,"data":data}))!=null?stack1:"")},"4":function(container,depth0,helpers,partials,data,blockParams,depths){var stack1,alias1=container.lambda;return"                            <tr >\r\n                                <td>\r\n                                    <span class=\"perso-td-first-row perso-td-date\">\r\n                                        "+((stack1=alias1((depth0!=null?depth0.date:depth0),depth0))!=null?stack1:"")+"\r\n                                    </span>                                    \r\n                                </td>\r\n                                <td> \r\n                                    <span class=\"perso-td-first-row perso-td-account-number\">\r\n                                        "+((stack1=alias1((depth0!=null?depth0.accountNumber:depth0),depth0))!=null?stack1:"")+"\r\n                                    </span>\r\n                                    <span class=\"perso-td-transaction\">\r\n                                        "+((stack1=alias1((depth0!=null?depth0.transaction:depth0),depth0))!=null?stack1:"")+"\r\n                                    </span>                           \r\n                                </td>\r\n                                <td class=\"rightAlign\" >\r\n                                     <span class=\"perso-td-first-row perso-td-balance-title perso-td-small\">\r\n                                        "+container.escapeExpression(alias1((depths[1]!=null?depths[1].balanceLabel:depths[1]),depth0))+"\r\n                                    </span>\r\n                                    <span class=\"perso-td-amount-balance perso-td-balance\">\r\n                                        "+((stack1=alias1((depth0!=null?depth0.balance:depth0),depth0))!=null?stack1:"")+"\r\n                                    </span>\r\n                                </td>   \r\n                                \r\n                            </tr>\r\n"},"compiler":[7,">= 4.0.0"],"main":function(container,depth0,helpers,partials,data,blockParams,depths){var stack1;return"<div class=\"pstory-block-frame pstory-block-table\">\r\n    <div class=\"pstory-block-container\">\r\n        <div class=\"pstory-block-content\">\r\n            <table class=\"pstory-table pstory-table-txlist3\">\r\n"+((stack1=helpers["if"].call(depth0!=null?depth0:(container.nullContext||{}),(depth0!=null?depth0.future:depth0),{"name":"if","hash":{},"fn":container.program(1,data,0,blockParams,depths),"inverse":container.program(3,data,0,blockParams,depths),"data":data}))!=null?stack1:"")+"            </table>\r\n        </div>\r\n    </div>\r\n</div>"},"useData":!0,"useDepths":!0});this["Personetics"].UI.Handlebars.templates["pstory-block-table-perso-txlist4"]=Handlebars.template({"1":function(container,depth0,helpers,partials,data){var stack1;return"                <div id=\"perso-legend-wrapper\">\r\n"+((stack1=helpers.each.call(depth0!=null?depth0:(container.nullContext||{}),(depth0!=null?depth0.legendTexts:depth0),{"name":"each","hash":{},"fn":container.program(2,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"                </div>\r\n"},"2":function(container,depth0,helpers,partials,data){var stack1,helper,alias1=depth0!=null?depth0:(container.nullContext||{}),alias2=helpers.helperMissing,alias3="function";return"                        <div class=\"perso-legend-container\">\r\n                            <div class=\"perso-legend-dot "+((stack1=((helper=(helper=helpers["class"]||(depth0!=null?depth0["class"]:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"class","hash":{},"data":data}):helper)))!=null?stack1:"")+"-dot\"></div>\r\n                            <span class=\"perso-legend-text\">"+((stack1=((helper=(helper=helpers.text||(depth0!=null?depth0.text:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"text","hash":{},"data":data}):helper)))!=null?stack1:"")+"</span>\r\n                        </div>\r\n"},"4":function(container,depth0,helpers,partials,data){return"                    <div class=\"perso-table-row\">\r\n                        <div class=\"perso-loading-tbl\">\r\n                            <span>Loading...</span>\r\n                        </div>\r\n                    </div>\r\n"},"6":function(container,depth0,helpers,partials,data){var stack1;return((stack1=helpers.each.call(depth0!=null?depth0:(container.nullContext||{}),(depth0!=null?depth0.rows:depth0),{"name":"each","hash":{},"fn":container.program(7,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")},"7":function(container,depth0,helpers,partials,data){var stack1,alias1=container.lambda;return"                    <div class=\"perso-table-row scheduled-"+((stack1=alias1((depth0!=null?depth0.isScheduled:depth0),depth0))!=null?stack1:"")+"\">\r\n"+((stack1=helpers["if"].call(depth0!=null?depth0:(container.nullContext||{}),(depth0!=null?depth0.isScheduled:depth0),{"name":"if","hash":{},"fn":container.program(8,data,0),"inverse":container.program(10,data,0),"data":data}))!=null?stack1:"")+"                        <div class=\"perso-table-cell perso-cell-1\">\r\n                            <div class=\"perso-transaction-title\">"+((stack1=alias1((depth0!=null?depth0.transaction:depth0),depth0))!=null?stack1:"")+"</div>\r\n                            <div class=\"perso-transaction-date\">"+((stack1=alias1((depth0!=null?depth0.isAnticipated:depth0),depth0))!=null?stack1:"")+" "+((stack1=alias1((depth0!=null?depth0.date:depth0),depth0))!=null?stack1:"")+"</div>\r\n                        </div>\r\n                        <div class=\"perso-table-cell perso-cell-2\">\r\n                            <div class=\"perso-td-amount-balance perso-td-amount\">"+((stack1=alias1((depth0!=null?depth0.amount:depth0),depth0))!=null?stack1:"")+"</div>\r\n                        </div>\r\n                    </div>\r\n"},"8":function(container,depth0,helpers,partials,data){var stack1;return"                            <div class=\"perso-large-legend-dot scheduled-dot "+((stack1=container.lambda((depth0!=null?depth0.debitOrCredit:depth0),depth0))!=null?stack1:"")+"\"></div>\r\n"},"10":function(container,depth0,helpers,partials,data){var stack1;return"                            <div class=\"perso-large-legend-dot estimated-dot "+((stack1=container.lambda((depth0!=null?depth0.debitOrCredit:depth0),depth0))!=null?stack1:"")+"\"></div>\r\n"},"compiler":[7,">= 4.0.0"],"main":function(container,depth0,helpers,partials,data){var stack1,alias1=depth0!=null?depth0:(container.nullContext||{});return"<div class=\"pstory-block-frame pstory-block-table\">\r\n    <div class=\"pstory-block-container\">\r\n        <div class=\"pstory-block-content\">\r\n"+((stack1=helpers["if"].call(alias1,(depth0!=null?depth0.legendTexts:depth0),{"name":"if","hash":{},"fn":container.program(1,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"            <div class=\"pstory-table-type-2 pstory-table-txlist4\">\r\n"+((stack1=helpers["if"].call(alias1,(depth0!=null?depth0.future:depth0),{"name":"if","hash":{},"fn":container.program(4,data,0),"inverse":container.program(6,data,0),"data":data}))!=null?stack1:"")+"            </div>\r\n        </div>\r\n    </div>\r\n</div>"},"useData":!0});this["Personetics"].UI.Handlebars.templates["pstory-block-table-perso-txlist5"]=Handlebars.template({"1":function(container,depth0,helpers,partials,data){return"                    <tr>\r\n                        <td class=\"perso-loading-table\">Loading...</td>\r\n                    </tr>\r\n"},"3":function(container,depth0,helpers,partials,data,blockParams,depths){var stack1;return((stack1=helpers.each.call(depth0!=null?depth0:(container.nullContext||{}),(depth0!=null?depth0.rows:depth0),{"name":"each","hash":{},"fn":container.program(4,data,0,blockParams,depths),"inverse":container.noop,"data":data}))!=null?stack1:"")},"4":function(container,depth0,helpers,partials,data,blockParams,depths){var stack1,alias1=container.lambda;return"                            <tr >\r\n                                <td>\r\n                                    <span class=\"perso-td-first-row perso-td-date\">\r\n                                        "+((stack1=alias1((depth0!=null?depth0.date:depth0),depth0))!=null?stack1:"")+"\r\n                                    </span>\r\n                                </td>\r\n                                <td  class=\"leftAlign\">\r\n                                    <span class=\"perso-td-first-row perso-td-transaction perso-td-small\">\r\n                                        "+((stack1=alias1((depth0!=null?depth0.transaction:depth0),depth0))!=null?stack1:"")+"\r\n                                    </span>\r\n                                      <span class=\"perso-td-amount-balance perso-td-amount\">\r\n                                        "+((stack1=alias1((depth0!=null?depth0.amount:depth0),depth0))!=null?stack1:"")+"\r\n                                    </span>\r\n                                </td>\r\n                                <td  class=\"leftAlign\" role=\"cell\">\r\n                                    <span class=\"perso-td-first-row perso-td-balance-title perso-td-small\">\r\n                                        "+container.escapeExpression(alias1((depths[1]!=null?depths[1].balanceLabel:depths[1]),depth0))+"\r\n                                    </span>\r\n                                      <span class=\"perso-td-amount-balance perso-td-balance\">\r\n                                          "+((stack1=alias1((depth0!=null?depth0.balance:depth0),depth0))!=null?stack1:"")+"\r\n                                      </span>\r\n                                </td>\r\n                            </tr>\r\n"},"compiler":[7,">= 4.0.0"],"main":function(container,depth0,helpers,partials,data,blockParams,depths){var stack1;return"<div class=\"pstory-block-frame pstory-block-table\">\r\n    <div class=\"pstory-block-container\">\r\n        <div class=\"pstory-block-content\">\r\n            <table class=\"pstory-table pstory-table-txlist5\">\r\n"+((stack1=helpers["if"].call(depth0!=null?depth0:(container.nullContext||{}),(depth0!=null?depth0.future:depth0),{"name":"if","hash":{},"fn":container.program(1,data,0,blockParams,depths),"inverse":container.program(3,data,0,blockParams,depths),"data":data}))!=null?stack1:"")+"            </table>\r\n        </div>\r\n    </div>\r\n</div>"},"useData":!0,"useDepths":!0});this["Personetics"].UI.Handlebars.templates["pstory-block-table-perso-txlist6"]=Handlebars.template({"1":function(container,depth0,helpers,partials,data){return"                    <tr>\r\n                        <td class=\"perso-loading-table\">Loading...</td>\r\n                    </tr>\r\n"},"3":function(container,depth0,helpers,partials,data){var stack1;return((stack1=helpers.each.call(depth0!=null?depth0:(container.nullContext||{}),(depth0!=null?depth0.rows:depth0),{"name":"each","hash":{},"fn":container.program(4,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")},"4":function(container,depth0,helpers,partials,data){var stack1,alias1=container.lambda;return"                            <tr>\r\n                                <td>\r\n                                    <span class=\"perso-td-date\">\r\n                                        "+((stack1=alias1((depth0!=null?depth0.date:depth0),depth0))!=null?stack1:"")+"\r\n                                    </span>\r\n                                </td>\r\n                                <td >\r\n                                    <span class=\"perso-td-transaction\">\r\n                                        "+((stack1=alias1((depth0!=null?depth0.transaction:depth0),depth0))!=null?stack1:"")+"\r\n                                    </span>\r\n                                </td>\r\n                                <td  class=\"rightAlign\">\r\n                                       <span class=\"perso-td-amount-balance perso-td-amount\">\r\n                                           "+((stack1=alias1((depth0!=null?depth0.amount:depth0),depth0))!=null?stack1:"")+"\r\n                                       </span>\r\n                                </td>\r\n                            </tr>\r\n"},"compiler":[7,">= 4.0.0"],"main":function(container,depth0,helpers,partials,data){var stack1;return"<div class=\"pstory-block-frame pstory-block-table\">\r\n    <div class=\"pstory-block-container\">\r\n        <div class=\"pstory-block-content\">\r\n            <table class=\"pstory-table pstory-table-txlist6\">\r\n"+((stack1=helpers["if"].call(depth0!=null?depth0:(container.nullContext||{}),(depth0!=null?depth0.future:depth0),{"name":"if","hash":{},"fn":container.program(1,data,0),"inverse":container.program(3,data,0),"data":data}))!=null?stack1:"")+"            </table>\r\n        </div>\r\n    </div>\r\n</div>"},"useData":!0});this["Personetics"].UI.Handlebars.templates["tmpl-pstory-title"]=Handlebars.template({"compiler":[7,">= 4.0.0"],"main":function(container,depth0,helpers,partials,data){var stack1,helper,alias1=depth0!=null?depth0:(container.nullContext||{}),alias2=helpers.helperMissing,alias3="function";return"<div class=\"pstory-title-outer-wrapper\">\r\n    <div class=\"pstory-title-wrapper pstory-fixed\">\r\n        <div class=\"pstory-title\">\r\n            <input aria-label=\""+container.escapeExpression(((helper=(helper=helpers.backButtonText||(depth0!=null?depth0.backButtonText:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"backButtonText","hash":{},"data":data}):helper)))+"\" type=\"button\" class=\"pstory-title-close\"/>\r\n            <div role=\"heading\" aria-level=\"1\" class=\"pstory-title-text\">"+((stack1=((helper=(helper=helpers.title||(depth0!=null?depth0.title:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"title","hash":{},"data":data}):helper)))!=null?stack1:"")+"</div>\r\n        </div>\r\n    </div>\r\n</div>\r\n<div id=\"story-frame-container\"></div>"},"useData":!0});this["Personetics"].UI.Handlebars.templates.doubleBox=Handlebars.template({"1":function(container,depth0,helpers,partials,data){var stack1,alias1=container.lambda,alias2=container.escapeExpression;return((stack1=container.invokePartial(partials.teaserHeader,depth0,{"name":"teaserHeader","data":data,"indent":"    ","helpers":helpers,"partials":partials,"decorators":container.decorators}))!=null?stack1:"")+"\r\n    <div class=\"perso-teaser-border\">\r\n        <div class=\"pstory-block-hbox-columns-frame teaser-body\" aria-hidden=\"true\">\r\n            <div class=\"pstory-hbox-column-frame\" data-width=\"6\">\r\n\r\n                <div class=\"pstory-hbox-column-frame perso-double-box perso-double-box-left\" data-v-align=\"middle\" data-width=\"12\">\r\n                    <div class=\"pstory-block-frame pstory-block-text\">\r\n                        <div class=\"pstory-block-content perso-double-box-value\">\r\n                            "+((stack1=alias1(((stack1=(depth0!=null?depth0["box-value1"]:depth0))!=null?stack1.text:stack1),depth0))!=null?stack1:"")+"\r\n                        </div>\r\n                    </div>\r\n                    <div class=\"pstory-block-frame pstory-block-text\">\r\n                        <div class=\"pstory-block-content perso-double-box-text\">\r\n                            "+alias2(alias1(((stack1=(depth0!=null?depth0["box-label1"]:depth0))!=null?stack1.text:stack1),depth0))+"\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n\r\n            </div>\r\n            <div class=\"pstory-hbox-column-frame\" data-width=\"6\">\r\n\r\n                <div class=\"pstory-hbox-column-frame perso-double-box perso-double-box-right\" data-v-align=\"middle\" data-width=\"12\">\r\n                    <div class=\"pstory-block-frame pstory-block-text\">\r\n                        <div class=\"pstory-block-content perso-double-box-value \">\r\n                            "+((stack1=alias1(((stack1=(depth0!=null?depth0["box-value2"]:depth0))!=null?stack1.text:stack1),depth0))!=null?stack1:"")+"\r\n                        </div>\r\n                    </div>\r\n                    <div class=\"pstory-block-frame pstory-block-text\">\r\n                        <div class=\"pstory-block-content perso-double-box-text\">\r\n                            "+alias2(alias1(((stack1=(depth0!=null?depth0["box-label2"]:depth0))!=null?stack1.text:stack1),depth0))+"\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n\r\n            </div>\r\n        </div>\r\n    </div>\r\n"},"compiler":[7,">= 4.0.0"],"main":function(container,depth0,helpers,partials,data){var stack1;return((stack1=container.invokePartial(partials.teaserWrapperPartial,depth0,{"name":"teaserWrapperPartial","fn":container.program(1,data,0),"inverse":container.noop,"data":data,"helpers":helpers,"partials":partials,"decorators":container.decorators}))!=null?stack1:"")},"usePartial":!0,"useData":!0});this["Personetics"].UI.Handlebars.templates.horizontalBar=Handlebars.template({"1":function(container,depth0,helpers,partials,data){var stack1,helper,alias1=container.escapeExpression;return((stack1=container.invokePartial(partials.teaserHeader,depth0,{"name":"teaserHeader","data":data,"indent":"    ","helpers":helpers,"partials":partials,"decorators":container.decorators}))!=null?stack1:"")+"    <div class=\"perso-teaser-border\">\r\n        <div class=\"pstory-block-hbox-columns-frame teaser-body multi-horizontal-bar\" aria-hidden=\"true\">\r\n            <div class=\"pstory-hbox-column-frame\" data-width=\"12\" id=\""+alias1(((helper=(helper=helpers.insightId||(depth0!=null?depth0.insightId:depth0))!=null?helper:helpers.helperMissing),(typeof helper==="function"?helper.call(depth0!=null?depth0:(container.nullContext||{}),{"name":"insightId","hash":{},"data":data}):helper)))+"_"+alias1(container.lambda(((stack1=(depth0!=null?depth0.chart:depth0))!=null?stack1.blockId:stack1),depth0))+"\"></div>\r\n        </div>\r\n    </div>\r\n"},"compiler":[7,">= 4.0.0"],"main":function(container,depth0,helpers,partials,data){var stack1;return((stack1=container.invokePartial(partials.teaserWrapperPartial,depth0,{"name":"teaserWrapperPartial","fn":container.program(1,data,0),"inverse":container.noop,"data":data,"helpers":helpers,"partials":partials,"decorators":container.decorators}))!=null?stack1:"")},"usePartial":!0,"useData":!0});this["Personetics"].UI.Handlebars.templates.horizontalBarAndBox=Handlebars.template({"1":function(container,depth0,helpers,partials,data){var stack1,helper,alias1=container.escapeExpression,alias2=container.lambda;return((stack1=container.invokePartial(partials.teaserHeader,depth0,{"name":"teaserHeader","data":data,"indent":"    ","helpers":helpers,"partials":partials,"decorators":container.decorators}))!=null?stack1:"")+"\r\n    <div class=\"perso-teaser-border\">\r\n        <div class=\"pstory-block-hbox-columns-frame teaser-body multi-horizontal-bar-box\" aria-hidden=\"true\">\r\n            <div class=\"pstory-hbox-column-frame\" data-width=\"8\">\r\n                <div id=\""+alias1(((helper=(helper=helpers.insightId||(depth0!=null?depth0.insightId:depth0))!=null?helper:helpers.helperMissing),(typeof helper==="function"?helper.call(depth0!=null?depth0:(container.nullContext||{}),{"name":"insightId","hash":{},"data":data}):helper)))+"_"+alias1(alias2(((stack1=(depth0!=null?depth0.chart:depth0))!=null?stack1.blockId:stack1),depth0))+"\"></div>\r\n            </div>\r\n\r\n           <div class=\"pstory-hbox-column-frame\" data-width=\"4\">\r\n                <!--<div class=\"pstory-block-hbox-columns-frame\">-->\r\n\r\n                <div class=\"pstory-hbox-column-frame\" data-v-align=\"middle\" data-width=\"12\">\r\n                    <div class=\"pstory-block-frame pstory-block-text perso-percent-large\">\r\n                        <div class=\"pstory-block-content\">\r\n                            "+alias1(alias2(((stack1=(depth0!=null?depth0["box-value"]:depth0))!=null?stack1.text:stack1),depth0))+"\r\n                        </div>\r\n                    </div>\r\n                    <div class=\"pstory-block-frame pstory-block-text\">\r\n                        <div class=\"pstory-block-content\">\r\n                            "+alias1(alias2(((stack1=(depth0!=null?depth0["box-label"]:depth0))!=null?stack1.text:stack1),depth0))+"\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n\r\n            </div>\r\n        </div>\r\n    </div>\r\n\r\n"},"compiler":[7,">= 4.0.0"],"main":function(container,depth0,helpers,partials,data){var stack1;return((stack1=container.invokePartial(partials.teaserWrapperPartial,depth0,{"name":"teaserWrapperPartial","fn":container.program(1,data,0),"inverse":container.noop,"data":data,"helpers":helpers,"partials":partials,"decorators":container.decorators}))!=null?stack1:"")},"usePartial":!0,"useData":!0});this["Personetics"].UI.Handlebars.templates.image=Handlebars.template({"1":function(container,depth0,helpers,partials,data){var stack1;return((stack1=container.invokePartial(partials.teaserHeader,depth0,{"name":"teaserHeader","data":data,"indent":"    ","helpers":helpers,"partials":partials,"decorators":container.decorators}))!=null?stack1:"")+"    <div class=\"perso-teaser-border\">\r\n        <div class=\"teaser-body\" aria-hidden=\"true\">\r\n"+((stack1=helpers["if"].call(depth0!=null?depth0:(container.nullContext||{}),((stack1=(depth0!=null?depth0["main-image"]:depth0))!=null?stack1.isAbsoluteURL:stack1),{"name":"if","hash":{},"fn":container.program(2,data,0),"inverse":container.program(4,data,0),"data":data}))!=null?stack1:"")+"        </div>\r\n    </div>\r\n"},"2":function(container,depth0,helpers,partials,data){var stack1,alias1=container.lambda,alias2=container.escapeExpression;return"                <img src=\""+alias2(alias1(((stack1=(depth0!=null?depth0["main-image"]:depth0))!=null?stack1.absUrl:stack1),depth0))+"\" alt=\""+alias2(alias1(((stack1=(depth0!=null?depth0["main-image"]:depth0))!=null?stack1.alt:stack1),depth0))+"\" />\r\n"},"4":function(container,depth0,helpers,partials,data){var stack1;return"                <div class=\"image "+container.escapeExpression(container.lambda(((stack1=(depth0!=null?depth0["main-image"]:depth0))!=null?stack1.absUrl:stack1),depth0))+"\"></div>\r\n"},"compiler":[7,">= 4.0.0"],"main":function(container,depth0,helpers,partials,data){var stack1;return((stack1=container.invokePartial(partials.teaserWrapperPartial,depth0,{"name":"teaserWrapperPartial","fn":container.program(1,data,0),"inverse":container.noop,"data":data,"helpers":helpers,"partials":partials,"decorators":container.decorators}))!=null?stack1:"")},"usePartial":!0,"useData":!0});this["Personetics"].UI.Handlebars.templates.imageAndBox=Handlebars.template({"1":function(container,depth0,helpers,partials,data){var stack1,alias1=container.lambda,alias2=container.escapeExpression;return((stack1=container.invokePartial(partials.teaserHeader,depth0,{"name":"teaserHeader","data":data,"indent":"    ","helpers":helpers,"partials":partials,"decorators":container.decorators}))!=null?stack1:"")+"\r\n    <div class=\"pstory-block-hbox-columns-frame teaser-body\" aria-hidden=\"true\">\r\n        <div class=\"pstory-hbox-column-frame\" data-width=\"6\">\r\n            <img src=\""+alias2(alias1(((stack1=(depth0!=null?depth0.image:depth0))!=null?stack1.url:stack1),depth0))+"\" alt=\""+alias2(alias1(((stack1=(depth0!=null?depth0.image:depth0))!=null?stack1.alt:stack1),depth0))+"\" style=\"max-height: 100%; max-width: 100%\" />\r\n        </div>\r\n        <div class=\"pstory-hbox-column-frame\" data-v-align=\"middle\" data-width=\"6\">\r\n            \r\n            <div class=\"pstory-block-hbox-columns-frame\">\r\n\r\n                <div class=\"pstory-block-frame pstory-block-text\">\r\n                    <div class=\"pstory-block-content\">\r\n                        "+alias2(alias1(((stack1=(depth0!=null?depth0["box-label"]:depth0))!=null?stack1.text:stack1),depth0))+"\r\n                    </div>\r\n                </div>\r\n                <div class=\"pstory-block-frame pstory-block-text perso-percent-large\">\r\n                    <div class=\"pstory-block-content\">\r\n                        "+((stack1=alias1(((stack1=(depth0!=null?depth0["box-value"]:depth0))!=null?stack1.text:stack1),depth0))!=null?stack1:"")+"\r\n                    </div>\r\n                </div>\r\n\r\n            </div>\r\n        </div>\r\n    </div>\r\n"},"compiler":[7,">= 4.0.0"],"main":function(container,depth0,helpers,partials,data){var stack1;return((stack1=container.invokePartial(partials.teaserWrapperPartial,depth0,{"name":"teaserWrapperPartial","fn":container.program(1,data,0),"inverse":container.noop,"data":data,"helpers":helpers,"partials":partials,"decorators":container.decorators}))!=null?stack1:"")},"usePartial":!0,"useData":!0});this["Personetics"].UI.Handlebars.templates.multiVerticalBar=Handlebars.template({"1":function(container,depth0,helpers,partials,data){var stack1,helper,alias1=container.escapeExpression;return((stack1=container.invokePartial(partials.teaserHeader,depth0,{"name":"teaserHeader","data":data,"indent":"    ","helpers":helpers,"partials":partials,"decorators":container.decorators}))!=null?stack1:"")+"    <div class=\"perso-teaser-border\">\r\n        <div class=\"teaser-body multi-vertical-bar-chart\" id=\""+alias1(((helper=(helper=helpers.insightId||(depth0!=null?depth0.insightId:depth0))!=null?helper:helpers.helperMissing),(typeof helper==="function"?helper.call(depth0!=null?depth0:(container.nullContext||{}),{"name":"insightId","hash":{},"data":data}):helper)))+"_"+alias1(container.lambda(((stack1=(depth0!=null?depth0.chart:depth0))!=null?stack1.blockId:stack1),depth0))+"\"  aria-hidden=\"true\"></div>\r\n    </div>\r\n"},"compiler":[7,">= 4.0.0"],"main":function(container,depth0,helpers,partials,data){var stack1;return((stack1=container.invokePartial(partials.teaserWrapperPartial,depth0,{"name":"teaserWrapperPartial","fn":container.program(1,data,0),"inverse":container.noop,"data":data,"helpers":helpers,"partials":partials,"decorators":container.decorators}))!=null?stack1:"")},"usePartial":!0,"useData":!0});this["Personetics"].UI.Handlebars.templates.pie=Handlebars.template({"1":function(container,depth0,helpers,partials,data){var stack1,helper,alias1=depth0!=null?depth0:(container.nullContext||{}),alias2=container.escapeExpression;return((stack1=container.invokePartial(partials.teaserHeader,depth0,{"name":"teaserHeader","data":data,"indent":"    ","helpers":helpers,"partials":partials,"decorators":container.decorators}))!=null?stack1:"")+"    <div class=\"perso-teaser-border\">\r\n        <div class=\"pstory-block-hbox-columns-frame teaser-body pie-chart\" aria-hidden=\"true\">\r\n                <div class=\"pstory-hbox-column-frame\" data-width=\"4\">\r\n                    <div id=\""+alias2(((helper=(helper=helpers.insightId||(depth0!=null?depth0.insightId:depth0))!=null?helper:helpers.helperMissing),(typeof helper==="function"?helper.call(alias1,{"name":"insightId","hash":{},"data":data}):helper)))+"_"+alias2(container.lambda(((stack1=(depth0!=null?depth0.chart1:depth0))!=null?stack1.blockId:stack1),depth0))+"\"></div>\r\n\r\n                </div>\r\n"+((stack1=helpers["if"].call(alias1,(depth0!=null?depth0.chart2:depth0),{"name":"if","hash":{},"fn":container.program(2,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+((stack1=helpers["if"].call(alias1,(depth0!=null?depth0.chart3:depth0),{"name":"if","hash":{},"fn":container.program(4,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"        </div>\r\n    </div>\r\n"},"2":function(container,depth0,helpers,partials,data){var stack1,helper,alias1=container.escapeExpression;return"                <div class=\"pstory-hbox-column-frame\" data-width=\"4\">\r\n                    <div id=\""+alias1(((helper=(helper=helpers.insightId||(depth0!=null?depth0.insightId:depth0))!=null?helper:helpers.helperMissing),(typeof helper==="function"?helper.call(depth0!=null?depth0:(container.nullContext||{}),{"name":"insightId","hash":{},"data":data}):helper)))+"_"+alias1(container.lambda(((stack1=(depth0!=null?depth0.chart2:depth0))!=null?stack1.blockId:stack1),depth0))+"\"></div>\r\n\r\n                </div>\r\n"},"4":function(container,depth0,helpers,partials,data){var stack1,helper,alias1=container.escapeExpression;return"                <div class=\"pstory-hbox-column-frame\" data-width=\"4\">\r\n                    <div id=\""+alias1(((helper=(helper=helpers.insightId||(depth0!=null?depth0.insightId:depth0))!=null?helper:helpers.helperMissing),(typeof helper==="function"?helper.call(depth0!=null?depth0:(container.nullContext||{}),{"name":"insightId","hash":{},"data":data}):helper)))+"_"+alias1(container.lambda(((stack1=(depth0!=null?depth0.chart3:depth0))!=null?stack1.blockId:stack1),depth0))+"\"></div>\r\n\r\n                </div>\r\n"},"compiler":[7,">= 4.0.0"],"main":function(container,depth0,helpers,partials,data){var stack1;return((stack1=container.invokePartial(partials.teaserWrapperPartial,depth0,{"name":"teaserWrapperPartial","fn":container.program(1,data,0),"inverse":container.noop,"data":data,"helpers":helpers,"partials":partials,"decorators":container.decorators}))!=null?stack1:"")},"usePartial":!0,"useData":!0});this["Personetics"].UI.Handlebars.templates.pinChart=Handlebars.template({"1":function(container,depth0,helpers,partials,data){var stack1,helper,alias1=container.escapeExpression;return((stack1=container.invokePartial(partials.teaserHeader,depth0,{"name":"teaserHeader","data":data,"indent":"    ","helpers":helpers,"partials":partials,"decorators":container.decorators}))!=null?stack1:"")+"    <div class=\"perso-teaser-border\">\r\n        <div class=\"teaser-body pin-chart\" id=\""+alias1(((helper=(helper=helpers.insightId||(depth0!=null?depth0.insightId:depth0))!=null?helper:helpers.helperMissing),(typeof helper==="function"?helper.call(depth0!=null?depth0:(container.nullContext||{}),{"name":"insightId","hash":{},"data":data}):helper)))+"_"+alias1(container.lambda(((stack1=(depth0!=null?depth0.chart:depth0))!=null?stack1.blockId:stack1),depth0))+"\"  aria-hidden=\"true\"></div>\r\n    </div>\r\n"},"compiler":[7,">= 4.0.0"],"main":function(container,depth0,helpers,partials,data){var stack1;return((stack1=container.invokePartial(partials.teaserWrapperPartial,depth0,{"name":"teaserWrapperPartial","fn":container.program(1,data,0),"inverse":container.noop,"data":data,"helpers":helpers,"partials":partials,"decorators":container.decorators}))!=null?stack1:"")},"usePartial":!0,"useData":!0});this["Personetics"].UI.Handlebars.templates.simpleText=Handlebars.template({"1":function(container,depth0,helpers,partials,data){var stack1;return((stack1=container.invokePartial(partials.teaserHeader,depth0,{"name":"teaserHeader","data":data,"indent":"    ","helpers":helpers,"partials":partials,"decorators":container.decorators}))!=null?stack1:"")},"compiler":[7,">= 4.0.0"],"main":function(container,depth0,helpers,partials,data){var stack1;return((stack1=container.invokePartial(partials.teaserWrapperPartial,depth0,{"name":"teaserWrapperPartial","fn":container.program(1,data,0),"inverse":container.noop,"data":data,"helpers":helpers,"partials":partials,"decorators":container.decorators}))!=null?stack1:"")},"usePartial":!0,"useData":!0});this["Personetics"].UI.Handlebars.templates.teaserHeader=Handlebars.template({"1":function(container,depth0,helpers,partials,data){var stack1,alias1=container.lambda,alias2=container.escapeExpression;return"                        <img class=\"pstory-block-image-icon\" src=\""+alias2(alias1(((stack1=(depth0!=null?depth0.icon:depth0))!=null?stack1.absUrl:stack1),depth0))+"\" alt=\""+alias2(alias1(((stack1=(depth0!=null?depth0.icon:depth0))!=null?stack1.alt:stack1),depth0))+"\" />\r\n"},"3":function(container,depth0,helpers,partials,data){var stack1,alias1=container.lambda,alias2=container.escapeExpression;return"                        <div class=\"pstory-block-image-icon "+alias2(alias1(((stack1=(depth0!=null?depth0.icon:depth0))!=null?stack1.absUrl:stack1),depth0))+"\" title=\""+alias2(alias1(((stack1=(depth0!=null?depth0.icon:depth0))!=null?stack1.alt:stack1),depth0))+"\"></div>\r\n"},"compiler":[7,">= 4.0.0"],"main":function(container,depth0,helpers,partials,data){var stack1,alias1=container.lambda;return"<div class=\"teaser-header\" aria-hidden=\"true\">\r\n    <div class=\"pstory-block-hbox-columns-frame teaser-top\">\r\n        <div class=\"pstory-hbox-column-frame\" data-width=\"1.5\">\r\n            <div class=\"pstory-block-frame pstory-block-icon\">\r\n                <div class=\"pstory-block-content\">\r\n"+((stack1=helpers["if"].call(depth0!=null?depth0:(container.nullContext||{}),((stack1=(depth0!=null?depth0["main-image"]:depth0))!=null?stack1.isAbsoluteURL:stack1),{"name":"if","hash":{},"fn":container.program(1,data,0),"inverse":container.program(3,data,0),"data":data}))!=null?stack1:"")+"                </div>\r\n            </div>\r\n        </div>\r\n\r\n        <div class=\"pstory-hbox-column-frame\" data-width=\"9\" data-v-align=\"middle\">\r\n            <div class=\"pstory-block-frame pstory-block-text insight-title-text block-title\">\r\n                <div class=\"pstory-block-content\">\r\n                    "+container.escapeExpression(alias1(((stack1=(depth0!=null?depth0.title:depth0))!=null?stack1.text:stack1),depth0))+"\r\n                </div>\r\n            </div>\r\n        </div>\r\n\r\n    </div>\r\n\r\n    <div class=\"pstory-block-frame pstory-block-text teaser-text\">\r\n        <div class=\"pstory-block-content\">\r\n           "+((stack1=alias1(((stack1=(depth0!=null?depth0["teaser-text"]:depth0))!=null?stack1.text:stack1),depth0))!=null?stack1:"")+"\r\n        </div>\r\n    </div>\r\n</div>"},"useData":!0});this["Personetics"].UI.Handlebars.templates.teaserWrapperPartial=Handlebars.template({"1":function(container,depth0,helpers,partials,data){return"perso-highlighted"},"3":function(container,depth0,helpers,partials,data){return"not "},"compiler":[7,">= 4.0.0"],"main":function(container,depth0,helpers,partials,data){var stack1,helper,alias1=depth0!=null?depth0:(container.nullContext||{}),alias2=helpers.helperMissing,alias3="function",alias4=container.escapeExpression,alias5=container.lambda;return"<div class=\"perso-teaser-template perso-teaser-template-bar-box perso-"+alias4(((helper=(helper=helpers.status||(depth0!=null?depth0.status:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"status","hash":{},"data":data}):helper)))+"  "+((stack1=helpers["if"].call(alias1,(depth0!=null?depth0.highlighted:depth0),{"name":"if","hash":{},"fn":container.program(1,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\" id=\"perso-teaser-template_"+alias4(((helper=(helper=helpers.insightId||(depth0!=null?depth0.insightId:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"insightId","hash":{},"data":data}):helper)))+"\"\r\n role=\"button\" aria-label=\""+alias4(alias5(((stack1=(depth0!=null?depth0.date:depth0))!=null?stack1.month:stack1),depth0))+" "+alias4(alias5(((stack1=(depth0!=null?depth0.date:depth0))!=null?stack1.day:stack1),depth0))+"."+alias4(alias5(((stack1=(depth0!=null?depth0.title:depth0))!=null?stack1.text:stack1),depth0))+"."+alias4(((helper=(helper=helpers.status||(depth0!=null?depth0.status:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"status","hash":{},"data":data}):helper)))+"."+((stack1=helpers.unless.call(alias1,(depth0!=null?depth0.highlighted:depth0),{"name":"unless","hash":{},"fn":container.program(3,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"highlighted."+((stack1=alias5(((stack1=(depth0!=null?depth0["teaser-text"]:depth0))!=null?stack1.text:stack1),depth0))!=null?stack1:"")+"\">\r\n"+((stack1=container.invokePartial(partials["@partial-block"],depth0,{"name":"@partial-block","data":data,"indent":"    ","helpers":helpers,"partials":partials,"decorators":container.decorators}))!=null?stack1:"")+"</div>"},"usePartial":!0,"useData":!0});this["Personetics"].UI.Handlebars.templates.textAndButton=Handlebars.template({"1":function(container,depth0,helpers,partials,data){var stack1,alias1=container.lambda,alias2=container.escapeExpression;return((stack1=container.invokePartial(partials.teaserHeader,depth0,{"name":"teaserHeader","data":data,"indent":"    ","helpers":helpers,"partials":partials,"decorators":container.decorators}))!=null?stack1:"")+"\r\n    <div class=\"teaser-body\" aria-hidden=\"true\">\r\n        <div id=\"pstory-block-buttons_"+alias2(alias1(((stack1=(depth0!=null?depth0.buttons:depth0))!=null?stack1.blockId:stack1),depth0))+"\" class=\"pstory-block-frame pstory-block-buttons\">\r\n            <div class=\"pstory-block-content\">\r\n                <a href=\"#!\" class=\"pstory-link-navigateTo pstory-button ripple-closed\" pnavigate-id=\""+alias2(alias1(((stack1=((stack1=((stack1=(depth0!=null?depth0.buttons:depth0))!=null?stack1.options:stack1))!=null?stack1["0"]:stack1))!=null?stack1.navigateTarget:stack1),depth0))+"\" >"+((stack1=alias1(((stack1=((stack1=((stack1=(depth0!=null?depth0.buttons:depth0))!=null?stack1.options:stack1))!=null?stack1["0"]:stack1))!=null?stack1.text:stack1),depth0))!=null?stack1:"")+"</a>\r\n            </div>\r\n        </div>\r\n    </div>\r\n"},"compiler":[7,">= 4.0.0"],"main":function(container,depth0,helpers,partials,data){var stack1;return((stack1=container.invokePartial(partials.teaserWrapperPartial,depth0,{"name":"teaserWrapperPartial","fn":container.program(1,data,0),"inverse":container.noop,"data":data,"helpers":helpers,"partials":partials,"decorators":container.decorators}))!=null?stack1:"")},"usePartial":!0,"useData":!0});this["Personetics"].UI.Handlebars.templates.verticalBar=Handlebars.template({"1":function(container,depth0,helpers,partials,data){var stack1,helper,alias1=container.escapeExpression;return((stack1=container.invokePartial(partials.teaserHeader,depth0,{"name":"teaserHeader","data":data,"indent":"    ","helpers":helpers,"partials":partials,"decorators":container.decorators}))!=null?stack1:"")+"    <div class=\"perso-teaser-border\">\r\n        <div class=\"teaser-body bar-chart\" id=\""+alias1(((helper=(helper=helpers.insightId||(depth0!=null?depth0.insightId:depth0))!=null?helper:helpers.helperMissing),(typeof helper==="function"?helper.call(depth0!=null?depth0:(container.nullContext||{}),{"name":"insightId","hash":{},"data":data}):helper)))+"_"+alias1(container.lambda(((stack1=(depth0!=null?depth0.chart:depth0))!=null?stack1.blockId:stack1),depth0))+"\"  aria-hidden=\"true\"></div>\r\n    </div>\r\n"},"compiler":[7,">= 4.0.0"],"main":function(container,depth0,helpers,partials,data){var stack1;return((stack1=container.invokePartial(partials.teaserWrapperPartial,depth0,{"name":"teaserWrapperPartial","fn":container.program(1,data,0),"inverse":container.noop,"data":data,"helpers":helpers,"partials":partials,"decorators":container.decorators}))!=null?stack1:"")},"usePartial":!0,"useData":!0});this["Personetics"].UI.Handlebars.templates.verticalBarAndBox=Handlebars.template({"1":function(container,depth0,helpers,partials,data){var stack1,helper,alias1=container.escapeExpression,alias2=container.lambda;return((stack1=container.invokePartial(partials.teaserHeader,depth0,{"name":"teaserHeader","data":data,"indent":"    ","helpers":helpers,"partials":partials,"decorators":container.decorators}))!=null?stack1:"")+"\r\n    <div class=\"perso-teaser-border\">\r\n        <div class=\"pstory-block-hbox-columns-frame teaser-body bar-chart-box\" aria-hidden=\"true\">\r\n            <div class=\"pstory-hbox-column-frame\" data-width=\"8\">\r\n                <div id=\""+alias1(((helper=(helper=helpers.insightId||(depth0!=null?depth0.insightId:depth0))!=null?helper:helpers.helperMissing),(typeof helper==="function"?helper.call(depth0!=null?depth0:(container.nullContext||{}),{"name":"insightId","hash":{},"data":data}):helper)))+"_"+alias1(alias2(((stack1=(depth0!=null?depth0.chart:depth0))!=null?stack1.blockId:stack1),depth0))+"\"></div>\r\n            </div>\r\n            <div class=\"pstory-hbox-column-frame\" data-width=\"4\">\r\n                <!--<div class=\"pstory-block-hbox-columns-frame\">-->\r\n\r\n                <div class=\"pstory-hbox-column-frame\" data-v-align=\"middle\" data-width=\"12\">\r\n                    <div class=\"pstory-block-frame pstory-block-text perso-percent-large\">\r\n                        <div class=\"pstory-block-content\">\r\n                            "+alias1(alias2(((stack1=(depth0!=null?depth0["box-value"]:depth0))!=null?stack1.text:stack1),depth0))+"\r\n                        </div>\r\n                    </div>\r\n                    <div class=\"pstory-block-frame pstory-block-text\">\r\n                        <div class=\"pstory-block-content\">\r\n                            "+alias1(alias2(((stack1=(depth0!=null?depth0["box-label"]:depth0))!=null?stack1.text:stack1),depth0))+"\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n\r\n            </div>\r\n        </div>\r\n    </div>\r\n"},"compiler":[7,">= 4.0.0"],"main":function(container,depth0,helpers,partials,data){var stack1;return((stack1=container.invokePartial(partials.teaserWrapperPartial,depth0,{"name":"teaserWrapperPartial","fn":container.program(1,data,0),"inverse":container.noop,"data":data,"helpers":helpers,"partials":partials,"decorators":container.decorators}))!=null?stack1:"")},"usePartial":!0,"useData":!0});this["Personetics"].UI.Handlebars.templates["tmpl-perso-loading-animation"]=Handlebars.template({"compiler":[7,">= 4.0.0"],"main":function(container,depth0,helpers,partials,data){var stack1,helper;return"<div id='perso-loading-widget'>\r\n    <div class='perso-loading'></div>\r\n    <div class='perso-loading-text' >\r\n         "+((stack1=((helper=(helper=helpers.loadingText||(depth0!=null?depth0.loadingText:depth0))!=null?helper:helpers.helperMissing),(typeof helper==="function"?helper.call(depth0!=null?depth0:(container.nullContext||{}),{"name":"loadingText","hash":{},"data":data}):helper)))!=null?stack1:"")+"\r\n    </div>\r\n</div>"},"useData":!0});this["Personetics"].UI.Handlebars.templates["pstory-block-account-selector-inner-card-desktop"]=Handlebars.template({"1":function(container,depth0,helpers,partials,data){var helper,alias1=depth0!=null?depth0:(container.nullContext||{}),alias2=helpers.helperMissing,alias3="function",alias4=container.escapeExpression;return"		<span class=\"perso-account-number\" aria-label=\""+alias4(((helper=(helper=helpers.numberPrefAccessibility||(depth0!=null?depth0.numberPrefAccessibility:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"numberPrefAccessibility","hash":{},"data":data}):helper)))+" "+alias4(((helper=(helper=helpers.number||(depth0!=null?depth0.number:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"number","hash":{},"data":data}):helper)))+".\">"+alias4(((helper=(helper=helpers.id||(depth0!=null?depth0.id:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"id","hash":{},"data":data}):helper)))+"</span>\r\n"},"compiler":[7,">= 4.0.0"],"main":function(container,depth0,helpers,partials,data){var stack1,helper,alias1=depth0!=null?depth0:(container.nullContext||{}),alias2=helpers.helperMissing,alias3="function",alias4=container.escapeExpression;return"<div class=\"card card_"+alias4(((helper=(helper=helpers.typeImage||(depth0!=null?depth0.typeImage:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"typeImage","hash":{},"data":data}):helper)))+" cards"+alias4(((helper=(helper=helpers.numCards||(depth0!=null?depth0.numCards:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"numCards","hash":{},"data":data}):helper)))+"\" pstory-id=\""+alias4(((helper=(helper=helpers.id||(depth0!=null?depth0.id:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"id","hash":{},"data":data}):helper)))+"\">	\r\n"+((stack1=helpers["if"].call(alias1,(depth0!=null?depth0.id:depth0),{"name":"if","hash":{},"fn":container.program(1,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"	<span class=\"perso-account-name\" aria-label=\""+alias4(((helper=(helper=helpers.name||(depth0!=null?depth0.name:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"name","hash":{},"data":data}):helper)))+".\">"+alias4(((helper=(helper=helpers.name||(depth0!=null?depth0.name:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"name","hash":{},"data":data}):helper)))+"</span>\r\n	<div class=\"perso-account-selector-card-line\"></div>\r\n	<div id=\"pop-"+alias4(container.lambda(depth0,depth0))+"\" class=\"pstory-button-txt-wrapper\" pstory-id=\""+alias4(((helper=(helper=helpers.id||(depth0!=null?depth0.id:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"id","hash":{},"data":data}):helper)))+"\">\r\n		<span class=\"pstory-button-txt\">"+((stack1=((helper=(helper=helpers.text||(depth0!=null?depth0.text:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"text","hash":{},"data":data}):helper)))!=null?stack1:"")+"</span>\r\n	</div>\r\n</div>"},"useData":!0});this["Personetics"].UI.Handlebars.templates["pstory-block-pie-chart"]=Handlebars.template({"compiler":[7,">= 4.0.0"],"main":function(container,depth0,helpers,partials,data){var stack1,alias1=container.lambda,alias2=container.escapeExpression;return"<div class=\"pstory-block-frame pstory-block-pie-chart\">\r\n    <div class=\"pstory-block-container\">\r\n        <div class=\"pstory-block-content\" tabindex=\"0\">\r\n            <div class=\"pstory-pie-chart\"></div>\r\n            <div class=\"pstory-pie-data\">\r\n                <input type=\"button\" class=\"pstory-arrow pstory-next-arrow\" tabindex=\"-1\" aria-label=\""+alias2(alias1(((stack1=(depth0!=null?depth0.texts:depth0))!=null?stack1.nextCategory:stack1),depth0))+"\"/>\r\n                <div class=\"pstory-pie-info perso-accessibility-wrapper\" role=\"text\">\r\n                </div>\r\n                <input type=\"button\" class=\"pstory-arrow pstory-previous-arrow\" tabindex=\"-1\" aria-label=\""+alias2(alias1(((stack1=(depth0!=null?depth0.texts:depth0))!=null?stack1.previousCategory:stack1),depth0))+"\"/>\r\n                <div class=\"carousel-animate carousel-wrapper\">\r\n                    <div class=\"carousel-index-wrapper\">\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</div>"},"useData":!0});this["Personetics"].UI.Handlebars.templates["pstory-block-table-perso-txlist3-desktop"]=Handlebars.template({"1":function(container,depth0,helpers,partials,data){return"                    <tr>\r\n                        <td class=\"perso-loading-table\">Loading...</td>\r\n                    </tr>\r\n"},"3":function(container,depth0,helpers,partials,data,blockParams,depths){var stack1;return((stack1=helpers.each.call(depth0!=null?depth0:(container.nullContext||{}),(depth0!=null?depth0.rows:depth0),{"name":"each","hash":{},"fn":container.program(4,data,0,blockParams,depths),"inverse":container.noop,"data":data}))!=null?stack1:"")},"4":function(container,depth0,helpers,partials,data,blockParams,depths){var stack1,alias1=container.lambda;return"                            <tr >\r\n                                <td>\r\n                                    <span class=\"perso-td-first-row perso-td-date\">\r\n                                        "+((stack1=alias1((depth0!=null?depth0.date:depth0),depth0))!=null?stack1:"")+"\r\n                                    </span>\r\n                                </td>\r\n                                <td  class=\"leftAlign\"> \r\n                                    <span class=\"perso-td-first-row perso-td-account-number\">\r\n                                        "+((stack1=alias1((depth0!=null?depth0.accountNumber:depth0),depth0))!=null?stack1:"")+"\r\n                                    </span>\r\n                                    <span class=\"perso-td-transaction\">\r\n                                        "+((stack1=alias1((depth0!=null?depth0.transaction:depth0),depth0))!=null?stack1:"")+"\r\n                                    </span>\r\n                                </td>\r\n                                <td class=\"leftAlign\" >\r\n                                    <span class=\"perso-td-first-row\">\r\n                                        "+container.escapeExpression(alias1((depths[1]!=null?depths[1].balanceLabel:depths[1]),depth0))+"\r\n                                    </span>\r\n                                    <span class=\"perso-td-amount-balance\">\r\n                                        "+((stack1=alias1((depth0!=null?depth0.balance:depth0),depth0))!=null?stack1:"")+"\r\n                                    </span>\r\n                                </td>   \r\n                            </tr>\r\n"},"compiler":[7,">= 4.0.0"],"main":function(container,depth0,helpers,partials,data,blockParams,depths){var stack1;return"<div class=\"pstory-block-frame pstory-block-table\">\r\n    <div class=\"pstory-block-container\">\r\n        <div class=\"pstory-block-content\">\r\n            <table class=\"pstory-table pstory-table-txlist3\">\r\n"+((stack1=helpers["if"].call(depth0!=null?depth0:(container.nullContext||{}),(depth0!=null?depth0.future:depth0),{"name":"if","hash":{},"fn":container.program(1,data,0,blockParams,depths),"inverse":container.program(3,data,0,blockParams,depths),"data":data}))!=null?stack1:"")+"            </table>\r\n        </div>\r\n    </div>\r\n</div>\r\n"},"useData":!0,"useDepths":!0});this["Personetics"].UI.Handlebars.templates["pstory-block-table-perso-txlist4-desktop"]=Handlebars.template({"1":function(container,depth0,helpers,partials,data){return"                    <tr>\r\n                        <td class=\"perso-loading-table\">Loading...</td>\r\n                    </tr>\r\n"},"3":function(container,depth0,helpers,partials,data){var stack1;return((stack1=helpers.each.call(depth0!=null?depth0:(container.nullContext||{}),(depth0!=null?depth0.rows:depth0),{"name":"each","hash":{},"fn":container.program(4,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")},"4":function(container,depth0,helpers,partials,data){var stack1,alias1=container.lambda;return"                            <tr >\r\n                                <td>\r\n                                    <span class=\"perso-td-first-row perso-td-date\">\r\n                                        "+((stack1=alias1((depth0!=null?depth0.date:depth0),depth0))!=null?stack1:"")+"\r\n                                    </span>\r\n                                    <span class=\"perso-td-transaction\">\r\n                                        "+((stack1=alias1((depth0!=null?depth0.transaction:depth0),depth0))!=null?stack1:"")+"\r\n                                    </span>\r\n                                </td>\r\n                                <td  class=\"leftAlign\">\r\n                                      <span class=\"perso-td-first-row perso-td-amount-balance\">\r\n                                          "+((stack1=alias1((depth0!=null?depth0.balance:depth0),depth0))!=null?stack1:"")+"\r\n                                      </span>\r\n                                </td>\r\n                            </tr>\r\n"},"compiler":[7,">= 4.0.0"],"main":function(container,depth0,helpers,partials,data){var stack1;return"<div class=\"pstory-block-frame pstory-block-table\">\r\n    <div class=\"pstory-block-container\">\r\n        <div class=\"pstory-block-content\">\r\n            <table class=\"pstory-table pstory-table-txlist4\">\r\n"+((stack1=helpers["if"].call(depth0!=null?depth0:(container.nullContext||{}),(depth0!=null?depth0.future:depth0),{"name":"if","hash":{},"fn":container.program(1,data,0),"inverse":container.program(3,data,0),"data":data}))!=null?stack1:"")+"            </table>\r\n        </div>\r\n    </div>\r\n</div>\r\n"},"useData":!0});this["Personetics"].UI.Handlebars.templates["tmpl-perso-rating-desktop"]=Handlebars.template({"compiler":[7,">= 4.0.0"],"main":function(container,depth0,helpers,partials,data){var helper;return"<div class=\"perso-ratings-wrapper perso-rating-close-state\">\r\n   <div class='perso-ratings-text'>"+container.escapeExpression(((helper=(helper=helpers.ratingTitle||(depth0!=null?depth0.ratingTitle:depth0))!=null?helper:helpers.helperMissing),(typeof helper==="function"?helper.call(depth0!=null?depth0:(container.nullContext||{}),{"name":"ratingTitle","hash":{},"data":data}):helper)))+"</div>\r\n   <div class='perso-ratings-icons' data-rating-max='5'></div>\r\n</div>\r\n\r\n"},"useData":!0});this["Personetics"].UI.Handlebars.templates["pstory-block-account-selector-inner-card-desktop"]=Handlebars.template({"1":function(container,depth0,helpers,partials,data){var helper,alias1=depth0!=null?depth0:(container.nullContext||{}),alias2=helpers.helperMissing,alias3="function",alias4=container.escapeExpression;return"        <span>"+alias4(((helper=(helper=helpers.accountNumberTxt||(depth0!=null?depth0.accountNumberTxt:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"accountNumberTxt","hash":{},"data":data}):helper)))+" - "+alias4(((helper=(helper=helpers.number||(depth0!=null?depth0.number:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"number","hash":{},"data":data}):helper)))+"</span> "},"compiler":[7,">= 4.0.0"],"main":function(container,depth0,helpers,partials,data){var stack1,helper,alias1=depth0!=null?depth0:(container.nullContext||{}),alias2=helpers.helperMissing,alias3="function",alias4=container.escapeExpression;return"<div class=\"card card_"+alias4(((helper=(helper=helpers.typeImage||(depth0!=null?depth0.typeImage:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"typeImage","hash":{},"data":data}):helper)))+" cards"+alias4(((helper=(helper=helpers.numCards||(depth0!=null?depth0.numCards:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"numCards","hash":{},"data":data}):helper)))+"\" pstory-id=\""+alias4(((helper=(helper=helpers.id||(depth0!=null?depth0.id:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"id","hash":{},"data":data}):helper)))+"\">	\r\n    <div class=\"perso-card-img "+alias4(((helper=(helper=helpers.image||(depth0!=null?depth0.image:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"image","hash":{},"data":data}):helper)))+"\" ></div>\r\n</div>\r\n<div id=\"pop-"+alias4(container.lambda(depth0,depth0))+"\" class=\"pstory-button-txt-wrapper\" pstory-id=\""+alias4(((helper=(helper=helpers.id||(depth0!=null?depth0.id:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"id","hash":{},"data":data}):helper)))+"\">\r\n    <span class=\"pstory-button-txt account-number\">\r\n"+((stack1=helpers["if"].call(alias1,(depth0!=null?depth0.number:depth0),{"name":"if","hash":{},"fn":container.program(1,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\r\n    </span>\r\n    <span class=\"pstory-button-txt\">\r\n    "+((stack1=((helper=(helper=helpers.text||(depth0!=null?depth0.text:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"text","hash":{},"data":data}):helper)))!=null?stack1:"")+"\r\n    </span>\r\n</div>"},"useData":!0});this["Personetics"].UI.Handlebars.templates["pstory-block-account-selector"]=Handlebars.template({"1":function(container,depth0,helpers,partials,data,blockParams,depths){var stack1;return"			<div class=\"header-container\">\r\n				<div class=\"pstory-tab-animated-border-bottom\"></div>\r\n				<ul class=\"tablist\" role=\"tablist\">\r\n"+((stack1=helpers.each.call(depth0!=null?depth0:(container.nullContext||{}),(depth0!=null?depth0.headersArray:depth0),{"name":"each","hash":{},"fn":container.program(2,data,0,blockParams,depths),"inverse":container.noop,"data":data}))!=null?stack1:"")+"				</ul>\r\n			</div>\r\n			<div class=\"carousel-outer-wrapper\">\r\n				<div class=\"carousel-animate options-container carousel-wrapper pstory-show-header-tabs\">\r\n"},"2":function(container,depth0,helpers,partials,data,blockParams,depths){var stack1,helper,alias1=depth0!=null?depth0:(container.nullContext||{}),alias2=helpers.helperMissing,alias3="function";return"						<li class=\"pstory-header-button\" "+((stack1=helpers["if"].call(alias1,(depths[1]!=null?depths[1].isDesktopMode:depths[1]),{"name":"if","hash":{},"fn":container.program(3,data,0,blockParams,depths),"inverse":container.noop,"data":data}))!=null?stack1:"")+" role=\"tab\" data-all=\""+container.escapeExpression(((helper=(helper=helpers.isAll||(depth0!=null?depth0.isAll:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"isAll","hash":{},"data":data}):helper)))+"\" "+((stack1=helpers["if"].call(alias1,(depth0!=null?depth0.isAll:depth0),{"name":"if","hash":{},"fn":container.program(5,data,0,blockParams,depths),"inverse":container.noop,"data":data}))!=null?stack1:"")+">"+((stack1=((helper=(helper=helpers.text||(depth0!=null?depth0.text:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"text","hash":{},"data":data}):helper)))!=null?stack1:"")+"\r\n							<span class=\"pstory-header-button-arrow\"></span>\r\n						</li>\r\n"},"3":function(container,depth0,helpers,partials,data){var stack1,helper;return" tabindex=\"0\"  aria-label=\""+((stack1=((helper=(helper=helpers.text||(depth0!=null?depth0.text:depth0))!=null?helper:helpers.helperMissing),(typeof helper==="function"?helper.call(depth0!=null?depth0:(container.nullContext||{}),{"name":"text","hash":{},"data":data}):helper)))!=null?stack1:"")+"\" "},"5":function(container,depth0,helpers,partials,data){return"pstory-id=\"all\""},"7":function(container,depth0,helpers,partials,data){return"					<div class=\"carousel-outer-wrapper\">\r\n						<div class=\"carousel-animate options-container carousel-wrapper\">\r\n"},"9":function(container,depth0,helpers,partials,data,blockParams,depths){var stack1,helper,alias1=depth0!=null?depth0:(container.nullContext||{}),alias2=helpers.helperMissing,alias3="function",alias4=container.escapeExpression;return"								<div class=\"carousel-item pstory-button "+((stack1=helpers["if"].call(alias1,(depth0!=null?depth0.selected:depth0),{"name":"if","hash":{},"fn":container.program(10,data,0,blockParams,depths),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\" aria-hidden=\"true\" pstory-id=\""+alias4(((helper=(helper=helpers.id||(depth0!=null?depth0.id:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"id","hash":{},"data":data}):helper)))+"\" pstory-event=\""+alias4(((helper=(helper=helpers.event||(depth0!=null?depth0.event:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"event","hash":{},"data":data}):helper)))+"\"\r\n								 role=\""+alias4(container.lambda((depths[1]!=null?depths[1].role:depths[1]),depth0))+"\">\r\n									"+((stack1=helpers["if"].call(alias1,(depths[1]!=null?depths[1].isDesktopMode:depths[1]),{"name":"if","hash":{},"fn":container.program(12,data,0,blockParams,depths),"inverse":container.program(14,data,0,blockParams,depths),"data":data}))!=null?stack1:"")+"\r\n								</div>\r\n"},"10":function(container,depth0,helpers,partials,data){return"selected"},"12":function(container,depth0,helpers,partials,data,blockParams,depths){var stack1;return" "+((stack1=container.invokePartial(partials.innerCardDesktop,depth0,{"name":"innerCardDesktop","hash":{"accountNumberTxt":(depths[1]!=null?depths[1].accountNumberTxt:depths[1]),"numberPrefAccessibility":(depths[1]!=null?depths[1].numberPrefAccessibility:depths[1]),"numberPref":(depths[1]!=null?depths[1].numberPref:depths[1])},"data":data,"helpers":helpers,"partials":partials,"decorators":container.decorators}))!=null?stack1:"")+"\r\n									"},"14":function(container,depth0,helpers,partials,data,blockParams,depths){var stack1;return" "+((stack1=container.invokePartial(partials.innerCard,depth0,{"name":"innerCard","hash":{"numberPrefAccessibility":(depths[1]!=null?depths[1].numberPrefAccessibility:depths[1]),"numberPref":(depths[1]!=null?depths[1].numberPref:depths[1])},"data":data,"helpers":helpers,"partials":partials,"decorators":container.decorators}))!=null?stack1:"")+" "},"16":function(container,depth0,helpers,partials,data){var stack1,alias1=depth0!=null?depth0:(container.nullContext||{});return"							<div class=\"carousel-index-wrapper\" "+((stack1=helpers["if"].call(alias1,(depth0!=null?depth0.isDesktopMode:depth0),{"name":"if","hash":{},"fn":container.program(17,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+">\r\n								<div class=\"carousel-index-container\">\r\n"+((stack1=helpers.each.call(alias1,(depth0!=null?depth0.options:depth0),{"name":"each","hash":{},"fn":container.program(19,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"								</div>\r\n							</div>\r\n"},"17":function(container,depth0,helpers,partials,data){var stack1;return" role=\"application\" aria-labelledby=\"perso-accessibility-read-"+container.escapeExpression(container.lambda(((stack1=((stack1=(depth0!=null?depth0.options:depth0))!=null?stack1["0"]:stack1))!=null?stack1.id:stack1),depth0))+"\""},"19":function(container,depth0,helpers,partials,data){return"									<div class=\"carousel-index-dot\">\r\n										<div class=\"carousel-index-dot-circle\"></div>\r\n									</div> \r\n"},"21":function(container,depth0,helpers,partials,data){return" tabindex=\"-1\" "},"compiler":[7,">= 4.0.0"],"main":function(container,depth0,helpers,partials,data,blockParams,depths){var stack1,helper,alias1=depth0!=null?depth0:(container.nullContext||{}),alias2=helpers.helperMissing,alias3="function",alias4=container.escapeExpression;return"<div id=\"pstory-block-account-selector_"+alias4(((helper=(helper=helpers.index||(depth0!=null?depth0.index:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"index","hash":{},"data":data}):helper)))+"\" class=\"pstory-block-frame pstory-block-account-selector "+alias4(((helper=(helper=helpers["class"]||(depth0!=null?depth0["class"]:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"class","hash":{},"data":data}):helper)))+"\" data-show-header-tabs="+alias4(((helper=(helper=helpers.showHeaderTabs||(depth0!=null?depth0.showHeaderTabs:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"showHeaderTabs","hash":{},"data":data}):helper)))+">\r\n	<div class=\"pstory-block-container\">\r\n		<div class=\"pstory-block-content\">\r\n"+((stack1=helpers["if"].call(alias1,(depth0!=null?depth0.showHeaderTabs:depth0),{"name":"if","hash":{},"fn":container.program(1,data,0,blockParams,depths),"inverse":container.program(7,data,0,blockParams,depths),"data":data}))!=null?stack1:"")+"							<div class=\"carousel-inner-wrapper cards-wrapper\" aria-hidden=\"true\">\r\n"+((stack1=helpers.each.call(alias1,(depth0!=null?depth0.options:depth0),{"name":"each","hash":{},"fn":container.program(9,data,0,blockParams,depths),"inverse":container.noop,"data":data}))!=null?stack1:"")+"							</div>\r\n\r\n							<div class=\"perso-accessibility-wrapper pstory-account-button selected\" role=\"text\">\r\n								<span class=\"perso-accessibility-read\">"+alias4(((helper=(helper=helpers.accountName||(depth0!=null?depth0.accountName:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"accountName","hash":{},"data":data}):helper)))+". "+alias4(((helper=(helper=helpers.numberPrefAccessibility||(depth0!=null?depth0.numberPrefAccessibility:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"numberPrefAccessibility","hash":{},"data":data}):helper)))+" "+alias4(((helper=(helper=helpers.accountNumber||(depth0!=null?depth0.accountNumber:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"accountNumber","hash":{},"data":data}):helper)))+"</span>\r\n							</div>\r\n\r\n"+((stack1=helpers["if"].call(alias1,(depth0!=null?depth0.showIndexDots:depth0),{"name":"if","hash":{},"fn":container.program(16,data,0,blockParams,depths),"inverse":container.noop,"data":data}))!=null?stack1:"")+"							<div class=\"pstory-all-accounts-txt\" role=\"text\">"+((stack1=((helper=(helper=helpers.allAccountsTxt||(depth0!=null?depth0.allAccountsTxt:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"allAccountsTxt","hash":{},"data":data}):helper)))!=null?stack1:"")+"</div>\r\n						</div>\r\n						<input type=\"button\" class=\"pstory-account-button pstory-prev-account-button\" aria-label=\""+alias4(((helper=(helper=helpers.next||(depth0!=null?depth0.next:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"next","hash":{},"data":data}):helper)))+"\" "+((stack1=helpers["if"].call(alias1,(depth0!=null?depth0.isDesktopMode:depth0),{"name":"if","hash":{},"fn":container.program(21,data,0,blockParams,depths),"inverse":container.noop,"data":data}))!=null?stack1:"")+" />\r\n						<input type=\"button\" class=\"pstory-account-button pstory-next-account-button\" aria-label=\""+alias4(((helper=(helper=helpers.next||(depth0!=null?depth0.next:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"next","hash":{},"data":data}):helper)))+"\" "+((stack1=helpers["if"].call(alias1,(depth0!=null?depth0.isDesktopMode:depth0),{"name":"if","hash":{},"fn":container.program(21,data,0,blockParams,depths),"inverse":container.noop,"data":data}))!=null?stack1:"")+"/>\r\n					</div>\r\n					<div class=\"pstory-comment\">"+((stack1=((helper=(helper=helpers.comment||(depth0!=null?depth0.comment:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"comment","hash":{},"data":data}):helper)))!=null?stack1:"")+"</div>\r\n				</div>\r\n			</div>\r\n		</div>\r\n	</div>\r\n</div>\r\n"},"usePartial":!0,"useData":!0,"useDepths":!0});this["Personetics"].UI.Handlebars.templates["pstory-block-pie-chart"]=Handlebars.template({"compiler":[7,">= 4.0.0"],"main":function(container,depth0,helpers,partials,data){var stack1,alias1=container.lambda,alias2=container.escapeExpression;return"<div class=\"pstory-block-frame pstory-block-pie-chart\">\r\n    <div class=\"pstory-block-container\">\r\n        <div class=\"pstory-block-content\">\r\n            <div class=\"pstory-pie-chart\"></div>\r\n            <div class=\"pstory-pie-data\">\r\n                <input type=\"button\" class=\"pstory-arrow pstory-next-arrow\" aria-label=\""+alias2(alias1(((stack1=(depth0!=null?depth0.texts:depth0))!=null?stack1.nextCategory:stack1),depth0))+"\"/>\r\n                <div class=\"pstory-pie-info perso-accessibility-wrapper\" role=\"text\">\r\n                </div>\r\n                <input type=\"button\" class=\"pstory-arrow pstory-previous-arrow\" aria-label=\""+alias2(alias1(((stack1=(depth0!=null?depth0.texts:depth0))!=null?stack1.previousCategory:stack1),depth0))+"\"/>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</div>"},"useData":!0});this["Personetics"].UI.Handlebars.templates["pstory-block-table-perso-txlist1"]=Handlebars.template({"1":function(container,depth0,helpers,partials,data){var stack1;return"                    <table class=\"pstory-table\">\r\n                        <tr class=\"table-header-row\">\r\n                            <th colspan=\"3\">"+((stack1=container.lambda((depth0!=null?depth0.date:depth0),depth0))!=null?stack1:"")+"</th>\r\n                        </tr>\r\n"+((stack1=helpers.each.call(depth0!=null?depth0:(container.nullContext||{}),(depth0!=null?depth0.rows:depth0),{"name":"each","hash":{},"fn":container.program(2,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"                    </table>\r\n"},"2":function(container,depth0,helpers,partials,data){var stack1,alias1=container.lambda;return"                            <tr>\r\n                                <td class=\"perso-td-account-number\">\r\n                                    "+((stack1=alias1((depth0!=null?depth0.accountNumber:depth0),depth0))!=null?stack1:"")+"\r\n                                </td>\r\n                                <td class=\"perso-td-transaction\"> \r\n                                    "+((stack1=alias1((depth0!=null?depth0.transaction:depth0),depth0))!=null?stack1:"")+"\r\n                                </td>\r\n                                <td class=\"perso-td-amount-balance\">\r\n                                    "+((stack1=alias1((depth0!=null?depth0.amount:depth0),depth0))!=null?stack1:"")+"\r\n                                </td>\r\n                            </tr>\r\n"},"compiler":[7,">= 4.0.0"],"main":function(container,depth0,helpers,partials,data){var stack1,helper,alias1=depth0!=null?depth0:(container.nullContext||{});return"<div class=\"pstory-block-frame pstory-block-table "+container.escapeExpression(((helper=(helper=helpers["class"]||(depth0!=null?depth0["class"]:depth0))!=null?helper:helpers.helperMissing),(typeof helper==="function"?helper.call(alias1,{"name":"class","hash":{},"data":data}):helper)))+"\">\r\n    <div class=\"pstory-block-container\">\r\n        <div class=\"pstory-block-content\">\r\n            <div>\r\n"+((stack1=helpers.each.call(alias1,(depth0!=null?depth0.groups:depth0),{"name":"each","hash":{},"fn":container.program(1,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"            </div>\r\n        </div>\r\n    </div>\r\n</div>"},"useData":!0});this["Personetics"].UI.Handlebars.templates["pstory-block-tabs"]=Handlebars.template({"1":function(container,depth0,helpers,partials,data){var stack1,helper,alias1=depth0!=null?depth0:(container.nullContext||{}),alias2=helpers.helperMissing,alias3="function";return"            \r\n                <input type=\"button\" class=\"pstory-tab pstory-button "+((stack1=helpers["if"].call(alias1,(depth0!=null?depth0.selected:depth0),{"name":"if","hash":{},"fn":container.program(2,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\" value=\""+((stack1=((helper=(helper=helpers.text||(depth0!=null?depth0.text:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"text","hash":{},"data":data}):helper)))!=null?stack1:"")+"\" pstory-id=\""+container.escapeExpression(((helper=(helper=helpers.id||(depth0!=null?depth0.id:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"id","hash":{},"data":data}):helper)))+"\" />\r\n            "},"2":function(container,depth0,helpers,partials,data){return"selected"},"4":function(container,depth0,helpers,partials,data){var stack1,helper,alias1=depth0!=null?depth0:(container.nullContext||{}),alias2=helpers.helperMissing,alias3="function",alias4=container.escapeExpression;return"                    <li  class=\"pstory-tab pstory-button "+((stack1=helpers["if"].call(alias1,(depth0!=null?depth0.selected:depth0),{"name":"if","hash":{},"fn":container.program(2,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\" aria-selected=\""+alias4(((helper=(helper=helpers.selected||(depth0!=null?depth0.selected:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"selected","hash":{},"data":data}):helper)))+"\" role=\"tab\" tabindex=\""+alias4(((helper=(helper=helpers.index||(data&&data.index))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"index","hash":{},"data":data}):helper)))+"\" pstory-id=\""+alias4(((helper=(helper=helpers.id||(depth0!=null?depth0.id:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"id","hash":{},"data":data}):helper)))+"\">"+((stack1=((helper=(helper=helpers.text||(depth0!=null?depth0.text:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"text","hash":{},"data":data}):helper)))!=null?stack1:"")+"\r\n                    <span class=\"pstory-header-button-arrow\"></span></li>\r\n"},"compiler":[7,">= 4.0.0"],"main":function(container,depth0,helpers,partials,data){var stack1,helper,alias1=depth0!=null?depth0:(container.nullContext||{}),alias2=helpers.helperMissing,alias3="function",alias4=container.escapeExpression;return"<div id=\"pstory-block-tabs_"+alias4(((helper=(helper=helpers.id||(depth0!=null?depth0.id:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"id","hash":{},"data":data}):helper)))+"\" class=\"pstory-block-frame pstory-block-tabs "+alias4(((helper=(helper=helpers["class"]||(depth0!=null?depth0["class"]:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"class","hash":{},"data":data}):helper)))+"\">\r\n    <div class=\"pstory-block-container\">\r\n        <div class=\"pstory-block-content\">\r\n            <!--"+((stack1=helpers.each.call(alias1,(depth0!=null?depth0.options:depth0),{"name":"each","hash":{},"fn":container.program(1,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"-->\r\n            <div class=\"pstory-tab-animated-border-bottom\"></div>            \r\n            <ul class=\"tablist\" role=\"tablist\">\r\n"+((stack1=helpers.each.call(alias1,(depth0!=null?depth0.options:depth0),{"name":"each","hash":{},"fn":container.program(4,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"            </ul>\r\n        </div>\r\n    </div>\r\n</div>"},"useData":!0});this["Personetics"].UI.Handlebars.templates["tmpl-pstory-title"]=Handlebars.template({"compiler":[7,">= 4.0.0"],"main":function(container,depth0,helpers,partials,data){var stack1,helper,alias1=depth0!=null?depth0:(container.nullContext||{}),alias2=helpers.helperMissing,alias3="function";return"<div class=\"pstory-title-outer-wrapper\">\r\n    <div class=\"pstory-title-wrapper\">\r\n        <input aria-label=\""+container.escapeExpression(((helper=(helper=helpers.backButtonText||(depth0!=null?depth0.backButtonText:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"backButtonText","hash":{},"data":data}):helper)))+"\" type=\"button\" class=\"pstory-title-close\"/>\r\n        <div class=\"pstory-title\">\r\n            <div role=\"text\" class=\"pstory-title-text\">"+((stack1=((helper=(helper=helpers.title||(depth0!=null?depth0.title:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"title","hash":{},"data":data}):helper)))!=null?stack1:"")+"</div>\r\n        </div>\r\n    </div>\r\n</div>\r\n<div id=\"story-frame-container\"></div>"},"useData":!0});this["Personetics"].UI.Handlebars.templates["tmpl-perso-feedback"]=Handlebars.template({"compiler":[7,">= 4.0.0"],"main":function(container,depth0,helpers,partials,data){var stack1,helper,alias1=depth0!=null?depth0:(container.nullContext||{}),alias2=helpers.helperMissing,alias3="function",alias4=container.escapeExpression;return"<div class=\"perso-feedback-wrapper perso-rating-close-state\">\r\n    <div class=\"textarea-wrapper\">\r\n        <div class=\"textarea-container\">\r\n            <div class=\"perso-feedback-label\">"+alias4(((helper=(helper=helpers.lblfeedbackprompt||(depth0!=null?depth0.lblfeedbackprompt:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"lblfeedbackprompt","hash":{},"data":data}):helper)))+"</div>\r\n            <textarea class=\"perso-feedback-text direction-text-center\" ></textarea>\r\n            <div class=\"textarea-size\" ></div>\r\n        </div>\r\n        <input class=\"perso-feedback-submit disabled-button\" disabled=\"disabled\" type=\"button\" value=\""+((stack1=((helper=(helper=helpers.btnsubmit||(depth0!=null?depth0.btnsubmit:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"btnsubmit","hash":{},"data":data}):helper)))!=null?stack1:"")+"\"/>\r\n    </div>\r\n    <div class=\"perso-feedback-reaction\">"+alias4(((helper=(helper=helpers.lblreactionFeedback||(depth0!=null?depth0.lblreactionFeedback:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"lblreactionFeedback","hash":{},"data":data}):helper)))+"</div>\r\n</div>\r\n"},"useData":!0})})(window,window.Personetics=window.Personetics||{},jQuery,window.Personetics.UI.Handlebars);(function(window,Personetics,$,undefined){Personetics.story=Personetics.story||{};Personetics.story.PieChartBlockCiti=Personetics.story.PieChartBlockProduct.extend({setPieSize:function setPieSize(){Personetics.story.PieChartBlock.prototype.setPieSize.call(this);this.height=this.width*0.46;this.innerRadius=this.radius-153;this.outerRadius=this.radius-178;this.innerRadiusOver=this.radius-121.5;this.outerRadiusOver=this.radius-178},updatePieInfoValues:function(obj){var block=this;if(obj){block.el.find(".perso-total-txt").html(obj.category);if(this.options.arcs.filter.grayFilter==!0){block.el.find('.pstory-pie-amount').css('color',"#ffffff")}
block.el.find(".perso-total-amount").html(obj.label);totalAmount=obj.label;var text=block.frameEl.find('.perso-total-amount');text.empty();text=d3.select(text[0]);var tspan=text.append('tspan');var attrs=$(totalAmount)[0]?$(totalAmount)[0].attributes:[];$.each(attrs,function(j,attr){tspan.attr(attr.name,attr.value)});var totalAmountChildren=$(totalAmount).children();$.each(totalAmountChildren,function(i,node){var innerTspan=tspan.append('tspan').text($(node).text());var attrs=node.attributes;$.each(attrs,function(j,attr){innerTspan.attr(attr.name,attr.value)})})}
this.totalText=obj.category;arcPaths=block.frameEl.find('.pstory-pie-chart svg .perso-arc path');var wrapLabelTextBind=Personetics.bind(this,this.wrapLabelText);var labelTextwidth=120;this.svg.selectAll('text.perso-total-txt').attr('dy','1.66em').html(obj.category).call(wrapLabelTextBind,120)},initPieInfoValues:function(){this.setTotal(this.layoutInstructions);var amountDiv='<div class="pstory-pie-amount perso-accessibility-no-read"><span>'+this.totalAmount+'</span></div>';var categoryDiv='<div class="pstory-pie-category perso-accessibility-no-read"><span>'+this.totalText+'</span></div>';var $infoContainer=this.frameEl.find('.pstory-pie-info');$infoContainer.empty();$infoContainer.append(categoryDiv);$infoContainer.append(amountDiv)},renderGrayFilter:function renderGrayFilter(){this.svg.append("filter").attr("id",this.grayscaleId).append("feColorMatrix").attr("type","matrix").attr("values","0 1 0 1 0 0 0.623 0 1 0 0 0.345 0 1 0 0 1 0 1 0 ")},renderPie:function(el,layoutInstructions,block){arcPaths=block.frameEl.find('.pstory-pie-chart svg .perso-arc path');this.renderArcs(layoutInstructions);var slices=layoutInstructions.slices[this.getSelectedPathIndex(arcPaths)];this.totalText=slices?slices.category:"";this.renderPieTitle(this.totalText,block);this.renderPieAmount(slices?slices.label:"")},renderPieTitle:function(totalText,block){var wrapLabelTextBind=Personetics.bind(this,this.wrapLabelText);var labelTextwidth=120;this.svg.append('text').attr('class','perso-total-txt').attr('dy','1.66em').call(wrapLabelTextBind,120)},renderPieAmount:function(totalAmount){var text=this.svg.append('text').attr('class','perso-total-amount').attr('dy','-.3em');var tspan=text.append('tspan');var attrs=$(totalAmount)[0]?$(totalAmount)[0].attributes:[];$.each(attrs,function(j,attr){tspan.attr(attr.name,attr.value)});var totalAmountChildren=$(totalAmount).children();$.each(totalAmountChildren,function(i,node){var innerTspan=tspan.append('tspan').text($(node).text());var attrs=node.attributes;$.each(attrs,function(j,attr){innerTspan.attr(attr.name,attr.value)})})},wrapLabelText:function(text,width){var block=this;var totalAmount=block.frameEl.find('.perso-total-amount');var totalText=block.frameEl.find('.perso-total-txt');text.each(function(){var text=d3.select(this),words=block.totalText.split(/\s+/).reverse(),word,line=[],lineNumber=0,lineHeight=-0.15,y=text.attr("y"),dy=parseFloat(text.attr("dy")),tspan=text.text(null).append("tspan").attr("x",0).attr("y",y).attr("dy",dy+"em");while(word=words.pop()){line.push(word);tspan.text(line.join(" "));if(tspan.node().getComputedTextLength()>width){line.pop();tspan.text(line.join(" "));line=[word];tspan=text.append("tspan").attr("x",0).attr("y",y).attr("dy",++lineNumber*lineHeight+dy+"em").text(word)}
if(lineNumber==1){$(totalAmount).css("transform","translateY(-0.269em)");$(totalText).css("transform","translateY(-0.58em)")}}})}})})(window,window.Personetics=window.Personetics||{},jQuery);(function(window,Personetics,$,undefined){Personetics.story=Personetics.story||{};Personetics.story.BlockChartFactory=new function(){this.chartHelperFactoryMap={};this.registerChartHelper=function(type,config){if(config.hasOwnProperty('helperClass')){if(config.helperClass){var entry=this.chartHelperFactoryMap[type];if(!entry){entry={type:type,class:{},widthModes:{}};this.chartHelperFactoryMap[type]=entry}
if(config.class){entry.class[config.class]=config.helperClass}
else if(config.widthMode){entry.widthModes[config.widthMode]=config.helperClass}
else{entry.helperClass=config.helperClass}}}
else{this.chartHelperFactoryMap[type]=config}};this.generateHelperClazz=function(name,config){var generatedChartHelper=null;if(typeof(name)!=="undefined"&&name!=null&&this.chartHelperFactoryMap.hasOwnProperty(name)){var chartHelperClass=this.chartHelperFactoryMap[name].helperClass;if(config.hasOwnProperty("widthMode")&&typeof config.widthMode!=='undefined'&&config.widthMode!==null&&config.widthMode.length>0&&this.chartHelperFactoryMap[name].widthModes[config.widthMode]!=undefined){var chartHelperClass=this.chartHelperFactoryMap[name].widthModes[config.widthMode]}
generatedChartHelper=new chartHelperClass()}else{Personetics.log('The helper'+name+'is not valid')}
return generatedChartHelper}}})(window,window.Personetics=window.Personetics||{},jQuery);(function(window,Personetics,$,undefined){var d3=Personetics.persoD3||window.d3;Personetics.utils=Personetics.utils?Personetics.utils:{};Personetics.utils.d3Helpers=Personetics.utils.d3Helpers?Personetics.utils.d3Helpers:{};Personetics.utils.d3Helpers.BlockHelperBase=Base.extend({prepareChart:function(data,options){this.options=options;this.width=this.getValueByScreenWidth(this.options.svgWidth)},renderSVGBase:function(el,clazz){var helper=this;if(!clazz){clazz=''}
return(d3.select(el.get(0)).append("svg").attr("class","perso-svg-chart-container "+clazz).attr("width",helper.width).attr("height",helper.getValueByScreenWidth(helper.options.svgHeight)).append("g").attr("transform","translate(0,0)"))},renderLabels:function(){var helper=this;if(this.options.labels.drawLabels){this.svg.append("g").selectAll().data(helper.seriesData).enter().append("text").attr("class","perso-label").attr("class",function(d){var clazz='perso-label';if(d.selected){clazz+=" selected"}
return clazz}).attr("text-anchor","middle").attr("x",function(d,i){return helper.xScale(helper.categoriesData[i])+helper.xScale.rangeBand()/2}).attr("y",function(d){var margin=(this.options.labels.marginBottom>0)?this.options.labels.marginBottom:0;return helper.yScale(d.value)-margin}).html(function(d){return d.label})}},renderXAxis:function(){var helper=this;if(this.xAxis){this.svg.append("g").attr("class","x axis").attr("transform",function(d,i){var x=0;var y=0;if(helper.options.axis.translation.x){x=helper.options.axis.translation.x}
if(helper.options.axis.translation.y=="height"){y+=(helper.height+helper.margin.bottom)}
return("translate("+x+","+y+")")}).call(helper.xAxis)}},wrapLabelText:function(text){text.each(function(){var text=d3.select(this),words=[],word,lineNumber=0,lineHeight=0.8,y=text.attr("y"),dy=parseFloat(text.attr("dy"));if(text.text().match(/\d+/g)!=null)
words[0]=text.text().match(/\d+/g)[0];if(text.text().match(/[a-zA-Z]+/)!=null)
words[1]=text.text().match(/[a-zA-Z]+/)[0];text.text(null);while(word=words.pop()){tspan=text.append("tspan").attr("x",0).attr("y",y).attr("dy",(lineNumber*lineHeight*1.5+dy)+"em");tspan.text(word);lineNumber++}})},renderYAxis:function(isNegative){var helper=this;if(this.options.yAxisLineDisplay){this.svg.append("g").attr("class","y axis perso-grid").attr("transform",function(d,i){var y=typeof helper.options.yAxisTop!='undefined'?helper.options.yAxisTop:0;if(typeof isNegative==='boolean'&&isNegative){y=helper.negativeYAxisTop}
var x=typeof helper.options.horizontalLineLeft!='undefined'?helper.options.horizontalLineLeft:0;return("translate("+helper.getValueByScreenWidth(x)+","+helper.getValueByScreenWidth(y)+")")}).call(helper.yAxis).selectAll(".tick line").attr('x2',function(d,i){var x2=typeof helper.options.horizontalLineWidth!='undefined'?helper.options.horizontalLineWidth:(helper.options.svgWidth||0);return helper.getValueByScreenWidth(x2)})}
if(!this.options.yAxisTextDisplay){this.svg.selectAll(".y.perso-grid .tick text").remove();this.svg.selectAll(".y.perso-grid path").remove()}},renderHorizontalLines:function(y0Scale){var helper=this;var lines=this.svg.append("g").attr("transform","translate("+helper.margin.left*-1+","+0+")").selectAll("g").data(helper.seriesData).enter().append("g").attr("class","perso-chart-line").attr("transform",function(d,i){var y=y1Scale(i)*(i+1);return"translate(0,"+y+")"}).selectAll('.line').data(function(d){return d}).enter().append("line").attr("class","perso-chart-line").attr("x1","0").attr("x2",helper.width).attr("y1",function(d,i){return y0Scale(i)+helper.options.rectangles.paddingBottom}).attr("y2",function(d,i){return y0Scale(i)+helper.options.rectangles.paddingBottom})},renderVerticalLines:function(x0Scale){var helper=this;if(helper.options.drowVerticalLines){var lineMarginLeft=helper.options.lineMarginLeft?helper.options.lineMarginLeft:-30;var lines=this.svg.append("g").attr("transform","translate("+helper.getValueByScreenWidth(lineMarginLeft)+","+helper.getValueByScreenWidth(helper.options.verticalLineTop)+")").selectAll("g").data(helper.seriesData).enter().append("g").attr("class","perso-chart-line").attr("transform",function(d,i){return"translate(0,0)"}).selectAll('.line').data(function(d){return d}).enter().append("line").attr("class","perso-chart-line").attr("y1","0").attr("y2",helper.getValueByScreenWidth(helper.options.lineHeight)).attr("x1",function(d,i){return x0Scale(i)+helper.getValueByScreenWidth(helper.options.rectangles.paddingBottom)}).attr("x2",function(d,i){return x0Scale(i)+helper.getValueByScreenWidth(helper.options.rectangles.paddingBottom)})}},renderGradient:function(){var gradients=this.options.rectangles.gradients;var defWithGradients=this.svg.append("defs");if(gradients){$.each(gradients,function(i,gradient){if(gradient){defWithGradients=defWithGradients.append("linearGradient").attr("id",gradient.id).attr("x1","0").attr("x2","0").attr("y1","0").attr("y2","1");$.each(gradient.stopColors,function(i,stopColor){defWithGradients.append("stop").attr("offset",gradient.offset[i]).attr("stop-color",stopColor)})}})}},renderFilter:function(){var filters=this.options.rectangles.filter;var svgWithFilters=this.svg.selectAll("defs");if(filters){$.each(filters,function(i,filter){if(filter){var filterSvg=svgWithFilters.append("filter").attr("id",filter.id)
filterSvg.append("feGaussianBlur").attr("in",filter.in).attr("stdDeviation",filter.stdDeviation)
filterSvg.append("feOffset").attr("dx",filter.dxOffset).attr("dy",filter.dyOffset)
var feMerge=filterSvg.append("feMerge")
feMerge.append("feMergeNode")
feMerge.append("feMergeNode").attr("in",filter.in)}})}},getValueByScreenWidth:function(value){var screenWidth=$(window).width();if(screenWidth>=this.options.desktopScreenWidth){return value}
else{if(screenWidth<347){return value}else if(screenWidth>=414){return value*this.options.screen.ratio_large}else{return value*this.options.screen.ratio_medium}}}})})(window,window.Personetics=window.Personetics||{},jQuery);(function(window,Personetics,$,undefined){var d3=Personetics.persoD3||window.d3;Personetics.utils=Personetics.utils?Personetics.utils:{};Personetics.utils.d3Helpers=Personetics.utils.d3Helpers?Personetics.utils.d3Helpers:{};Personetics.utils.d3Helpers.MultiVerticalChartHelper=Personetics.utils.d3Helpers.BlockHelperBase.extend({MIN_BAR_HEIGHT:20,prepareChart:function(data,options,handleClick){Personetics.utils.d3Helpers.BlockHelperBase.prototype.prepareChart.call(this,data,options);var helper=this;this.handleClick=handleClick;this.seriesData=data.series;this.categoriesData=data.categories;this.seriesLabelsData=data.seriesLabels;this.series=data.series;this.width=this.getValueByScreenWidth(this.options.svgWidth);this.yScale=d3.scale.linear().range([(this.getValueByScreenWidth(this.options.maxBarHeight)-this.MIN_BAR_HEIGHT),0],.1);this.yAxisScale=d3.scale.linear().range([this.getValueByScreenWidth(this.options.yAxisHeight),0]);this.colorScale=d3.scale.ordinal().rangeRoundBands([0,this.width],.1);this.colors=this.colorScale.range(helper.options.palette);this.colorsLabels=d3.scale.ordinal().rangeRoundBands([0,this.width],.1).range(helper.options.paletteLabels);this.dispatch=d3.dispatch("clickOnMonth");var dataLength=0;this.seriesData.map(function(a){dataLength+=a.length;return a});this.dataLength=dataLength;this.xScale=d3.scale.ordinal().domain(helper.categoriesData).rangeBands([0,this.width]);this.x0Scale=d3.scale.ordinal().domain(d3.range(helper.categoriesData.length)).rangeBands([0,this.width],0);this.xAxis=d3.svg.axis().scale(this.xScale).outerTickSize(0)},renderChart:function(el){var helper=this;this.yScale.domain([0,d3.max(helper.seriesData,function(d){return d3.max(d,function(k){return k.value})})]);this.modifyData();this.svg=this.renderSVGBase(el,"multiVertical");this.renderGradient();this.renderFilter();this.renderMultiVerticalBars();this.renderHiddenRects(this.seriesData);this.renderLabels();this.renderXAxis();this.renderVerticalLines(this.x0Scale)},renderMultiVerticalBars:function(){var helper=this;var mergedData=[].concat.apply([],this.seriesData);this.minValue=d3.min(mergedData,function(d){return d.value||Infinity});this.maxValue=d3.max(mergedData,function(d){return d.value});helper.sortedData=helper.sortData();var blockWithBars=this.svg.append("g").attr("transform",function(data,i){var marginLeft=helper.options.rectangles.marginLeft?helper.options.rectangles.marginLeft:0;return"translate("+marginLeft+","+helper.getValueByScreenWidth(helper.options.barTop)+")"}).selectAll("g").data(helper.sortedData).enter().append("g").style("fill",function(d,i){return helper.colors(i)}).attr("transform",function(d,i){return"translate("+helper.getSeriesTranslateValue(i)+",0)"}).selectAll("rect").data(function(d){return d});blockWithBars.enter().append("rect").attr("class",function(d){var clazz='perso-chart-rect'+' '+d.mode;if(d.selected){clazz+=" selected"}
return clazz}).attr("y",this.getValueByScreenWidth(this.options.maxBarHeight)).attr("height",0).attr("x",function(d,i){return helper.xScale(helper.categoriesData[i])+(helper.width/helper.dataLength)-15}).attr("width",function(d,i){var rectWidth=helper.getValueByScreenWidth(helper.options.rectangles.width);return rectWidth}).attr("rx",function(d){var rx=(helper.options.rectangles.borderRadius.rx)?helper.options.rectangles.borderRadius.rx:"0";return helper.getValueByScreenWidth(rx)}).attr("ry",function(d){var ry=(helper.options.rectangles.borderRadius.ry)?helper.options.rectangles.borderRadius.ry:"0";return helper.getValueByScreenWidth(ry)}).on("click",function(obj,clickedItemIndex){if(typeof helper.handleClick=='function'){helper.handleClick(obj,clickedItemIndex)}});this.MultiVerticalBarsTransition(blockWithBars)},MultiVerticalBarsTransition:function(blockWithBars){var helper=this;blockWithBars.transition().duration(helper.options.rectangles.transition.duration).delay(helper.options.rectangles.transition.delay).attr("y",function(d){return helper.getBarsY(d)}).attr("height",function(d){return helper.getBarsHeight(d)})},getBarsHeight:function(d){var helper=this;var currentValue=Math.abs(d.value);var barHeight=d.value?helper.getValueByScreenWidth(this.options.maxBarHeight)-this.yScale(currentValue):0;d.barHeight=barHeight;return barHeight},getBarsY:function(d){var yValue;if(d.value<0){yValue=this.getValueByScreenWidth(this.options.maxBarHeight)}else{yValue=this.yScale(d.value)}
return yValue},renderLabels:function renderLabels(){var helper=this;helper.sortedData=helper.sortData();if(this.options.labels.drawLabels){var cssClass='perso-label perso-label-fadeIn';if(this.categoriesData.length>=4){cssClass+=" minimize-font"}
var blockWithBars=this.svg.append("g").attr("transform",function(d,i){var transX=helper.width*.14;var transValue=helper.getValueByScreenWidth(helper.options.labelTop);return"translate("+0+","+transValue+")"}).selectAll("g").data(helper.sortedData).enter().append("g").style("fill",function(d,i){return helper.colorsLabels(i)}).attr("transform",function(d,i){var transValue=helper.getValueByScreenWidth(helper.options.nextLabelTop)*(!i);return"translate("+helper.getValueByScreenWidth(helper.options.labels.right)+","+transValue+")"}).selectAll("text").data(function(d){return d});blockWithBars.enter().append("text").attr("text-anchor","middle").attr("class",function(d){var clazz=cssClass+' '+d.mode;if(d.selected){clazz+=" selected"}
return clazz}).attr("x",function(d,i){return helper.xScale(helper.categoriesData[i])+(helper.width/helper.dataLength)}).attr("y",function(d,i,j){var maxBarHeightInMonth=helper.getMaxBarHeightInMonth(helper.categoriesData[i]);var yValue=helper.yScale(0)-maxBarHeightInMonth;return(yValue)}).attr("dy","0.4em");$.each(helper.seriesLabelsData,function(modeIndex,mode){var amounts=helper.svg.selectAll('.perso-label.'+mode);var tspans=amounts.append('tspan');$.each(tspans[0],function(index,tspan){var attrs=$(helper.seriesData[modeIndex][index].label)[0].attributes;$.each(attrs,function(j,attr){tspan.setAttribute(attr.name,attr.value)});$(tspan).attr("perso-index",index);var totalAmountChildren=$($(helper.seriesData[modeIndex][index].label)[0]).children();$.each(totalAmountChildren,function(i,node){var svgTspan=helper.svg.select('[perso-index="'+index+'"]');var innerTspan=svgTspan.append('tspan').text($(node).text());var attrs=node.attributes;$.each(attrs,function(j,attr){innerTspan.attr(attr.name,attr.value)})})})})}},renderXAxis:function(){var helper=this;if(this.xAxis){var axisTick=this.svg.append("g").attr("class","x axis").attr("transform",function(d,i){var x=0;var y=0;if(helper.options.axis.translation.x){x=helper.options.axis.translation.x}
y=helper.getValueByScreenWidth(helper.options.xAxiaTop);return("translate("+x+","+y+")")}).call(helper.xAxis).selectAll(".tick text").attr("y","0").data(this.seriesData[0]).attr("class",function(d,i){var clazz="perso-xAxis-label";if(d.selected){clazz+=" selected"}
if(helper.seriesData[1][i].value===0&&helper.seriesData[0][i].value===0&&helper.seriesData[1][i].category===d.category&&helper.seriesData[0][i].category===d.category){clazz+=" perso-unclickable"}
return clazz}).on("click",function(obj,clickedItemIndex){if((helper.seriesData[1][clickedItemIndex].value!==0||helper.seriesData[0][clickedItemIndex].value!==0)&&helper.seriesData[1][clickedItemIndex].category===obj.category&&helper.seriesData[0][clickedItemIndex].category===obj.category){if(typeof helper.handleClick=='function'){helper.handleClick(obj,clickedItemIndex)}}})}},renderHiddenRects:function(seriesData){var helper=this;var hiddenRectWidth=helper.getValueByScreenWidth(helper.options.rectangles.width*2+helper.options.rectangles.paddingRight);var hiddenRectHeight=helper.getValueByScreenWidth(helper.options.maxBarHeight);helper.seriesData=seriesData;var hiddenRects=this.svg.append('g').attr('class','perso-hidden-rects').attr("transform",function(data,i){var marginLeft=helper.options.rectangles.marginLeft?helper.options.rectangles.marginLeft:0;return"translate("+marginLeft+","+helper.getValueByScreenWidth(helper.options.barTop)+")"}).selectAll("g").data(this.seriesData[0]);hiddenRects.enter().append('rect').attr("class",function(d,i){var clazz='hidden-rect';if(helper.seriesData[1][i].value===0&&helper.seriesData[0][i].value===0&&helper.seriesData[1][i].category===d.category&&helper.seriesData[0][i].category===d.category){clazz+=" perso-unclickable"}
return clazz}).attr("height",function(d,i){return hiddenRectHeight}).attr('width',hiddenRectWidth).attr("x",function(d,i){return helper.xScale(helper.categoriesData[i])+(helper.width/helper.dataLength)-15}).attr('fill-opacity',0).on("click",function(obj,clickedItemIndex){if((helper.seriesData[1][clickedItemIndex].value!==0||helper.seriesData[0][clickedItemIndex].value!==0)&&helper.seriesData[1][clickedItemIndex].category===obj.category&&helper.seriesData[0][clickedItemIndex].category===obj.category){if(typeof helper.handleClick=='function'){helper.handleClick(obj,clickedItemIndex)}}})},getMaxBarHeightInMonth:function(category){var helper=this;var maxValue=0;if(this.series&&this.series.length>0){$.each(helper.seriesData,function(i,series){$.each(series,function(j,item){if(helper.categoriesData[j]==category&&Math.abs(item.barHeight)>maxValue){maxValue=Math.abs(item.barHeight)}})})}
return maxValue},sortData:function(){var helper=this;if(this.seriesData){var reversedLabels=this.seriesLabelsData.slice().reverse();var sortedData=[];reversedLabels.forEach(function(series,i){sortedData[reversedLabels.indexOf(helper.seriesLabelsData[i])]=helper.seriesData[i]})}
return sortedData},modifyData:function(){var helper=this;if(this.seriesData){var series=this.seriesLabelsData;$.each(series,function(i){$.each(helper.seriesData[i],function(k,seriesObj){seriesObj.mode=series[i]})})}},getSeriesTranslateValue:function(index){var paddingRight=this.options.rectangles.paddingRight?this.options.rectangles.paddingRight:0;return this.getValueByScreenWidth(paddingRight)*index}})})(window,window.Personetics=window.Personetics||{},jQuery);(function(window,Personetics,$,undefined){var d3=Personetics.persoD3||window.d3;Personetics.utils=Personetics.utils?Personetics.utils:{};Personetics.utils.d3Helpers=Personetics.utils.d3Helpers?Personetics.utils.d3Helpers:{};Personetics.utils.d3Helpers.VerticalChartHelper=Personetics.utils.d3Helpers.BlockHelperBase.extend({MIN_BAR_HEIGHT:20,prepareChart:function(data,options,handleClick){Personetics.utils.d3Helpers.BlockHelperBase.prototype.prepareChart.call(this,data,options);var helper=this;this.handleClick=handleClick;this.seriesData=data.series;this.categoriesData=data.categories;this.width=this.getValueByScreenWidth(this.options.svgWidth);this.negativeBarTop=this.options.negativeBarTop||this.options.svgHeight;this.negativeYAxisTop=this.options.negativeYAxisTop||this.options.svgHeight;var rect=this.options.rectangles;var maxCategories=(this.width+this.getValueByScreenWidth(rect.space))/this.getValueByScreenWidth(rect.width+rect.space);this.numOfBars=this.categoriesData.length>maxCategories?Math.floor(maxCategories):this.categoriesData.length;this.calcLeft=(this.width-(this.numOfBars+1)*this.getValueByScreenWidth(rect.width+rect.space))/2;var accessCat=this.accessibilityCategories;if(Personetics.processor.PStoryConfig.isRtl()){var slice=this.categoriesData.length-(this.categoriesData.length-this.numOfBars);this.categoriesData=this.categoriesData.slice(0,slice);this.seriesData=this.seriesData.slice(0,slice)}
else{this.categoriesData=this.categoriesData.slice(this.categoriesData.length-this.numOfBars,this.categoriesData.length);this.seriesData=this.seriesData.slice(this.categoriesData.length-this.numOfBars,this.categoriesData.length)}
this.xScale=d3.scale.ordinal().rangeRoundBands([0,(this.numOfBars+1)*this.getValueByScreenWidth(rect.width+rect.space)],1);this.yScale=d3.scale.linear().range([(this.getValueByScreenWidth(this.options.maxBarHeight)-this.MIN_BAR_HEIGHT),0]);this.xAxis=d3.svg.axis().scale(this.xScale).outerTickSize(0)
this.yAxisScale=d3.scale.linear().range([this.getValueByScreenWidth(this.options.yAxisHeight),0]);this.yAxis=d3.svg.axis().scale(this.yAxisScale).orient("left").innerTickSize(-this.width).outerTickSize(0).ticks(5)},renderChart:function(el){var helper=this;var cfg=this.config;this.minVal=0;this.maxVal=d3.max(helper.seriesData,function(d){return Math.abs(parseFloat(d.value))});this.xScale.domain(helper.categoriesData.map(function(d){return d}));this.yScale.domain([this.minVal,this.maxVal]);this.hasMinVals=!1;this.seriesMinVal=d3.min(helper.seriesData,function(d){return parseFloat(d.value)});if(this.seriesMinVal<0){this.hasMinVals=!0;this.maxPositiveVal=d3.max(helper.seriesData,function(d){return parseFloat(d.value)});this.maxNegativeBarHeight=this.options.maxBarHeight-this.yScale(Math.abs(this.seriesMinVal));this.maxPositiveBarHeight=this.options.maxBarHeight-this.yScale(this.maxPositiveVal)}
this.svg=this.renderSVGBase(el);this.renderGradient();this.renderFilter();this.renderYAxis();if(this.hasMinVals)
this.renderYAxis(!0);if(this.options.hasOwnProperty('isDesktop')&&this.options.isDesktop){this.renderAccessibilityHiddenRects()}
this.renderVerticalBars();this.renderLabels();this.renderXAxis()},renderSVGBase:function(el){var helper=this;var height=helper.getValueByScreenWidth(helper.options.svgHeight);var y=0;if(helper.hasMinVals){height=height+helper.getValueByScreenWidth(this.maxNegativeBarHeight+this.options.barTop);y=helper.getValueByScreenWidth(helper.maxPositiveBarHeight-helper.options.maxBarHeight)}
return(d3.select(el.get(0)).append("svg").attr("class","perso-svg-chart-container").attr("width",helper.width).attr("height",height+y).append("g").attr('class','perso-svg-container-group').attr("transform",function(){return"translate(0,"+y+")"}))},renderVerticalBars:function(){var helper=this;helper.minAbsValue=d3.min(helper.seriesData,function(d){return Math.abs(d.value)||Infinity});helper.maxValue=helper.maxVal;helper.minValue=helper.minVal;var rectSpace=helper.getValueByScreenWidth(helper.options.rectangles.space||30);var rectWidth=helper.getValueByScreenWidth(helper.options.rectangles.width);var left=(helper.width-(helper.numOfBars*rectWidth+(helper.numOfBars-1)*rectSpace))/2;var bars=this.svg.append("g").attr("transform",function(){return("translate("+left+","+helper.getValueByScreenWidth(helper.options.barTop)+")")}).selectAll("rect").data(helper.seriesData).enter().append("rect").attr("class",function(d){var clazz="perso-bar";if(d.selected){clazz+=" selected"}
return clazz}).attr("x",function(d,i){return i*(rectSpace+rectWidth)}).attr("width",function(d,i){return rectWidth}).attr("y",function(d,i){if(d.value<0)
return helper.getValueByScreenWidth(helper.negativeBarTop-helper.options.barTop);return helper.getValueByScreenWidth(helper.options.maxBarHeight)}).attr("height",0).attr("rx",function(d){var rx=(helper.options.rectangles.borderRadius.rx)?helper.options.rectangles.borderRadius.rx:"0";return helper.getValueByScreenWidth(rx)}).attr("ry",function(d){var ry=(helper.options.rectangles.borderRadius.ry)?helper.options.rectangles.borderRadius.ry:"0";return helper.getValueByScreenWidth(ry)}).on("click",function(obj,clickedItemIndex){if(typeof helper.handleClick=='function'){helper.handleClick(obj,clickedItemIndex)}})
this.barsTransition(bars)},barsTransition:function(bars){var helper=this;bars.transition().duration(helper.options.rectangles.transition.duration).delay(helper.options.rectangles.transition.delay).attr("y",function(d){return helper.getBarsY(d)}).attr("height",function(d){return helper.getBarsHeight(d)})},getBarsHeight:function(d){var currentValue=Math.abs(d.value);var barHeight=d.value?this.getValueByScreenWidth(this.options.maxBarHeight)-this.yScale(currentValue):0;d.barHeight=barHeight;return barHeight},getBarsY:function(d){var yValue;if(d.value<0){yValue=this.getValueByScreenWidth(this.negativeBarTop-this.options.barTop)}else{yValue=this.yScale(d.value)}
return yValue},renderLabels:function(){var cssClass="perso-label perso-label-fadeIn";var helper=this;if(helper.seriesData.length>=6){cssClass+=" minimize-font"}
if(this.options.labels.drawLabels){this.svg.append("g").attr("transform",function(){var y=helper.options.labelTop?helper.getValueByScreenWidth(helper.options.labelTop):0;return("translate("+helper.calcLeft+","+y+")")}).selectAll().data(helper.seriesData).enter().append("text").attr("class",function(d){var clazz=cssClass;if(d.selected){clazz+=" selected"}
return clazz}).attr("text-anchor","middle").attr("x",function(d,i){return(helper.xScale(helper.categoriesData[i]))}).attr("y",function(d){return helper.getLabelsY(d)}).attr("dy",function(d){if(d.value<0)
return"1em";return 0});var amounts=this.svg.selectAll('.perso-label');var tspans=amounts.append('tspan');$.each(tspans[0],function(index,tspan){var attrs=$(helper.seriesData[index].label)[0].attributes;$.each(attrs,function(j,attr){tspan.setAttribute(attr.name,attr.value)});$(tspan).attr("perso-index",index);var totalAmountChildren=$($(helper.seriesData[index].label)[0]).children();$.each(totalAmountChildren,function(i,node){var svgTspan=helper.svg.select('[perso-index="'+index+'"]');var innerTspan=svgTspan.append('tspan').text($(node).text());var attrs=node.attributes;$.each(attrs,function(j,attr){innerTspan.attr(attr.name,attr.value)})})})}},getLabelsY:function(d){var helper=this;var y;if(d.value<0){y=helper.getValueByScreenWidth(this.options.barTop-this.options.labelTop+this.negativeBarTop-this.options.labelTop)+d.barHeight}
else y=this.yScale(0)-d.barHeight+this.MIN_BAR_HEIGHT;return y},renderXAxis:function(){var helper=this;if(this.xAxis){this.svg.append("g").attr("class","x axis").attr("transform",function(d,i){return("translate("+helper.calcLeft+","+helper.getValueByScreenWidth(helper.options.xAxisTop)+")")}).call(helper.xAxis).selectAll(".tick text").data(helper.seriesData).attr("y","0").attr("class",function(d,i){var clazz="perso-xAxis-label";if(d.selected){clazz+=" selected"}
if(d.value===0){clazz+=" perso-unclickable"}
return clazz})}},renderAccessibilityHiddenRects:function(){var helper=this;var hiddenRectWidth=helper.getValueByScreenWidth((helper.options.rectangles.width*3)+(helper.options.rectangles.paddingRight||0));var hiddenRectHeight=helper.getValueByScreenWidth(helper.options.svgHeight-(helper.options.labelTop||0));var rectSpace=helper.getValueByScreenWidth(helper.options.rectangles.space||30);var rectWidth=helper.getValueByScreenWidth(helper.options.rectangles.width);var left=(helper.width-(helper.numOfBars*rectWidth+(helper.numOfBars-1)*rectSpace))/2;var reversedData=this.seriesData.slice().reverse();var hiddenRects=this.svg.append('g').attr('class','perso-hidden-rects').attr("transform",function(data,i){var marginLeft=helper.options.rectangles.marginLeft?helper.options.rectangles.marginLeft:0;return"translate("+left+","+helper.getValueByScreenWidth(helper.options.barTop-helper.options.yAxisTop)+")"}).selectAll("g").data(reversedData);hiddenRects.enter().append('rect').attr("class",function(d){var clazz='access-hidden-rect';if(d.value===0){clazz+=" perso-unclickable"}
return clazz}).attr("height",function(d,i){return hiddenRectHeight}).attr('width',hiddenRectWidth).attr("x",function(d,i){var lastItemIndex=helper.seriesData.length-1;return((lastItemIndex-i)*(rectSpace+rectWidth)-hiddenRectWidth/3)}).attr('fill-opacity',0)}})})(window,window.Personetics=window.Personetics||{},jQuery);(function(window,Personetics,$,undefined){var d3=Personetics.persoD3||window.d3;Personetics.utils=Personetics.utils?Personetics.utils:{};Personetics.utils.d3Helpers=Personetics.utils.d3Helpers?Personetics.utils.d3Helpers:{};Personetics.utils.d3Helpers.MultiHorizontalChartHelper=Base.extend({localConfigs:{barFillPercent:0.55},prepareMultiHorizontalChart:function(block,el){this.prepareChart(block,el);this.maxDataArraLength=this.getMaxDataArray(block.layoutInstructions.series);this.height=block.options.chartHeight||(this.maxDataArraLength*block.layoutInstructions.series.length*(this.getValueByScreenWidth(block.options.rectangles.height)+this.getValueByScreenWidth(this.options.rectangles.paddingBottom)*2)+block.layoutInstructions.seriesLabels.length*this.options.rectangles.seriesPadding/2);this.localConfigs.barFillPercent=this.options.rectangles.barFillPercent?this.options.rectangles.barFillPercent:this.localConfigs.barFillPercent;this.xScale=d3.scale.linear().range([0,this.width*this.localConfigs.barFillPercent]);this.colorScale=d3.scale.ordinal().rangeRoundBands([0,this.width],.1);var palette=block.defaultConfig.barGraphPalette;var paletteLabels=block.defaultConfig.barGraphLabelsPalette;this.colors=this.colorScale.range(palette);this.colorsLabels=d3.scale.ordinal().rangeRoundBands([0,this.width],.1).range(paletteLabels);this.y0Scale=d3.scale.ordinal().domain(d3.range(block.layoutInstructions.categories.length)).rangeBands([this.height,0],0.05);this.y1Scale=d3.scale.ordinal().domain(d3.range(block.layoutInstructions.series.length)).rangeBands([this.y0Scale.rangeBand(),0],0.05);this.y2Scale=d3.scale.ordinal().domain(block.layoutInstructions.categories).rangeBands([0,this.height]);this.xAxis=d3.svg.axis().scale(this.xScale).orient("bottom");this.yAxis=d3.svg.axis().scale(this.y2Scale).orient("right")},renderMultiHorizontalChart:function(block,el,data){var cfg=block.config;var xScale=this.xScale;var y0Scale=this.y0Scale;var y1Scale=this.y1Scale;var y2Scale=this.y2Scale;xScale.domain([0,d3.max(data.series,function(d){return d3.max(d,function(k){return k.value})})]);this.svg=this.renderSVGBase(el,"multiHorizontal");this.renderGradient();this.renderFilter();this.renderMultiHorizontalBars(block,data,xScale,y1Scale,y0Scale);this.renderHorizontalLines(data,xScale,y0Scale,y1Scale);this.renderLabels(data,xScale,y0Scale,y1Scale);this.renderYAxis()},renderSVGBase:function(el,clazz){var helper=this;if(!clazz){clazz=''}
return(d3.select(el.get(0)).append("svg").attr("focusable",!1).attr("class","perso-svg-chart-container "+clazz).attr("width",helper.width).attr("height",helper.height).append("g").attr("transform","translate("+helper.getValueByScreenWidth(helper.margin.left)+","+helper.getValueByScreenWidth(helper.margin.top)+")"))},renderMultiHorizontalBars:function(block,data,xScale,y1Scale,y0Scale){var inOut=["Out","In"];var helper=this
var mergedData=[].concat.apply([],data.series);helper.minValue=d3.min(mergedData,function(d){return d.value||Infinity});helper.maxValue=d3.max(mergedData,function(d){return d.value});var blockWithBars=this.svg.append("g").attr("transform",function(d,i){var yValue=helper.getValueByScreenWidth(helper.options.rectangles.paddingTop);var xValue=helper.getValueByScreenWidth(helper.options.rectangles.paddingLeft);return"translate("+xValue+","+yValue+")"}).attr("width",helper.width).selectAll("g").data(data.series).enter().append("g").style("fill",function(d,i){return helper.colors(i)}).attr("class",function(d,i){return inOut[i]}).attr("transform",function(d,i){var screenWidth=screen.width;var y=helper.options.rectangles.paddingBottom;y=y1Scale(i)*(i+1)+helper.getValueByScreenWidth(y)*(i+1);return"translate(0,"+y+")"}).selectAll("rect").data(function(d){return d});blockWithBars.enter().append("rect").attr("class",function(d){var clazz='perso-chart-rect';if(d.selected){clazz+=" selected"}
return clazz}).attr("height",function(d,i){var rectHeight=helper.options.rectangles.height;return helper.getValueByScreenWidth(rectHeight)}).attr("y",function(d,i){return y0Scale(i)}).attr("width",1).attr("rx",function(d){var rx=(helper.options.rectangles.borderRadius.rx)?helper.options.rectangles.borderRadius.rx:"0";return helper.getValueByScreenWidth(rx)}).attr("ry",function(d){var ry=(helper.options.rectangles.borderRadius.ry)?helper.options.rectangles.borderRadius.ry:"0";return helper.getValueByScreenWidth(ry)}).on("click",function(obj,clickedItemIndex){if(block)
block.handleClick(obj,clickedItemIndex)});blockWithBars.transition().duration(1000).delay(500).attr("width",function(d){var maxBarWidth=helper.width*0.4;var minBarWidth=maxBarWidth*.166;var minValueInArray=helper.minValue;var maxValueInData=helper.maxValue
var currentValue=d.value;var currentBarWidth=xScale(currentValue);var rectWidth=minBarWidth;if((currentValue/maxValueInData)>0.166||currentValue>minValueInArray){rectWidth+=currentBarWidth}else if(currentValue==0){rectWidth=currentBarWidth}
return rectWidth})},renderLabels:function(data,xScale,y0Scale,y1Scale){var helper=this;if(this.options.drawLabels){var blockWithdata=this.svg.append("g").attr("transform",function(d,i){var yValue=helper.getValueByScreenWidth(helper.options.rectangles.paddingTop);var xValue=helper.getValueByScreenWidth(helper.options.rectangles.paddingLeft);return"translate("+xValue+","+yValue+")"}).attr("width",helper.width).selectAll("g").data(data.series).enter().append("g").attr("transform",function(d,i){var y=helper.options.rectangles.paddingBottom;y=y1Scale(i)*(i+1)+helper.getValueByScreenWidth(y)*(i+1);return"translate(-7,"+y+")"}).selectAll("text").data(function(d){return d});blockWithdata.enter().append("text").attr("class",function(d){var clazz='perso-label perso-label-fadeIn';if(d.selected){clazz+=" selected"}
return clazz}).attr("text-anchor","start").style("fill",function(d,i,j){return helper.colorsLabels(j)}).attr("x",function(d){var paddingLeft=(helper.options.labels.paddingLeft)?helper.options.labels.paddingLeft:"0";var xValue=xScale(d.value)+helper.getValueByScreenWidth(paddingLeft);return xValue}).attr("y",function(d,i){return y0Scale(i)+helper.options.rectangles.height/2}).attr("dy","0.4em").html(function(d){return d.label})}},renderYAxis:function(){var helper=this;if(this.yAxis){var transValue=helper.getValueByScreenWidth(this.options.axis.yAxis.transValue);this.svg.append("g").attr("transform","translate("+helper.options.axis.yAxis.paddingRight*-1+","+transValue+")").attr("class","y axis").call(helper.yAxis).selectAll(".tick text").call(helper.wrapLabelText,screen.width*.23)}
if(this.options.axis.yAxis.hide){this.svg.selectAll(".y .tick text").remove();this.svg.selectAll(".y path").remove()}},getMaxDataArray:function(data){var maxLength=0;if(data.length){$.each(data,function(i,array){if(array.length>maxLength){maxLength=array.length}})}
return maxLength},wrapLabelText:function(text,width){text.each(function(){var text=d3.select(this);var yValue=0;var lines=1;if(this.getComputedTextLength()>width){lines=2;yValue=-5}
var words=text.text().split(/\s+/).reverse(),word,line=[],lineNumber=0,lineHeight=.95,y=text.attr("y"),dy=parseFloat(text.attr("dy")),tspan=text.text(null).append("tspan").attr("x",9).attr("y",yValue*lines).attr("dy",dy+"em");while(word=words.pop()){line.push(word);tspan.text(line.join(" "));if(tspan.node().getComputedTextLength()>width){line.pop();tspan.text(line.join(" "));line=[word];tspan=text.append("tspan").attr("x",9).attr("y",yValue*lines).attr("dy",(++lineNumber*lineHeight*1.5)+dy+"em").text(word)}}})},prepareChart:function(block,el){this.options=block.options;this.totalWidth=el.width();this.margin={top:this.getValueByScreenWidth(this.options.margin.top),right:this.getValueByScreenWidth(this.options.margin.right),bottom:this.getValueByScreenWidth(this.options.margin.bottom),left:this.getValueByScreenWidth(this.options.margin.left)};this.width=el.width()-this.margin.left-this.margin.right},renderHorizontalLines:function(data,xScale,y0Scale,y1Scale){var helper=this;var lines=this.svg.append("g").attr("transform","translate("+helper.margin.left*-1+","+0+")").selectAll("g").data(data.series).enter().append("g").attr("class","perso-chart-line").attr("transform",function(d,i){var y=y1Scale(i)*(i+1);return"translate(0,"+y+")"}).selectAll('.line').data(function(d){return d}).enter().append("line").attr("class","perso-chart-line").attr("x1","0").attr("x2",helper.totalWidth).attr("y1",function(d,i){return y0Scale(i)}).attr("y2",function(d,i){return y0Scale(i)})},renderGradient:function(){var gradients=this.options.rectangles.gradients;var defWithGradients=this.svg.append("defs");if(gradients){$.each(gradients,function(i,gradient){if(gradient){defWithGradients=defWithGradients.append("linearGradient").attr("id",gradient.id).attr("x1","0").attr("x2","0").attr("y1","0").attr("y2","1");defWithGradients.append("stop").attr("offset",gradient.offset1).attr("stop-color",gradient.stopColor1);defWithGradients.append("stop").attr("offset",gradient.offset2).attr("stop-color",gradient.stopColor2)}})}},renderFilter:function(){var filters=this.options.rectangles.filter;var svgWithFilters=this.svg.selectAll("defs");if(filters){$.each(filters,function(i,filter){if(filter){var filterSvg=svgWithFilters.append("filter").attr("id",filter.id)
filterSvg.append("feGaussianBlur").attr("in",filter.in).attr("stdDeviation",filter.stdDeviation)
filterSvg.append("feOffset").attr("dx",filter.dxOffset).attr("dy",filter.dyOffset)
var feMerge=filterSvg.append("feMerge")
feMerge.append("feMergeNode")
feMerge.append("feMergeNode").attr("in",filter.in)}})}},getValueByScreenWidth:function(value){var screenWidth=$(window).width();if(screenWidth>=790){return value}
else{if(screenWidth<347){return value}else if(screenWidth>=414){return value*this.options.screen.ratio_large}else{return value*this.options.screen.ratio_medium}}}})})(window,window.Personetics=window.Personetics||{},jQuery);(function(window,Personetics,$,undefined){var d3=Personetics.persoD3||window.d3;Personetics.utils=Personetics.utils?Personetics.utils:{};Personetics.utils.d3Helpers=Personetics.utils.d3Helpers?Personetics.utils.d3Helpers:{};Personetics.utils.d3Helpers.PinGraphChartHelper=Personetics.utils.d3Helpers.VerticalChartHelper.extend({})})(window,window.Personetics=window.Personetics||{},jQuery);(function(window,Personetics,$,undefined){Personetics.utils=Personetics.utils?Personetics.utils:{};Personetics.utils.d3Helpers=Personetics.utils.d3Helpers?Personetics.utils.d3Helpers:{};Personetics.utils.d3Helpers.VerticalChartHelperProduct=Personetics.utils.d3Helpers.VerticalChartHelper.extend({renderXAxis:function(){var helper=this;if(this.xAxis){this.svg.append("g").attr("class","x axis").attr("transform",function(d,i){var y=helper.getValueByScreenWidth(helper.options.xAxisTop);return("translate("+helper.calcLeft+","+y+")")}).call(helper.xAxis).selectAll(".tick text").data(helper.seriesData).attr("y","0").attr("class",function(d){var clazz="perso-xAxis-label";if(d.selected){clazz+=" selected"}
return clazz}).on("click",function(obj,clickedItemIndex){if(typeof helper.handleClick=='function')
helper.handleClick(obj,clickedItemIndex)})}}})})(window,window.Personetics=window.Personetics||{},jQuery);(function(window,Personetics,$,undefined){Personetics.utils=Personetics.utils?Personetics.utils:{};Personetics.utils.d3Helpers=Personetics.utils.d3Helpers?Personetics.utils.d3Helpers:{};Personetics.utils.d3Helpers.PinGraphChartHelperProduct=Personetics.utils.d3Helpers.VerticalChartHelperProduct.extend({})})(window,window.Personetics=window.Personetics||{},jQuery);(function(window,Personetics,$,undefined){var d3=Personetics.persoD3||window.d3;Personetics.utils=Personetics.utils?Personetics.utils:{};Personetics.utils.d3Helpers=Personetics.utils.d3Helpers?Personetics.utils.d3Helpers:{};Personetics.utils.d3Helpers.MultiVerticalChartHelperDesktop=Personetics.utils.d3Helpers.MultiVerticalChartHelper.extend({prepareChart:function(data,options,handleClick){Personetics.utils.d3Helpers.MultiVerticalChartHelper.prototype.prepareChart.call(this,data,options,handleClick);this.yAxis=d3.svg.axis().scale(this.yAxisScale).orient("left").innerTickSize(-this.width).outerTickSize(0).ticks(5)},renderChart:function(el){var helper=this;this.yScale.domain([0,d3.max(helper.seriesData,function(d){return d3.max(d,function(k){return k.value})})]);this.modifyData();this.svg=this.renderSVGBase(el,"multiVertical");this.renderGradient();this.renderFilter();this.renderYAxis();this.renderAccessibilityHiddenRects();this.renderMultiVerticalBars();this.renderHiddenRects(this.seriesData);this.renderLabels();this.renderXAxis();this.renderVerticalLines(this.x0Scale)},renderAccessibilityHiddenRects:function(){var helper=this;var hiddenRectWidth=helper.getValueByScreenWidth((helper.options.rectangles.width*3)+(helper.options.rectangles.paddingRight||0));var hiddenRectHeight=helper.getValueByScreenWidth(helper.options.svgHeight-(helper.options.labelTop||0));var reversedData=this.seriesData[0].slice().reverse();var hiddenRects=this.svg.append('g').attr('class','perso-hidden-rects').attr("transform",function(data,i){return"translate("+helper.options.accessHiddenRectMarginLeft+","+helper.getValueByScreenWidth(helper.options.accessHiddenRectMarginTop)+")"}).selectAll("g").data(reversedData);hiddenRects.enter().append('rect').attr('class','access-hidden-rect').attr("height",function(d,i){return hiddenRectHeight}).attr('width',hiddenRectWidth).attr("x",function(d,i){var lastItemIndex=helper.series[0].length-1
return(helper.xScale(helper.categoriesData[lastItemIndex-i])+(helper.width/helper.dataLength)-15)-hiddenRectWidth/4}).attr('fill-opacity',0)},renderSVGBase:function(el,clazz){var helper=this;if(!clazz){clazz=''}
this.options.chart=this.options.chart||{};return(d3.select(el.get(0)).append("svg").attr("class","perso-svg-chart-container "+clazz).attr("width",helper.width).attr("height",helper.options.svgHeight).append("g").attr("transform","translate("+this.options.chart.transX+","+helper.getValueByScreenWidth(this.options.chart.transY)+")"))},})})(window,window.Personetics=window.Personetics||{},jQuery);(function(window,Personetics,$,undefined){Personetics.utils.d3Helpers=Personetics.utils.d3Helpers||{};Personetics.utils.d3Helpers.VerticalChartHelperCiti=Personetics.utils.d3Helpers.VerticalChartHelperProduct.extend({barsTransition:function(bars){var helper=this;bars.transition().duration(helper.options.rectangles.transition.duration).delay(helper.options.rectangles.transition.delay).attr("y",function(d){return helper.getBarsY(d)}).attr("height",function(d){return helper.getBarsHeight(d)}).each("end",function(d){if(typeof helper.appendTooltip=="function"){helper.appendTooltip()}})},prepareChart:function(data,options,handleClick,appendTooltip){Personetics.utils.d3Helpers.VerticalChartHelperProduct.prototype.prepareChart.call(this,data,options,handleClick);this.appendTooltip=appendTooltip}})})(window,window.Personetics=window.Personetics||{},jQuery);(function(window,Personetics,$,undefined){Personetics.utils=Personetics.utils||{};Personetics.utils.d3Helpers.PinGraphChartHelperCiti=Personetics.utils.d3Helpers.VerticalChartHelperCiti.extend({renderXAxis:function(data,block){var helper=this;if(this.xAxis){this.svg.append("g").attr("class","x axis").attr("transform",function(d,i){var y=helper.getValueByScreenWidth(helper.options.xAxisTop);return("translate("+helper.calcLeft+","+y+")")}).call(helper.xAxis).selectAll(".tick text").data(helper.seriesData).attr("class",function(d){var clazz="perso-xAxis-label";if(d.selected||d.highlight){clazz+=" selected"}
return clazz}).call(helper.wrapLabelText).on("click",function(obj,clickedItemIndex){if(typeof helper.handleClick=='function')
helper.handleClick(obj,clickedItemIndex)})}}})})(window,window.Personetics=window.Personetics||{},jQuery);(function(window,Personetics,$,undefined){Personetics.utils=Personetics.utils||{};Personetics.utils.d3Helpers.MultiVerticalChartHelperCiti=Personetics.utils.d3Helpers.MultiVerticalChartHelperDesktop.extend({MultiVerticalBarsTransition:function(blockWithBars,block,data,yScale,minValue,maxValue){var helper=this;blockWithBars.transition().duration(helper.options.rectangles.transition.duration).delay(helper.options.rectangles.transition.delay).attr("y",function(d){return helper.getBarsY(d,block,data,yScale,helper.minValue,helper.maxValue)}).attr("height",function(d){return helper.getBarsHeight(d,block,data,yScale,helper.minValue,helper.maxValue)}).each("end",function(d){block.appendTooltip()})}})})(window,window.Personetics=window.Personetics||{},jQuery);(function(window,Personetics,$,undefined){Personetics.story=Personetics.story||{};var keyCode={"Space":32,"Enter":13,"LeftArrow":37,"RightArrow":39,"UpArrow":38,"DownArrow":40};Personetics.story.AccountSelectorBlockProductDesktop=Personetics.story.AccountSelectorBlockProduct.extend({beforeRender:function(el,layoutInstructions){this.animationEnd=!0;Personetics.story.AccountSelectorBlockProduct.prototype.beforeRender.call(this,el,layoutInstructions)},prepareCarouselParam:function prepareCarouselParam(){var me=this;var params=Personetics.story.AccountSelectorBlockProduct.prototype.prepareCarouselParam.call(this);params.updateDotsForAccessibility=this.updateDotsForAccessibility;params.isDesktop=!0;params.onAnimationEnd=function()
{me.animationEnd=!0};return params},updateDotsForAccessibility:function(dotsWrapper,id){dotsWrapper.attr("aria-labelledby","perso-accessibility-read-"+id);if(!!window.MSInputMethodContext&&!!document.documentMode){dotsWrapper.blur();dotsWrapper.focus()}},putFocusAccessibility:function putFocusAccessibility(elementForFocus){},onChooseAccountClick:function onChooseAccountClick(target){Personetics.story.AccountSelectorBlockProduct.prototype.onChooseAccountClick.call(this,target)},optionHeaderKeydownEvent:function optionHeaderClickEvent(e){if([keyCode.Space,keyCode.Enter].indexOf(e.which)!==-1)
{this.optionHeaderClickEvent(e);var elem;var target=$(e.target);if(target.attr("data-all")==="true"||target.parent().attr("data-all")==="true"){elem=$("#allAccountHelper")}else{elem=$("#chooseAccountHelper");elem.attr("aria-labelledby",$(".carousel-index-wrapper").attr("aria-labelledby"))}
elem.addClass("pstory-header-button");elem.attr("tabindex","0");elem.focus();e.preventDefault();e.stopImmediatePropagation()}},optionCarouselDotKeydownEvent:function optionHeaderClickEvent(e){if(this.animationEnd){if([keyCode.RightArrow,keyCode.DownArrow].indexOf(e.which)!==-1){this.animationEnd=!1;this.carouselAnimation.onSwipe("left");return!1}else if([keyCode.LeftArrow,keyCode.UpArrow].indexOf(e.which)!==-1){this.animationEnd=!1;this.carouselAnimation.onSwipe("right");return!1}}else{return!1}
if([keyCode.Space].indexOf(e.which)!==-1)
{e.preventDefault();e.stopImmediatePropagation()}},bindEvents:function bindEvents(){Personetics.story.AccountSelectorBlockProduct.prototype.bindEvents.call(this);Personetics.utils.accessibility.trackFocus(this.frameEl);this.frameEl.find(".pstory-header-button").bind("keypress",Personetics.bind(this,this.optionHeaderKeydownEvent));this.frameEl.find(".carousel-index-wrapper").bind("keydown",Personetics.bind(this,this.optionCarouselDotKeydownEvent))},afterRender:function afterRender(el){Personetics.story.AccountSelectorBlockProduct.prototype.afterRender.call(this,el);var carouselItem=el.find(".carousel-inner-wrapper .carousel-item");if(carouselItem.length>1){this.frameEl.find(".carousel-index-wrapper").attr("tabindex","0")}else{this.frameEl.find(".carousel-index-wrapper").removeAttr("tabindex")}
if(this.showHeaderTabs){this.addAccessibilityTabsHelper()}
carouselItem.each(function()
{var element=$(this);element.find(".perso-bold").attr("id","perso-bold"+element.attr("pstory-id"));element.find(".perso-amount").attr("id","perso-amount"+element.attr("pstory-id"))});el.find(".pstory-all-accounts-txt").find(".perso-bold").attr("id","perso-bold-all");el.find(".pstory-all-accounts-txt").find(".perso-amount").attr("id","perso-amount-all")},addAccessibilityTabsHelper:function addAccessibilityTabsHelper(){var allAccountTab=this.frameEl.find(".pstory-header-button[data-all='true']");var chooseAccountTab=this.frameEl.find(".pstory-header-button[data-all='false']");allAccountTab.append("<div id='allAccountHelper' style='position: absolute;top:0;left:0' aria-labelledby='perso-bold-all perso-amount-all'></div>");chooseAccountTab.append("<div id='chooseAccountHelper' style='position: absolute;top:0;left:0' aria-labelledby='"+$(".carousel-index-wrapper").attr("aria-labelledby")+"'></div>");$("#allAccountHelper,#chooseAccountHelper").focusout(function(){var elem=$(this);elem.removeAttr("tabindex");elem.removeClass("pstory-header-button");if(elem.attr("id")==="chooseAccountHelper"){elem.removeAttr("aria-labelledby")}});if(!!window.MSInputMethodContext&&!!document.documentMode){var ofLabel=Personetics.dictionary.getText("accessibilityOfLbl");allAccountTab.attr("aria-label",allAccountTab.text()+" "+"1 "+ofLabel+" 2");chooseAccountTab.attr("aria-label",chooseAccountTab.text()+" "+"2 "+ofLabel+" 2")}}})})(window,window.Personetics=window.Personetics||{},jQuery);(function(window,Personetics,$,undefined){Personetics.story=Personetics.story||{};var keyCode={'Enter':13};Personetics.story.D3BarChartBlockProductDesktop=Personetics.story.D3BarChartBlockProduct.extend({initOptions:function(){if(this.chartType=="multiVertical"){this.options=this.story.uxCtrl.getColumnChartMultiSeriesOptionsDesktop();this.options.palette=this.story.uxCtrl.getMultiVerticalPaletteDesktop();this.options.paletteLabels=this.story.uxCtrl.getMultiVerticalLabelsPaletteDesktop()}
else if(this.chartType=="multiHorizontal")
this.options=this.story.uxCtrl.getBarChartOptionsDesktop();else this.options=this.story.uxCtrl.getColumnChartOptionsDesktop()},renderAccessibility:function renderAccessibility(el,chartType){Personetics.story.D3BarChartBlockProduct.prototype.renderAccessibility.call(this,el,chartType);this.frameEl.find(".accessibility-chart-wrapper .accessibility-chart-button").attr('tabindex','-1')},afterRender:function(el){var $barChartContainer=this.el.find(".perso-svg-chart-container");Personetics.story.D3BarChartBlockProduct.prototype.afterRender.call(this,el);$barChartContainer.attr("aria-labelledby",$barChartContainer.find("title").attr("id"));Personetics.utils.accessibility.trackFocus($barChartContainer);if(this.chartType!=='pinGraph'){this.addAccessDataToHiddenRects();this.updateSelectedHiddenRect()}
if(this.layoutInstructions.hasOwnProperty('var')&&typeof this.layoutInstructions.var!=='undefined'){this.listenToKeypress()}},putFocusAccessibility:function putFocusAccessibility(elementForFocus){},listenToKeypress:function(){var block=this;if(block.chartHelper.svg){this.el.find(".perso-svg-chart-container").bind("keypress",function(e){if(e.target.className.animVal.indexOf('access-hidden-rect')!==-1){if([keyCode.Enter].indexOf(e.which)!==-1){var data=(block.layoutInstructions.seriesLabels.length>=2)?block.layoutInstructions.series[0]:block.layoutInstructions.series;var lastBarIndex=data.length-1;var targetBarIndex=$(e.target).index();block.handleClick(data[lastBarIndex-targetBarIndex],lastBarIndex-targetBarIndex)}}})}},getSelectedBarIndex:function(svgEl,isSeries){var index;if(svgEl){if(isSeries){index=$(svgEl[0]).find('.perso-chart-rect.In.selected').index()}else{index=$(svgEl[0]).find('.perso-bar.selected').index()}}
return index},renderAccessibilityData:function renderAccessibilityData(el){Personetics.story.D3BarChartBlock.prototype.renderAccessibilityData.call(this,el);if(this.chartType!=='pinGraph'){if(!!window.MSInputMethodContext&&!!document.documentMode){this.el.find(".perso-svg-chart-container").attr('focusable',!1);this.el.find(".perso-svg-container-group").attr({'focusable':!0,"aria-hidden":"false"});this.chartHelper.svg.selectAll(".perso-bar").attr('focusable',!1);this.chartHelper.svg.selectAll(".access-hidden-rect").attr({'focusable':!0,"class":"access-hidden-rect-IE","aria-hidden":"false"})}
this.el.find(".perso-svg-chart-container").attr('tabindex','-1');this.chartHelper.svg.selectAll(".perso-bar").attr('tabindex','-1');this.chartHelper.svg.selectAll(".access-hidden-rect").attr('tabindex','0');this.chartHelper.svg.selectAll(".perso-hidden-rects, .access-hidden-rect").attr('aria-hidden',!1)}},handleClick:function(obj,clickedItemIndex){var block=this;var seriesData=block.layoutInstructions.series;if(obj.hasOwnProperty('mode')&&obj.mode){if((seriesData[1][clickedItemIndex].value!==0||seriesData[0][clickedItemIndex].value!==0)&&seriesData[1][clickedItemIndex].category===obj.category&&seriesData[0][clickedItemIndex].category===obj.category){Personetics.story.D3BarChartBlockProduct.prototype.handleClick.call(this,obj,clickedItemIndex);this.handleMultiChartClick()}}else{if(seriesData[clickedItemIndex].value!==0){Personetics.story.D3BarChartBlockProduct.prototype.handleClick.call(this,obj,clickedItemIndex);this.handleSingleChartClick()}}
this.updateSelectedHiddenRect()},handleSingleChartClick:function(){var persoBarsNum=this.el.find('.perso-bar').length-1;this.el.find('.accessibility-chart-button.selected').removeClass('selected');$(this.el.find('.accessibility-chart-button')[persoBarsNum-(this.el.find('.perso-bar.selected').index())]).addClass('selected')},handleMultiChartClick:function(){var persoBarsNum=this.el.find('.perso-chart-rect.Out').length-1;this.el.find('.accessibility-chart-button.selected').removeClass('selected');$(this.el.find('.accessibility-chart-button')[persoBarsNum-(this.el.find('.perso-chart-rect.Out.selected').index())]).addClass('selected')},addAccessDataToHiddenRects:function(){var accessChartButtons=$(this.el.find('.accessibility-chart-button'));var hiddenRects=$(this.el.find('.access-hidden-rect, .access-hidden-rect-IE'));if(accessChartButtons.length&&hiddenRects.length){for(var i=0;i<hiddenRects.length;i++){var itemData=accessChartButtons.eq(i).attr('aria-label');hiddenRects.eq(i).attr('aria-label',itemData)}}},updateSelectedHiddenRect:function(){var block=this;var classSelected=block.el.find('.perso-xAxis-label.selected').length>0?" "+block.texts.selected:"";var hiddenRects=block.el.find('.access-hidden-rect, .access-hidden-rect-IE');var selectedIndex=block.el.find(".accessibility-chart-button.selected").index();$.each(hiddenRects,function(i,rect){var $rect=$(rect);var ariaLabel=($rect.attr('aria-label').indexOf('not selected')!==-1)?$rect.attr('aria-label').split('not selected'):$rect.attr('aria-label').split('selected');if(selectedIndex!==-1){if(selectedIndex==i){$rect.attr('aria-label',ariaLabel[0]+classSelected)}else{if($rect.attr('aria-label').indexOf('not selected')==-1){$rect.attr('aria-label',ariaLabel[0]+' '+block.texts.notSelected)}}}})}})})(window,window.Personetics=window.Personetics||{},jQuery);(function(window,Personetics,$,undefined){var d3=Personetics.persoD3||window.d3;Personetics.story=Personetics.story||{};Personetics.story.D3PinGraphChartBlockProductDesktop=Personetics.story.D3BarChartBlockProductDesktop.extend({beforeRender:function(el,layoutInstructions){Personetics.story.D3BarChartBlockProduct.prototype.beforeRender.call(this,el,layoutInstructions);this.texts.accessibilityPinGraphTitle=Personetics.dictionary.getText("accessibilityPinGraphTitle")},getHtmlTemplateId:function(clazz){return"pinGraph-chart"},render:function(el,layoutInstructions){Personetics.story.Block.prototype.render.call(this,el,layoutInstructions);this.options.desktopScreenWidth=this.story.uxCtrl.getDesktopScreenWidth();var chartEl=this.frameEl.find(".pstory-pinGraph-chart");if(chartEl.length>0){this.renderBarChart(chartEl,layoutInstructions)}},renderBarChart:function(el,data){this.chartHelper.prepareChart(data,this.options);this.chartHelper.renderChart(el)},beforeRenderChart:function(el,layoutInstructions){this.layoutInstructions.series=this.layoutInstructions.series[0];this.chartType=this.getChartType();this.chartTypeHelper=(this.chartType+"Helper");this.initChartHelper(this.chartTypeHelper);this.options=this.story.uxCtrl.getPinGraphChartOptionsDesktop()},afterRender:function(el){var $barChartContainer=this.el.find(".perso-svg-chart-container");Personetics.story.D3BarChartBlockProductDesktop.prototype.afterRender.call(this,el);$barChartContainer.attr('tabindex','-1')},barsDirection:function barsDirection(){if(Personetics.processor.PStoryConfig.isRtl()){this.barsDirectionRTL()}},getChartType:function(){var type='pinGraph';return type},getAccessibilityTitle:function getAccessibilityTitle(){return this.texts.accessibilityPinGraphTitle},})})(window,window.Personetics=window.Personetics||{},jQuery);(function(window,Personetics,$,undefined){Personetics.story=Personetics.story||{};Personetics.story.D3BarChartBlockCiti=Personetics.story.D3BarChartBlockProductDesktop.extend({renderBarChart:function(el,layoutInstructions){var data=layoutInstructions;this.options.desktopScreenWidth=this.story.uxCtrl.getDesktopScreenWidth();var handleClickBind=Personetics.bind(this,this.handleClick);var appendTooltipBind=Personetics.bind(this,this.appendTooltip);if(this.chartType=="multiHorizontal"){this.chartHelper.prepareMultiHorizontalChart(this,el);this.chartHelper.renderMultiHorizontalChart(this,el,this.layoutInstructions)}
else{this.chartHelper.prepareChart(data,this.options,handleClickBind,appendTooltipBind);this.chartHelper.renderChart(el)}},renderAccessibility:function renderAccessibility(el,chartType){var element=$("<div class='accessibility-chart-wrapper'></div>");var layoutInstructions=this.layoutInstructions;var block=this;var inRect=$(el.find("svg .perso-chart-rect.In"));var buttonHeight;var buttonLeft;var button="";var left=this.getETransform(el);if(chartType!="pinGraph"){el.find("svg .perso-bar, svg .perso-chart-rect.Out").each(function(index,item){button=$("<input type='button' class='accessibility-chart-button'/>");if(chartType=="multiVertical"){buttonHeight=layoutInstructions.series[0][index].barHeight>layoutInstructions.series[1][index].barHeight?layoutInstructions.series[0][index].barHeight:layoutInstructions.series[1][index].barHeight}
else{buttonHeight=layoutInstructions.series[index].barHeight;button.css('width',item.getAttribute("width")+"px")}
buttonLeft=parseInt(item.getAttribute("x"))+left;button.css('left',+buttonLeft+"px");if(buttonHeight>0)
button.css('height',buttonHeight+"px");else button.css('height',"5px");block.ariaLabelAccessibilityButtons(button,layoutInstructions,index,chartType);block.ariaLabelSetSelected(el,item,button);$(button).bind('click',function(e){block.handleClickAccessibilityButtons(layoutInstructions,index,chartType);block.ariaLabelSetSelected(el,item,$(this))});$(button).bind('mouseenter',function(e){block.handleHover(layoutInstructions,index,chartType)});element.prepend(button)});el.find(".pstory-bar-chart").append(element)}},handleHover:function(layoutInstructions,index,chartType){var obj=layoutInstructions;if(chartType=="multiVertical"){obj=layoutInstructions.series[0][index]}
else{obj=layoutInstructions.series[index]}
this.setTooltip(obj,index)},appendTooltip:function appendTooltip(){var chartEl=this.frameEl.find('.pstory-bar-chart');if(chartEl.find('.pstory-tooltip').length>0){return}
chartEl.append("<div class='pstory-tooltip'></div>");var index;if(this.chartType=='vertical'){var selected=this.layoutInstructions.series.filter(function(item,i){index=i;return item.selected==!0})[0]}
else{var selected=this.layoutInstructions.series[0].filter(function(item,i){index=i;return item.selected==!0})[0]}
this.setTooltip(selected,index)},setTooltip:function setTooltip(obj,clickedItemIndex){var selectedRect=this.frameEl.find('svg rect:not(.access-hidden-rect)')[clickedItemIndex];var left=selectedRect.x.baseVal.value+parseFloat(this.frameEl.find(".pstory-bar-chart").css('padding-left'))+this.getETransform(this.frameEl);var tooltip=this.frameEl.find('.pstory-tooltip');if(this.chartType=="multiVertical"){tooltip.empty();tooltip.append("<span>EARNED</span><span class='in-val'></span><span>SPENT</span><span class='out-val'></span>");var $inObj=this.frameEl.find('.in-val');var $outObj=this.frameEl.find('.out-val');$inObj.append(this.layoutInstructions.series[0][clickedItemIndex].label);$outObj.append(this.layoutInstructions.series[1][clickedItemIndex].label);left=left-tooltip.innerWidth()/2+this.options.rectangles.width*1.5;selectedRect=this.frameEl.find('svg rect.selected');var top=selectedRect[0].y.baseVal.value<=selectedRect[1].y.baseVal.value?selectedRect[0].y.baseVal.value+26:selectedRect[1].y.baseVal.value+26}
else{tooltip.html(obj.label);left=left-tooltip.innerWidth()/2+this.options.rectangles.width/2;var top=selectedRect.y.baseVal.value+18}
tooltip.css("left",left+"px")
tooltip.css("top",top+"px")},updateSelectedHiddenRect:function(){var block=this;var classSelected=block.el.find('.perso-xAxis-label.selected').length>0?" "+block.texts.selected:"";var hiddenRects=block.el.find('.access-hidden-rect, .access-hidden-rect-IE');var selectedIndex=block.el.find(".accessibility-chart-button.selected").index();if($(block.el.find('.accessibility-chart-button')).length>0){$.each(hiddenRects,function(i,rect){var $rect=$(rect);var ariaLabel=($rect.attr('aria-label').indexOf('not selected')!==-1)?$rect.attr('aria-label').split('not selected'):$rect.attr('aria-label').split('selected');if(selectedIndex!==-1){if(selectedIndex==i){$rect.attr('aria-label',ariaLabel[0]+classSelected)}else{if($rect.attr('aria-label').indexOf('not selected')==-1){$rect.attr('aria-label',ariaLabel[0]+' '+block.texts.notSelected)}}}})}}})})(window,window.Personetics=window.Personetics||{},jQuery);(function(window,Personetics,$,undefined){Personetics.story=Personetics.story||{};Personetics.story.AccountSelectorBlockCITIDesktop=Personetics.story.AccountSelectorBlockProductDesktop.extend({beforeRender:function(el,layoutInstructions){Personetics.story.AccountSelectorBlockProductDesktop.prototype.beforeRender.call(this,el,layoutInstructions);this.minAccountsForDisplayingArrows=2},headerTabsAnimation:function headerTabsAnimation(selected){if(typeof selected==="undefined"||selected===null||selected.length==0)
return;var tabAnimatedBorder=$(this.frameEl).find(".pstory-tab-animated-border-bottom");var arrow=$(this.frameEl).find('.pstory-header-button-arrow');var left=selected.offset().left-this.frameEl.offset().left-44;var width=selected.width();tabAnimatedBorder.css({"left":left+'px',width:width+'px'})},getAccountSelectorText:function getAccountSelectorText(){var text=Personetics.story.AccountSelectorBlockProductDesktop.prototype.getAccountSelectorText.call(this);text.accountNumberTxt=Personetics.dictionary.getText("accountNumberTxt");return text},onChooseAccountClick:function onChooseAccountClick(selected){this.frameEl.parents('#personetics-story-widget').css({'overflow-y':'hidden'});Personetics.story.AccountSelectorBlockProductDesktop.prototype.onChooseAccountClick.call(this,selected);this.frameEl.parents('#personetics-story-widget').css({'overflow-y':'auto'})},})})(window,window.Personetics=window.Personetics||{},jQuery);(function(window,Personetics,$,undefined){Personetics.story=Personetics.story||{};Personetics.story.D3PinGraphChartBlockDesktopCITI=Personetics.story.D3PinGraphChartBlockProductDesktop.extend({handleClick:function(obj,clickedItemIndex){Personetics.story.D3PinGraphChartBlockProductDesktop.prototype.handleClick.call(this,obj,clickedItemIndex)},handleHover:function(layoutInstructions,index,chartType){var obj=layoutInstructions;obj=layoutInstructions.series[index];this.setTooltip(obj,index)},afterRender:function afterRender(el){Personetics.story.D3PinGraphChartBlockProductDesktop.prototype.afterRender.call(this,el);var layoutInstructions=this.layoutInstructions;var block=this;el.find("svg .perso-bar").each(function(index,item){$(item).bind('mouseenter',function(e){block.handleHover(layoutInstructions,index,block.chartType)})})},appendTooltip:function appendTooltip(){var chartEl=this.frameEl.find('.pstory-pinGraph-chart');if(chartEl.find('.pstory-tooltip').length>0){return}
chartEl.append("<div class='pstory-tooltip'></div>");var index;var selected=this.layoutInstructions.series.filter(function(item,i){index=i;return item.selected==!0})[0];this.setTooltip(selected,index)},setTooltip:function setTooltip(obj,clickedItemIndex){var selectedRect=this.frameEl.find('svg rect')[clickedItemIndex];var left=selectedRect.x.baseVal.value+parseFloat(this.frameEl.find(".pstory-pinGraph-chart svg").css('padding-left'))+this.getETransform(this.frameEl);var top=selectedRect.y.baseVal.value;var tooltip=this.frameEl.find('.pstory-tooltip');tooltip.html(obj.label);left=left-tooltip.innerWidth()/2+this.options.rectangles.width/2+parseFloat(this.frameEl.find(".pstory-pinGraph-chart").css('padding-left'));tooltip.css("left",left+"px")
tooltip.css("top",top+"px")}})})(window,window.Personetics=window.Personetics||{},jQuery);(function(window,Personetics,$,undefined){Personetics.story=Personetics.story||{};Personetics.story.TableBlockCITIDesktop=Personetics.story.TableBlockProduct.extend({beforeRender:function(el,layoutInstructions){Personetics.story.Block.prototype.beforeRender.call(this,el,layoutInstructions);this.addTexts();this.texts={tableTitle:Personetics.dictionary.getText("accessibilityTableTitle"),tableStart:Personetics.dictionary.getText("accessibilityTableStart"),tableEnd:Personetics.dictionary.getText("accessibilityTableEnd")}
this.parseTableToObj();layoutInstructions=this.computeMode(layoutInstructions);this.groupTable();this.formatTable()},computeMode:function computeMode(layoutInstructions){layoutInstructions.rows.forEach(function(obj){if(obj.amount!==null&&typeof(obj.amount)!=="undefined")
if(parseFloat(obj.amount)==obj.amount)
if((parseFloat(obj.amount))>0)
obj.mode="In";else obj.mode="Out"});return layoutInstructions}})})(window,window.Personetics=window.Personetics||{},jQuery);(function(window,Personetics,$,undefined){Personetics.UI=Personetics.UI||{};var factory=Base.extend({widgetsTextsMap:{},defaultLang:"en",getText:function(textId,lang,fallbackText){var fallbackTextValue=fallbackText||"";var text=fallbackTextValue;if(this.widgetsTextsMap.hasOwnProperty(textId)){var textObj=this.widgetsTextsMap[textId];text=textObj[lang]||textObj[this.defaultLang]||fallbackTextValue}
return text},registerText:function(textId,text,lang)
{var lang=lang||this.defaultLang;if(!this.widgetsTextsMap.hasOwnProperty(textId))
this.widgetsTextsMap[textId]={};this.widgetsTextsMap[textId][lang]=text}});Personetics.UI.PWidgetsTextsFactory=new factory()})(window,window.Personetics=window.Personetics||{},jQuery);(function(window,Personetics,$,undefined){Personetics.UI=Personetics.UI||{};Personetics.UI.PAppCtrl=Personetics.UI.PWidgetCtrl.extend({initialize:function(config){this.super=Personetics.UI.PWidgetCtrl.prototype;this.super.initialize.call(this,config);this.config.parentCtrl=this;this.config.widthMode="";this.widgets={};var skinController=config.uxCtrl;if(!skinController)
skinController=new Personetics.story.skinController();this.uxCtrl=skinController;this.desktopScreenWidth=this.uxCtrl.getDesktopScreenWidth();this.screenWidth=$(window).width();if(this.screenWidth>this.desktopScreenWidth){this.config.widthMode="desktop"}
this.setFirstWidgetType(config.widgetType);this.registerTexts()},setFirstWidgetType:function(widgetType){this.firstWidgetType=widgetType||"insights"},addConfigurationClasses:function(){var deviceType=personetics.getDeviceType();this.el.addClass("personetics-device-"+deviceType)},getWidgetEl:function(widgetType){var widgetEl=this.el.find("#personetics-"+widgetType);if(widgetEl.length==0){widgetEl=$("<div id='personetics-"+widgetType+"'></div>");this.el.append(widgetEl)}
return widgetEl},start:function(el){el.empty();var containerEl=$("<div class='personetics-widgets-wrapper'></div>");el.append(containerEl);this.el=containerEl;this.addConfigurationClasses();var widget=Personetics.UI.PWidgetFactory.createWidget(this.firstWidgetType,this.config);this.widgets[this.firstWidgetType]=widget;var firstWidgetEl=this.getWidgetEl(this.firstWidgetType);widget.start(firstWidgetEl)},sendMessage:function(messageObj){var widgetType=messageObj.targetWidget;var message=messageObj.message;var args=messageObj.arguments;var widget=this.widgets[widgetType];if(widget&&widget.hasOwnProperty(message)){return widget[message].apply(widget,args)}},startWidget:function(widgetType,options){options.parentCtrl=options.parentCtrl||this;options.widthMode=this.config.widthMode;var widget=Personetics.UI.PWidgetFactory.createWidget(widgetType,options);widget.start(options.el);if(widget)
this.widgets[widgetType]=widget},closeLoading:function closeLoading(){this.sendMessage({targetWidget:"loading-animation",message:"removeLoading"})},startManagement:function(options){var el=options.el;var managementCtrl=new Personetics.UI.PManagementCtrl(options,this);managementCtrl.start(el);return managementCtrl},startRatings:function(options){var el=$(".pstory-frame");this.currentRatingsEl=el;var ratingCtrl=new Personetics.UI.PRatingCtrl(options,this);ratingCtrl.start(el);return ratingCtrl},startInbox:function(options){var el=options.el;var inboxCtrl=new Personetics.story.PInboxCtrl(options,this);inboxCtrl.start(el);return inboxCtrl},registerTexts:function registerTexts(){Personetics.dictionary.setLanguage(this.config.lang)}})})(window,window.Personetics=window.Personetics||{},jQuery);(function(window,Personetics,$,undefined){Personetics.UI=Personetics.UI||{};Personetics.UI.PRatingCtrl=Personetics.UI.PWidgetCtrl.extend({initialize:function(config){this.super=Personetics.UI.PWidgetCtrl.prototype;this.super.initialize.call(this,config);this.insight=this.config.insight;this.lang=this.config.lang;this.texts={accessibilityRatingLevelTitle:Personetics.dictionary.getText("accessibilityRatingLevelTitle")};this.ratingTemplate="#tmpl-perso-rating";this.feedbackTemplate="#tmpl-perso-feedback"},start:function(el){this.el=el;var ratingTmpl=this.getRatingTemplate();el.append(ratingTmpl);this.fixRatingElToBottom();this.sendGetRatings()},getRatingTemplate:function getRatingTemplate(){var ratingTitle=Personetics.dictionary.getText("lblstoryRating");var ratingTmpl=this.getTemplateHtml(this.ratingTemplate,{ratingTitle:ratingTitle});return ratingTmpl},fixRatingElToBottom:function fixRatingElToBottom(){var ratingEl=this.el.find('.perso-ratings-wrapper');var ratingHeight=ratingEl.height()+1;ratingEl.height(ratingHeight);var ratingOuterHeight=ratingEl.outerHeight(!0);this.el.find('.pstory-container').css('minHeight','calc(100% - '+(ratingOuterHeight-2)+'px)')},sendGetRatings:function(){var testData=window.testData?window.testData.ratings:null;var me=this;if(testData){setTimeout(function(){me.onGetRatigsResponse((testData))},500)}else{var data={id:this.insight.id};personetics.getInsightRating(data,Personetics.bind(this,this.onGetRatigsResponse),Personetics.bind(this,this.onGetRatingsError))}},onGetRatigsResponse:function(json){var rating=json?json.rating:0;var el=this.el.find(".perso-ratings-icons");this.id=json.id;this.starRating(el,rating);this.afterRender()},onGetRatingsError:function onGetRatingsError(){this.onError();var json={id:this.insight.id,rating:0}
this.onGetRatigsResponse(json)},starRating:function(el,prevRating){var me=this;var ratingId=this.insight.id+'_'+this.el.index()+'_rating_';return el.each(function(){var $ratingElement=el;for(var x=0;x<$ratingElement.data("rating-max");x++){var starElement=me.createRatingStarElement(x,prevRating,ratingId+x);$ratingElement.append(starElement)}
var $ratingItems=$ratingElement.children("input");var rating=0;$ratingItems.bind("click",{id:me.id,me:me},Personetics.bind(me,me.rateClick));if(typeof prevRating!=='undefined'&&prevRating!==null){rating=prevRating;$ratingElement.attr("data-val",rating);$($ratingItems[rating-1]).attr("checked",!0)}})},createRatingStarElement:function createRatingStarElement(index,prevRating,ratingElementId){var label=this.texts.accessibilityRatingLevelTitle+' '+(index+1);var element=$("<input type='radio' id='"+ratingElementId+"' name='rating' aria-label='"+label+"'/><label for='"+ratingElementId+"'/>");return element},afterRender:function(){},rateClick:function rateClick(e){this.onRateClick(e);this.feedbackStart()},onRateClick:function onRateClick(e){var target=e.currentTarget;var rating=$(target).index(".perso-ratings-icons input[type='radio']")+1;$("li:lt("+rating+")",$(target).parent("ul")).addClass("perso-hover");$("li:gt("+($(target).index())+")",$(target).parent("ul")).removeClass("perso-hover");$(target).closest("[data-val]").attr("data-val",rating);this.eventObj={id:e.data.id,rating:rating,insightId:this.insight.id};var testData=window.testData?window.testData.ratingsResponse:null;if(testData){var widget=this;setTimeout(function(){e.data.me.onSuccesRate((testData))},500)}else{personetics.updateInsightRating(this.eventObj,e.data.me.onSuccesRate,e.data.me.onError)}},feedbackStart:function feedbackStart(){if(Personetics.projectConfiguration.getConfig("showFeedback")==!0){if(!this.disableFeedBack){this.showFeedback()}
else{if(this.el.find('.perso-feedback-text').length>0&&this.el.find(".perso-feedback-text").val()==""){var lblfeedbackprompt=Personetics.dictionary.getText("lblfeedbackprompt"+this.eventObj.rating);var feedbackText=this.el.find('.perso-feedback-text');feedbackText.attr({placeholder:lblfeedbackprompt,"aria-label":lblfeedbackprompt})}}}},onSuccesRate:function(data){Personetics.log("rating succes")},onError:function(){Personetics.log("rating error")},showFeedback:function showFeedback(){var widget=this;this.el.find('.perso-feedback-wrapper').remove();this.disableFeedBack=!0;var lblfeedbackprompt=Personetics.dictionary.getText("lblfeedbackprompt"+this.eventObj.rating);var lblreactionFeedback=Personetics.dictionary.getText("lblreactionFeedback");var btnsubmit=Personetics.dictionary.getText("btnsubmit");var ratingTmpl=this.getTemplateHtml(this.feedbackTemplate,{lblfeedbackprompt:lblfeedbackprompt,lblreactionFeedback:lblreactionFeedback,btnsubmit:btnsubmit});this.el.append(ratingTmpl);var submit=this.el.find('.perso-feedback-submit');submit.css('margin-left','calc(100% - '+submit.outerWidth()+'px)');submit.bind("click",{id:widget.insight.id,widget:widget},Personetics.bind(widget,widget.sendFeedback));submit.hide();this.el.find('.perso-feedback-reaction').hide();var element=this.el.find('.perso-feedback-wrapper');this.scrollToEnd(this.el,element);this.feedbackText=this.el.find('.perso-feedback-text');this.textareaSize=this.el.find('.textarea-size');var feedbackTextFocusBind=Personetics.bind(this,this.feedbackTextFocus);$(this.feedbackText).bind('focus',feedbackTextFocusBind);var feedbackTextBlurBind=Personetics.bind(this,this.feedbackTextBlur);$(this.feedbackText).bind('blur',feedbackTextBlurBind);widget.textareaSize.text(this.feedbackText.value+'\n');var feedbackTextInputBind=Personetics.bind(this,this.feedbackTextInput);$(this.feedbackText).bind('input',feedbackTextInputBind)},feedbackTextBlur:function feedbackTextBlur(e){var widget=this;var lblfeedbackprompt=Personetics.dictionary.getText("lblfeedbackprompt"+this.eventObj.rating);if(this.value==0){widget.el.find('.perso-feedback-submit').hide();widget.feedbackText.removeClass('direction-text');widget.feedbackText.addClass('direction-text-center');widget.feedbackText.attr("placeholder",lblfeedbackprompt)}
setTimeout(function(){widget.parentCtrl.enableCollapse=!0},800)},feedbackTextInput:function feedbackTextInput(e){var element=this.el.find('.perso-feedback-wrapper');this.textareaSize.text(e.target.value+'\n');this.el.scrollTop(this.el[0].scrollHeight)},feedbackTextFocus:function feedbackTextFocus(e){var element=this.el.find('.perso-feedback-wrapper');this.feedbackText.removeClass('direction-text-center');this.feedbackText.addClass('direction-text');this.feedbackText.attr("placeholder","");this.el.find('.perso-feedback-submit').show();this.el.scrollTop(this.el[0].scrollHeight)
this.parentCtrl.enableCollapse=!1},scrollToEnd:function scrollTo(el,toElement){if(toElement.length>0){$(el).animate({scrollTop:toElement.offset().top-el.offset().top+el.scrollTop()},500)}},sendFeedback:function sendFeedback(e){var widget=this;var feedback=this.el.find('.perso-feedback-text').val();if(typeof feedback!="undefined"&&feedback.length>0){this.eventObj={id:e.data.id,feedback:feedback};personetics.updateInsightFeedback(this.eventObj,e.data.widget.onSuccesFeedback,e.data.widget.onErrorFeedback)}
widget.showFeedbackReaction()},onSuccesFeedback:function(data){Personetics.utils.PLogger.debug("feedback succes")},onErrorFeedback:function(){Personetics.utils.PLogger.debug("feedback error")},showFeedbackReaction:function showFeedbackReaction(){var widget=this;var height=this.el.find('.perso-feedback-wrapper').height();this.el.find('.perso-feedback-wrapper').height(height);var element=this.el.find('.perso-feedback-reaction');element.show();this.el.find(".perso-feedback-wrapper").css('overflow','scroll');var heightreaction=this.el.find('.perso-feedback-reaction').outerHeight();this.el.find('.perso-feedback-wrapper').animate({'scrollTop':150,'height':heightreaction},400,function(){widget.disableFeedBack=!1;widget.el.find(".textarea-wrapper").hide()})}})})(window,window.Personetics=window.Personetics||{},jQuery);(function(window,Personetics,$,undefined){Personetics.UI=Personetics.UI||{};Personetics.UI.PAppCtrlProduct=Personetics.UI.PAppCtrl.extend({setFirstWidgetType:function(widgetType){this.firstWidgetType=widgetType||"teaser-widget"},registerTexts:function registerTexts(){Personetics.UI.PAppCtrl.prototype.registerTexts.call(this)}})})(window,window.Personetics=window.Personetics||{},jQuery);(function(window,Personetics,$,undefined){Personetics.UI=Personetics.UI||{};var keyCode={"UpArrow":38,"DownArrow":40};Personetics.UI.PStoryWidgetCtrl=Personetics.UI.PWidgetCtrl.extend({initialize:function(config){this.super=Personetics.UI.PWidgetCtrl.prototype;this.super.initialize.call(this,config);if(typeof config!==undefined){Personetics.utils.PEventReporting.setValue({"instanceId":config.insightId,"insightId":config.instanceId,"userId":config.userId})}
this.tmplInnerErrorName="#tmpl-perso-widget-story-error";this.texts={imgClass:"errorImage",textSmall:Personetics.dictionary.getText("inboxTechnicalIssues"),textLarge:Personetics.dictionary.getText("OhNo"),errorText:Personetics.dictionary.getText("storyErrorText"),backButtonText:Personetics.dictionary.getText("accessibilityStoryBackButtonText")};this.showTitle=Personetics.projectConfiguration.getConfig("showTitle");this.loadingAnimation=Personetics.projectConfiguration.getConfig("showLoadingAnimation")},start:function(parentEl){this.parentEl=parentEl;this.el=this.parentEl;this.lang=this.config.lang;this.el.empty();if(this.config.widthMode==="desktop"){var me=this;this.el.attr("tabindex","0");Personetics.utils.accessibility.trackFocus(this.el);this.el.keydown(function(e){if(e.currentTarget===e.target){if(e.keyCode===keyCode.DownArrow||e.keyCode===keyCode.UpArrow){var direction=e.keyCode===keyCode.DownArrow?50:-50;me.el.find(".pstory-frame").animate({scrollTop:me.el.find(".pstory-frame").scrollTop()+direction},0,'swing')}}})}
this.renderTitle();this.sendGetStory()},renderTitle:function(){if(!this.showTitle)
return;var html=this.getTemplateHtml("#tmpl-pstory-title",this.texts);var newEl=$(html);this.el.append(newEl);var closeEl=newEl.find(".pstory-title-close");var widget=this;closeEl.bind("click",function(){widget.closeHandler()});var openTeasersEl=newEl.find(".pstory-open-teasers-button");openTeasersEl.bind("click",function(){widget.onShowTeasersButtonClick()})},sendGetStory:function(){var me=this;var testData=window.testData&&window.testData.stories?window.testData.stories[this.config.insightId]:null;if(this.loadingAnimation){this.parentCtrl.startWidget('loading-animation',{el:this.el.find('#story-frame-container')})}
if(testData){setTimeout(function(){me.onGetStoryResponse(testData)},500)}
else{if(typeof storyData!=="undefined"){this.config.payload=storyData}
if(typeof this.config.payload!='undefined'&&this.config.payload!=null){var payload=this.config.payload;if(typeof this.config.isPayloadEncoded!='undefined'&&(this.config.isPayloadEncoded==!0||this.config.isPayloadEncoded=="true")){try{payload=Personetics.utils.encodeDecode.Base64.decode(payload);payload=$.parseJSON(payload)}
catch(payload){this.onError();return}}
me.onGetStoryResponse(payload)}
else{var data={widgetId:this.widgetId,insightId:this.config.insightId};personetics.getInsightDetails(data,Personetics.bind(this,this.onGetStoryResponse),Personetics.bind(this,this.onError))}}},onGetStoryResponse:function(json){if(this.loadingAnimation)
this.parentCtrl.closeLoading();this.context="story";this.openStory(json);this.bindEvents()},openStory:function(storyCfg){var me=this;if(storyCfg){var el=this.parentEl.find("#story-frame-container");if(el.length==0){el=this.parentEl}
this.startStory(storyCfg,el);var titleElement=this.el.find(".pstory-title-text");if(titleElement.length>0){this.setVoiceOverFocus(titleElement[0])}
else{var element=Personetics.utils.accessibility.firstChildFocusable($('.pstory-frame'));if(typeof element!='undefind'){this.setVoiceOverFocus(element)}}}},startStory:function(storyCfg,el){var story=new Personetics.story.PStory({parent:this,lang:this.lang,defaultLang:this.defaultLang,texts:storyCfg.text,flowDef:storyCfg.story,userId:this.config.userId,expressions:storyCfg.expressions,insight:{id:this.config.insightId},data:storyCfg.facts,uxCtrl:this.uxCtrl,showTitle:this.showTitle,widthMode:this.widthMode,iconType:this.iconType,resizeHandler:function(newHeight){},onStartHandleEvent:function(oldHeight,el){$(el).css('height',$(el).height())},onEndHandleEvent:function(el){$(el).css('height','auto')},openTeasersHandler:Personetics.bind(this,function(){this.onShowTeasersButtonClick()})});story.start(el);var ratingsOptions={el:el.find(".pstory-frame"),insight:story.insight,lang:this.lang};this.parentCtrl.startWidget("ratings",ratingsOptions);story.addTouchScroll();return story},onError:function(err){if(this.loadingAnimation)
this.parentCtrl.closeLoading();Personetics.utils.PLogger.error(err);var data={textSmall:this.texts.textSmall,textLarge:this.texts.textLarge,imgClass:this.texts.imgClass,};var el=this.parentEl.find("#story-frame-container");if(el.length==0){el=this.parentEl}
var html=this.getTemplateHtml(this.tmplInnerErrorName,data);el.append(html);this.bindEvents();var closeEl=this.el.find(".pstory-title-close");var me=this;closeEl.bind("click",function(){if(typeof me.closeHandler=='function')
me.closeHandler()})},bindEvents:function(){},closeHandler:function(){var deviceType=personetics.getDeviceType();Personetics.API.personetics.eventBuffer&&Personetics.API.personetics.eventBuffer.sendEvents();if(deviceType==='web'){this.el.parent().empty();var regexResult=new RegExp('[\?&]'+'teasersView'+'=([^&#]*)').exec(window.location.href);var widgetIndicator=0;if(typeof regexResult!=='undefined'&&regexResult!==null)
widgetIndicator=regexResult[1]||0;var widgetType=widgetIndicator==="Carousel"?"teaser-widget-carousel":"teaser-widget"
if(widgetIndicator==="Carousel")this.parentCtrl.config.filter=!1;var config=$.extend(!0,{},this.parentCtrl.config);config.el=this.parentCtrl.getWidgetEl(widgetType);this.parentCtrl.startWidget(widgetType,config)}
else{var bridge=personetics.getJSBridge();if(bridge&&($.isFunction(bridge.sessionEnded))){var params={type:"ExitInsight",value:"1"}
Personetics.utils.PEventReporting.setValue(params);Personetics.utils.PEventReporting.notifyEvent();var config=$.extend(!0,{},this.parentCtrl.config);delete config.eventType;bridge.sessionEnded(config)}
else Personetics.log("Events Delegate not defined")}},onShowTeasersButtonClick:function onShowTeasersButtonClick(){var teasersWidgetEl=this.parentCtrl.getWidgetEl("teaser-widget");var config=$.extend(!0,this.parentCtrl.config,{el:teasersWidgetEl});this.parentCtrl.startWidget("teaser-widget",config)},setVoiceOverFocus:function setVoiceOverFocus(element){var focusInterval=10;var focusTotalRepetitions=10;if(this.config.widthMode!=='desktop'){element.setAttribute('tabindex','0')}
var focusRepetitions=0;var interval=window.setInterval(function(){element.focus();focusRepetitions++;if(focusRepetitions>=focusTotalRepetitions){window.clearInterval(interval)}},focusInterval)}})})(window,window.Personetics=window.Personetics||{},jQuery);(function(window,Personetics,$,undefined){Personetics.story=Personetics.story||{};Personetics.UI.PStoryWidgetCtrlProduct=Personetics.UI.PStoryWidgetCtrl.extend({initialize:function(config){this.super=Personetics.UI.PStoryWidgetCtrl.prototype;this.super.initialize.call(this,config);this.uxCtrl=new Personetics.story.skinController()}})})(window,window.Personetics=window.Personetics||{},jQuery);(function(window,Personetics,$,undefined){Personetics.UI=Personetics.UI||{};Personetics.UI.PStoryWidgetCtrlCITI=Personetics.UI.PStoryWidgetCtrl.extend({initialize:function(config){this.super=Personetics.UI.PStoryWidgetCtrl.prototype;this.super.initialize.call(this,config);this.texts.errorTextTitle=Personetics.dictionary.getText("storyErrorTextTitle");this.texts.errorTextBody=Personetics.dictionary.getText("storyErrorTextBody")},onError:function(err){if(this.loadingAnimation)
this.parentCtrl.closeLoading();Personetics.utils.PLogger.error(err);var data={errorTextTitle:this.texts.errorTextTitle,errorTextBody:this.texts.errorTextBody};var el=this.parentEl.find("#story-frame-container");if(el.length==0){el=this.parentEl}
var html=this.getTemplateHtml(this.tmplInnerErrorName,data);el.append(html);this.bindEvents();var closeEl=this.el.find(".pstory-title-close");var me=this;closeEl.bind("click",function(){if(typeof me.closeHandler=='function')
me.closeHandler()})}})})(window,window.Personetics=window.Personetics||{},jQuery);(function(window,Personetics,$,undefined){var HandlebarsTeaserHelpers=function HandlebarsTeaserHelpers(parent){this.parent=parent};HandlebarsTeaserHelpers.prototype.registerHelpers=function createView(){Handlebars.registerHelper("renderBarChart",function(layoutInstructions){this.renderBarChart(layoutInstructions)}.bind(this))};HandlebarsTeaserHelpers.prototype.renderBlock=function renderBlock(parentEl,layoutInstructions,insightId){var el=parentEl.find("#"+insightId+"_"+layoutInstructions.blockId);if(el.length>0){var block=Personetics.teaser.PBlockFactory.createBlock(this.parent,layoutInstructions);block.beforeRender(el,layoutInstructions,insightId);block.render(el,layoutInstructions);block.afterRender();block.bindEvents()}};window.HandlebarsTeaserHelpers=HandlebarsTeaserHelpers})(window,window.Personetics=window.Personetics||{},jQuery);(function(window,Personetics,$,undefined){var Widget=function Widget(config){this.config=config};Widget.prototype.start=function start(element){this.element=element};Widget.prototype.stop=function stop(){};Personetics.Widget=Widget})(window,window.Personetics=window.Personetics||{},jQuery);var WidgetEventHandler=function WidgetDelegate(){};WidgetEventHandler.prototype.sendToPServer=function sendToPServer(widget,data,onReceive){Personetics.utils.PLogger.debug(widget.getName()+" sending data to PServer: "+JSON.stringify(data))};WidgetEventHandler.prototype.navigateToPage=function navigateToPage(widget,params){Personetics.utils.PLogger.debug(widget.getName()+" navigating to page "+json.stringify(params))};WidgetEventHandler.prototype.widgetError=function widgetError(widget,errorParams){Personetics.utils.PLogger.debug(widget.getName()+" has encoutered an error: "+JSON.stringify(errorParams))};WidgetEventHandler.prototype.widgetStopped=function widgetStopped(widget){Personetics.utils.PLogger.debug(widget.getName()+" has stopped")};WidgetEventHandler.prototype.handleWidgetEvent=function handleWidgetEvent(widget,event){};(function(window,Personetics,undefined){var Handlebars=Personetics.UI.Handlebars;var horizontalBarChartsTemplates=["horizontalBar","horizontalBarAndBox","columnHorizontalBoxTeaser"];var imageFileExtensions=["png","jpg","svg","bmp"];var HandlebarsTeaserWidget=function HandlebarsTeaserWidget(config){Personetics.Widget.call(this,config);this.helpers=new HandlebarsTeaserHelpers(this)};HandlebarsTeaserWidget.prototype=Object.create(Personetics.Widget.prototype);HandlebarsTeaserWidget.prototype.start=function start(parentEl){Personetics.Widget.prototype.start.call(this,parentEl);var me=this;var insightId=this.config.insight.id;this.lang=this.config.lang;Personetics.processor.PStoryConfig.setConfig("lang",this.lang);this.teaserId="perso-teaser-template_"+insightId;var teaserBlocks;var templateId;var isTextTeasers=!1;if(!this.config.insight.hasOwnProperty("teaserTemplate")||this.config.insight.teaserTemplate===null||this.config.insight.teaserTemplate.length==0)
isTextTeasers=!0;if(!this.config.insight.hasOwnProperty("teaserBlocks")||this.config.insight.teaserBlocks===null)
isTextTeasers=!0;if(isTextTeasers){templateId="simpleText";teaserBlocks=[{"blockId":"date","type":"date-box","date":""},{"blockId":"title","type":"text","text":""},{"blockId":"teaser-text","type":"text","text":this.config.insight.text}]}
else{templateId=this.config.insight.teaserTemplate;teaserBlocks=this.config.insight.teaserBlocks}
var template=Handlebars.templates[templateId];if(template){var newTeaserBlocks={insightId:insightId,status:this.config.insight.status,highlighted:this.config.insight.highlighted};teaserBlocks.forEach(function(layoutInstructions,index){if(layoutInstructions.hasOwnProperty("date")){var dateStr=layoutInstructions.date.trim();var month=Personetics.utils.date.monthName(dateStr,me.lang,!0);if(typeof window.skinSetup.getDateFormat=="function"){if(window.skinSetup.getDateFormat()=="dd/mm/yy"){month=Personetics.utils.date.monthNumber(dateStr);var year=Personetics.utils.date.yearNumber(dateStr,!0);layoutInstructions.year=year}}
layoutInstructions.month=month;var day=Personetics.utils.date.dayNumber(dateStr,"DD");layoutInstructions.day=day}
var urlObj={};if(layoutInstructions.type=="image"){urlObj=Personetics.imageMap.getImageClass(layoutInstructions.url,"teaser_images");layoutInstructions.isAbsoluteURL=urlObj.isAbsoluteURL;layoutInstructions.absUrl=urlObj.url}
if(layoutInstructions.blockId=="icon"){urlObj=Personetics.imageMap.getImageClass(layoutInstructions.url,"icons");layoutInstructions.isAbsoluteURL=urlObj.isAbsoluteURL;layoutInstructions.absUrl=urlObj.url}
if(!(isNaN(new Date(layoutInstructions.text))))
{layoutInstructions.isDate=!0}
newTeaserBlocks[layoutInstructions.blockId]=layoutInstructions});var html=template(newTeaserBlocks);parentEl.append(html);this.afterRender(parentEl,newTeaserBlocks)}
else{Personetics.utils.PLogger.error("HandlebarsTeaserWidget.start() - Couldn't find template: '"+templateId+"'")}};HandlebarsTeaserWidget.prototype.afterRender=function(parentEl,teaserBlocks){$(".pstory-hbox-column-frame").each(function(){var parentWidth=$(this).parent().width();var weight=$(this).data("width");var width=Math.floor(weight/12*parentWidth);width=width;$(this).css("width",width);var parentHeight=$(this).parent().height();$(this).css("height",parentHeight)});for(var blockId in teaserBlocks){if(teaserBlocks.hasOwnProperty(blockId)){var layoutInstructions=teaserBlocks[blockId];if(layoutInstructions){if(layoutInstructions.type=="bar-chart"&&horizontalBarChartsTemplates.indexOf(this.config.insight.teaserTemplate)>=0)
layoutInstructions.direction="horizontal";this.helpers.renderBlock(parentEl,layoutInstructions,teaserBlocks.insightId)}}}
var enterKeyCode=13;var spaceKeyCode=32;var me=this;me.teaserClickBind=me.config.widgetType==="inbox-story-widget"?Personetics.bind(this,this.teaserInboxClick):Personetics.bind(this,this.teaserClick);parentEl.find("#"+me.teaserId).bind("click",{userId:me.config.userId,insightId:me.config.insight.id,instanceId:me.config.insight.insightId,lang:me.lang},me.teaserClickBind);parentEl.find("#"+me.teaserId).bind("keydown",{userId:me.config.userId,insightId:me.config.insight.id,instanceId:me.config.insight.insightId,lang:me.lang},function(e){if([enterKeyCode,spaceKeyCode].indexOf(e.which)!==-1){me.teaserClickBind(e)}});parentEl.find('#'+me.teaserId).attr('tabindex',0)};HandlebarsTeaserWidget.prototype.teaserClick=function teaserClick(event){var params={userId:event.data.userId,insightId:event.data.insightId,instanceId:event.data.instanceId,eventType:"teaserClick",lang:event.data.lang,clickedTeaser:$(event.currentTarget),teaserId:this.teaserId};if(typeof personetics!=='undefined'&&personetics!==null&&personetics.hasOwnProperty("sendWidgetEvent"))
personetics.sendWidgetEvent(this,params);else Personetics.utils.PLogger.debug("personetics JS API is not available")},HandlebarsTeaserWidget.prototype.teaserInboxClick=function teaserInboxClick(event){var params={userId:event.data.userId,insightId:event.data.insightId,instanceId:event.data.instanceId,lang:event.data.lang,clickedTeaser:$(event.currentTarget),teaserId:this.teaserId,widget:this.config.widget};if(typeof personetics!=='undefined'&&personetics!==null&&personetics.hasOwnProperty("sendWidgetEvent"))
personetics.sendWidgetEvent(this,params);else Personetics.utils.PLogger.debug("personetics JS API is not available");this.config.widget.startStory(params)},HandlebarsTeaserWidget.prototype.notifyEvent=function(block,eventName,params){Personetics.utils.PLogger.debug("Block: '"+block.layoutInstructions.type+"':'"+block.layoutInstructions.blockId+"' event:'"+event+"' params: "+params)};window.HandlebarsTeaserWidget=HandlebarsTeaserWidget})(window,window.Personetics=window.Personetics||{});(function(window,Personetics,undefined){var Handlebars=Personetics.UI.Handlebars;var filterInbox=function filterInbox(widget){this.parentEl=widget.element;this.widget=widget;this.renderer=Personetics.bind(widget,widget.__proto__.renderTeasers);this.afterRenderer=Personetics.bind(widget,widget.__proto__.afterRender);this.texts={"ttlinboxAll":Personetics.dictionary.getText("ttlinboxAll"),"ttlinboxHighlighted":Personetics.dictionary.getText("ttlinboxHighlighted"),"ttlinboxUnread":Personetics.dictionary.getText("ttlinboxUnread")};var tmpl=Handlebars.templates['filter-inbox-template'];var html=tmpl({"texts":this.texts});this.el=this.parentEl.find(".perso-teaser-filter-wrapper");this.el.append(html);this.afterRender()};filterInbox.prototype.bindEvents=function(){var helper=this;this.el.find(".perso-teaser-filter-tab").bind("click",function(e){helper.onSelectTab($(e.target))})};filterInbox.prototype.onSelectTab=function(selected){var selectedTabId=selected.data("id");this.el.find(".perso-teaser-filter-tab").removeClass('selected');selected.addClass('selected');this.filteredInsights=this.filterInsights(selectedTabId);this.parentEl.find(".perso-multi-teaser-template").empty();if(typeof this.renderer=='function'){this.renderer(this.filteredInsights)}
if(typeof this.afterRenderer=='function'){this.afterRenderer(this.parentEl,this.filteredInsights,selectedTabId)}
if(this.widget.config.hasOwnProperty("callbackOnSuccess")&&typeof this.widget.config.callbackOnSuccess!=="undefined")
{this.widget.config.callbackOnSuccess(this.widget.config)}};filterInbox.prototype.filterInsights=function filterInsights(selectedId){var filteredInsights;var insights=this.widget.insights;if(typeof insights==="undefined"||insights===null)
return[];switch(selectedId){case "all":filteredInsights=insights;break;case "flagged":filteredInsights=insights.filter(function(item){return item.highlighted});break;case "unread":case "new":filteredInsights=insights.filter(function(item){return item.status=="unread"||item.status=="new"});break;default:filteredInsights=insights}
return filteredInsights};filterInbox.prototype.afterRender=function(){this.bindEvents()};filterInbox.prototype.onGetInsights=function(insights){this.insights=insights};window.filterInbox=filterInbox})(window,window.Personetics=window.Personetics||{});(function(window,Personetics,undefined){var HandlebarsMultiTeaserWidget=function HandlebarsMultiTeaserWidget(config){Personetics.Widget.call(this,config)};HandlebarsMultiTeaserWidget.prototype=Object.create(Personetics.Widget.prototype);HandlebarsMultiTeaserWidget.prototype.start=function start(el){Personetics.Widget.prototype.start.call(this,el);el.empty();var me=this;this.renderTitle(el);this.renderWrapper(el);if(this.config.hasOwnProperty('payload')&&typeof(this.config.payload)!=='undefined'&&this.config.payload!==null){this.handlePayload()}else{this.sendGetInsights()}};HandlebarsMultiTeaserWidget.prototype.handlePayload=function handlePayload(){if(this.config.hasOwnProperty('isPayloadEncoded')&&typeof this.config.isPayloadEncoded!=='undefined'&&(this.config.isPayloadEncoded==!0||this.config.isPayloadEncoded=="true")){var decodedPayload=JSON.parse(Personetics.utils.encodeDecode.Base64.decode(this.config.payload));this.insights=decodedPayload.insights}else{this.insights=this.config.payload.insights}
this.onGetInsightsResponse({insights:this.insights})};HandlebarsMultiTeaserWidget.prototype.sendGetInsights=function sendGetInsights(){if(typeof personetics!=='undefined'&&personetics!==null&&personetics.hasOwnProperty("getInboxInsights")){var bankInfo=this.config.bankInfo;this.showLoading();personetics.getInboxInsights(bankInfo,Personetics.bind(this,this.onGetInsightsResponse),Personetics.bind(this,this.onError))}};HandlebarsMultiTeaserWidget.prototype.renderTitle=function renderTitle(el){if(this.config.filter==!0){var inboxTitle=Personetics.dictionary.getText("ttlinbox");var titleHtml='<div class="pstory-title perso-teaser-title">'+'<div aria-live="assertive" role="text" class="pstory-title-text">'+inboxTitle+'</div>'+'<input aria-label="close" type="button" class="pstory-title-close">'+'</div>';el.append(titleHtml);el.append("<div class='perso-teaser-filter-wrapper'></div>");this.filter=new window.filterInbox(this);var newEl=$(titleHtml);var closeEl=$(".pstory-title-close");var widget=this;closeEl.bind("click",function(){widget.closeHandler()});el.attr('aria-label',inboxTitle)}};HandlebarsMultiTeaserWidget.prototype.renderWrapper=function renderWrapper(el){el.append("<div class='perso-multi-teaser-template'></div>");this.parentEl=el;this.el=el.find(".perso-multi-teaser-template").last()};HandlebarsMultiTeaserWidget.prototype.onGetInsightsResponse=function onGetInsightsResponse(json){this.insights=json.insights||json;this.hideLoading();if(this.insights){if(this.insights.length>0){this.renderTeasers(this.insights);this.afterRender(this.parentEl)}
else{this.onEmptyInsights(null,Personetics.dictionary.getText("teasersWidgetNoInsightsText"))}}
else{this.onError(null,Personetics.dictionary.getText("teasersWidgetErrorText"))}};HandlebarsMultiTeaserWidget.prototype.onEmptyInsights=function onEmptyInsights(){this.updateHeight();this.el.empty();var params={textLarge:Personetics.dictionary.getText("noInsigthsTextSecondMsg"),textSmall:Personetics.dictionary.getText("noInsigthsTextFirstMsg"),imgClass:"noInsights"};var html=Personetics.utils.messages.noInsightsMessage(params);this.el.append(html)};HandlebarsMultiTeaserWidget.prototype.onError=function onError(serverError,errorMessage){this.updateHeight();this.el.empty();var params={textLarge:Personetics.dictionary.getText("OhNo"),textSmall:Personetics.dictionary.getText("inboxTechnicalIssues"),imgClass:"errorImage"};var html=Personetics.utils.messages.errorMessage(params);this.el.append(html)};HandlebarsMultiTeaserWidget.prototype.renderTeasers=function renderTeasers(insights){var config=this.config;var el=this.el;var insightIdToDisplay=null;if(config.hasOwnProperty("insightIdToDisplay")){insightIdToDisplay=config.insightIdToDisplay}
if(typeof insights!=="undefined"&&insights!==null){if(insightIdToDisplay!==null){insights.forEach(function(insight,index){if(insight.id==insightIdToDisplay){config.insight=insight;var widget=Personetics.UI.PWidgetFactory.createWidget('teaser-widget-single',config);widget.start(el)}})}
else{insights.forEach(function(insight,index){config.insight=insight;var widget=Personetics.UI.PWidgetFactory.createWidget('teaser-widget-single',config);widget.start(el)})}}};HandlebarsMultiTeaserWidget.prototype.afterRender=function afterRender(el,insights,selectedTabId){this.updateHeight();if(typeof insights!=='undefined'&&insights.length==0){if(selectedTabId==="all"){this.sendGetInsights()}else{var params={text:Personetics.dictionary.getText("nothingToShowHere")};var html=Personetics.utils.messages.noFilteredInsightsMessage(params);this.el.append(html)}}};HandlebarsMultiTeaserWidget.prototype.updateHeight=function updateHeight(){var totalSiblingsHeight=0;var siblings=this.el.siblings();$.each(siblings,function(i,sibling){if($(sibling).is(":visible")){totalSiblingsHeight+=$(sibling).outerHeight(!0)}});this.el.height(this.parentEl.height()-totalSiblingsHeight)}
HandlebarsMultiTeaserWidget.prototype.showLoading=function showLoading(){this.el.append("<div class='perso-loading-wrapper'><div>"+Personetics.dictionary.getText("insightsLoadInsights")+"</div><div class='perso-loading'></div></div>")};HandlebarsMultiTeaserWidget.prototype.hideLoading=function hideLoading(){this.el.find(".perso-loading-wrapper").remove()};HandlebarsMultiTeaserWidget.prototype.closeHandler=function closeHandler(){if(typeof personetics!=='undefined'&&personetics!==null&&personetics.hasOwnProperty("getDeviceType")){var deviceType=personetics.getDeviceType()}
if(deviceType==='web'){}
else{if(typeof personetics!=='undefined'&&personetics!==null){var bridge=personetics.getJSBridge();if(bridge&&($.isFunction(bridge.sessionEnded))){Personetics.utils.PEventReporting.setValue("1");bridge.sessionEnded()}
else Personetics.log("Events Delegate not defined")}}};window.HandlebarsMultiTeaserWidget=HandlebarsMultiTeaserWidget})(window,window.Personetics=window.Personetics||{});(function(window,Personetics,undefined){var HandlebarsMultiTeaserWidgetCarousel=function HandlebarsMultiTeaserWidgetCarousel(config){window.HandlebarsMultiTeaserWidget.call(this,config)};HandlebarsMultiTeaserWidgetCarousel.prototype=Object.create(window.HandlebarsMultiTeaserWidget.prototype);HandlebarsMultiTeaserWidgetCarousel.prototype.start=function start(el){window.HandlebarsMultiTeaserWidget.prototype.start.call(this,el)};HandlebarsMultiTeaserWidgetCarousel.prototype.renderTitle=function renderTitle(el){};HandlebarsMultiTeaserWidgetCarousel.prototype.sendGetInsights=function sendGetInsights(){if(typeof personetics!=='undefined'&&personetics!==null&&personetics.hasOwnProperty("getInsights")){var bankInfo=this.config.bankInfo;this.showLoading();personetics.getInsights(bankInfo,Personetics.bind(this,this.onGetInsightsResponse),Personetics.bind(this,this.onError))}};HandlebarsMultiTeaserWidgetCarousel.prototype.afterRender=function afterRender(el){var $innerWrapperEl=el.find('.perso-multi-teaser-template');window.HandlebarsMultiTeaserWidget.prototype.afterRender.call(this);addCarouselClasses(el);this.bindCarousel(el);addNextAccountForAccessibility(el);this.addSelectedButtonForAccessibility(el);if(this.config.widthMode==='desktop'){$innerWrapperEl.attr("tabindex",0);$innerWrapperEl.find(".carousel-item [tabindex='0']").removeAttr('tabindex');$('#personetics-teaser-widget-carousel').find('#perso-teaser-acc-button, .perso-next-button').attr('tabindex',-1)}};HandlebarsMultiTeaserWidgetCarousel.prototype.renderWrapper=function renderWrapper(el){window.HandlebarsMultiTeaserWidget.prototype.renderWrapper.call(this,el);var $innerWrapperEl=el.find('.perso-multi-teaser-template');$innerWrapperEl.wrap('<div class="carousel-animate carousel-wrapper"></div>');$innerWrapperEl.addClass('carousel-inner-wrapper')};var addNextAccountForAccessibility=function addNextAccountForAccessibility(el){var container=el;var nextAccText="click to select next teaser";var nextAccButton=$('<input type="button" class="perso-next-button" aria-label="'+nextAccText+'" />')
container.append(nextAccButton);var nextTeaser=el.find('.carousel-item.selected:not([clone="true"])').next();if(nextTeaser.length==0)
return;var top=nextTeaser.offset().top-container.offset().top;var left=nextTeaser.offset().left-container.offset().left;var visibleHeight=Math.min(nextTeaser.height(),container.height()-top);var visibleWidth=Math.max(10,container.width()-left);nextAccButton.css({'top':top,'left':left,'height':visibleHeight,'width':visibleWidth,'position':'absolute','background':'transparent','border':'none','outline':'none'});container.css('position','relative');nextAccButton.siblings().css({'position':'relative'});bindEventsForAccButton(el,nextAccButton)};var bindEventsForAccButton=function bindEventsForAccButton(el,nextAccButton){nextAccButton.bind('click',function(){var nextTeaser=el.find('.carousel-item.selected:not([clone="true"])').next();if(nextTeaser.length==0)
nextTeaser=el.find('.carousel-item.selected:not([clone="true"])').prev();nextTeaser.click()})};HandlebarsMultiTeaserWidgetCarousel.prototype.addSelectedButtonForAccessibility=function addSelectedButtonForAccessibility(el){var container=el;var selectedTeaser=el.find('.carousel-item.selected:not([clone="true"])');var teaserAccButton=$('<input id="perso-teaser-acc-button" type="button" class="account-button selected perso-teaser-acc-button"/>');container.append(teaserAccButton);if(selectedTeaser.length==0)
return;this.setSelectedAccButtonLabel();var top=selectedTeaser.offset().top-container.offset().top;var left=selectedTeaser.offset().left-container.offset().left;var visibleHeight=Math.min(selectedTeaser.height(),container.height()-top);var visibleWidth=Math.max(10,container.width()-left);teaserAccButton.css({'top':top,'left':left,'height':visibleHeight,'width':visibleWidth,'position':'absolute','background':'transparent','border':'none','outline':'none'});container.css('position','relative');teaserAccButton.siblings().css({'position':'relative'});bindEventsForTeaserAccButton(el,teaserAccButton)};HandlebarsMultiTeaserWidgetCarousel.prototype.setSelectedAccButtonLabel=function setSelectedAccButtonLabel(){el=this.parentEl
var selectedTeaser=el.find('.carousel-item.selected:not([clone="true"])');var selectedTeaserId=selectedTeaser.attr('pstory-id');el.find('#perso-teaser-acc-button').attr('aria-labelledby',selectedTeaserId)};var bindEventsForTeaserAccButton=function bindEventsForTeaserAccButton(el,teaserAccButton){teaserAccButton.bind('click',function(){selectedTeaserId=teaserAccButton.attr('aria-labelledby');var selectedTeaser=el.find('#'+selectedTeaserId);selectedTeaser.click()})};var addCarouselClasses=function addCarouselClasses(el){var $teaserTemplateElms=el.find('.perso-teaser-template');var carouselItemTemplate='<div class="carousel-item" role="button"></div>';$teaserTemplateElms.each(function(){$(this).wrap(carouselItemTemplate);var pstoryId=$(this).attr('id');$(this).parent().attr('pstory-id',pstoryId)})};HandlebarsMultiTeaserWidgetCarousel.prototype.bindCarousel=function bindCarousel(el){var param=getOptionsWidth(el);param.afterCarouselEnd=Personetics.bind(this,this.setSelectedAccButtonLabel);this.carouselAnimation=new Personetics.utils.carouselAnimation.bindCarouselEventsForAnimation(el,param)};var getOptionsWidth=function getOptionsWidth(el){var container=el.find('.perso-multi-teaser-template');var teaserWidth=container.find('.carousel-item').outerWidth(!0);return{itemWidth:teaserWidth,selectedItemWidth:teaserWidth,numItemsDispaly:container.children().length}};window.HandlebarsMultiTeaserWidgetCarousel=HandlebarsMultiTeaserWidgetCarousel})(window,window.Personetics=window.Personetics||{});(function(window,Personetics,undefined){var Handlebars=Personetics.UI.Handlebars;var filterInboxStory=function filterInboxStory(widget){this.parentEl=widget.element;this.widget=widget;this.renderer=Personetics.bind(widget,widget.__proto__.renderTeasers);this.afterRenderer=Personetics.bind(widget,widget.__proto__.afterRender);this.texts={"ttlinboxAll":Personetics.dictionary.getText("ttlinboxAll"),"ttlinboxHighlighted":Personetics.dictionary.getText("ttlinboxHighlighted"),"ttlinboxUnread":Personetics.dictionary.getText("ttlinboxUnread")};var tmpl=Handlebars.templates['filter-inbox-template'];var html=tmpl({"texts":this.texts});this.el=this.parentEl.find(".perso-teaser-filter-wrapper");this.el.append(html);this.afterRender()};filterInboxStory.prototype.bindEvents=function(){var enterKeyCode=13;var spaceKeyCode=32;var helper=this;this.el.find(".perso-teaser-filter-tab").bind("click",function(e){helper.onSelectTab($(e.target))});this.el.find(".perso-teaser-filter-tab").bind("keydown",function(e){if(([enterKeyCode,spaceKeyCode].indexOf(e.which)!==-1)){helper.onSelectTab($(e.target))}})};filterInboxStory.prototype.onSelectTab=function(selected){if(selected.hasClass("selected"))
{return}
var selectedTabId=selected.data("id");var $previousSelectedTab=this.el.find(".perso-teaser-filter-tab");$previousSelectedTab.removeClass('selected');$previousSelectedTab.attr('aria-selected',!1);selected.addClass('selected');selected.attr('aria-selected',!0);var filteredInsights=this.filterInsights(selectedTabId);this.parentEl.find(".perso-multi-teaser-template").empty();if(typeof this.renderer=='function'){this.renderer(filteredInsights)}
if(typeof this.afterRenderer=='function'){this.afterRenderer(this.parentEl,selectedTabId)}};filterInboxStory.prototype.filterInsights=function filterInsights(selectedId){var filteredInsights;var insights=this.widget.insights;if(typeof insights==="undefined"||insights===null)
return[];switch(selectedId){case "all":filteredInsights=insights;break;case "flagged":filteredInsights=insights.filter(function(item){return item.highlighted});break;case "unread":case "new":filteredInsights=insights.filter(function(item){return item.status=="unread"||item.status=="new"});break;default:filteredInsights=insights}
return filteredInsights};filterInboxStory.prototype.afterRender=function(){this.parentEl.find('.perso-teaser-filter-wrapper ul').children().each(function(i){$(this).attr('tabindex',0)});this.bindEvents()};filterInboxStory.prototype.onGetInsights=function(insights){this.insights=insights};filterInboxStory.prototype.updateInsight=function(insightId){if(typeof this.widget.insights!=="undefined"&&this.widget.insights.length){var insight;if(insightId){insight=this.widget.insights.filter(function(ins){return ins.id===insightId})}
insight=(insight&&insight.length>0)?insight[0]:this.widget.insights[0];insight.status="read";return insight.id}};window.filterInboxStory=filterInboxStory})(window,window.Personetics=window.Personetics||{});(function(window,Personetics,Handlebars,undefined){var HandlebarsTeaserInboxAndStoryWidget=function HandlebarsTeaserInboxAndStoryWidget(config){Personetics.Widget.call(this,config)};HandlebarsTeaserInboxAndStoryWidget.prototype=Object.create(window.Personetics.Widget.prototype);HandlebarsTeaserInboxAndStoryWidget.prototype.start=function start(el){var inboxContent=Handlebars.templates[this.config.templateId?this.config.templateId:'inboxContainer'];el.append(inboxContent);inboxContainerEl=el.find("#personetics-inbox-container");this.config.story.el=el.find("#personetics-story");Personetics.Widget.prototype.start.call(this,inboxContainerEl);inboxContainerEl.empty();if(typeof teaserData!=="undefined"){this.config.payload=teaserData}
this.renderTitle(inboxContainerEl);Personetics.utils.accessibility.trackFocus(inboxContainerEl.find(".perso-teaser-filter-wrapper"));this.renderWrapper(inboxContainerEl);if(this.config.hasOwnProperty('payload')&&typeof(this.config.payload)!=='undefined'&&this.config.payload!==null){this.handlePayload()}else{this.sendGetInsights()}
this.updateHeight()};HandlebarsTeaserInboxAndStoryWidget.prototype.handlePayload=function handlePayload(){if(this.config.hasOwnProperty('isPayloadEncoded')&&typeof this.config.isPayloadEncoded!=='undefined'&&(this.config.isPayloadEncoded==!0||this.config.isPayloadEncoded=="true")){var decodedPayload=JSON.parse(Personetics.utils.encodeDecode.Base64.decode(this.config.payload));this.insights=decodedPayload.insights}else{this.insights=this.config.payload.insights}
this.onGetInsightsResponse({insights:this.insights})};HandlebarsTeaserInboxAndStoryWidget.prototype.sendGetInsights=function sendGetInsights(){if(typeof personetics!=='undefined'&&personetics!==null&&personetics.hasOwnProperty("getInboxInsights")){var bankInfo=this.config.bankInfo;this.showLoading();var me=this;personetics.getInboxInsights(bankInfo,Personetics.bind(this,me.onGetInsightsResponse),Personetics.bind(this,me.onError))}};HandlebarsTeaserInboxAndStoryWidget.prototype.renderTitle=function renderTitle(el){if(this.config.filter==!0){var inboxTitle=Personetics.dictionary.getText("ttlinboxstory");var titleHtml='<div class="pstory-title perso-teaser-title">'+'<div aria-live="assertive" role="text" class="pstory-title-text">'+inboxTitle+'</div>'+'<input aria-label="close" type="button" class="pstory-title-close" tabindex="0">'+'</div>';el.append(titleHtml);el.append("<div class='perso-teaser-filter-wrapper'></div>");this.filter=new window.filterInboxStory(this);var newEl=$(titleHtml);var closeEl=$(".pstory-title-close");var widget=this;closeEl.bind("click",function(){widget.closeHandler()});el.attr('aria-label',inboxTitle)}};HandlebarsTeaserInboxAndStoryWidget.prototype.renderWrapper=function renderWrapper(el){el.closest(".personetics-widgets-wrapper").addClass("personetics-widgets-insights-inbox-wrapper");el.append("<div class='perso-multi-teaser-template'></div>");this.parentEl=el;this.el=el.find(".perso-multi-teaser-template").last()};HandlebarsTeaserInboxAndStoryWidget.prototype.onGetInsightsResponse=function onGetInsightsResponse(json){this.insights=json.insights||json;this.hideLoading();if(this.insights){if(this.insights.length>0){this.renderTeasers(this.insights);this.afterRender(this.parentEl)}
else{this.onEmptyInsights()}}
else{this.onError(null,Personetics.dictionary.getText("inboxTechnicalIssues"))}};HandlebarsTeaserInboxAndStoryWidget.prototype.onEmptyInsights=function(){this.el.empty();var params={textLarge:Personetics.dictionary.getText("noInsigthsTextSecondMsg"),textSmall:Personetics.dictionary.getText("There are no insights for you right now"),imgClass:"errorImage"};var html=Personetics.utils.messages.noInsightsMessage(params);this.el.append(html)}
HandlebarsTeaserInboxAndStoryWidget.prototype.onError=function onError(serverError,errorMessage){this.updateHeight();this.el.empty();var params={textLarge:Personetics.dictionary.getText("OhNo"),textSmall:Personetics.dictionary.getText("inboxTechnicalIssues"),imgClass:"errorImage"};var html=Personetics.utils.messages.errorMessage(params);this.el.append(html)};HandlebarsTeaserInboxAndStoryWidget.prototype.renderTeasers=function renderTeasers(insights){var config=this.config;var el=this.el;var me=this;var insightIdToDisplay=null;if(config.hasOwnProperty("insightIdToDisplay")){insightIdToDisplay=config.insightIdToDisplay}
if(typeof insights!=="undefined"&&insights!==null){if(insightIdToDisplay!==null){insights.forEach(function(insight,index){if(insight.id==insightIdToDisplay){config.insight=insight;config.widget=me;var widget=Personetics.UI.PWidgetFactory.createWidget('teaser-widget-single',config);widget.start(el)}})}
else{insights.forEach(function(insight,index){config.insight=insight;config.widget=me;var widget=Personetics.UI.PWidgetFactory.createWidget('teaser-widget-single',config);widget.start(el)})}}};HandlebarsTeaserInboxAndStoryWidget.prototype.afterRender=function afterRender(el,selectedTabId){Personetics.utils.accessibility.trackFocus(this.el);this.updateHeight();if(this.el.children().length){if(typeof selectedTabId!=="undefined")
{this.startStory()}
else{this.setSelected(this.config.story.teaserId);this.startStory(this.config.story)}}
else{if(selectedTabId==="all"){if(this.config.hasOwnProperty('payload')&&typeof(this.config.payload)!=='undefined'&&this.config.payload!==null){this.handlePayload()}else{this.sendGetInsights()}}
else{var params={text:Personetics.dictionary.getText("nothingToShowHere")};var html=Personetics.utils.messages.noFilteredInsightsMessage(params);this.el.append(html);this.config.story.el.empty()}}};HandlebarsTeaserInboxAndStoryWidget.prototype.updateHeight=function updateHeight(){var totalSiblingsHeight=0;var siblings=this.el.siblings();$.each(siblings,function(i,sibling){if($(sibling).is(":visible")){totalSiblingsHeight+=$(sibling).outerHeight(!0)}});this.el.find(".perso-teaser-template").each(function(){var elem=$(this);elem.prepend("<div class='perso-teaser-overlay'></div>")});this.el.height(this.config.el.height()-totalSiblingsHeight-parseInt(this.el.css('margin-top'),10)-7)}
HandlebarsTeaserInboxAndStoryWidget.prototype.startStory=function startStory(params){if(!params)
{this.loadFirstTeaserStory()}
else{if(this.config.filter){params.insightId=this.filter.updateInsight(params.insightId);if(!params.instanceId){for(var i=0;i<this.insights.length;i++){if(this.insights[i].id===params.insightId){params.instanceId=this.insights[i].insightId}}}
params.teaserId=params.teaserId||"perso-teaser-template_"+params.insightId;this.updateSelectTeasers(params.teaserId);for(key in params){if(typeof params[key]!=="undefined"){this.config.story[key]=params[key]}}}
personetics.startWidget(this.config.story)}};HandlebarsTeaserInboxAndStoryWidget.prototype.updateSelectTeasers=function updateSelectTeasers(insightId)
{className="selected";var teaserObj=this.el.find("#"+insightId);if(teaserObj.length){if(!teaserObj.hasClass(className)){var teasers=this.el.find(".perso-teaser-template.selected");$.each(teasers,function(i,teaser){$(teaser).removeClass(className)});teaserObj.addClass(className)}
this.scrollIntoView(teaserObj.get(0))}
else{this.loadFirstTeaserStory()}};HandlebarsTeaserInboxAndStoryWidget.prototype.setSelected=function setSelected(teaserId)
{if(teaserId===null){var teaserObj=el.find(".perso-teaser-template").eq(0);if(teaserObj.length)
{teaserObj.click()}
else{$("#personetics-story").empty()}}
else{var teaserObj=this.el.find("#"+teaserId);if(teaserObj.length){teaserObj.addClass("selected")
this.scrollIntoView(teaserObj.get(0))}
else{this.config.story.el.empty()}}};HandlebarsTeaserInboxAndStoryWidget.prototype.loadFirstTeaserStory=function loadFirstTeaserStory()
{var teaserObj=this.el.find(".perso-teaser-template").eq(0);if(teaserObj.length)
{teaserObj.click()}
else{$("#personetics-story").empty()}};HandlebarsTeaserInboxAndStoryWidget.prototype.scrollIntoView=function scrollIntoView(e){if(this.isInViewport(e))
{return}
$('.perso-multi-teaser-template').animate({scrollTop:$(e).offset().top},1000)}
HandlebarsTeaserInboxAndStoryWidget.prototype.isInViewport=function isInViewport(element){var rect=element.getBoundingClientRect();var html=document.documentElement;return(rect.top>=40&&rect.left>=0&&rect.bottom<=(window.innerHeight||html.clientHeight)&&rect.right<=(window.innerWidth||html.clientWidth))}
HandlebarsTeaserInboxAndStoryWidget.prototype.showLoading=function showLoading(){this.el.append("<div class='perso-loading-wrapper'><div>"+Personetics.dictionary.getText("insightsLoadInsights")+"</div><div class='perso-loading'></div></div>")};HandlebarsTeaserInboxAndStoryWidget.prototype.hideLoading=function hideLoading(){this.el.find(".perso-loading-wrapper").remove()};HandlebarsTeaserInboxAndStoryWidget.prototype.closeHandler=function closeHandler(){this.config.story&&this.config.story.el.empty()
if(typeof personetics!=='undefined'&&personetics!==null&&personetics.hasOwnProperty("getDeviceType")){var deviceType=personetics.getDeviceType()}
if(deviceType==='web'){}
else{if(typeof personetics!=='undefined'&&personetics!==null){var bridge=personetics.getJSBridge();if(bridge&&($.isFunction(bridge.sessionEnded))){bridge.sessionEnded()}
else Personetics.log("Events Delegate not defined")}}};HandlebarsTeaserInboxAndStoryWidget.prototype.teaserClick=function teaserClick(event){var eventType=this.config!=="undefined"&&this.config.hasOwnProperty("eventType")&&typeof this.config.eventType!=="undefined"?this.config.eventType:"teaserClick";var params={userId:event.data.userId,insightId:event.data.insightId,instanceId:event.data.instanceId,eventType:eventType,lang:event.data.lang,clickedTeaser:$(event.currentTarget),teaserId:this.teaserId};Personetics.utils.PEventReporting.setValue({"instanceId":params.insightId,"insightId":params.instanceId,"userId":event.data.userId});if(typeof personetics!=='undefined'&&personetics!==null&&personetics.hasOwnProperty("sendWidgetEvent"))
personetics.sendWidgetEvent(this,params);else console.log("personetics JS API is not available")};window.HandlebarsTeaserInboxAndStoryWidget=HandlebarsTeaserInboxAndStoryWidget})(window,window.Personetics=window.Personetics||{},Personetics.UI.Handlebars);(function(window,Personetics,$,undefined){Personetics.UI=Personetics.UI||{};Personetics.UI.PLoadingAnimationCtrl=Personetics.UI.PWidgetCtrl.extend({initialize:function(config){this.super=Personetics.UI.PWidgetCtrl.prototype;this.super.initialize.call(this,config);this.loadingText=this.getLoadingTxt(config)},getLoadingTxt:function getLoadingTxt(config){return config.loadingText},start:function(el){this.el=el;this.el.empty();var loadingText=this.loadingText;var loadingTmpl=this.getTemplateHtml("#tmpl-perso-loading-animation",{loadingText:loadingText});el.append(loadingTmpl);this.afterRender()},afterRender:function afterRender(){this.setHeightToParentSpace()},setHeightToParentSpace:function setHeightToParentSpace(){var parentEl=this.el.parent();var parentHeight=parentEl.height();var totalSiblingsHeight=0;var siblings=this.el.siblings();$.each(siblings,function(index,item){if($(item).css("position")=="static")
totalSiblingsHeight+=$(item).height()})
var loadingHeight=parentHeight-totalSiblingsHeight;this.el.find("#perso-loading-widget").height(loadingHeight)},removeLoading:function renderLoading(){var loadingEl=this.el.children("#perso-loading-widget");loadingEl.remove()}})})(window,window.Personetics=window.Personetics||{},jQuery);(function(window,Personetics,$,undefined){Personetics.UI=Personetics.UI||{};Personetics.UI.PRatingCtrlCITI=Personetics.UI.PRatingCtrl.extend({showFeedback:function showFeedback(){Personetics.UI.PRatingCtrl.prototype.showFeedback.call(this);var submit=$(this.el.find('.perso-feedback-submit'));submit.css('margin-left','0');this.el.find('.perso-feedback-submit').show()},feedbackTextInput:function feedbackTextInput(e){var sendButton=$(this.el).find('.perso-feedback-submit');if(e.target.value.length>0){sendButton.removeAttr('disabled');sendButton.removeClass("disabled-button")}
else{if(sendButton.length>0){sendButton.attr('disabled','disabled');sendButton.addClass("disabled-button")}}
Personetics.UI.PRatingCtrl.prototype.feedbackTextInput.call(this,e)},scrollToEnd:function scrollTo(el,toElement){el=$("#personetics-story-widget");if(toElement.length>0){$(el).animate({scrollTop:toElement.offset().top-el.offset().top+el.scrollTop()},500)}},feedbackStart:function feedbackStart(){if(Personetics.projectConfiguration.getConfig("showFeedback")==!0){if(!this.disableFeedBack){this.showFeedback()}
else{if($(this.el.find('.perso-feedback-text')).length>0){var lblfeedbackprompt=Personetics.dictionary.getText("lblfeedbackprompt"+this.eventObj.rating);$(this.el.find('.perso-feedback-label')).text(lblfeedbackprompt)}}}},showFeedbackReaction:function showFeedbackReaction(){var widget=this;var height=$(this.el.find('.perso-feedback-wrapper')).height();$(this.el.find('.perso-feedback-wrapper')).height(height);var element=this.el.find('.perso-feedback-reaction');$(element).show();var heightreaction=$(this.el.find('.perso-feedback-reaction')).outerHeight();$('.perso-feedback-wrapper').animate({'scrollTop':200,'height':heightreaction},400,function(){widget.disableFeedBack=!1;$(".textarea-wrapper").hide()})}})})(window,window.Personetics=window.Personetics||{},jQuery);(function(window,Personetics,$,undefined){Personetics.UI=Personetics.UI||{};Personetics.UI.PLoadingAnimationCtrlCITI=Personetics.UI.PLoadingAnimationCtrl.extend({getLoadingTxt:function getLoadingTxt(){return Personetics.dictionary.getText("loadingMassage")},})})(window,window.Personetics=window.Personetics||{},jQuery);(function(window,Personetics,$,undefined){Personetics.story=Personetics.story||{};Personetics.story.ProductSkinControler=Personetics.story.PSkinControler.extend({registerWidgets:function(){this.registerDefaultWidgets();Personetics.UI.PWidgetFactory.registerWidget("app-ctrl",{widgetClass:Personetics.UI.PAppCtrlProduct,widgetName:"Product app ctrl"});Personetics.UI.PWidgetFactory.registerWidget("master",{widgetClass:Personetics.UI.PAppCtrlProduct,widgetName:"Product master"});Personetics.UI.PWidgetFactory.registerWidget("master-teaser",{widgetClass:Personetics.UI.PAppTeaserCtrl,widgetName:"Product master teaser"});Personetics.UI.PWidgetFactory.registerWidget("story-widget",{widgetClass:Personetics.UI.PStoryWidgetCtrlProduct,widgetName:"Product story widget"});Personetics.UI.PWidgetFactory.registerWidget("inbox-story-widget",{widgetClass:window.HandlebarsTeaserInboxAndStoryWidget,widgetName:"Product inbox and story widget"});Personetics.UI.PWidgetFactory.registerWidget("teaser-widget-single",{widgetClass:window.HandlebarsTeaserWidget,widgetName:"Product single teaser widget"});Personetics.UI.PWidgetFactory.registerWidget("teaser-widget",{widgetClass:window.HandlebarsMultiTeaserWidget,widgetName:"Product teaser widget"});Personetics.UI.PWidgetFactory.registerWidget("teaser-widget-carousel",{widgetClass:window.HandlebarsMultiTeaserWidgetCarousel,widgetName:"Product teaser widget"});Personetics.UI.PWidgetFactory.registerWidget("ratings",{widgetClass:Personetics.UI.PRatingCtrlDesktop,widgetName:"Desktop ratings",widthMode:"desktop"})},registerBlocks:function(){Personetics.story.PSkinControler.prototype.registerBlocks.call(this);this.registerBlock("account-selector",{blockClass:Personetics.story.AccountSelectorBlockProduct});this.registerBlock("account-selector",{widthMode:"desktop",blockClass:Personetics.story.AccountSelectorBlockProductDesktop});this.registerBlock("buttons",{blockClass:Personetics.story.ButtonsBlockProduct});this.registerBlock("pie-chart",{blockClass:Personetics.story.PieChartBlockProduct});this.registerBlock("arc-chart",{blockClass:Personetics.story.PieChartBlockProduct});this.registerBlock("pie-chart",{widthMode:"desktop",blockClass:Personetics.story.PieChartBlockProductDesktop});this.registerBlock("bar-chart",{blockClass:Personetics.story.D3BarChartBlockProduct});this.registerBlock("bar-chart",{widthMode:"desktop",blockClass:Personetics.story.D3BarChartBlockProductDesktop});this.registerBlock("pin-graph",{blockClass:Personetics.story.D3PinGraphChartBlockProduct});this.registerBlock("pin-graph",{widthMode:"desktop",blockClass:Personetics.story.D3PinGraphChartBlockProductDesktop});this.registerBlock("line-chart",{blockClass:Personetics.story.DotsLineChartBlock});this.registerBlock("line-chart",{widthMode:"desktop",blockClass:Personetics.story.DotsLineChartBlockDesktop});this.registerBlock("table",{blockClass:Personetics.story.TableBlockProduct});this.registerBlock("tranList",{blockClass:Personetics.story.TableBlockProduct});this.registerChartHelper("verticalHelper",{helperClass:Personetics.utils.d3Helpers.VerticalChartHelperProduct});this.registerChartHelper("multiVerticalHelper",{helperClass:Personetics.utils.d3Helpers.MultiVerticalChartHelperDesktop,widthMode:"desktop"});this.registerChartHelper("pinGraphHelper",{helperClass:Personetics.utils.d3Helpers.PinGraphChartHelperProduct});this.registerChartHelper("collapseHelper",{helperClass:Personetics.story.CollapseHelper})},getScreenOptions:function(){return{ratio_medium:1.17,ratio_large:1.3}},getValueByScreenWidth:function(value){var screenWidth=$(window).width();var screenOptions=this.getScreenOptions();var returnValue=value;if(screenWidth>=414){returnValue=value*screenOptions.ratio_large}else if(screenWidth>=347){returnValue=value*screenOptions.ratio_medium}
return returnValue},getDesktopScreenWidth:function(){return 790},getCollapseOptions:function(){var screenWidth=$(window).width();var screenOptions=this.getScreenOptions();var displayedHeight;if(screenWidth<347){displayedHeight=70}else if(screenWidth>=414){displayedHeight=70*screenOptions.ratio_large}else{displayedHeight=70*screenOptions.ratio_medium}
return{"displayedHeight":displayedHeight}},getColumnChartOptions:function(){var options={maxBarHeight:99,svgHeight:200,svgWidth:320,labelTop:27,barTop:41,xAxisTop:170,yAxisHeight:128,yAxisTop:20,yAxisLineDisplay:!0,yAxisTextDisplay:!1,negativeYAxisTop:181,negativeBarTop:190,horizontalLineWidth:281,horizontalLineLeft:20,screen:{ratio_medium:1.17,ratio_large:1.3},margin:{top:43,bottom:40},height:180,chart:{transX:0,transY:10},labels:{drawLabels:!0,marginBottom:18,marginTop:-10},rectangles:{width:16,space:33,minHeightPercent:0.15,borderRadius:{rx:9,ry:9},marginFromBottom:15,marginFromLeft:0,gradients:[{id:"selectedGradient",offset:["0%","100%"],stopColors:["#6888d2","#536fb1"]}],filter:{dropShadow:{id:"dropShadow",in:"SourceGraphic",stdDeviation:3,dxOffset:1,dyOffset:2}},transition:{duration:1000,delay:500}},selected:{},axis:{translation:{x:0,y:"height"},xAxis:{hide:!1,collapsedPadding:{top:22,bottom:15}},yAxis:{x:0,y:0,hide:!0}}};return options},getPinGraphChartOptions:function(){var options={svgHeight:200,svgWidth:281,maxBarHeight:112,labelTop:12,barTop:27,xAxisTop:170,yAxisHeight:128,yAxisTop:20,yAxisLineDisplay:!0,yAxisTextDisplay:!1,screen:{ratio_medium:1.17,ratio_large:1.3},margin:{top:43,bottom:40},height:180,chart:{transX:0,transY:10},totalHeight:220,labels:{drawLabels:!0,marginBottom:18,marginTop:4.5},rectangles:{minHeightPercent:0.15,width:9,space:40,borderRadius:{rx:4,ry:4},marginFromBottom:15,gradients:{selectedGradient:{id:"selectedGradient",offset:["0%","100%"],stopColors:["#6888d2","#536fb1"]}},filter:{dropShadow:{id:"dropShadow",in:"SourceGraphic",stdDeviation:3,dxOffset:1,dyOffset:2}},transition:{duration:1000,delay:500}},selected:{},axis:{translation:{x:0,y:"height"},xAxis:{hide:!1,tickPadding:10,collapsedPadding:{top:22,bottom:15}},yAxis:{x:0,y:0,hide:!0}}};return options},getColumnChartMultiSeriesOptions:function(){var options={svgHeight:200,svgWidth:313,maxBarHeight:93,labelTop:45,nextLabelTop:14,barTop:56,xAxiaTop:170,verticalLineTop:20,lineHeight:130,drowVerticalLines:!0,yAxisDisplay:!1,screen:{ratio_medium:1.17,ratio_large:1.3},margin:{top:34,right:24,bottom:72,left:24},totalHeight:220,labels:{drawLabels:!0,marginTop:-16,marginBottom:4,right:2},rectangles:{width:9,space:41,paddingTop:30,paddingLeft:-19,paddingRight:22,paddingBottom:33,seriesPadding:12.5,transX:4,minHeight:0.25,borderRadius:{rx:4,ry:4},marginFromBottom:5,gradients:{selectedInGradient:{id:"selectedInGradient",offset:["0%","100%"],stopColors:["#7193e2","#485f96"]},selectedOutGradient:{id:"selectedOutGradient",offset:["0%","100%"],stopColors:["#ffcc00","#ffb80a"]}},filter:{dropShadow:{id:"dropShadow",in:"SourceGraphic",stdDeviation:3,dxOffset:1,dyOffset:2}},transition:{duration:1000,delay:500}},selected:{},axis:{translation:{x:2.5,y:"height"},xAxis:{hide:!1,tickPadding:10,minimizedPadding:{top:22,bottom:15}}}};return options},getDotsLineChartOptions:function(){var options={screen:{ratio_medium:1.17,ratio_large:1.3},svgHeight:200,svgWidth:320,line_left:59,line_top:20,line_width:227,line_height:130,area_display:!1,lineStyle_interpolate:'cardinal',lineStyle_thickness:3,xAxis_line_y:20,xAxis_line_x:63,xAxis_line_height:130,xAxis_text_y:171,xAxis_text_x:57,xAxis_display:!0,yAxis_x:47,yAxis_y:20,yAxis_display:!0,duration:2000,dots_radius:4.5,dots_radius_selected:5,labels_x:59,labels_y:8.3,labels_display:!0,horizonalLine_x:0,horizonalLine_length:308,horizonalLine_y:100,horizonalLine_display:!1,highlightBy:'last'}
return options},getDotsLineChartOptionsDesktop:function(){var options={screen:{ratio_medium:1.17,ratio_large:1.3},svgHeight:404,svgWidth:790,line_left:89,line_top:105,line_width:611,line_height:162,area_display:!1,lineStyle_interpolate:'cardinal',lineStyle_thickness:4,xAxis_line_y:47,xAxis_line_x:89,xAxis_line_height:257,xAxis_text_y:339,xAxis_text_x:93,xAxis_display:!0,yAxis_x:47,yAxis_y:20,yAxis_display:!1,duration:2000,dots_radius:5,dots_radius_selected:9,labels_x:91,labels_y:24.31,labels_display:!0,horizonalLine_display:!1,highlightBy:'last'}
return options},getBarChartOptions:function(){var options={screen:{ratio_medium:1.17,ratio_large:1.3},margin:{top:22,bottom:0},drawLabels:!0,rectangles:{height:13,width:281,color:"rgba(169, 167, 167, 1)",paddingTop:-28,paddingBottom:10,seriesPadding:3,borderRadius:{rx:6,ry:6},gradients:{selectedGradient:{id:"selectedGradient",offset:["0%","100%"],stopColors:["#6888d2","#536fb1"]}},filter:{dropShadow:{id:"dropShadow",in:"SourceGraphic",stdDeviation:3,dxOffset:1,dyOffset:2}}},labels:{minWidth:100,},selected:{},axis:{xAxis:{hide:!0},yAxis:{hide:!1,transValue:-20}}};return options},getBarGraphPalette:function(){return['rgba(169, 167, 167, 1)','url(#selectedGradient)']},getBarGraphLabelsPalette:function(){return['rgba(40, 36, 37, 1)','rgba(84, 113, 180, 1)']},getMultiVerticalPalette:function(){return['rgba(183, 183, 183, 1)','rgba(215, 215, 215, 1)']},getMultiVerticalLabelsPalette:function(){return['rgba(147, 145, 149, 1)','rgba(40, 36, 37, 1)']},getPieGraphPalette:function(selectedTabId){var outFlowsPalette=['#ffce40','#ffb608','#ff9819','#fe7d3f','#f9652b','#df4c3a','#c72735'];var inFlowsPalette=['#6787d1','#027ac4','#7390c5','#3095bd','#45a5d3','#5acafa','#95dafb'];if(selectedTabId=="Out")
return outFlowsPalette;return inFlowsPalette},getPieOptions:function(){var options={arcs:{selctedPrimaryColor:null,selectedInflowPrimaryColor:null,selectedOutflowPrimaryColor:null,filter:{grayFilter:!0},cornerRadius:{radiusCorner:9},padAngle:0.04}}
return options},getPieOptionsDesktop:function(){var options={arcs:{selctedPrimaryColor:null,selectedInflowPrimaryColor:null,selectedOutflowPrimaryColor:null,filter:{grayFilter:!0},cornerRadius:{radiusCorner:9},padAngle:-0.02},drawCenterLine:!0,centerLineWidth:100}
return options},getPinGraphChartOptionsDesktop:function(){var options={isDesktop:!0,maxBarHeight:177,svgHeight:404,svgWidth:730,labelTop:90,barTop:114,xAxisTop:340,yAxisHeight:255,yAxisTop:47,yAxisLineDisplay:!0,yAxisTextDisplay:!1,screen:{ratio_medium:1.17,ratio_large:1.3},margin:{top:120,bottom:117},chart:{transX:0,transY:10},labels:{drawLabels:!0},rectangles:{width:14,space:89,borderRadius:{rx:6,ry:6},gradients:[{id:"selectedGradient",offset:["0%","100%"],stopColors:["#6888d2","#536fb1"]}],filter:{dropShadow:{id:"dropShadow",in:"SourceGraphic",stdDeviation:3,dxOffset:1,dyOffset:2}},transition:{duration:1000,delay:500}},selected:{},axis:{translation:{x:0,y:"height"},xAxis:{hide:!1,collapsedPadding:{top:22,bottom:15}}}};return options},getColumnChartOptionsDesktop:function(){var options={isDesktop:!0,maxBarHeight:150,svgHeight:404,svgWidth:730,labelTop:118,barTop:137,xAxisTop:340,yAxisHeight:253,yAxisTop:49,yAxisLineDisplay:!0,yAxisTextDisplay:!1,screen:{ratio_medium:1.17,ratio_large:1.3},chart:{transX:0,transY:10},labels:{drawLabels:!0},rectangles:{width:18,space:87,borderRadius:{rx:9,ry:9},gradients:[{id:"selectedGradient",offset:["0%","100%"],stopColors:["#6888d2","#536fb1"]}],filter:{dropShadow:{id:"dropShadow",in:"SourceGraphic",stdDeviation:3,dxOffset:1,dyOffset:2}},transition:{duration:1000,delay:500}},selected:{},axis:{translation:{x:0,y:"height"},xAxis:{hide:!1,collapsedPadding:{top:22,bottom:15}},yAxis:{x:0,y:0,hide:!0}}};return options},getColumnChartMultiSeriesOptionsDesktop:function(){var options={svgHeight:404,svgWidth:730,maxBarHeight:180,labelTop:80,nextLabelTop:21,barTop:107,xAxiaTop:340,yAxisTop:49,yAxisHeight:253,spaceLeft:30,yAxisLineDisplay:!0,yAxisTextDisplay:!1,drowVerticalLines:!1,accessHiddenRectMarginLeft:0,accessHiddenRectMarginTop:43,screen:{ratio_medium:1.17,ratio_large:1.3},chart:{transX:0,transY:0},labels:{drawLabels:!0,right:6},rectangles:{width:18,space:57,seriesPadding:12.5,paddingRight:25,transX:4,borderRadius:{rx:9,ry:9},gradients:{selectedInGradient:{id:"selectedInGradient",offset:["100%"],stopColors:["rgba(84, 113, 180, 1)"]},selectedOutGradient:{id:"selectedOutGradient",offset:["100%"],stopColors:["rgba(255, 185, 10, 1)"]}},filter:{dropShadow:{id:"dropShadow",in:"SourceGraphic",stdDeviation:3,dxOffset:1,dyOffset:2}},transition:{duration:1000,delay:500}},selected:{},axis:{translation:{x:8,y:"height"},xAxis:{hide:!1,tickPadding:10,minimizedPadding:{top:22,bottom:15}},yAxis:{hide:!0,x:0,y:30}}};return options},getBarChartOptionsDesktop:function(){var options={screen:{ratio_medium:1.17,ratio_large:1.3},margin:{top:22,bottom:0},drawLabels:!0,rectangles:{height:13,width:730,color:"rgba(169, 167, 167, 1)",paddingTop:-28,paddingBottom:10,seriesPadding:3,borderRadius:{rx:6,ry:6},gradients:{selectedGradient:{id:"selectedGradient",offset:["0%","100%"],stopColors:["#6888d2","#536fb1"]}},filter:{dropShadow:{id:"dropShadow",in:"SourceGraphic",stdDeviation:3,dxOffset:1,dyOffset:2}}},labels:{minWidth:100,},selected:{},axis:{xAxis:{hide:!0},yAxis:{hide:!1,paddingRight:27,transValue:-20}}};return options},getMultiVerticalPaletteDesktop:function(){return['rgba(215, 215, 215, 1)','rgba(183, 183, 183, 1)']},getMultiVerticalLabelsPaletteDesktop:function(){return['rgba(0, 0, 0, 1)','rgba(115, 114, 114, 1)']},getDotsLineGraphPalette:function(){return['rgba(46, 115, 255, 1)']},getAccountSelectorPalette:function(){return['image1','image2','image3','image4','image5','image6']},getAccountSelectorConfig:function getAccountSelectorConfig(){var config={showArrows:!0,minAccountsForDisplayingArrows:2,enableInfiniteCarousel:!0,showIndexDots:!0,nextArrowDir:"ltr",allAnimation:{type:"fadingSlidingOut",}}
return config},getAccountSelectorConfigDesktop:function getAccountSelectorConfigDesktop(){var config={showArrows:!0,minAccountsForDisplayingArrows:4,enableInfiniteCarousel:!0,showIndexDots:!0,nextArrowDir:"rtl",allAnimation:{type:"heapCards",cardsStackTotalHeight:43,maxSpaceBetweenCards:14,showBoxShadowForLastCardOnly:!1,}}
return config},getCollapseBlockHeight:function getCollapseBlockHeight(blockType){switch(blockType){case "account-selector":return 120;break;case "bar-chart":case "pin-graph":case "pie-chart":return 70;break;default:return 70}}});Personetics.story.skinController=Personetics.story.ProductSkinControler;Personetics.story.getTablesFormat=function(){return{"table-perso-txlist1":{"columns":["accountNumber","transaction","date","amount"],"displayColumns":{"date":{"format":"MM/DD/YY","type":"date"},"amount":{"format":"###,###.00","type":"amount"}}},"table-perso-txlist2":{"columns":["transaction","date","amount"],"displayColumns":{"date":{"format":"MM/DD/YY","type":"date"},"amount":{"format":"###,###.00","type":"amount"}}},"table-perso-txlist3":{"columns":["accountNumber","transaction","date","amount","date","balance"],"displayColumns":{"date":{"format":"MM/DD/YY","type":"date"},"amount":{"format":"###,###.00","type":"amount"},"balance":{"format":"###,###.00","type":"amount"}}},"table-perso-txlist4":{"columns":["date","transaction","amount"],"displayColumns":{"date":{"format":"MM/DD/YY","type":"date"},"amount":{"format":"###,###.00","type":"amount"}}},"table-perso-txlist5":{"columns":["date","transaction","amount","balance"],"displayColumns":{"date":{"format":"MM/DD/YY","type":"date"},"amount":{"format":"###,###.00","type":"amount"},"balance":{"format":"###,###.00","type":"amount"}}},"table-perso-txlist6":{"columns":["date","transaction","amount"],"displayColumns":{"date":{"format":"MM/DD/YY","type":"date"},"amount":{"format":"###,###.00","type":"amount"}}},"table-default":{"displayColumns":{"date":{"format":"MM/DD/YY","type":"date"},"amount":{"format":"###,###.00","type":"amount"}}},}}})(window,window.Personetics=window.Personetics||{},jQuery);(function(window,Personetics,$,undefined){Personetics.story=Personetics.story||{};Personetics.story.CITISkinControler=Personetics.story.ProductSkinControler.extend({registerWidgets:function(){Personetics.story.ProductSkinControler.prototype.registerWidgets.call(this);Personetics.UI.PWidgetFactory.registerWidget("ratings",Personetics.UI.PRatingCtrlCITI,"CITI ratings");Personetics.UI.PWidgetFactory.registerWidget("loading-animation",Personetics.UI.PLoadingAnimationCtrlCITI,"CITI loading");Personetics.UI.PWidgetFactory.registerWidget("story-widget",Personetics.UI.PStoryWidgetCtrlCITI,"CITI story widget")},registerBlocks:function(){Personetics.story.ProductSkinControler.prototype.registerBlocks.call(this);this.registerBlock("account-selector",{widthMode:"desktop",blockClass:Personetics.story.AccountSelectorBlockCITIDesktop});this.registerBlock("pie-chart",{blockClass:Personetics.story.PieChartBlockCiti});this.registerBlock("bar-chart",{widthMode:"desktop",blockClass:Personetics.story.D3BarChartBlockCiti});this.registerBlock("pin-graph",{widthMode:"desktop",blockClass:Personetics.story.D3PinGraphChartBlockDesktopCITI});this.registerChartHelper("verticalHelper",{helperClass:Personetics.utils.d3Helpers.VerticalChartHelperCiti});this.registerChartHelper("pinGraphHelper",{helperClass:Personetics.utils.d3Helpers.PinGraphChartHelperCiti});this.registerChartHelper("multiVerticalHelper",{widthMode:"desktop",helperClass:Personetics.utils.d3Helpers.MultiVerticalChartHelperDesktop});this.registerChartHelper("multiVerticalHelper",{helperClass:Personetics.utils.d3Helpers.MultiVerticalChartHelperCiti})},getColumnChartOptionsDesktop:function(){var options=Personetics.story.ProductSkinControler.prototype.getColumnChartOptionsDesktop.call(this);options.maxBarHeight=165,options.svgHeight=309,options.svgWidth=580,options.labelTop=31,options.barTop=75,options.xAxisTop=251,options.yAxisHeight=199,options.yAxisTop=40,options.rectangles.width=40;options.svgWidth=580;options.rectangles.space=65;options.axis.xAxis.tickPadding=13;options.rectangles.borderRadius.rx=0;options.rectangles.borderRadius.ry=0;options.rectangles.minHeightPercent=0.184;options.rectangles.marginFromBottom=27.5;options.axis.yAxis.y=5;options.axis.xAxis.tickPadding=18;options.labels.drawLabels=!1;return options},getDesktopScreenWidth:function(){return 740},getPinGraphChartOptionsDesktop:function(){var options=Personetics.story.ProductSkinControler.prototype.getPinGraphChartOptionsDesktop.call(this);options.maxBarHeight=165,options.svgHeight=309,options.svgWidth=580,options.labelTop=31,options.barTop=75,options.xAxisTop=251,options.yAxisHeight=199,options.yAxisTop=40,options.rectangles.width=40;options.svgWidth=580;options.rectangles.space=65;options.axis.xAxis.tickPadding=13;options.rectangles.borderRadius.rx=0;options.rectangles.borderRadius.ry=0;options.rectangles.minHeightPercent=0.184;options.rectangles.marginFromBottom=27.5;options.axis.xAxis.tickPadding=18;options.labels.drawLabels=!1;return options},getColumnChartMultiSeriesOptionsDesktop:function(){var options=Personetics.story.ProductSkinControler.prototype.getColumnChartMultiSeriesOptionsDesktop.call(this);options.svgHeight=309,options.svgWidth=580,options.maxBarHeight=122,options.barTop=118,options.xAxiaTop=251,options.yAxisTop=40,options.yAxisHeight=199,options.drowVerticalLines=!1,options.rectangles.width=20;options.svgWidth=580;options.rectangles.space=60;options.chart.transY=3;options.axis.xAxis.tickPadding=13;options.rectangles.minHeight=0;options.rectangles.borderRadius.rx=0;options.rectangles.borderRadius.ry=0;options.rectangles.paddingRight=40;options.axis.translation.x=12.5;options.labels.drawLabels=!1;return options},getBarChartOptionsDesktop:function(){var options=Personetics.story.ProductSkinControler.prototype.getBarChartOptionsDesktop.call(this);options.rectangles.width=40;options.rectangles.borderRadius.rx=0;options.rectangles.borderRadius.ry=0;options.labels.drawLabels=!1;return options},getPieOptions:function(){var options=Personetics.story.ProductSkinControler.prototype.getPieOptions.call(this);options.arcs.cornerRadius.radiusCorner=0;return options},getPieGraphPalette:function(selectedTabId){var outFlowsPalette=['#cb6015'];var inFlowsPalette=['#0060a7'];if(selectedTabId=="Out")
return outFlowsPalette;return inFlowsPalette},getMultiVerticalPaletteDesktop:function(){return[' rgba(255, 255, 255, 1)','rgba(153, 153, 153, 1)']},getBarGraphPalette:function(){return[' rgba(255, 255, 255, 1)','url(#selectedGradient)']},getAccountSelectorConfigDesktop:function getAccountSelectorConfigDesktop(){var config={showArrows:!0,enableInfiniteCarousel:!0,minAccountsForDisplayingArrows:2,showIndexDots:!0,allAnimation:{type:"heapCards",cardsStackTotalHeight:80,maxSpaceBetweenCards:10,showBoxShadowForLastCardOnly:!1,}}
return config},});Personetics.story.skinController=Personetics.story.CITISkinControler})(window,window.Personetics=window.Personetics||{},jQuery);Personetics.story.getTablesFormat=function(){return{"table-perso-txlist1":{"columns":["accountNumber","transaction","date","amount"],"displayColumns":{"date":{"format":"weekday, MMMMM DD, YY","type":"date"},"amount":{"format":"###,###.00","currencySymbol":"$","type":"amount"}},"isGroup":!0,"groupingField":"date"},"table-default":{"displayColumns":{"date":{"format":"weekday, MMMMM DD,YY","type":"date"},"amount":{"format":"###,###.00","currencySymbol":"$","type":"amount"}}}}};(function(window,Personetics,$,undefined){var Handlebars=Personetics.UI.Handlebars;Personetics.teaser=Personetics.teaser||{};Personetics.teaser.Block=Base.extend({initialize:function(parent,layoutInstructions,defaultConfig){this.parent=parent;this.layoutInstructions=layoutInstructions;var tmplId=this.getHtmlTemplateId(layoutInstructions.class);if(tmplId)
this.template=Handlebars.templates["block-"+tmplId];if(typeof defaultConfig!=="undefined"&&defaultConfig!==null){this.defaultConfig=defaultConfig}},getHtmlTemplateId:function(clazz){throw "No template id defined for block"},initBlock:function(){},handleQueryData:function(data){this.renderData(data);this.bindEvents()},setVisible:function(visible){},beforeRender:function(el,layoutInstructions){this.layoutInstructions=layoutInstructions},render:function(el,layoutInstructions){this.layoutInstructions=this.layoutInstructions||layoutInstructions;this.el=el;var html=this.template(layoutInstructions);el.append(html);this.frameEl=el.find(".pstory-block-frame").last()},renderAgain:function(data){var html=this.template(data);$(this.frameEl).replaceWith(html)},renderData:function(data){},afterRender:function(el){},bindEvents:function(){}})})(window,window.Personetics=window.Personetics||{},jQuery);(function(window,Personetics,$,undefined){Personetics.teaser=Personetics.teaser||{};Personetics.teaser.TextBlock=Personetics.teaser.Block.extend({getHtmlTemplateId:function(clazz){switch(clazz){case "note":case "perso-note":return"txt-note";default:return"txt"}}})})(window,window.Personetics=window.Personetics||{},jQuery);(function(window,Personetics,$,undefined){Personetics.teaser=Personetics.teaser||{};Personetics.teaser.DateBoxBlock=Personetics.teaser.Block.extend({getHtmlTemplateId:function(clazz){return"date-box"}})})(window,window.Personetics=window.Personetics||{},jQuery);(function(window,Personetics,$,undefined){Personetics.teaser=Personetics.teaser||{};Personetics.teaser.D3BarChartBlock=Personetics.teaser.Block.extend({CHART_TYPES:{MultiVertical:"multiVertical",MultiHorizontal:"multiHorizontal",SingleVertical:"vertical",SingleHorizontal:"horizontal"},getHtmlTemplateId:function(clazz){return"bar-chart"},beforeRender:function(el,layoutInstructions,templateId){Personetics.teaser.Block.prototype.beforeRender.call(this,el,layoutInstructions);this.setSelected();this.barsDirection();this.beforeRenderChart(el,templateId)},setSelected:function setSelected(){var block=this;this.hasSelected=!1;$.each(this.layoutInstructions.series,function(i,seriesArray){$.each(seriesArray,function(j,item){if(item.selected==!0){block.hasSelected=!0;return!1}})});if(this.hasSelected==!1){$.each(this.layoutInstructions.series,function(i,seriesArray){if(seriesArray.length>0){seriesArray[seriesArray.length-1].selected=!0}})}},render:function(el,layoutInstructions){this.renderSelectedBar(layoutInstructions);this.renderBlock(el,layoutInstructions)},renderBlock:function(el,layoutInstructions){Personetics.teaser.Block.prototype.render.call(this,el,layoutInstructions);var chartEl=this.frameEl.find(".pstory-bar-chart");if(chartEl.length>0){this.renderBarChart(chartEl,layoutInstructions)}},renderSelectedBar:function(layoutInstructions){},afterRender:function(){$(this.chartEl).addClass(this.layoutInstructions.direction);if(this.chartType==this.CHART_TYPES.MultiHorizontal){this.reverseData()}},barsDirection:function barsDirection(){if(this.layoutInstructions.direction=="vertical"&&Personetics.processor.PStoryConfig.isRtl()){this.barsDirectionRTL()}},barsDirectionRTL:function barsDirectionRTL(){if($.isArray(this.layoutInstructions.categories)){this.layoutInstructions.categories.reverse()}
if($.isArray(this.layoutInstructions.series)){$.each(this.layoutInstructions.series,function(i,series){if($.isArray(series)){series.reverse()}})}},beforeRenderChart:function(el,templateId){var direction=this.layoutInstructions.direction||"vertical";if(this.layoutInstructions.series.length==1&&$.isArray(this.layoutInstructions.series[0]))
this.layoutInstructions.series=this.layoutInstructions.series[0];this.chartType=this.getChartType(direction,this.layoutInstructions.seriesLabels.length>1);this.chartTypeHelper=this.chartType+"Helper";this.initChartHelper(this.chartTypeHelper);if(this.chartType==this.CHART_TYPES.MultiVertical)
this.options=this.defaultConfig.columnChartMultiSeriesOptions;else if(this.chartType==this.CHART_TYPES.MultiHorizontal){this.options=this.defaultConfig.barChartOptions;this.reverseData()}
else if(this.chartType==this.CHART_TYPES.SingleHorizontal)
this.options=this.defaultConfig.singleHorizontalChartOptions;else if(templateId=="verticalBarAndBoxTeaser"){this.options=this.defaultConfig.columnChartAndBoxOptions}
else{this.options=this.defaultConfig.columnChartOptions}
if(this.defaultConfig.hasOwnProperty('desktopScreenWidth')&&this.defaultConfig.desktopScreenWidth!=='undefined'&&this.defaultConfig.desktopScreenWidth!==null){this.options.desktopScreenWidth=this.defaultConfig.desktopScreenWidth}},renderBarChart:function(el,layoutInstructions){var data=layoutInstructions;var handleClickBind=Personetics.bind(this,this.handleClick);if(this.chartType=="multiHorizontal"){this.options.palette=this.defaultConfig.barGraphPalette;this.options.paletteLabels=this.defaultConfig.barGraphLabelsPalette;this.chartHelper.prepareMultiHorizontalChart(this,el);this.chartHelper.renderMultiHorizontalChart(this,el,this.layoutInstructions)}
else{this.chartHelper.prepareChart(data,this.options,handleClickBind);this.chartHelper.renderChart(el)}},reverseData:function reverseData(){this.layoutInstructions.series.reverse();$.each(this.layoutInstructions.series,function(index,item){item.reverse()})},handleClick:function(obj,clickedItemIndex){if(this.hasSelected==!1){return}
if(obj.amount==0)
return;var svg=this.frameEl.find('svg .perso-bar, svg .perso-chart-rect')[clickedItemIndex].className.animVal;if(svg.indexOf("selected")!=-1){return}
var highlightedElements=this.frameEl.find('svg .perso-bar.selected, svg .perso-chart-rect.selected');$.each(highlightedElements,function(i,element){element.className.baseVal=Personetics.utils.string.removeClass(element.className,'selected')});var highlightedLabels=this.frameEl.find('svg .perso-label');$.each(highlightedLabels,function(i,label){label.className.baseVal=Personetics.utils.string.removeClass(label.className,'selected')});var highlightedxAxisLabels=this.frameEl.find('svg .perso-xAxis-label');$.each(highlightedxAxisLabels,function(i,xAxisLabel){xAxisLabel.className.baseVal=Personetics.utils.string.removeClass(xAxisLabel.className,'selected')});if(obj.hasOwnProperty("mode")){var highlightSelectedInElements=this.frameEl.find('svg .perso-bar, svg .perso-chart-rect.In')[clickedItemIndex];var highlightSelectedOutElements=this.frameEl.find('svg .perso-bar, svg .perso-chart-rect.Out')[clickedItemIndex];var highlightSelectedInLabels=this.frameEl.find('svg .perso-label.In')[clickedItemIndex];var highlightSelectedOutLabels=this.frameEl.find('svg .perso-label.Out')[clickedItemIndex];highlightSelectedInElements.className.baseVal=Personetics.utils.string.addClass(highlightSelectedInElements.className,'selected');highlightSelectedOutElements.className.baseVal=Personetics.utils.string.addClass(highlightSelectedOutElements.className,'selected');highlightSelectedInLabels.className.baseVal=Personetics.utils.string.addClass(highlightSelectedInLabels.className,'selected');highlightSelectedOutLabels.className.baseVal=Personetics.utils.string.addClass(highlightSelectedOutLabels.className,'selected')}else{var clickedBar=this.frameEl.find('svg .perso-bar, svg .perso-chart-rect')[clickedItemIndex];var clickedBarLabel=this.frameEl.find('svg .perso-label')[clickedItemIndex];var clickedBarxAxis=this.frameEl.find('svg .perso-xAxis-label')[clickedItemIndex];clickedBar.className.baseVal=Personetics.utils.string.addClass(clickedBar.className,'selected');clickedBarLabel.className.baseVal=Personetics.utils.string.addClass(clickedBarLabel.className,'selected');if(clickedBarxAxis){clickedBarxAxis.className.baseVal=Personetics.utils.string.addClass(clickedBarxAxis.className,'selected')}}
this.parent.notifyEvent(this,"setSelectedValue",obj.category);this.notifyReportEvent(obj.category)},getChartType:function(direction,hasMultiSeries){var type=null;if(direction=="vertical"&&hasMultiSeries){type="multiVertical"}else if(direction=="horizontal"&&hasMultiSeries){type="multiHorizontal"}else if(direction=="vertical"){type="vertical"}
else if(direction=="horizontal"){type="horizontal"}
return type},initChartHelper:function(type){this.chartHelper=Personetics.story.BlockChartFactory.generateHelperClazz(type,{})}})})(window,window.Personetics=window.Personetics||{},jQuery);(function(window,Personetics,$,undefined){var d3=Personetics.persoD3||window.d3;Personetics.teaser=Personetics.teaser||{};Personetics.teaser.PieChartBlock=Personetics.teaser.Block.extend({getHtmlTemplateId:function(clazz){return"pie-chart"},beforeRender:function(el,layoutInstructions){Personetics.teaser.Block.prototype.beforeRender.call(this,el,layoutInstructions);this.options=this.defaultConfig.pieOptions;this.cornerRadiusPie=(typeof this.options.arcs.cornerRadius!="undefined")&&(typeof this.options.arcs.cornerRadius.radiusCorner!="undefined")?this.options.arcs.cornerRadius.radiusCorner:9;this.setTotal(layoutInstructions);this.colors=d3.scale.ordinal().range(this.defaultConfig.pieGraphPalette());this.grayscaleId="grayscale_"+ +new Date()},pie:function(){var block=this;var totalAmount=block.totalAmountInt||0;var normalizedValue=totalAmount*0.05;return d3.layout.pie().padAngle(-0.015).value(function(d){var value=d.value+normalizedValue;return value})},setTotal:function setTotal(layoutInstructions){var totalFromSrc=layoutInstructions.centerText;this.totalText=totalFromSrc;if(layoutInstructions.hasOwnProperty('slices')&&layoutInstructions.slices.length>0){var totalAmountObj=layoutInstructions.slices.reduce(function(total,slice){return{value:total.value+slice.value}});this.totalAmountInt=totalAmountObj.value}
else{this.totalAmountInt=0}},getGraphPalette:function(){return this.defaultConfig.pieGraphPalette},render:function(el,layoutInstructions){Personetics.teaser.Block.prototype.render.call(this,el,layoutInstructions);this.frameEl=el.find('.pstory-block-frame').last();var chartEl=this.frameEl.find(".pstory-pie-chart");if(chartEl.length>0){this.renderPieChart(chartEl,layoutInstructions)}},renderPieChart:function(el,layoutInstructions){var block=this;this.setPieSize();d3.selection.prototype.moveToFront=function(){return this.each(function(){var gparent=this.parentNode;gparent.parentNode.appendChild(gparent)})};block.arc=d3.svg.arc().innerRadius(block.innerRadius).outerRadius(block.outerRadius);block.arcOver=d3.svg.arc().innerRadius(block.innerRadiusOver).outerRadius(block.outerRadiusOver);this.renderPieBase(el);this.renderShadowFilter(block);this.renderPie(el,layoutInstructions)},setPieSize:function setPieSize(percents){if(percents)
var percents=percents;else var percents={heightPercent:0.7,innerRadiusPercent:0.17,outerRadiusPercent:0.2,innerRadiusOverPercent:0.165,outerRadiusOverPercent:0.22}
this.margin={top:0,right:19,bottom:0,left:19};this.width=this.frameEl.find('.pstory-pie-chart').width();this.height=this.width*percents.heightPercent;this.radius=this.width/2.3;var calculatedInnerRadiusRatio=percents.innerRadiusPercent*this.width;var calculatedOuterRadiusRatio=percents.outerRadiusPercent*this.width;var calculatedInnerRadiusOverRatio=percents.innerRadiusOverPercent*this.width;var calculatedOuterRadiusOverRatio=percents.outerRadiusOverPercent*this.width;this.innerRadius=this.radius-calculatedInnerRadiusRatio;this.outerRadius=this.radius-calculatedOuterRadiusRatio;this.innerRadiusOver=this.radius-calculatedInnerRadiusOverRatio;this.outerRadiusOver=this.radius-calculatedOuterRadiusOverRatio},renderPieBase:function renderPieBase(el){this.svg=this.renderPieSvgBase(el)},renderPieSvgBase:function(el){var block=this;if(el){return(d3.select(el.get(0)).append("svg").attr("focusable",!1).attr("width",block.width).attr("height",block.height).append("g").attr("transform","translate("+block.width/2+","+block.height/2+")"))}},renderPie:function(el,layoutInstructions){this.renderArcs(layoutInstructions);this.renderPieTitle(this.totalText)},renderArcs:function(layoutInstructions){var block=this;var arcs=block.svg.selectAll(".arc").data(block.pie()(layoutInstructions.slices)).enter().append("g").attr("class","perso-arc");arcs.append("path").attr("d",block.arc).attr("class",function(d){var clazz="";if(d.data.highlight){clazz+="perso-selected"}
return clazz}).style("fill",function(d,i){return block.colors(i)}).on("click",function(obj,clickedItemIndex){if(!obj.data.hasOwnProperty("highlight")){block.onPieItemClick(obj,clickedItemIndex,this)}})},renderTicks:function(block,layoutInstructions){if(block){var ticks=block.svg.append('g').attr('class','perso-ticks').selectAll("line").data(block.pie()(layoutInstructions)).enter().append("line");ticks.attr('class','perso-tick').attr("x1",0).attr("x2",0).attr("y1",-block.radius*.8).attr("y2",-block.radius*.9).attr("stroke","gray").attr("transform",function(d){return"rotate("+(d.startAngle+d.endAngle)/2*(180/Math.PI)+")"})}},renderPieLabels:function(block,layoutInstructions){if(block){var labels=block.svg.append('g').attr('class','perso-pie-labels').attr("transform","translate(8,0)").selectAll("text").data(block.pie()(layoutInstructions)).enter().append("text");labels.attr("class","perso-pie-label").attr("transform",function(d){var dist=block.radius+20;var angle=(d.startAngle+d.endAngle)/2;var x=dist*Math.sin(angle);var y=-dist*Math.cos(angle);return"translate("+x+","+y+")"}).attr("dy","-0.5em").attr("text-anchor","middle").text(function(d){return d.data.category}).call(block.wrapLabelText,screen.width*.28)}},renderPieTitle:function(totalText){this.svg.append('text').attr('class','perso-total-txt').attr('text-anchor','middle').attr('dy','.25em').style('font-size',this.options.centerText.fontSize).style('font-weight',this.options.centerText.fontWeight).text(totalText)},renderPieAmount:function(totalAmount){this.svg.append('text').attr('class','perso-total-amount').attr('dy','.9em').text(totalAmount)},onPieItemClick:function(obj,clickedItemIndex,clickedItem){var block=this;var oldSelectedArc=$('.perso-arc path.perso-selected');if(oldSelectedArc.length){oldSelectedArc[0].className.baseVal=Personetics.utils.string.removeClass(oldSelectedArc[0].className,'perso-selected')}
var oldSelectedArcLabel=this.frameEl.find('.pstory-pie-chart svg .perso-pie-label.selected');if(oldSelectedArcLabel.length){oldSelectedArcLabel[0].className.baseVal=Personetics.utils.string.removeClass(oldSelectedArcLabel[0].className,'selected')}
d3.select(clickedItem).attr("class","perso-selected");var pstoryLabels=this.frameEl.find('.pstory-pie-chart svg .perso-pie-label');if(typeof pstoryLabels!='undefined'&&pstoryLabels.length>clickedItemIndex){var clickedArcLabel=pstoryLabels[clickedItemIndex];clickedArcLabel.className.baseVal=Personetics.utils.string.addClass(clickedArcLabel.className,'selected')}
this.handleClick(obj,clickedItemIndex)},renderShadowFilter:function(block){var filters=block.options.arcs.filter;var svgWithFilters=block.svg;if(filters){$.each(filters,function(i,filter){if(filter){var filterSvg=svgWithFilters.append("filter").attr("id",filter.id);filterSvg.append("feGaussianBlur").attr("in",filter.in).attr("stdDeviation",filter.stdDeviation);filterSvg.append("feOffset").attr("dx",filter.dxOffset).attr("dy",filter.dyOffset);var feMerge=filterSvg.append("feMerge");feMerge.append("feMergeNode");feMerge.append("feMergeNode").attr("in",filter.in)}})}},handleClick:function(obj,clickedItemIndex){var dataObj=obj;if(dataObj.data){dataObj=dataObj.data}
this.parent.notifyEvent(this,"setSelectedValue",dataObj.category)},getSelectedPathIndex:function(paths){var pathIndex=0;if(paths.length){$.each(paths,function(i,path){if(path.className.baseVal=='perso-selected'){pathIndex=i;return!1}})}
return pathIndex},wrapLabelText:function(text,width){text.each(function(){var text=d3.select(this),words=text.text().split(/\s+/).reverse(),word,line=[],lineNumber=0,lineHeight=.95,y=text.attr("y"),dy=parseFloat(text.attr("dy")),tspan=text.text(null).append("tspan").attr("x",0).attr("y",y).attr("dy",dy+"em");while(word=words.pop()){line.push(word);tspan.text(line.join(" "));if(tspan.node().getComputedTextLength()>width){line.pop();tspan.text(line.join(" "));line=[word];tspan=text.append("tspan").attr("x",0).attr("y",y).attr("dy",(++lineNumber*lineHeight*1.5)+dy+"em").text(word)}}
if(lineNumber==1){}})}})})(window,window.Personetics=window.Personetics||{},jQuery);(function(window,Personetics,$,undefined){Personetics.teaser=Personetics.teaser||{};Personetics.teaser.D3PinGraphChartBlock=Personetics.teaser.D3BarChartBlock.extend({getHtmlTemplateId:function(clazz){return"pinGraph-chart"},render:function(el,layoutInstructions){Personetics.teaser.D3BarChartBlock.prototype.renderSelectedBar.call(this,layoutInstructions);this.renderBlock(el,layoutInstructions)},renderBlock:function(el,layoutInstructions){Personetics.teaser.Block.prototype.render.call(this,el,layoutInstructions);var chartEl=this.frameEl.find(".pstory-pinGraph-chart");if(chartEl.length>0){this.renderBarChart(chartEl,layoutInstructions)}},renderBarChart:function(el,data){this.chartHelper.prepareChart(data,this.options);this.chartHelper.renderChart(el)},beforeRenderChart:function(el,layoutInstructions){if(this.layoutInstructions.series.length==1&&$.isArray(this.layoutInstructions.series[0]))
this.layoutInstructions.series=this.layoutInstructions.series[0];this.chartType=this.getChartType();this.chartTypeHelper=(this.chartType+"Helper");this.initChartHelper(this.chartTypeHelper);this.options=this.defaultConfig.pinGraphChartOptions;if(this.defaultConfig.hasOwnProperty('desktopScreenWidth')&&this.defaultConfig.desktopScreenWidth!=='undefined'&&this.defaultConfig.desktopScreenWidth!==null){this.options.desktopScreenWidth=this.defaultConfig.desktopScreenWidth}},getChartType:function(){var type='pinGraph';return type}})})(window,window.Personetics=window.Personetics||{},jQuery);(function(window,Personetics,$,undefined){Personetics.teaser=Personetics.teaser||{};Personetics.teaser.PBlockFactory=new function(){this.types={"TYPE_CONTAINER":"layout"};this.blockFactoryMap={};this.index="0";this.registerBlock=function(type,config){var entry=this.blockFactoryMap[type];if(config.blockClass){if(!entry){entry={type:type,class:{},widthModes:{}};this.blockFactoryMap[type]=entry}
if(config.class){entry.class[config.class]=config.blockClass}
else if(config.widthMode){entry.widthModes[config.widthMode]=config.blockClass}
else{entry.blockClass=config.blockClass}}
if(config.hasOwnProperty("defaultConfig")){entry.defaultConfig=config.defaultConfig}};this.createBlock=function(parent,layoutInstructions,story){var block;var blockClass;var storyCfg=story?story.cfg:null;var type=layoutInstructions.type;if(type==this.types.TYPE_CONTAINER){blockClass=Personetics.teaser.LayoutBlock;layoutInstructions.layoutId="layout-"+this.index;this.index++}
else{var cClass=storyCfg?layoutInstructions.class||storyCfg.chartsLibClass:null;var widthMode=storyCfg?storyCfg.widthMode:null;var entry=this.blockFactoryMap[type];if(entry){if(widthMode){blockClass=entry.widthModes[widthMode]}
if(cClass){blockClass=entry.class[cClass]}
if(!blockClass)
blockClass=entry.blockClass}
if(!blockClass){blockClass=Personetics.teaser.Block;Personetics.log("Invalid block type '"+type+"'")}}
block=new blockClass(parent,layoutInstructions,entry.defaultConfig);return block}}})(window,window.Personetics=window.Personetics||{},jQuery);(function(window,Personetics,$,undefined){var d3=Personetics.persoD3||window.d3;Personetics.teaser=Personetics.teaser||{};Personetics.teaser.PieChartBlockProduct=Personetics.teaser.PieChartBlock.extend({beforeRender:function beforeRender(el,layoutInstructions){Personetics.teaser.PieChartBlock.prototype.beforeRender.call(this,el,layoutInstructions);var previousDialogs=el.parents('.pstory-dialog-frame').prev('.pstory-dialog-frame');var tabsBlock=previousDialogs.find('.pstory-block-tabs');var selectedTab=tabsBlock.find('.pstory-button.selected');var selectedTabId=selectedTab.attr("pstory-id");this.colors=d3.scale.ordinal().range(this.getGraphPalette(selectedTabId))},getGraphPalette:function(selectedTabId){return this.defaultConfig.pieGraphPalette(selectedTabId)},renderPieBase:function renderPieBase(el){Personetics.teaser.PieChartBlock.prototype.renderPieBase.call(this,el);this.renderGrayFilter()},renderGrayFilter:function renderGrayFilter(){this.svg.append("filter").attr("id",this.grayscaleId).append("feColorMatrix").attr("type","matrix").attr("values","0.3333 0.3333 0.3333 0 0 0.3333 0.3333 0.3333 0 0 0.3333 0.3333 0.3333 0 0 0 0 0 1 0")},renderArcs:function(layoutInstructions){Personetics.teaser.PieChartBlock.prototype.renderArcs.call(this,layoutInstructions);var arcs=this.frameEl.find('.pstory-pie-chart svg .perso-arc path');var grayscaleId=this.grayscaleId;$.each(arcs,function(i,arc){d3.select(arc).style("filter","url(#"+grayscaleId+")")})},afterRender:function(el){var block=this;block.arcPaths=block.frameEl.find('.pstory-pie-chart svg .perso-arc path');var defaultPath=this.frameEl.find('.pstory-pie-chart svg .perso-arc path.perso-selected')[0];var defaultPathIndex=this.getSelectedPathIndex(block.arcPaths);d3.select(defaultPath).attr("d",block.arcOver.cornerRadius(block.cornerRadiusPie)).style("filter","").style("fill",function(d,i){return block.colors(defaultPathIndex)});d3.select(defaultPath).moveToFront();var selected=this.layoutInstructions.slices[this.getSelectedPathIndex(block.arcPaths)];block.updatePieInfoValues(selected);if(this.layoutInstructions.slices.length>1){this.frameEl.find('.pstory-pie-data .pstory-arrow').show()}
else{this.frameEl.find('.pstory-pie-data .pstory-arrow').hide()}
block.highlightCenterText(block.colors(defaultPathIndex))},bindEvents:function(){var block=this;var $nextArrow=this.frameEl.find('.pstory-next-arrow');var $previousArrow=this.frameEl.find('.pstory-previous-arrow');var $paths=block.arcPaths;$nextArrow.bind('click',function(e){if(block.frameEl.hasClass('perso-minimized')){return}
var currentItemIndex=block.getSelectedPathIndex($paths);if(currentItemIndex==($paths.length-1)){block.moveArcs(0);block.handleClick(block.layoutInstructions.slices[0],0)}else{block.moveArcs(++currentItemIndex);block.handleClick(block.layoutInstructions.slices[currentItemIndex],currentItemIndex)}});$previousArrow.bind('click',function(e){if(block.frameEl.hasClass('perso-minimized')){return}
var currentItemIndex=block.getSelectedPathIndex($paths);if(currentItemIndex==0){block.moveArcs($paths.length-1);block.handleClick(block.layoutInstructions.slices[$paths.length-1],$paths.length-1)}else{block.moveArcs(--currentItemIndex);block.handleClick(block.layoutInstructions.slices[currentItemIndex],currentItemIndex)}})},onPieItemClick:function onPieItemClick(obj,clickedItemIndex,clickedItem){var block=this;var oldSelectedArc=$('.perso-arc path.perso-selected');var grayscaleId=this.grayscaleId;if(oldSelectedArc.length){oldSelectedArc[0].className.baseVal=Personetics.utils.string.removeClass(oldSelectedArc[0].className,'perso-selected');d3.select(oldSelectedArc[0]).attr("d",block.arc).style("filter","url(#"+grayscaleId+")")}
d3.select(clickedItem).attr("d",block.arcOver.cornerRadius(block.cornerRadiusPie)).attr("class","perso-selected").style("filter","").style("fill",function(d,i){return block.colors(i)});d3.select(clickedItem).moveToFront();this.handleClick(obj,clickedItemIndex);this.updatePieInfoValues(obj.data)},updatePieInfoValues:function(obj){if(this.options.showInfoContainer){var block=this;if(obj){var amountDiv='<div class="pstory-pie-amount"><span>'+obj.label+'</span></div>';var categoryDiv='<div class="pstory-pie-category"><span>'+obj.category+'</span></div>';var $infoContainer=this.frameEl.find('.pstory-pie-info');$infoContainer.empty();$infoContainer.append(amountDiv);$infoContainer.append(categoryDiv);$('.pstory-pie-amount').css('color',block.colors(obj.category))}}},moveArcs:function(index){var block=this
var path=block.arcPaths[index];var oldSelectedArc=$('.perso-arc path.perso-selected');var grayscaleId=this.grayscaleId;if(path){d3.select('.perso-arc path.perso-selected').attr("d",block.arc).style("filter","url(#"+grayscaleId+")")
oldSelectedArc[0].className.baseVal=Personetics.utils.string.removeClass(oldSelectedArc[0].className,'perso-selected');d3.select(path).attr("d",block.arcOver.cornerRadius(block.cornerRadiusPie)).attr("class","perso-selected").style("filter","").style("fill",function(d,i){return block.colors(i)});d3.select(path).moveToFront();block.updatePieInfoValues(block.layoutInstructions.slices[index])}},highlightCenterText:function(color){var block=this;var centerTextElem=block.frameEl.find('.perso-total-txt')[0];d3.select(centerTextElem).style('fill',color)},doScrollEvent:function(){this.minimized=typeof this.minimized!='undefined'?this.minimized:{};var heightPrevFixedElements=0;var prevMinimized=$('.perso-minimized:not(.pstory-block-pie-chart)').last().find('.pstory-block-container');if(prevMinimized.length>0){var prevMinimizedTop=prevMinimized.offset().top;var prevMinimizedHeight=parseFloat(prevMinimized.outerHeight(!0));heightPrevFixedElements=prevMinimizedTop+prevMinimizedHeight}
this.minimized.heightPrevFixedElements=heightPrevFixedElements;this.minimized.prevMinimized=prevMinimized;this.minimized.elementDisplayed=this.frameEl.find('.pstory-pie-data');var offsetElement=this.minimized.elementDisplayed.offset();if(typeof this.minimized.isMinimized!='undefined'&&this.minimized.isMinimized==!0&&this.frameEl.offset().top+15>=this.minimized.topFixedContainer){this.minimized.isMinimized=!1;this.unMinimized()}
else if(offsetElement.top<=this.minimized.heightPrevFixedElements){if(typeof this.minimized.isMinimized=='undefined'||this.minimized.isMinimized==!1){this.minimized.isMinimized=!0;this.doMinimized()}}},doMinimized:function(){var fixedContainer=this.frameEl.find('.pstory-block-container');var marginRight=this.frameEl.css('margin-right');var marginLeft=this.frameEl.css('margin-left');fixedContainer.css({'padding-right':marginRight,'padding-left':marginLeft});this.frameEl.height(this.frameEl.outerHeight());var elementHeight=this.minimized.elementDisplayed.outerHeight();var topFixedContainer=elementHeight-fixedContainer.outerHeight()+this.minimized.heightPrevFixedElements;this.minimized.topFixedContainer=topFixedContainer;fixedContainer.css({'top':topFixedContainer+'px'});var zIndex=999;var prevMinimized=this.minimized.prevMinimized;if(prevMinimized.length>0)
zIndex=prevMinimized.css('z-index')-1;fixedContainer.css({'z-index':zIndex});this.frameEl.removeClass('perso-unMinimized');this.frameEl.addClass('perso-minimized')},unMinimized:function(){this.frameEl.removeClass('perso-minimized');this.frameEl.addClass('perso-unMinimized')}})})(window,window.Personetics=window.Personetics||{},jQuery);(function(window,Personetics,$,undefined){var Handlebars=Personetics.UI.Handlebars;var SkinSetup=function SkinSetup(){};SkinSetup.prototype.init=function registerBlocks(){this.registerDefaultBlocks();this.registerDefaultChartHeplers();this.registerPartialTemplates()};SkinSetup.prototype.registerBlock=function(type,config){Personetics.teaser.PBlockFactory.registerBlock(type,config)};SkinSetup.prototype.registerChartHelper=function(name,clazz){Personetics.story.BlockChartFactory.registerChartHelper(name,clazz)};SkinSetup.prototype.registerPartialTemplates=function registerPartialTemplates(){var me=this;var partialTemplates=this.getPartialTemplates();partialTemplates.forEach(function(partial){var partialTemplate=Handlebars.templates[partial.id];if(typeof partialTemplate!=="undefined"&&partialTemplate!==null)
Handlebars.registerPartial(partial.name,partialTemplate)})};SkinSetup.prototype.getPartialTemplates=function getPartialTemplates(){return[{"name":"teaserWrapperPartial","id":"teaserWrapperPartial"},{"name":"teaserHeader","id":"teaserHeader"}]};SkinSetup.prototype.registerDefaultBlocks=function registerDefaultBlocks(type){this.registerBlock("txt",{blockClass:Personetics.teaser.TextBlock});this.registerBlock("text",{blockClass:Personetics.teaser.TextBlock});this.registerBlock("date-box",{blockClass:Personetics.teaser.DateBoxBlock});this.registerBlock("image",{blockClass:Personetics.teaser.ImageBlock});this.registerBlock("bar-chart",{blockClass:Personetics.teaser.D3BarChartBlock,defaultConfig:{columnChartOptions:{desktopScreenWidth:740,svgHeight:124,svgWidth:300,maxBarHeight:62,barTop:20,xAxisTop:93,yAxisHeight:82,horizontalLineWidth:0,horizontalLineLeft:0,screen:{ratio_medium:1.17,ratio_large:1.3},margin:{top:43,bottom:40},height:180,chart:{transX:0,transY:10},labels:{drawLabels:!1,marginBottom:18,marginTop:4.5},rectangles:{width:5,space:60,minHeightPercent:0.15,borderRadius:{rx:0,ry:0},marginFromBottom:15,marginFromLeft:2,gradients:[{id:"selectedGradient",offset:["0%","100%"],stopColors:["#6888d2","#536fb1"]}],filter:{dropShadow:{id:"dropShadow",in:"SourceGraphic",stdDeviation:3,dxOffset:1,dyOffset:2}},transition:{duration:1000,delay:500}},selected:{},axis:{translation:{x:0,y:"height"},xAxis:{hide:!1,collapsedPadding:{top:22,bottom:0}},yAxis:{x:0,y:0,hide:!0}}},columnChartAndBoxOptions:{maxBarHeight:62,desktopScreenWidth:740,svgHeight:124,svgWidth:235,barTop:20,xAxisTop:94,screen:{ratio_medium:1.17,ratio_large:1.3},margin:{top:43,bottom:40},height:180,chart:{transX:0,transY:10},labels:{drawLabels:!1,marginBottom:18,marginTop:-10},rectangles:{width:5,space:40,borderRadius:{rx:0,ry:0},marginFromBottom:15,marginFromLeft:0,gradients:[{id:"selectedGradient",offset:["0%","100%"],stopColors:["#6888d2","#536fb1"]}],filter:{dropShadow:{id:"dropShadow",in:"SourceGraphic",stdDeviation:3,dxOffset:1,dyOffset:2}},transition:{duration:1000,delay:500}},selected:{},axis:{xAxis:{hide:!1}}},columnChartMultiSeriesOptions:{svgWidth:340,screen:{ratio_medium:1.17,ratio_large:1.3},margin:{top:0,right:24,bottom:0,left:24},totalHeight:101,labels:{drawLabels:!0,marginTop:-16,marginBottom:4,right:3},rectangles:{width:5,paddingTop:30,paddingLeft:-19,paddingRight:22,paddingBottom:33,seriesPadding:12.5,transX:4,minHeight:0.15,borderRadius:{rx:0,ry:0},marginFromBottom:5,gradients:{selectedInGradient:{id:"selectedInGradient",offset:["0%","100%"],stopColors:["rgba(5, 109, 174, 1)","rgba(5, 109, 174, 1)"]},selectedOutGradient:{id:"selectedOutGradient",offset:["0%","100%"],stopColors:["rgba(203, 96, 21, 1)","rgba(203, 96, 21, 1)"]}},filter:{dropShadow:{id:"dropShadow",in:"SourceGraphic",stdDeviation:3,dxOffset:1,dyOffset:2}},transition:{duration:1000,delay:500}},selected:{},axis:{translation:{x:2.5,y:"height"},xAxis:{hide:!1,tickPadding:10,width:1,minimizedPadding:{top:22,bottom:15}},yAxis:{hide:!0}}},barChartOptions:{chartHeight:102,svgWidth:340,screen:{ratio_medium:1.17,ratio_large:1.3},margin:{top:19,right:20,bottom:0,left:20},drawLabels:!1,rectangles:{height:4,color:"rgba(169, 167, 167, 1)",paddingTop:-18,paddingLeft:21,paddingBottom:5,seriesPadding:4,barFillPercent:0.85,borderRadius:{rx:0,ry:0},gradients:{selectedInGradient:{id:"selectedInGradient",offset1:"0%",offset2:"100%",stopColor1:"rgba(5, 109, 174, 1)",stopColor2:"rgba(5, 109, 174, 1)",offset:["0%","100%"],stopColors:["rgba(5, 109, 174, 1)","rgba(5, 109, 174, 1)"]},selectedOutGradient:{id:"selectedOutGradient",offset1:"0%",offset2:"100%",stopColor1:"rgba(203, 96, 21, 1)",stopColor2:"rgba(203, 96, 21, 1)"}},filter:{dropShadow:{id:"dropShadow",in:"SourceGraphic",stdDeviation:3,dxOffset:1,dyOffset:2}}},labels:{paddingLeft:40,minWidth:100},selected:{},axis:{xAxis:{hide:!0},yAxis:{hide:!1,paddingRight:30,transValue:-20}}},singleHorizontalChartOptions:{chartHeight:100,svgWidth:340,screen:{ratio_medium:1.17,ratio_large:1.3},margin:{top:10,right:12,bottom:12,left:5},drawLabels:!1,rectangles:{height:7,color:"rgba(169, 167, 167, 1)",borderRadius:{rx:4,ry:4},groupMargins:{top:-3.5,left:35},gradients:{selectedGradient:{id:"selectedGradient",offset:["0%","100%"],stopColors:["#6888d2","#536fb1"]}},filter:{dropShadow:{id:"dropShadow",in:"SourceGraphic",stdDeviation:3,dxOffset:1,dyOffset:2}}},labels:{paddingLeft:40,minWidth:100},selected:{},axis:{xAxis:{hide:!0},yAxis:{hide:!1}}},barGraphPalette:['url(#selectedOutGradient)','url(#selectedInGradient)'],barGraphLabelsPalette:['rgba(40, 36, 37, 1)','rgba(84, 113, 180, 1)'],multiVerticalPalette:['url(#selectedGradient)','rgba(215, 215, 215, 1)'],multiVerticalLabelsPalette:['rgba(147, 145, 149, 1)','rgba(40, 36, 37, 1)'],columnGraphPalette:['#5D68C2','#3B49B6','#1729AF','#111F88','#08176C'],barChartMultiSeriesLabels:function(labels){return function(){if(labels&&labels.length>0){var label=labels[this.series.index];return("<span class='"+this.series.name+"'>"+label+"</span>")}
else{return""}}}}});this.registerBlock("pie-chart",{blockClass:Personetics.teaser.PieChartBlockCiti,defaultConfig:{pieGraphPalette:function(selectedTabId){return['#056dae']},pieOptions:{arcs:{filter:{dropShadow:{id:"dropShadow",in:"SourceGraphic",stdDeviation:3,dxOffset:1,dyOffset:2}},cornerRadius:{radiusCorner:0},padAngle:-0.02},centerText:{fontSize:12,fontWeight:700,color:'white'},showInfoContainer:!1},renderGrayFilter:function renderGrayFilter(){this.svg.append("filter").attr("id",this.grayscaleId).append("feColorMatrix").attr("type","matrix").attr("values","0 1 0 1 0 0 0.623 0 1 0 0 0.345 0 1 0 0 1 0 1 0 ")},}});this.registerBlock("pin-chart",{blockClass:Personetics.teaser.D3PinGraphChartBlock,defaultConfig:{pinGraphChartOptions:{desktopScreenWidth:740,maxBarHeight:46,svgHeight:124,barTop:20,xAxisTop:68,svgWidth:300,screen:{ratio_medium:1.17,ratio_large:1.3},margin:{top:35,right:20,bottom:40,left:15},height:102,chart:{transX:0,transY:0},totalHeight:102,labels:{drawLabels:!1,marginBottom:18,marginTop:4.5,marginRight:5},rectangles:{minHeightPercent:0.15,width:5,space:60,borderRadius:{rx:0,ry:0},marginFromBottom:10,marginFromLeft:0,gradients:{selectedGradient:{id:"selectedGradient",offset:["0%","100%"],stopColors:["rgba(5, 109, 174, 1)","rgba(5, 109, 174, 1)"]}},filter:{dropShadow:{id:"dropShadow",in:"SourceGraphic",stdDeviation:3,dxOffset:1,dyOffset:2}},transition:{duration:1000,delay:500}},selected:{},axis:{translation:{x:0,y:"height"},xAxis:{hide:!1,tickPadding:15,width:1,minimizedPadding:{top:22,bottom:15,fontSize:12,fontWeight:300,color:'#A94F48'},fontSize:12,fontWeight:700,color:'white'},yAxis:{hide:!0,x:0,y:0,fontSize:0,fontWeight:0,color:'#000'}}}}});this.registerBlock("pin-graph",{blockClass:Personetics.teaser.D3PinGraphChartBlock,defaultConfig:{pinGraphChartOptions:{screen:{ratio_medium:1.17,ratio_large:1.3},margin:{top:35,right:20,bottom:40,left:15},height:102,chart:{transX:0,transY:0},totalHeight:102,labels:{drawLabels:!1,marginBottom:18,marginTop:4.5,marginRight:5},rectangles:{minHeightPercent:0.15,width:8,borderRadius:{rx:3,ry:3},marginFromBottom:10,marginFromLeft:0,gradients:{selectedGradient:{id:"selectedGradient",offset:["0%","100%"],stopColors:["#6888d2","#536fb1"]}},filter:{dropShadow:{id:"dropShadow",in:"SourceGraphic",stdDeviation:3,dxOffset:1,dyOffset:2}},transition:{duration:1000,delay:500}},selected:{},axis:{translation:{x:0,y:"height"},xAxis:{hide:!1,tickPadding:8,width:1,minimizedPadding:{top:22,bottom:15,fontSize:12,fontWeight:300,color:'#A94F48'},fontSize:12,fontWeight:300,color:'#000'},yAxis:{hide:!0,x:0,y:0,fontSize:0,fontWeight:0,color:'#000'}}}}});this.registerBlock("h-box",{blockClass:Personetics.teaser.HBoxBlock})};SkinSetup.prototype.registerDefaultChartHeplers=function registerDefaultChartHeplers(){this.registerChartHelper("verticalHelper",{helperClass:Personetics.utils.d3Helpers.VerticalChartHelperCiti});this.registerChartHelper("horizontalHelper",{helperClass:Personetics.utils.d3Helpers.HorizontalChartHelper});this.registerChartHelper("multiVerticalHelper",{helperClass:Personetics.utils.d3Helpers.MultiVerticalChartHelper});this.registerChartHelper("multiHorizontalHelper",{helperClass:Personetics.utils.d3Helpers.MultiHorizontalChartHelper});this.registerChartHelper("pinGraphHelper",{helperClass:Personetics.utils.d3Helpers.PinGraphChartHelperCiti});Personetics.story.BlockChartFactory.registerChartHelper("lineChartHelper",{helperClass:Personetics.utils.d3Helpers.LineChartHelper})};SkinSetup.prototype.registerTemplates=function registerTemplates(){var loader=new HandlebarTemplateLoader("../skins/vanilla/templates/");loader.load("simpleText","simple-teaser");loader.load("image","image-teaser");loader.load("verticalBar","bar-teaser");loader.load("multiVerticalBar","bar-teaser");loader.load("horizontalBarAndBox","compare-box-teaser");loader.load("pinChart","bar-teaser");loader.load("pie","pies-teaser");loader.load("textAndButton","buttons-teaser");loader.load("imageAndBox","image-box-teaser");loader.load("verticalBarAndBox","bar-box-teaser");loader.load("doubleBox","double-box-teaser");loader.load("horizontalBar","bar-teaser");loader.loadPartial("teaserHeader","teaser-header-partial");loader.loadPartial("teaserWrapperPartial","teaser-wrapper-partial")};window.SkinSetup=SkinSetup})(window,window.Personetics=window.Personetics||{},jQuery);(function(window,Personetics,$,undefined){Personetics.teaser=Personetics.teaser||{};Personetics.teaser.PieChartBlockCiti=Personetics.teaser.PieChartBlockProduct.extend({highlightCenterText:function(){var block=this;var centerTextElem=block.frameEl.find('.perso-total-txt')[0];d3.select(centerTextElem).style('fill',this.options.centerText.color)},renderGrayFilter:function renderGrayFilter(){this.svg.append("filter").attr("id",this.grayscaleId).append("feColorMatrix").attr("type","matrix").attr("values","0 1 0 1 0 0 0.623 0 1 0 0 0.345 0 1 0 0 1 0 1 0 ")},setPieSize:function setPieSize(){var percents={heightPercent:1.2,}
this.margin={top:0,right:19,bottom:0,left:19};this.width=this.frameEl.find('.pstory-pie-chart').width();this.height=this.width*percents.heightPercent;this.radius=this.width/2.3;this.innerRadius=66/2;this.outerRadius=56/2;this.innerRadiusOver=84/2;this.outerRadiusOver=56/2},renderPieSvgBase:function(el){var block=this;block.height=124;if(el){return(d3.select(el.get(0)).append("svg").attr("width",block.width).attr("height",block.height).append("g").attr("transform","translate("+block.width/2+","+block.height/2+")"))}}})})(window,window.Personetics=window.Personetics||{},jQuery);(function(window,Personetics,$,undefined){Personetics.teaser=Personetics.teaser||{};Personetics.teaser.VerticalChartHelperCiti=Personetics.utils.d3Helpers.VerticalChartHelper.extend({})})(window,window.Personetics=window.Personetics||{},jQuery);(function(window,Personetics,$,undefined){Personetics.utils=Personetics.utils||{};Personetics.teaser.PinGraphChartHelperCiti=Personetics.utils.d3Helpers.VerticalChartHelperCiti.extend({renderXAxis:function(data,block){var helper=this;if(this.xAxis){this.svg.append("g").attr("class","x axis").attr("transform",function(d,i){var x=0;var y=helper.yScale(0);if(helper.minValue<0){y=helper.maxPositiveBarHeight+helper.getValueByScreenWidth(10)}
if(helper.options.axis.translation.x){x=helper.options.axis.translation.x}
return("translate("+x+","+y+")")}).call(helper.xAxis).selectAll(".tick text").data(data.series).attr("class",function(d){var clazz="perso-xAxis-label";if(d.selected||d.highlight){clazz+=" selected"}
return clazz}).call(helper.wrapLabelText).on("click",function(obj,clickedItemIndex){if(block)
block.handleClick(obj,clickedItemIndex)}).style('fill',helper.options.axis.xAxis.color).style('font-size',helper.options.axis.xAxis.fontSize).style('font-weight',helper.options.axis.xAxis.fontWeight)}}})})(window,window.Personetics=window.Personetics||{},jQuery)